---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Konto Bestätigung & Kenn Wort Wiederherstellung-C#ASP.net Identity ()-ASP.NET 4. x
author: HaoK
description: Vor der Durchführung dieses Tutorials sollten Sie zunächst Erstellen einer Secure ASP.NET MVC 5-Web-App mit Anmeldung, e-Mail-Bestätigung und Kenn Wort Zurücksetzung Fertigstellen. Dieses Tutorial...
ms.author: riande
ms.date: 01/23/2019
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 4b2c88280df39aa81d60f9508910e8fe5d6db6b8
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78499983"
---
# <a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="7010a-104">Konto Bestätigung und Kenn Wort Wiederherstellung mitC#ASP.net Identity ()</span><span class="sxs-lookup"><span data-stu-id="7010a-104">Account confirmation and password recovery with ASP.NET Identity (C#)</span></span>

> <span data-ttu-id="7010a-105">Vor der Durchführung dieses Tutorials sollten Sie zunächst [Erstellen einer Secure ASP.NET MVC 5-Web-App mit Anmeldung, e-Mail-Bestätigung und Kenn Wort](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)Zurücksetzung Fertigstellen.</span><span class="sxs-lookup"><span data-stu-id="7010a-105">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="7010a-106">Dieses Tutorial enthält weitere Details und zeigt Ihnen, wie Sie e-Mail für die lokale Konto Bestätigung einrichten und Benutzern ermöglichen, Ihr vergessenes Kennwort in ASP.net Identity zurückzusetzen.</span><span class="sxs-lookup"><span data-stu-id="7010a-106">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span>

<span data-ttu-id="7010a-107">Ein lokales Benutzerkonto erfordert, dass der Benutzer ein Kennwort für das Konto erstellt, und dieses Kennwort wird (sicher) in der Web-App gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7010a-107">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="7010a-108">ASP.net Identity unterstützt auch Konten für soziale Netzwerke, die nicht erfordern, dass der Benutzer ein Kennwort für die App erstellt.</span><span class="sxs-lookup"><span data-stu-id="7010a-108">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="7010a-109">[Konten für soziale](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Netzwerke verwenden einen Drittanbieter (z. b. Google, Twitter, Facebook oder Microsoft), um Benutzer zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="7010a-109">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook, or Microsoft) to authenticate users.</span></span> <span data-ttu-id="7010a-110">In diesem Thema werden folgende Themen behandelt:</span><span class="sxs-lookup"><span data-stu-id="7010a-110">This topic covers the following:</span></span>

- <span data-ttu-id="7010a-111">[Erstellen Sie eine ASP.NET MVC-App](#createMvc) , und entdecken Sie ASP.net Identity Features.</span><span class="sxs-lookup"><span data-stu-id="7010a-111">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="7010a-112">Erstellen des Identitäts Beispiels</span><span class="sxs-lookup"><span data-stu-id="7010a-112">Build the Identity sample</span></span>](#build)
- [<span data-ttu-id="7010a-113">E-Mail-Bestätigung einrichten</span><span class="sxs-lookup"><span data-stu-id="7010a-113">Set up email confirmation</span></span>](#email)

<span data-ttu-id="7010a-114">Neue Benutzer registrieren Ihren e-Mail-Alias, mit dem ein lokales Konto erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="7010a-114">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="7010a-115">Wenn Sie die Schaltfläche registrieren auswählen, wird eine Bestätigungs-e-Mail mit einem Überprüfungs Token an Ihre e-Mail</span><span class="sxs-lookup"><span data-stu-id="7010a-115">Selecting the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="7010a-116">Dem Benutzer wird eine e-Mail mit einem Bestätigungs Token für sein Konto gesendet.</span><span class="sxs-lookup"><span data-stu-id="7010a-116">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="7010a-117">Wenn Sie den Link auswählen, wird das Konto bestätigt.</span><span class="sxs-lookup"><span data-stu-id="7010a-117">Selecting the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="7010a-118">Kenn Wort Wiederherstellung/zurück Setzung</span><span class="sxs-lookup"><span data-stu-id="7010a-118">Password recovery/reset</span></span>

<span data-ttu-id="7010a-119">Lokale Benutzer, die Ihr Kennwort vergessen haben, können ein Sicherheits Token an Ihr e-Mail-Konto senden, sodass Sie Ihr Kennwort zurücksetzen können.</span><span class="sxs-lookup"><span data-stu-id="7010a-119">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="7010a-120">Der Benutzer erhält in Kürze eine e-Mail mit einem Link, über den die Benutzer sein Kennwort zurücksetzen können.</span><span class="sxs-lookup"><span data-stu-id="7010a-120">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="7010a-121">Wenn Sie den Link auswählen, gelangen Sie auf die Seite zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="7010a-121">Selecting the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="7010a-122">Durch Auswählen der Schaltfläche **Zurücksetzen** wird bestätigt, dass das Kennwort zurückgesetzt wurde.</span><span class="sxs-lookup"><span data-stu-id="7010a-122">Selecting the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="7010a-123">Erstellen einer ASP.NET-Web-App</span><span class="sxs-lookup"><span data-stu-id="7010a-123">Create an ASP.NET web app</span></span>

<span data-ttu-id="7010a-124">Beginnen Sie mit der Installation und Ausführung von [Visual Studio 2017](https://visualstudio.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="7010a-124">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/).</span></span>

1. <span data-ttu-id="7010a-125">Erstellen Sie ein neues ASP.NET-Webprojekt, und wählen Sie die MVC-Vorlage aus.</span><span class="sxs-lookup"><span data-stu-id="7010a-125">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="7010a-126">Web Forms auch ASP.net Identity unterstützen, sodass Sie ähnliche Schritte in einer Web Forms-app ausführen könnten.</span><span class="sxs-lookup"><span data-stu-id="7010a-126">Web Forms also support ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="7010a-127">Ändern Sie die Authentifizierung in **einzelne Benutzerkonten**.</span><span class="sxs-lookup"><span data-stu-id="7010a-127">Change the authentication to **Individual User Accounts**.</span></span>
3. <span data-ttu-id="7010a-128">Führen Sie die APP aus, wählen Sie den Link **registrieren** aus, und registrieren Sie einen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="7010a-128">Run the app, select the **Register** link and register a user.</span></span> <span data-ttu-id="7010a-129">An diesem Punkt wird nur die e-Mail-Überprüfung mit dem [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) -Attribut durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="7010a-129">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="7010a-130">Navigieren Sie in Server-Explorer zu **Daten connections\defaultconnection\tables\aspnettusers**, klicken Sie mit der rechten Maustaste, und wählen Sie **Tabellendefinition öffnen**aus.</span><span class="sxs-lookup"><span data-stu-id="7010a-130">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right-click and select **Open table definition**.</span></span>

    <span data-ttu-id="7010a-131">Die folgende Abbildung zeigt das `AspNetUsers` Schema:</span><span class="sxs-lookup"><span data-stu-id="7010a-131">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="7010a-132">Klicken Sie mit der rechten Maustaste auf die **aspnettusers** -Tabelle, und wählen Sie **Tabellendaten anzeigen**aus.</span><span class="sxs-lookup"><span data-stu-id="7010a-132">Right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="7010a-133">An diesem Punkt wurde die e-Mail nicht bestätigt.</span><span class="sxs-lookup"><span data-stu-id="7010a-133">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="7010a-134">Der Standarddaten Speicher für ASP.net Identity ist Entity Framework, Sie können ihn jedoch so konfigurieren, dass er andere Datenspeicher verwendet und zusätzliche Felder hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="7010a-134">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="7010a-135">Weitere Informationen finden Sie im Abschnitt [Weitere Ressourcen](#addRes) am Ende dieses Tutorials.</span><span class="sxs-lookup"><span data-stu-id="7010a-135">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="7010a-136">Die [owin-Startklasse](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) wird aufgerufen, wenn die APP gestartet wird, und ruft die `ConfigureAuth`-Methode in *App\_Start\Startup.auth.cs*auf, die die owin-Pipeline konfiguriert und ASP.net Identity initialisiert.</span><span class="sxs-lookup"><span data-stu-id="7010a-136">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="7010a-137">Untersuchen Sie die Methode `ConfigureAuth`.</span><span class="sxs-lookup"><span data-stu-id="7010a-137">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="7010a-138">Jeder `CreatePerOwinContext` Aufruf registriert einen Rückruf (gespeichert im `OwinContext`), der einmal pro Anforderung aufgerufen wird, um eine Instanz des angegebenen Typs zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="7010a-138">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="7010a-139">Sie können einen Haltepunkt im Konstruktor und `Create` Methode jedes Typs (`ApplicationDbContext, ApplicationUserManager`) festlegen und überprüfen, ob Sie für jede Anforderung aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-139">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="7010a-140">Eine Instanz von `ApplicationDbContext` und `ApplicationUserManager` wird im owin-Kontext gespeichert, auf den in der gesamten Anwendung zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="7010a-140">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="7010a-141">ASP.net Identity in die owin-Pipeline über Cookie-Middleware.</span><span class="sxs-lookup"><span data-stu-id="7010a-141">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="7010a-142">Weitere Informationen finden Sie unter [pro Verwaltung der Anforderungs Lebensdauer für die usermanager-Klasse in ASP.net Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="7010a-142">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="7010a-143">Wenn Sie Ihr Sicherheitsprofil ändern, wird ein neuer Sicherheits Stempel generiert und im Feld "`SecurityStamp`" der Tabelle " *aspnettusers* " gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7010a-143">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="7010a-144">Beachten Sie, dass sich das `SecurityStamp` Feld von dem Sicherheits Cookie unterscheidet.</span><span class="sxs-lookup"><span data-stu-id="7010a-144">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="7010a-145">Das Sicherheits Cookie wird nicht in der `AspNetUsers` Tabelle (oder an einer anderen Stelle in der Identitätsdatenbank) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7010a-145">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="7010a-146">Das sicherheitstokentoken wird mithilfe von [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) selbst signiert und mit den `UserId, SecurityStamp`-und Ablaufzeit Informationen erstellt.</span><span class="sxs-lookup"><span data-stu-id="7010a-146">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="7010a-147">Die Cookie-Middleware überprüft das Cookie für jede Anforderung.</span><span class="sxs-lookup"><span data-stu-id="7010a-147">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="7010a-148">Die `SecurityStampValidator`-Methode in der `Startup`-Klasse trifft auf die Datenbank und überprüft den Sicherheits Stempel in regelmäßigen Abständen, wie im `validateInterval`angegeben.</span><span class="sxs-lookup"><span data-stu-id="7010a-148">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="7010a-149">Dies geschieht nur alle 30 Minuten (in unserem Beispiel), es sei denn, Sie ändern das Sicherheitsprofil.</span><span class="sxs-lookup"><span data-stu-id="7010a-149">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="7010a-150">Das Intervall von 30 Minuten wurde gewählt, um die Fahrten zur Datenbank zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="7010a-150">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="7010a-151">Weitere Informationen finden Sie im [Tutorial zur zweistufigen Authentifizierung](index.md) .</span><span class="sxs-lookup"><span data-stu-id="7010a-151">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="7010a-152">Gemäß den Kommentaren im Code unterstützt die `UseCookieAuthentication`-Methode die Cookie-Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="7010a-152">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="7010a-153">Das Feld "`SecurityStamp`" und der zugehörige Code stellen eine zusätzliche Sicherheitsebene für Ihre APP bereit. Wenn Sie Ihr Kennwort ändern, werden Sie von dem Browser, mit dem Sie sich angemeldet haben, abgemeldet.</span><span class="sxs-lookup"><span data-stu-id="7010a-153">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="7010a-154">Die `SecurityStampValidator.OnValidateIdentity`-Methode ermöglicht der APP, das Sicherheits Token zu validieren, wenn sich der Benutzer anmeldet. dieser wird verwendet, wenn Sie ein Kennwort ändern oder den externen Anmelde Namen verwenden.</span><span class="sxs-lookup"><span data-stu-id="7010a-154">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="7010a-155">Dies ist erforderlich, um sicherzustellen, dass alle mit dem alten Kennwort generierten Token (Cookies) für ungültig erklärt werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-155">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="7010a-156">Wenn Sie im Beispiel Projekt das Benutzer Kennwort ändern, wird ein neues Token für den Benutzer generiert, vorherige Token werden für ungültig erklärt, und das `SecurityStamp` Feld wird aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="7010a-156">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="7010a-157">Mit dem Identitätssystem können Sie Ihre APP so konfigurieren, dass sich das Sicherheitsprofil des Benutzers ändert (z. b. wenn der Benutzer sein Kennwort ändert oder die zugehörige Anmeldung ändert (z. b. von Facebook, Google, Microsoft-Konto usw.), dass der Benutzer von allen Benutzern abgemeldet wird. Browser Instanzen.</span><span class="sxs-lookup"><span data-stu-id="7010a-157">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="7010a-158">Die folgende Abbildung zeigt beispielsweise die Beispiel-App für [einmaliges Anmelden](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) , mit der der Benutzer sich von allen Browser Instanzen (in diesem Fall IE, Firefox und Chrome) abmelden kann, indem er eine Schaltfläche auswählt.</span><span class="sxs-lookup"><span data-stu-id="7010a-158">For example, the image below shows the [Single signout sample](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by selecting one button.</span></span> <span data-ttu-id="7010a-159">Alternativ können Sie mit dem Beispiel nur von einer bestimmten Browser Instanz abmelden.</span><span class="sxs-lookup"><span data-stu-id="7010a-159">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="7010a-160">Die Beispiel-App für [einmaliges Anmelden](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) zeigt, wie Sie mit ASP.net Identity das Sicherheits Token erneut generieren können.</span><span class="sxs-lookup"><span data-stu-id="7010a-160">The [Single signout sample](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SingleSignOutSample) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="7010a-161">Dies ist erforderlich, um sicherzustellen, dass alle mit dem alten Kennwort generierten Token (Cookies) für ungültig erklärt werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-161">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="7010a-162">Diese Funktion bietet eine zusätzliche Sicherheitsebene für Ihre Anwendung. Wenn Sie Ihr Kennwort ändern, werden Sie abgemeldet, wo Sie sich bei dieser Anwendung angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="7010a-162">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="7010a-163">Die *App\_start\identityconfig.cs* -Datei enthält die Klassen `ApplicationUserManager`, `EmailService` und `SmsService`.</span><span class="sxs-lookup"><span data-stu-id="7010a-163">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="7010a-164">Die Klassen `EmailService` und `SmsService` implementieren jeweils die `IIdentityMessageService`-Schnittstelle, sodass Sie in jeder Klasse allgemeine Methoden zum Konfigurieren von e-Mail und SMS haben.</span><span class="sxs-lookup"><span data-stu-id="7010a-164">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="7010a-165">Obwohl in diesem Tutorial nur das Hinzufügen von e-Mail-Benachrichtigungen über [sendgrid](http://sendgrid.com/)veranschaulicht wird, können Sie e-Mails mithilfe von SMTP und anderen Mechanismen senden.</span><span class="sxs-lookup"><span data-stu-id="7010a-165">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="7010a-166">Die `Startup`-Klasse enthält auch die kesselplatte zum Hinzufügen von Anmeldungen für soziale Netzwerke (Facebook, Twitter usw.). Weitere Informationen finden Sie unter My Tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) .</span><span class="sxs-lookup"><span data-stu-id="7010a-166">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="7010a-167">Überprüfen Sie die `ApplicationUserManager`-Klasse, die die Benutzer Identitätsinformationen enthält, und konfigurieren Sie die folgenden Funktionen:</span><span class="sxs-lookup"><span data-stu-id="7010a-167">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="7010a-168">Anforderungen an die Kenn Wort Stärke.</span><span class="sxs-lookup"><span data-stu-id="7010a-168">Password strength requirements.</span></span>
- <span data-ttu-id="7010a-169">Benutzer Sperre (Versuche und Uhrzeit).</span><span class="sxs-lookup"><span data-stu-id="7010a-169">User lock out (attempts and time).</span></span>
- <span data-ttu-id="7010a-170">Zweistufige Authentifizierung (2FA).</span><span class="sxs-lookup"><span data-stu-id="7010a-170">Two-factor authentication (2FA).</span></span> <span data-ttu-id="7010a-171">Ich werde 2FA und SMS in einem anderen Tutorial behandeln.</span><span class="sxs-lookup"><span data-stu-id="7010a-171">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="7010a-172">Einbinden der e-Mail-und SMS-Dienste</span><span class="sxs-lookup"><span data-stu-id="7010a-172">Hooking up the email and SMS services.</span></span> <span data-ttu-id="7010a-173">(Ich werde SMS in einem anderen Tutorial behandeln).</span><span class="sxs-lookup"><span data-stu-id="7010a-173">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="7010a-174">Die `ApplicationUserManager`-Klasse wird von der generischen `UserManager<ApplicationUser>`-Klasse abgeleitet.</span><span class="sxs-lookup"><span data-stu-id="7010a-174">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="7010a-175">`ApplicationUser` von [identityuser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx)abgeleitet.</span><span class="sxs-lookup"><span data-stu-id="7010a-175">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="7010a-176">`IdentityUser` abgeleitet von der generischen `IdentityUser` Klasse:</span><span class="sxs-lookup"><span data-stu-id="7010a-176">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="7010a-177">Die oben aufgeführten Eigenschaften stimmen mit den Eigenschaften in der `AspNetUsers` Tabelle überein.</span><span class="sxs-lookup"><span data-stu-id="7010a-177">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="7010a-178">Generische Argumente für `IUser` ermöglichen das Ableiten einer Klasse mit unterschiedlichen Typen für den Primärschlüssel.</span><span class="sxs-lookup"><span data-stu-id="7010a-178">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="7010a-179">Weitere Informationen zum Ändern des Primärschlüssels von der Zeichenfolge in "int" oder "GUID" finden Sie im Beispiel " [changepk](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/ChangePK) ".</span><span class="sxs-lookup"><span data-stu-id="7010a-179">See the [ChangePK](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/ChangePK) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="7010a-180">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="7010a-180">ApplicationUser</span></span>

<span data-ttu-id="7010a-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) ist in " *models\identitymodels.cs* " wie folgt definiert:</span><span class="sxs-lookup"><span data-stu-id="7010a-181">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="7010a-182">Der oben markierte Code generiert eine " [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx)".</span><span class="sxs-lookup"><span data-stu-id="7010a-182">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="7010a-183">ASP.net Identity-und owin-Cookieauthentifizierung sind Anspruchs basiert. Daher erfordert das Framework, dass die APP eine `ClaimsIdentity` für den Benutzer generiert.</span><span class="sxs-lookup"><span data-stu-id="7010a-183">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="7010a-184">`ClaimsIdentity` enthält Informationen über alle Ansprüche für den Benutzer, z. b. den Namen des Benutzers, das Alter und die Rollen, denen der Benutzer angehört.</span><span class="sxs-lookup"><span data-stu-id="7010a-184">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="7010a-185">Sie können in dieser Phase auch weitere Ansprüche für den Benutzer hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7010a-185">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="7010a-186">Die owin-`AuthenticationManager.SignIn` Methode übergibt die `ClaimsIdentity` und signiert den Benutzer:</span><span class="sxs-lookup"><span data-stu-id="7010a-186">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="7010a-187">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on (Anmelden von MVC 5](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) ) zeigt, wie Sie der `ApplicationUser`-Klasse zusätzliche Eigenschaften hinzufügen können.</span><span class="sxs-lookup"><span data-stu-id="7010a-187">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="7010a-188">Bestätigung per e-Mail</span><span class="sxs-lookup"><span data-stu-id="7010a-188">Email confirmation</span></span>

<span data-ttu-id="7010a-189">Es empfiehlt sich, die e-Mail zu bestätigen, bei der ein neuer Benutzer registriert ist, um sicherzustellen, dass die Identität eines anderen Benutzers nicht angenommen wird (d. h., Sie haben sich nicht bei einer anderen e-Mail registriert).</span><span class="sxs-lookup"><span data-stu-id="7010a-189">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="7010a-190">Angenommen, Sie hatten ein Diskussionsforum, Sie sollten verhindern, dass sich `"bob@example.com"` als `"joe@contoso.com"`registrieren.</span><span class="sxs-lookup"><span data-stu-id="7010a-190">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="7010a-191">Ohne e-Mail-Bestätigung können `"joe@contoso.com"` unerwünschte e-Mails von Ihrer APP erhalten.</span><span class="sxs-lookup"><span data-stu-id="7010a-191">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="7010a-192">Wenn Bob versehentlich als `"bib@example.com"` registriert ist und es nicht bemerkt hat, wäre er nicht in der Lage, die Kenn Wort Wiederherstellung zu verwenden, da die APP nicht über die richtige e-Mail verfügt.</span><span class="sxs-lookup"><span data-stu-id="7010a-192">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="7010a-193">E-Mail-Bestätigung bietet nur eingeschränkten Schutz vor Bots und bietet keinen Schutz vor ermittelten Spammern. Sie verfügen über viele funktionierende e-Mail-Aliase, die Sie zum Registrieren verwenden können. Im folgenden Beispiel kann der Benutzer sein Kennwort erst ändern, wenn das zugehörige Konto bestätigt wurde (indem er einen Bestätigungslink für das e-Mail-Konto ausgewählt hat, bei dem er registriert wurde). Sie können diesen Workflow auf andere Szenarien anwenden, z. b. das Senden eines Links zum bestätigen und Zurücksetzen des Kennworts für neue Konten, die vom Administrator erstellt wurden, und dem Benutzer eine e-Mail senden, wenn er das Profil geändert hat.</span><span class="sxs-lookup"><span data-stu-id="7010a-193">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them selecting a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="7010a-194">In der Regel möchten Sie, dass neue Benutzerdaten auf Ihrer Website veröffentlichen, bevor Sie per e-Mail, SMS-SMS oder einem anderen Mechanismus bestätigt wurden.</span><span class="sxs-lookup"><span data-stu-id="7010a-194">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="build-a-more-complete-sample"></a><span data-ttu-id="7010a-195">Erstellen Sie ein ausführlichere Beispiel</span><span class="sxs-lookup"><span data-stu-id="7010a-195">Build a more complete sample</span></span>

<span data-ttu-id="7010a-196">In diesem Abschnitt verwenden Sie nuget, um ein ausführeres Beispiel herunterzuladen, mit dem wir arbeiten werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-196">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="7010a-197">Erstellen Sie ein neues ***leeres*** ASP.NET-Webprojekt.</span><span class="sxs-lookup"><span data-stu-id="7010a-197">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="7010a-198">Geben Sie in der Paket-Manager-Konsole die folgenden Befehle ein:</span><span class="sxs-lookup"><span data-stu-id="7010a-198">In the Package Manager Console, enter the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="7010a-199">In diesem Tutorial verwenden wir [sendgrid](http://sendgrid.com/) , um e-Mails zu senden.</span><span class="sxs-lookup"><span data-stu-id="7010a-199">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="7010a-200">Das `Identity.Samples` Paket installiert den Code, mit dem wir arbeiten werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-200">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="7010a-201">Legen Sie fest, dass das [Projekt SSL verwendet](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="7010a-201">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="7010a-202">Testen Sie die Erstellung des lokalen Kontos, indem Sie die app ausführen, den Link **registrieren** auswählen und das Registrierungsformular veröffentlichen.</span><span class="sxs-lookup"><span data-stu-id="7010a-202">Test local account creation by running the app, selecting the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="7010a-203">Wählen Sie den Link für eine e-Mail aus, der die e-Mail-Bestätigung simuliert.</span><span class="sxs-lookup"><span data-stu-id="7010a-203">Select the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="7010a-204">Entfernen Sie den Bestätigungscode für den e-Mail-Link aus dem Beispiel (der `ViewBag.Link` Code im Konto Controller.</span><span class="sxs-lookup"><span data-stu-id="7010a-204">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="7010a-205">Weitere Informationen finden Sie in den `DisplayEmail`-und `ForgotPasswordConfirmation` Aktionsmethoden und Razor-Ansichten).</span><span class="sxs-lookup"><span data-stu-id="7010a-205">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!WARNING]
> <span data-ttu-id="7010a-206">Wenn Sie die Sicherheitseinstellungen in diesem Beispiel ändern, müssen die Produktions-apps eine Sicherheitsüberprüfung durchlaufen, die explizit die vorgenommenen Änderungen aufruft.</span><span class="sxs-lookup"><span data-stu-id="7010a-206">If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>

## <a name="examine-the-code-in-app_startidentityconfigcs"></a><span data-ttu-id="7010a-207">Untersuchen Sie den Code in App\_start\identityconfig.cs</span><span class="sxs-lookup"><span data-stu-id="7010a-207">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="7010a-208">Das Beispiel zeigt, wie Sie ein Konto erstellen und es der *Administrator* Rolle hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7010a-208">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="7010a-209">Sie sollten die e-Mail im Beispiel durch die e-Mail ersetzen, die Sie für das Administrator Konto verwenden.</span><span class="sxs-lookup"><span data-stu-id="7010a-209">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="7010a-210">Die einfachste Möglichkeit zum Erstellen eines Administrator Kontos ist in der `Seed`-Methode Programm gesteuert.</span><span class="sxs-lookup"><span data-stu-id="7010a-210">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="7010a-211">Wir hoffen, dass Sie in Zukunft über ein Tool verfügen, das Ihnen das Erstellen und Verwalten von Benutzern und Rollen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="7010a-211">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="7010a-212">Mit dem Beispielcode können Sie Benutzer und Rollen erstellen und verwalten. Sie müssen jedoch zunächst über ein Administrator Konto verfügen, um die SeitenRollen und Benutzer Administrator ausführen zu können.</span><span class="sxs-lookup"><span data-stu-id="7010a-212">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="7010a-213">In diesem Beispiel wird das Administrator Konto beim Seeding der Datenbank erstellt.</span><span class="sxs-lookup"><span data-stu-id="7010a-213">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="7010a-214">Ändern Sie das Kennwort, und ändern Sie den Namen in ein Konto, in dem Sie e-Mail-Benachrichtigungen erhalten</span><span class="sxs-lookup"><span data-stu-id="7010a-214">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="7010a-215">Sicherheit: Speichern Sie vertrauliche Daten niemals in Ihrem Quellcode.</span><span class="sxs-lookup"><span data-stu-id="7010a-215">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="7010a-216">Wie bereits erwähnt, fügt der `app.CreatePerOwinContext` Aufruf in der Startup-Klasse Rückrufe zur `Create`-Methode der Klassen "App DB Content", "User Manager" und "Role Manager" hinzu.</span><span class="sxs-lookup"><span data-stu-id="7010a-216">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="7010a-217">Die owin-Pipeline Ruft die `Create`-Methode für diese Klassen für jede Anforderung auf und speichert den Kontext für jede Klasse.</span><span class="sxs-lookup"><span data-stu-id="7010a-217">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="7010a-218">Der Konto Controller macht den Benutzer-Manager aus dem HTTP-Kontext (der den owin-Kontext enthält) verfügbar:</span><span class="sxs-lookup"><span data-stu-id="7010a-218">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="7010a-219">Wenn ein Benutzer ein lokales Konto registriert, wird die `HTTP Post Register`-Methode aufgerufen:</span><span class="sxs-lookup"><span data-stu-id="7010a-219">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="7010a-220">Der obige Code verwendet die Modelldaten zum Erstellen eines neuen Benutzerkontos mithilfe der eingegebenen e-Mail-Adresse und des eingegebenen Kennworts.</span><span class="sxs-lookup"><span data-stu-id="7010a-220">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="7010a-221">Wenn sich der e-Mail-Alias im Datenspeicher befindet, schlägt die Kontoerstellung fehl, und das Formular wird erneut angezeigt.</span><span class="sxs-lookup"><span data-stu-id="7010a-221">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="7010a-222">Die `GenerateEmailConfirmationTokenAsync`-Methode erstellt ein sicheres Bestätigungs Token und speichert es im ASP.net Identity Datenspeicher.</span><span class="sxs-lookup"><span data-stu-id="7010a-222">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="7010a-223">Die [URL. Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) -Methode erstellt einen Link, der die `UserId` und das Bestätigungs Token enthält.</span><span class="sxs-lookup"><span data-stu-id="7010a-223">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="7010a-224">Dieser Link wird dann per e-Mail an den Benutzer gesendet, der Benutzer kann den Link in der e-Mail-App auswählen, um sein Konto zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="7010a-224">This link is then emailed to the user, the user can select on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="7010a-225">E-Mail-Bestätigung einrichten</span><span class="sxs-lookup"><span data-stu-id="7010a-225">Set up email confirmation</span></span>

<span data-ttu-id="7010a-226">Wechseln Sie zur [Azure sendgrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) -Registrierungsseite, und registrieren Sie sich für ein kostenloses Konto.</span><span class="sxs-lookup"><span data-stu-id="7010a-226">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="7010a-227">Fügen Sie zum Konfigurieren von sendgrid Code ähnlich dem folgenden hinzu:</span><span class="sxs-lookup"><span data-stu-id="7010a-227">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="7010a-228">E-Mail-Clients akzeptieren häufig nur Textnachrichten (kein HTML-Format).</span><span class="sxs-lookup"><span data-stu-id="7010a-228">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="7010a-229">Sie sollten die Nachricht in Text und HTML bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="7010a-229">You should provide the message in text and HTML.</span></span> <span data-ttu-id="7010a-230">Im obigen sendgrid-Beispiel erfolgt dies mit dem oben gezeigten `myMessage.Text`-und `myMessage.Html` Code.</span><span class="sxs-lookup"><span data-stu-id="7010a-230">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>

<span data-ttu-id="7010a-231">Der folgende Code zeigt, wie Sie e-Mails mithilfe der [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) -Klasse senden, wobei `message.Body` nur den Link zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="7010a-231">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="7010a-232">Sicherheit: Speichern Sie vertrauliche Daten niemals in Ihrem Quellcode.</span><span class="sxs-lookup"><span data-stu-id="7010a-232">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="7010a-233">Das Konto und die Anmelde Informationen werden in der appSetting gespeichert.</span><span class="sxs-lookup"><span data-stu-id="7010a-233">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="7010a-234">In Azure können diese Werte auf der Registerkarte **[Konfigurieren](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** des Azure-Portal sicher gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="7010a-234">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="7010a-235">Weitere Informationen finden [Sie unter Bewährte Methoden für die Bereitstellung von Kenn Wörtern und anderen sensiblen Daten für ASP.net und Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md)</span><span class="sxs-lookup"><span data-stu-id="7010a-235">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>

<span data-ttu-id="7010a-236">Geben Sie Ihre sendgrid-Anmelde Informationen ein, führen Sie die APP aus, und registrieren Sie sich mit einem e-Mail-Alias</span><span class="sxs-lookup"><span data-stu-id="7010a-236">Enter your SendGrid credentials, run the app, register with an email alias can select the confirm link in your email.</span></span> <span data-ttu-id="7010a-237">Informationen dazu, wie Sie dies mit Ihrem [Outlook.com](http://outlook.com) -e-Mail-Konto durchführen, finden Sie in der SMTP-Konfiguration von John Tors [ C# für Outlook.com SMTP-Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) und im[ASP.net Identity 2,0: Einrichten der Konto Validierung und der zweistufigen Autorisierungs](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) Beiträge.</span><span class="sxs-lookup"><span data-stu-id="7010a-237">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="7010a-238">Nachdem ein Benutzer die Schaltfläche **registrieren** ausgewählt hat, wird eine Bestätigungs-e-Mail mit einem Überprüfungs Token an seine e-Mail-Adresse gesendet</span><span class="sxs-lookup"><span data-stu-id="7010a-238">Once a user selects the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="7010a-239">Dem Benutzer wird eine e-Mail mit einem Bestätigungs Token für sein Konto gesendet.</span><span class="sxs-lookup"><span data-stu-id="7010a-239">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="7010a-240">Untersuchen des Codes</span><span class="sxs-lookup"><span data-stu-id="7010a-240">Examine the code</span></span>

<span data-ttu-id="7010a-241">Der folgende Code veranschaulicht die `POST ForgotPassword`-Methode.</span><span class="sxs-lookup"><span data-stu-id="7010a-241">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="7010a-242">Die Methode schlägt im Hintergrund fehl, wenn die Benutzer-e-Mail nicht bestätigt wurde.</span><span class="sxs-lookup"><span data-stu-id="7010a-242">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="7010a-243">Wenn ein Fehler für eine ungültige e-Mail-Adresse gepostet wurde, können böswillige Benutzer diese Informationen verwenden, um gültige UserID (e-Mail-Aliase) für Angriffe zu suchen.</span><span class="sxs-lookup"><span data-stu-id="7010a-243">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="7010a-244">Der folgende Code zeigt die `ConfirmEmail` Methode im Konto Controller, die aufgerufen wird, wenn der Benutzer den Bestätigungslink in der e-Mail-Adresse auswählt, die an ihn gesendet wird:</span><span class="sxs-lookup"><span data-stu-id="7010a-244">The following code shows the `ConfirmEmail` method in the account controller that is called when the user selects the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="7010a-245">Sobald ein vergessenes Kenn Wort Token verwendet wurde, wird es ungültig.</span><span class="sxs-lookup"><span data-stu-id="7010a-245">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="7010a-246">Die folgende Codeänderung in der `Create`-Methode (in der Datei *App\_start\identityconfig.cs* ) legt fest, dass die Token in drei Stunden ablaufen.</span><span class="sxs-lookup"><span data-stu-id="7010a-246">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="7010a-247">Mit dem obigen Code läuft das vergessene Kennwort und die e-Mail-Bestätigungs Token in drei Stunden ab.</span><span class="sxs-lookup"><span data-stu-id="7010a-247">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="7010a-248">Der Standard `TokenLifespan` ist ein Tag.</span><span class="sxs-lookup"><span data-stu-id="7010a-248">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="7010a-249">Der folgende Code zeigt die e-Mail-Bestätigungs Methode:</span><span class="sxs-lookup"><span data-stu-id="7010a-249">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="7010a-250">ASP.net Identity unterstützt die zweistufige Authentifizierung (2FA), um Ihre APP sicherer zu machen.</span><span class="sxs-lookup"><span data-stu-id="7010a-250">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="7010a-251">Weitere Informationen finden [Sie unter ASP.net Identity 2,0: Einrichten der Konto Validierung und der zweistufigen Autorisierung](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) durch John Atten.</span><span class="sxs-lookup"><span data-stu-id="7010a-251">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="7010a-252">Obwohl Sie die Kontosperrung bei Fehlern beim Versuch eines Anmelde Kennworts festlegen können, ist der Anmelde Name für die [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) -Sperrung anfällig.</span><span class="sxs-lookup"><span data-stu-id="7010a-252">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="7010a-253">Es wird empfohlen, die Kontosperrung nur mit 2FA zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="7010a-253">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="7010a-254">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="7010a-254">Additional resources</span></span>

- [<span data-ttu-id="7010a-255">Übersicht über benutzerdefinierte Speicheranbieter für ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="7010a-255">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="7010a-256">Die [MVC 5-App mit Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) zeigt außerdem, wie Sie der Tabelle "Users" Profilinformationen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7010a-256">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="7010a-257">[ASP.NET MVC und Identity 2,0: Grundlegendes zu den Grundlagen](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) von John Atten.</span><span class="sxs-lookup"><span data-stu-id="7010a-257">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="7010a-258">Einführung zu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="7010a-258">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="7010a-259">[Ankündigungs-RTM von ASP.net Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) von Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="7010a-259">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
