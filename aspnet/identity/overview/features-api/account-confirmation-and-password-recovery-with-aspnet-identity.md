---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Konto zur Bestätigung und Kennwortwiederherstellung - ASP.NET-Identität (C#) – ASP.NET 4.x
author: HaoK
description: Vor der Durchführung dieses Tutorials sollten Sie zuerst erstellen Sie eine sichere ASP.NET MVC 5-Web-app mit Anmeldung, e-Mail-Bestätigung und kennwortzurücksetzung abschließen. In diesem Tutorial...
ms.author: riande
ms.date: 01/23/2019
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 2e4cd21d66e69590fb1642d7974e4b7f82cba0cb
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/09/2019
ms.locfileid: "59396420"
---
# <a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="cf228-104">Bestätigung und Wiederherstellung mit ASP.NET Identity-Konto (C#)</span><span class="sxs-lookup"><span data-stu-id="cf228-104">Account confirmation and password recovery with ASP.NET Identity (C#)</span></span>

> <span data-ttu-id="cf228-105">Vor der Durchführung dieses Tutorials sollten Sie zuerst abschließen [erstellen eine sichere ASP.NET MVC 5-Web-app mit Anmeldung, e-Mail-Bestätigung und kennwortzurücksetzung](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="cf228-105">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="cf228-106">Dieses Tutorial enthält weitere Informationen und erfahren Sie, wie e-Mail zur Bestätigung des lokalen Konto einrichten und Benutzer zum Zurücksetzen des Kennworts in ASP.NET Identity vergessen haben.</span><span class="sxs-lookup"><span data-stu-id="cf228-106">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span>

<span data-ttu-id="cf228-107">Ein lokales Benutzerkonto muss der Benutzer ein Kennwort für das Konto zu erstellen, und das Kennwort (sicher) in der Web-app gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="cf228-107">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="cf228-108">ASP.NET Identity unterstützt auch die Konten für soziale Netzwerke, die den Benutzer, erstellen ein Kennwort für die app nicht erforderlich.</span><span class="sxs-lookup"><span data-stu-id="cf228-108">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="cf228-109">[Konten für soziale Netzwerke](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) ein Dritter (z. B. Google, Twitter, Facebook oder Microsoft) zum Authentifizieren von Benutzern verwenden.</span><span class="sxs-lookup"><span data-stu-id="cf228-109">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook, or Microsoft) to authenticate users.</span></span> <span data-ttu-id="cf228-110">Dieses Thema behandelt Folgendes:</span><span class="sxs-lookup"><span data-stu-id="cf228-110">This topic covers the following:</span></span>

- <span data-ttu-id="cf228-111">[Erstellen einer ASP.NET MVC-app](#createMvc) und Untersuchen von ASP.NET Identity-Funktionen.</span><span class="sxs-lookup"><span data-stu-id="cf228-111">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="cf228-112">Erstellen Sie das Identity-Beispiel</span><span class="sxs-lookup"><span data-stu-id="cf228-112">Build the Identity sample</span></span>](#build)
- [<span data-ttu-id="cf228-113">Richten Sie e-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="cf228-113">Set up email confirmation</span></span>](#email)

<span data-ttu-id="cf228-114">Neuer Benutzer registrieren ihre e-Mail-Alias, der ein lokales Konto erstellt.</span><span class="sxs-lookup"><span data-stu-id="cf228-114">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="cf228-115">Auswählen der Schaltfläche "registrieren" sendet eine Bestätigung per e-Mail, die eine Überprüfungstoken an ihre e-Mail-Adresse enthält.</span><span class="sxs-lookup"><span data-stu-id="cf228-115">Selecting the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="cf228-116">Der Benutzer erhält eine e-Mail mit einem bestätigungstoken für ihr Konto.</span><span class="sxs-lookup"><span data-stu-id="cf228-116">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="cf228-117">Wählen Sie den Link klicken, wird das Konto bestätigt.</span><span class="sxs-lookup"><span data-stu-id="cf228-117">Selecting the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="cf228-118">Zurücksetzen des Kennworts/Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="cf228-118">Password recovery/reset</span></span>

<span data-ttu-id="cf228-119">Lokale Benutzer, die ihr Kennwort vergessen haben ein Sicherheitstoken gesendet, um ihre e-Mail-Konto, aktivieren sie zum Zurücksetzen des Kennworts.</span><span class="sxs-lookup"><span data-stu-id="cf228-119">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="cf228-120">Der Benutzer wird in Kürze eine e-Mail mit einem Link, sodass sie zum Zurücksetzen des Kennworts erhalten.</span><span class="sxs-lookup"><span data-stu-id="cf228-120">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="cf228-121">Wählen Sie den Link gelangen sie zu der Seite "Zurücksetzen".</span><span class="sxs-lookup"><span data-stu-id="cf228-121">Selecting the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="cf228-122">Auswählen der **zurücksetzen** Schaltfläche wird bestätigt das Kennwort wurde zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="cf228-122">Selecting the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="cf228-123">Erstellen einer ASP.NET-Web-App</span><span class="sxs-lookup"><span data-stu-id="cf228-123">Create an ASP.NET web app</span></span>

<span data-ttu-id="cf228-124">Zunächst installieren und Ausführen von [Visual Studio 2017](https://visualstudio.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="cf228-124">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/).</span></span>


1. <span data-ttu-id="cf228-125">Erstellen Sie ein neues ASP.NET Web-Projekt, und wählen Sie die MVC-Vorlage.</span><span class="sxs-lookup"><span data-stu-id="cf228-125">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="cf228-126">Web Forms unterstützen auch ASP.NET Identity, sodass Sie ähnliche Schritte in einer Web Forms-app ausführen konnte.</span><span class="sxs-lookup"><span data-stu-id="cf228-126">Web Forms also support ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="cf228-127">Ändern Sie die Authentifizierung auf **einzelne Benutzerkonten**.</span><span class="sxs-lookup"><span data-stu-id="cf228-127">Change the authentication to **Individual User Accounts**.</span></span>
3. <span data-ttu-id="cf228-128">Die app auszuführen, wählen Sie die **registrieren** verknüpfen, und registrieren Sie einen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="cf228-128">Run the app, select the **Register** link and register a user.</span></span> <span data-ttu-id="cf228-129">Die ausschließliche Überprüfung der auf die e-Mail-Adresse an diesem Punkt ist, mit der [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) Attribut.</span><span class="sxs-lookup"><span data-stu-id="cf228-129">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="cf228-130">Wechseln Sie in Server-Explorer zu **Daten Connections\DefaultConnection\Tables\AspNetUsers**mit der rechten Maustaste auf, und wählen Sie **Tabellendefinition öffnen**.</span><span class="sxs-lookup"><span data-stu-id="cf228-130">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right-click and select **Open table definition**.</span></span>

    <span data-ttu-id="cf228-131">Die folgende Abbildung zeigt die `AspNetUsers` Schema:</span><span class="sxs-lookup"><span data-stu-id="cf228-131">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="cf228-132">Mit der rechten Maustaste auf die **"aspnetusers"** Tabelle, und wählen Sie **Tabellendaten anzeigen**.</span><span class="sxs-lookup"><span data-stu-id="cf228-132">Right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="cf228-133">Die e-Mail wurde an diesem Punkt nicht bestätigt.</span><span class="sxs-lookup"><span data-stu-id="cf228-133">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="cf228-134">Der Standard-Datenspeicher für ASP.NET Identity ist Entity Framework, aber Sie können konfigurieren, verwenden Sie andere Datenspeicher und zusätzliche Felder hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="cf228-134">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="cf228-135">Finden Sie unter [Zusatzressourcen](#addRes) Abschnitt am Ende dieses Tutorials.</span><span class="sxs-lookup"><span data-stu-id="cf228-135">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="cf228-136">Die [OWIN-Startklasse](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *"Startup.cs"* ) wird aufgerufen, wenn die Anwendung gestartet und ruft die `ConfigureAuth` -Methode in der *App\_Start\Startup.Auth.cs*, die OWIN-Pipeline konfiguriert und initialisiert ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="cf228-136">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="cf228-137">Untersuchen Sie die Methode `ConfigureAuth`.</span><span class="sxs-lookup"><span data-stu-id="cf228-137">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="cf228-138">Jede `CreatePerOwinContext` Aufruf registriert einen Rückruf (gespeichert der `OwinContext`) aufgerufen wird einmal pro Anforderung zum Erstellen einer Instanz des angegebenen Typs.</span><span class="sxs-lookup"><span data-stu-id="cf228-138">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="cf228-139">Sie können einen Haltepunkt festlegen, in den Konstruktor und `Create` Methode jedes Typs (`ApplicationDbContext, ApplicationUserManager`) und überprüfen Sie, ob sie bei jeder Anforderung aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="cf228-139">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="cf228-140">Eine Instanz der `ApplicationDbContext` und `ApplicationUserManager` befindet sich in der OWIN-Kontext, die in der gesamten Anwendung zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="cf228-140">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="cf228-141">ASP.NET Identity klinkt sich in der OWIN-Pipeline, über Cookie-Middleware.</span><span class="sxs-lookup"><span data-stu-id="cf228-141">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="cf228-142">Weitere Informationen finden Sie unter [pro Anforderung Prozesslebensdauer-Verwaltung für UserManager-Klasse in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="cf228-142">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="cf228-143">Wenn Sie Ihrem Sicherheitsprofil ändern, ein neuen sicherheitsstempel generiert und gespeichert, der `SecurityStamp` Feld der *"aspnetusers"* Tabelle.</span><span class="sxs-lookup"><span data-stu-id="cf228-143">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="cf228-144">Beachten Sie, dass die `SecurityStamp` Feld unterscheidet sich das Sicherheitscookie.</span><span class="sxs-lookup"><span data-stu-id="cf228-144">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="cf228-145">Das Sicherheitscookie befindet sich nicht in der `AspNetUsers` Tabelle (oder an anderer Stelle in der Identity-DB).</span><span class="sxs-lookup"><span data-stu-id="cf228-145">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="cf228-146">Das Sicherheitstoken für das Cookie ist selbstsigniert mit [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) und wird erstellt, mit der `UserId, SecurityStamp` und Ablauf von Uhrzeitangaben.</span><span class="sxs-lookup"><span data-stu-id="cf228-146">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="cf228-147">Die Cookie-Middleware überprüft das Cookie bei jeder Anforderung.</span><span class="sxs-lookup"><span data-stu-id="cf228-147">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="cf228-148">Die `SecurityStampValidator` -Methode in der die `Startup` Klasse erreicht die Datenbank und in regelmäßigen Abständen, überprüft der sicherheitsstempel gemäß der Angabe der `validateInterval`.</span><span class="sxs-lookup"><span data-stu-id="cf228-148">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="cf228-149">Dies geschieht nur alle 30 Minuten (in unserem Beispiel), es sei denn, Sie zu Ihrem Sicherheitsprofil ändern.</span><span class="sxs-lookup"><span data-stu-id="cf228-149">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="cf228-150">Das 30-Minuten-Intervall wurde gewählt, um Roundtrips zur Datenbank zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="cf228-150">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="cf228-151">Finden Sie unter meinem [Tutorial zur zweistufigen Authentifizierung](index.md) Weitere Details.</span><span class="sxs-lookup"><span data-stu-id="cf228-151">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="cf228-152">Pro die Kommentare im Code die `UseCookieAuthentication` -Methode unterstützt die Cookie-Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="cf228-152">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="cf228-153">Die `SecurityStamp` Feld und den zugehörigen Code ist eine zusätzliche Sicherheitsschicht von Sicherheit für Ihre app, wenn Sie Ihr Kennwort ändern Sie protokolliert außerhalb des Browsers, die Sie sich angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="cf228-153">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="cf228-154">Die `SecurityStampValidator.OnValidateIdentity` Methode ermöglicht die app, die das Sicherheitstoken zu überprüfen, wenn der Benutzer anmeldet, die verwendet wird, wenn Sie ein Kennwort ändern oder mithilfe der externe Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="cf228-154">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="cf228-155">Dies ist erforderlich, um sicherzustellen, dass alle Token (Cookies) generiert, mit dem alten Kennwort ungültig sind.</span><span class="sxs-lookup"><span data-stu-id="cf228-155">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="cf228-156">Im Beispielprojekt, wenn Sie ändern das Benutzerkennwort klicken Sie dann ein neues Token für den Benutzer generiert wird, werden alle vorherigen Token für ungültig erklärt und die `SecurityStamp` Feld wird aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="cf228-156">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="cf228-157">Die Identity-System können Sie zum Konfigurieren Ihrer app also wenn sich das Sicherheitsprofil Benutzer ändert (z. B. wenn der Benutzer das Kennwort oder die Änderungen ändert Anmeldung verknüpft (z. B. von Facebook, Google, Microsoft-Konto usw.), der Benutzer angemeldet ist, von allen Browserinstanzen.</span><span class="sxs-lookup"><span data-stu-id="cf228-157">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="cf228-158">Z. B. die folgende Abbildung zeigt die [einmaliges Abmelden Beispiel](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) -app, die dem Benutzer ermöglicht, alle Browserinstanzen (in diesem Fall IE, Firefox und Chrome) abmelden, indem Sie eine Schaltfläche auswählen.</span><span class="sxs-lookup"><span data-stu-id="cf228-158">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by selecting one button.</span></span> <span data-ttu-id="cf228-159">Alternativ können mit das Beispiel nur einen bestimmten Browser-Instanz anmelden.</span><span class="sxs-lookup"><span data-stu-id="cf228-159">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="cf228-160">Die [einmaliges Abmelden Beispiel](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) -app zeigt, wie ASP.NET Identity das Token erneut generieren können.</span><span class="sxs-lookup"><span data-stu-id="cf228-160">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="cf228-161">Dies ist erforderlich, um sicherzustellen, dass alle Token (Cookies) generiert, mit dem alten Kennwort ungültig sind.</span><span class="sxs-lookup"><span data-stu-id="cf228-161">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="cf228-162">Diese Funktion bietet eine zusätzliche Sicherheitsebene für Ihre Anwendung; Wenn Sie Ihr Kennwort ändern, werden Sie abgemeldet, in dem Sie sich diese Anwendung angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="cf228-162">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="cf228-163">Die *App\_Start\IdentityConfig.cs* -Datei enthält die `ApplicationUserManager`, `EmailService` und `SmsService` Klassen.</span><span class="sxs-lookup"><span data-stu-id="cf228-163">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="cf228-164">Die `EmailService` und `SmsService` Klassen implementieren jeweils die `IIdentityMessageService` Schnittstelle, damit Sie häufige Methoden in jeder Klasse zum Konfigurieren von e-Mail und SMS verwenden.</span><span class="sxs-lookup"><span data-stu-id="cf228-164">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="cf228-165">Obwohl dieses Tutorial nur das zeigt Hinzufügen von e-Mail-Benachrichtigung über [SendGrid](http://sendgrid.com/), senden Sie eine e-Mail mit SMTP und andere Mechanismen.</span><span class="sxs-lookup"><span data-stu-id="cf228-165">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="cf228-166">Die `Startup` Klasse enthält auch eine Textvorlage zum Hinzufügen von Anmeldungen per sozialem Netzwerk (Facebook, Twitter usw.), finden Sie unter meinem Tutorial [MVC 5 App with Facebook, Twitter, LinkedIn und Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="cf228-166">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="cf228-167">Überprüfen Sie die `ApplicationUserManager` -Klasse, die die Identitätsinformationen für den Benutzer enthält, und konfiguriert die folgenden Funktionen:</span><span class="sxs-lookup"><span data-stu-id="cf228-167">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="cf228-168">Kennwort-sicherheitsanforderungen.</span><span class="sxs-lookup"><span data-stu-id="cf228-168">Password strength requirements.</span></span>
- <span data-ttu-id="cf228-169">Benutzer gesperrt (Versuche und -Uhrzeit).</span><span class="sxs-lookup"><span data-stu-id="cf228-169">User lock out (attempts and time).</span></span>
- <span data-ttu-id="cf228-170">Zwei-Faktor-Authentifizierung (2FA).</span><span class="sxs-lookup"><span data-stu-id="cf228-170">Two-factor authentication (2FA).</span></span> <span data-ttu-id="cf228-171">2FA und SMS behandelt in ein anderes Tutorial.</span><span class="sxs-lookup"><span data-stu-id="cf228-171">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="cf228-172">Einbinden von der e-Mail und SMS-Dienste.</span><span class="sxs-lookup"><span data-stu-id="cf228-172">Hooking up the email and SMS services.</span></span> <span data-ttu-id="cf228-173">(Ich werde in ein anderes Tutorial SMS behandeln).</span><span class="sxs-lookup"><span data-stu-id="cf228-173">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="cf228-174">Die `ApplicationUserManager` Klasse leitet sich von der generischen `UserManager<ApplicationUser>` Klasse.</span><span class="sxs-lookup"><span data-stu-id="cf228-174">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> `ApplicationUser` <span data-ttu-id="cf228-175">leitet sich von ["identityuser"](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="cf228-175">derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> `IdentityUser` <span data-ttu-id="cf228-176">abgeleitet von der generischen `IdentityUser` Klasse:</span><span class="sxs-lookup"><span data-stu-id="cf228-176">derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="cf228-177">Die oben genannten Eigenschaften übereinstimmen, mit den Eigenschaften in der `AspNetUsers` Tabelle oben.</span><span class="sxs-lookup"><span data-stu-id="cf228-177">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="cf228-178">Generische Argumente auf `IUser` ermöglichen es Ihnen, eine Klasse, die Verwendung verschiedener Typen für den primären Schlüssel abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="cf228-178">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="cf228-179">Finden Sie unter den [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) Beispiel zeigt, wie sich den Primärschlüssel von String in Int "oder" GUID zu ändern.</span><span class="sxs-lookup"><span data-stu-id="cf228-179">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="cf228-180">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="cf228-180">ApplicationUser</span></span>

`ApplicationUser` <span data-ttu-id="cf228-181">(`public class ApplicationUserManager : UserManager<ApplicationUser>`) wird in definiert *Models\IdentityModels.cs* als:</span><span class="sxs-lookup"><span data-stu-id="cf228-181">(`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="cf228-182">Der hervorgehobene Code oben generiert eine ["ClaimsIdentity"](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="cf228-182">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="cf228-183">ASP.NET Identity und OWIN Cookie-Authentifizierung sind Claims-basierte, daher das Framework erfordert die app zum Generieren einer `ClaimsIdentity` für den Benutzer.</span><span class="sxs-lookup"><span data-stu-id="cf228-183">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> `ClaimsIdentity` <span data-ttu-id="cf228-184">enthält Informationen über alle Ansprüche für Benutzer, z. B. den Namen des Benutzers, Alter und welche Rollen der Benutzer angehört.</span><span class="sxs-lookup"><span data-stu-id="cf228-184">has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="cf228-185">Sie können auch weitere Ansprüche für den Benutzer in dieser Phase hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="cf228-185">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="cf228-186">Die OWIN `AuthenticationManager.SignIn` Methode übergibt der `ClaimsIdentity` und der Benutzer anmeldet:</span><span class="sxs-lookup"><span data-stu-id="cf228-186">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="cf228-187">[MVC 5-App mit Facebook, Twitter, LinkedIn und Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) zeigt, wie Sie zusätzliche Eigenschaften zum Hinzufügen der `ApplicationUser` Klasse.</span><span class="sxs-lookup"><span data-stu-id="cf228-187">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="cf228-188">E-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="cf228-188">Email confirmation</span></span>

<span data-ttu-id="cf228-189">Es ist eine gute Idee, bestätigen die e-Mail-Adresse, um zu überprüfen, ob sie keine Identität einer anderen Person mit Registrierung neuer Benutzer (d. h. sie noch nicht registriert mit einer anderen Person für den e-Mail-Adresse).</span><span class="sxs-lookup"><span data-stu-id="cf228-189">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="cf228-190">Angenommen, Sie ein Diskussionsforum hatten, Sie möchten zu verhindern, dass `"bob@example.com"` aus der Registrierung als `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="cf228-190">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="cf228-191">Ohne e-Mail-Bestätigung `"joe@contoso.com"` unerwünschte e-Mail-Adresse Ihrer app abrufen konnte.</span><span class="sxs-lookup"><span data-stu-id="cf228-191">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="cf228-192">Angenommen, das Bob versehentlich als registriert `"bib@example.com"` und noch nicht bemerkt, er wäre Kennwort wiederherstellen zu verwenden, da die app nicht seine richtige e-Mail-Nachricht nicht.</span><span class="sxs-lookup"><span data-stu-id="cf228-192">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="cf228-193">E-Mail-Bestätigung enthält nur begrenzt Schutz von Bots und nicht bieten Schutz vor bestimmt Spammern, sie haben viele funktionierenden e-Mail-Aliase, die sie verwenden können, um zu registrieren. Im folgenden Beispiel wird der Benutzer nicht ihr Kennwort zu ändern, bis ihr Konto bestätigt wurde (durch diese Auswahl von eines Links zur Bestätigung empfangen wird, auf das e-Mail-Konto an, die, dem Sie registriert.) Sie können diesem Workflow auf andere Szenarien anwenden sendet z. B. einen Link, um zu bestätigen und Zurücksetzen des Kennworts für neue Konten, die durch den Administrator, dem Benutzer eine e-Mail senden, wenn sie ihr Profil und so weiter geändert wurden erstellt.</span><span class="sxs-lookup"><span data-stu-id="cf228-193">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them selecting a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="cf228-194">Im Allgemeinen möchten Sie verhindern, dass neue Benutzer keine Daten zu Ihrer Website veröffentlichen, bevor sie per e-Mail, eine SMS oder einen anderen Mechanismus bestätigt wurden.</span><span class="sxs-lookup"><span data-stu-id="cf228-194">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="build-a-more-complete-sample"></a><span data-ttu-id="cf228-195">Erstellen Sie ein ausführlicheres Beispiel</span><span class="sxs-lookup"><span data-stu-id="cf228-195">Build a more complete sample</span></span>

<span data-ttu-id="cf228-196">In diesem Abschnitt werden Sie NuGet verwenden, um ein ausführlicheres Beispiel herunterzuladen, mit denen, dem wir zusammenarbeiten werden.</span><span class="sxs-lookup"><span data-stu-id="cf228-196">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="cf228-197">Erstellen Sie ein neues ***leere*** ASP.NET-Webprojekt.</span><span class="sxs-lookup"><span data-stu-id="cf228-197">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="cf228-198">Geben Sie in der Paket-Manager-Konsole die folgenden Befehle aus:</span><span class="sxs-lookup"><span data-stu-id="cf228-198">In the Package Manager Console, enter the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="cf228-199">In diesem Tutorial verwenden wir [SendGrid](http://sendgrid.com/) zum Senden von e-Mails.</span><span class="sxs-lookup"><span data-stu-id="cf228-199">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="cf228-200">Die `Identity.Samples` Paket wird installiert, den wir arbeiten mit Code.</span><span class="sxs-lookup"><span data-stu-id="cf228-200">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="cf228-201">Legen Sie die [Projekt für die Verwendung von SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="cf228-201">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="cf228-202">Testen Sie die Erstellung von lokalen Konten durch Ausführen der app, wählen die **registrieren** verknüpfen, und veröffentlichen Sie das Registrierungsformular.</span><span class="sxs-lookup"><span data-stu-id="cf228-202">Test local account creation by running the app, selecting the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="cf228-203">Wählen Sie die Demo-e-Mail-Verknüpfung, die e-Mail-Bestätigung simuliert.</span><span class="sxs-lookup"><span data-stu-id="cf228-203">Select the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="cf228-204">Entfernen Sie den Democode e-Mail-Link zur Bestätigung aus dem Beispiel (das `ViewBag.Link` Code im Kontocontroller.</span><span class="sxs-lookup"><span data-stu-id="cf228-204">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="cf228-205">Finden Sie unter den `DisplayEmail` und `ForgotPasswordConfirmation` Aktionsmethoden und Razor-Ansichten).</span><span class="sxs-lookup"><span data-stu-id="cf228-205">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!WARNING]
> <span data-ttu-id="cf228-206">Wenn Sie die Sicherheitseinstellungen in diesem Beispiel ändern, müssen Produktionen apps eine sicherheitsüberprüfung unterzogen werden, die die Änderungen explizit aufruft.</span><span class="sxs-lookup"><span data-stu-id="cf228-206">If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>


## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="cf228-207">Überprüfen Sie den Code in App\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="cf228-207">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="cf228-208">Das Beispiel zeigt, wie Sie ein Konto erstellen und Hinzufügen der *Admin* Rolle.</span><span class="sxs-lookup"><span data-stu-id="cf228-208">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="cf228-209">Ersetzen Sie die e-Mail-Adresse in das Beispiel mit der e-Mail-Adresse, die Sie für das Administratorkonto verwenden möchten.</span><span class="sxs-lookup"><span data-stu-id="cf228-209">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="cf228-210">Die einfachste Möglichkeit jetzt zum Erstellen eines Administratorkontos wird programmgesteuert in die `Seed` Methode.</span><span class="sxs-lookup"><span data-stu-id="cf228-210">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="cf228-211">Wir hoffen, haben in der Zukunft ein Tool, mit denen Sie zum Erstellen und Verwalten von Benutzern und Rollen.</span><span class="sxs-lookup"><span data-stu-id="cf228-211">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="cf228-212">Der Beispielcode ist möglich, Sie erstellen und Verwalten von Benutzern und Rollen, jedoch benötigen Sie ein Administratorkonto zum Ausführen von Rollen und Verwaltungsseiten für Benutzer.</span><span class="sxs-lookup"><span data-stu-id="cf228-212">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="cf228-213">In diesem Beispiel wird das Administratorkonto erstellt, wenn die Datenbank ein Seeding durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="cf228-213">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="cf228-214">Ändern Sie das Kennwort ein, und ändern Sie den Namen mit einem Konto, in dem Sie die e-Mail-Benachrichtigungen empfangen können.</span><span class="sxs-lookup"><span data-stu-id="cf228-214">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="cf228-215">Sicherheit: vertrauliche Daten niemals in Ihrem Quellcode speichern.</span><span class="sxs-lookup"><span data-stu-id="cf228-215">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="cf228-216">Wie bereits erwähnt, die `app.CreatePerOwinContext` Aufruf in der Startup-Klasse fügt Rückrufe an die `Create` Methode der app DB Inhalten, Benutzer-Manager und die Rolle Manager Klassen.</span><span class="sxs-lookup"><span data-stu-id="cf228-216">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="cf228-217">Die OWIN-pipeline Ruft die `Create` Methode für diese Klassen für jede Anforderung, und der Kontext für jede Klasse gespeichert.</span><span class="sxs-lookup"><span data-stu-id="cf228-217">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="cf228-218">Der Kontocontroller macht den Benutzer-Manager aus dem HTTP-Kontext (mit der OWIN-Kontext):</span><span class="sxs-lookup"><span data-stu-id="cf228-218">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="cf228-219">Wenn ein Benutzer ein lokales Konto, registriert die `HTTP Post Register` aufgerufen:</span><span class="sxs-lookup"><span data-stu-id="cf228-219">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="cf228-220">Der obige Code verwendet die Modelldaten zum Erstellen eines neuen Benutzerkontos mithilfe der e-Mail-Adresse und Kennwort eingegeben werden.</span><span class="sxs-lookup"><span data-stu-id="cf228-220">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="cf228-221">Wenn der e-Mail-Alias im Datenspeicher, kontoerstellung fehlschlägt und das Formular wird erneut angezeigt.</span><span class="sxs-lookup"><span data-stu-id="cf228-221">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="cf228-222">Die `GenerateEmailConfirmationTokenAsync` Methode erstellt eine sichere bestätigungstoken und speichert sie in der ASP.NET Identity-Datenspeicher.</span><span class="sxs-lookup"><span data-stu-id="cf228-222">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="cf228-223">Die [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) -Methode erstellt eine Verknüpfung mit der `UserId` und bestätigungstoken.</span><span class="sxs-lookup"><span data-stu-id="cf228-223">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="cf228-224">Dieser Link wird dann per e-Mail gesendet, die dem Benutzer, der Benutzer kann auf den Link in ihren e-Mail-app auswählen, um ihr Konto zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="cf228-224">This link is then emailed to the user, the user can select on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="cf228-225">Richten Sie e-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="cf228-225">Set up email confirmation</span></span>

<span data-ttu-id="cf228-226">Wechseln Sie zu der [Anmeldeseite von Azure-SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) und kostenloses Konto registrieren.</span><span class="sxs-lookup"><span data-stu-id="cf228-226">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="cf228-227">Fügen Sie Code ähnlich dem folgenden SendGrid zu konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="cf228-227">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="cf228-228">E-Mail-Clients akzeptieren häufig nur SMS-Nachrichten (HTML).</span><span class="sxs-lookup"><span data-stu-id="cf228-228">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="cf228-229">Sie sollten die Nachricht in Text und HTML bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="cf228-229">You should provide the message in text and HTML.</span></span> <span data-ttu-id="cf228-230">Im obigen SendGrid-Beispiel ist dies mit der `myMessage.Text` und `myMessage.Html` oben gezeigte Code.</span><span class="sxs-lookup"><span data-stu-id="cf228-230">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>


<span data-ttu-id="cf228-231">Der folgende Code zeigt, wie zum Senden von e-Mails unter Verwendung der [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) Klasse Where `message.Body` gibt nur die Verknüpfung.</span><span class="sxs-lookup"><span data-stu-id="cf228-231">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="cf228-232">Sicherheit: vertrauliche Daten niemals in Ihrem Quellcode speichern.</span><span class="sxs-lookup"><span data-stu-id="cf228-232">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="cf228-233">Das Konto und die Anmeldeinformationen werden in der AppSetting gespeichert.</span><span class="sxs-lookup"><span data-stu-id="cf228-233">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="cf228-234">In Azure können sicher gespeichert werden diese Werte auf die **[konfigurieren](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** Registerkarte im Azure-Portal.</span><span class="sxs-lookup"><span data-stu-id="cf228-234">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="cf228-235">Finden Sie unter [bewährte Methoden für die Bereitstellung von Kennwörtern und anderen vertraulichen Daten in ASP.NET und Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="cf228-235">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


<span data-ttu-id="cf228-236">Geben Sie Ihre SendGrid-Anmeldeinformationen, die app ausführen, kann registrieren Sie sich mit einem e-Mail-Alias den Confirm-Link in Ihre e-Mail-Adresse auswählen.</span><span class="sxs-lookup"><span data-stu-id="cf228-236">Enter your SendGrid credentials, run the app, register with an email alias can select the confirm link in your email.</span></span> <span data-ttu-id="cf228-237">Informationen zu diesem Zweck Ihre [Outlook.com](http://outlook.com) e-Mail-Konto, finden Sie unter der John Atten [ C# SMTP-Konfiguration für die SMTP-Host Outlook.Com](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) sowie seine[ASP.NET Identity 2.0: Festlegen der Kontovalidierung und zwei-Faktor-Autorisierung](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) sendet.</span><span class="sxs-lookup"><span data-stu-id="cf228-237">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="cf228-238">Nach Auswahl der **registrieren** Schaltfläche eine Bestätigung per e-Mail, eine Validierung-Token enthält, wird ihre e-Mail-Adresse an.</span><span class="sxs-lookup"><span data-stu-id="cf228-238">Once a user selects the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="cf228-239">Der Benutzer erhält eine e-Mail mit einem bestätigungstoken für ihr Konto.</span><span class="sxs-lookup"><span data-stu-id="cf228-239">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="cf228-240">Überprüfen Sie den code</span><span class="sxs-lookup"><span data-stu-id="cf228-240">Examine the code</span></span>

<span data-ttu-id="cf228-241">Der folgende Code veranschaulicht die `POST ForgotPassword`-Methode.</span><span class="sxs-lookup"><span data-stu-id="cf228-241">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="cf228-242">Die Methode schlägt ohne Fehlermeldung fehl, wenn die e-Mail-Adresse des Benutzers nicht bestätigt wurde.</span><span class="sxs-lookup"><span data-stu-id="cf228-242">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="cf228-243">Wenn ein Fehler für eine ungültige e-Mail-Adresse bereitgestellt wurde, können böswillige Benutzer diese Informationen verwenden, gültige Benutzer-ID (e-Mail-Aliase) Angriffe gefunden.</span><span class="sxs-lookup"><span data-stu-id="cf228-243">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="cf228-244">Der folgende code zeigt die `ConfirmEmail` -Methode im Kontocontroller, die aufgerufen wird, wenn der Benutzer den Link zur Bestätigung in der an Sie verschickten e-Mail auswählt:</span><span class="sxs-lookup"><span data-stu-id="cf228-244">The following code shows the `ConfirmEmail` method in the account controller that is called when the user selects the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="cf228-245">Sobald ein vergessenes Kennwort-Token verwendet wurde, wird es ungültig.</span><span class="sxs-lookup"><span data-stu-id="cf228-245">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="cf228-246">Die folgende codeänderung in der `Create` Methode (in der *App\_Start\IdentityConfig.cs* Datei) legt die Token läuft in drei Stunden ab.</span><span class="sxs-lookup"><span data-stu-id="cf228-246">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="cf228-247">Mit dem obigen Code läuft das Kennwort vergessen haben und die e-Mail-bestätigungstoken in 3 Stunden.</span><span class="sxs-lookup"><span data-stu-id="cf228-247">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="cf228-248">Der Standardwert `TokenLifespan` ist ein Tag.</span><span class="sxs-lookup"><span data-stu-id="cf228-248">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="cf228-249">Der folgende Code zeigt die e-Mail-Bestätigung-Methode:</span><span class="sxs-lookup"><span data-stu-id="cf228-249">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="cf228-250">Um Ihre app sicherer machen, unterstützt ASP.NET Identity zweistufige Authentifizierung (2FA).</span><span class="sxs-lookup"><span data-stu-id="cf228-250">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="cf228-251">Finden Sie unter [ASP.NET-Identität 2.0: Einrichten der Kontoüberprüfung und zwei-Faktor-Autorisierung](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) von John Atten.</span><span class="sxs-lookup"><span data-stu-id="cf228-251">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="cf228-252">Obwohl Sie die kontosperrung auf Anmeldefehler in Verbindung mit Kennwort Versuch festlegen können, wird dieser Ansatz Ihr Anmeldename anfällig für [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) Sperrungen.</span><span class="sxs-lookup"><span data-stu-id="cf228-252">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="cf228-253">Es wird empfohlen, dass Sie nur mit 2FA Sperrung von Konten verwenden.</span><span class="sxs-lookup"><span data-stu-id="cf228-253">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="cf228-254">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="cf228-254">Additional resources</span></span>

- [<span data-ttu-id="cf228-255">Übersicht über benutzerdefinierte Speicheranbieter für ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="cf228-255">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="cf228-256">[MVC 5-App mit Facebook, Twitter, LinkedIn und Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) außerdem gezeigt, wie der Tabelle Informationen zum Profil hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="cf228-256">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="cf228-257">[ASP.NET MVC und Identität 2.0: Die Grundlagen](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) von John Atten.</span><span class="sxs-lookup"><span data-stu-id="cf228-257">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="cf228-258">Einführung in ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="cf228-258">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="cf228-259">[Ankündigung der RTM-Version von ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) von Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="cf228-259">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
