---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Hinzufügen von ASP.net Identity zu einem leeren oder vorhandenen Web Forms Projekt ASP.NET 4. x
author: raquelsa
description: In diesem Tutorial wird gezeigt, wie Sie einer ASP.NET-Anwendung ASP.net Identity (das Mitgliedschaftssystem für ASP.net) hinzufügen. Wenn Sie einen neuen Web Forms oder MVC erstellen...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8e82951d57f0b8052ee3f6530a7470be7d030206
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471975"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="7371f-104">Hinzufügen von ASP.NET Identity zu einem leeren oder vorhandenen Web Forms-Projekt</span><span class="sxs-lookup"><span data-stu-id="7371f-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>

> <span data-ttu-id="7371f-105">In diesem Tutorial wird gezeigt, wie Sie einer ASP.NET-Anwendung [ASP.net Identity](introduction-to-aspnet-identity.md) (das neue Mitgliedschaftssystem für ASP.net) hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7371f-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="7371f-106">Wenn Sie ein neues Web Forms-oder MVC-Projekt in Visual Studio 2017 RTM mit einzelnen Konten erstellen, werden alle erforderlichen Pakete von Visual Studio installiert, und alle erforderlichen Klassen werden für Sie hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="7371f-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="7371f-107">In diesem Tutorial werden die Schritte zum Hinzufügen ASP.net Identity Unterstützung für Ihr vorhandenes Web Forms Projekt oder ein neues leeres Projekt veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="7371f-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="7371f-108">Ich werde alle nuget-Pakete, die Sie installieren müssen, und die Klassen, die Sie hinzufügen müssen, erläutern.</span><span class="sxs-lookup"><span data-stu-id="7371f-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="7371f-109">Ich übergebe Beispiel Web Forms zum Registrieren neuer Benutzer und zum Anmelden, während alle Haupteinstiegspunkt-APIs für die Benutzerverwaltung und-Authentifizierung hervorgehoben werden.</span><span class="sxs-lookup"><span data-stu-id="7371f-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="7371f-110">In diesem Beispiel wird die ASP.net Identity Standard Implementierung für die SQL-Datenspeicherung verwendet, die auf Entity Framework basiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="7371f-111">In diesem Tutorial wird localdb für die SQL-Datenbank verwendet.</span><span class="sxs-lookup"><span data-stu-id="7371f-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="7371f-112">Beginnen Sie mit ASP.net Identity</span><span class="sxs-lookup"><span data-stu-id="7371f-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="7371f-113">Beginnen Sie mit der Installation und Ausführung von [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="7371f-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="7371f-114">Wählen Sie auf der Start Seite die Option **Neues Projekt** aus, oder verwenden Sie das Menü, und wählen Sie **Datei**und dann **Neues Projekt**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="7371f-115">Erweitern Sie im linken Bereich **Visualisierung C#** , und wählen Sie dann **Web**und dann **ASP.NET Webanwendung (.NET Framework)** aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="7371f-116">Benennen Sie das Projekt "webformsidentity", und wählen Sie **OK**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="7371f-117">Wählen Sie im Dialogfeld **Neues ASP.net-Projekt** die Vorlage **leer** aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="7371f-118">Beachten Sie, dass die Schaltfläche **Authentifizierung ändern** deaktiviert ist und in dieser Vorlage keine Authentifizierungs Unterstützung bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="7371f-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="7371f-119">Mit den Web Forms-, MVC-und Web-API-Vorlagen können Sie die Authentifizierungsmethode auswählen.</span><span class="sxs-lookup"><span data-stu-id="7371f-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="7371f-120">Hinzufügen von Identitäts Paketen zu Ihrer APP</span><span class="sxs-lookup"><span data-stu-id="7371f-120">Add Identity packages to your app</span></span>

<span data-ttu-id="7371f-121">Klicken Sie in Projektmappen-Explorer mit der rechten Maustaste auf das Projekt, und wählen Sie **nuget-Pakete verwalten**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="7371f-122">Suchen Sie nach dem Paket **Microsoft. Aspnet. Identity. EntityFramework** , und installieren Sie es.</span><span class="sxs-lookup"><span data-stu-id="7371f-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="7371f-123">Beachten Sie, dass mit diesem Paket die Abhängigkeits Pakete installiert werden: **EntityFramework** und **Microsoft ASP.net Identity Core**.</span><span class="sxs-lookup"><span data-stu-id="7371f-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="7371f-124">Hinzufügen eines Webformulars zum Registrieren von Benutzern</span><span class="sxs-lookup"><span data-stu-id="7371f-124">Add a web form to register users</span></span>

1. <span data-ttu-id="7371f-125">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und wählen Sie **Hinzufügen**und dann **Web Form aus**.</span><span class="sxs-lookup"><span data-stu-id="7371f-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="7371f-126">Benennen Sie im Dialogfeld **Name für Element angeben** das neue Webformular **Register**, und wählen Sie dann **OK** aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="7371f-127">Ersetzen Sie das Markup in der generierten Datei " *Register. aspx* " durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="7371f-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="7371f-128">Die Codeänderungen werden hervorgehoben.</span><span class="sxs-lookup"><span data-stu-id="7371f-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="7371f-129">Dies ist nur eine vereinfachte Version der Datei " *Register. aspx* ", die erstellt wird, wenn Sie ein neues ASP.net-Web Forms Projekt erstellen.</span><span class="sxs-lookup"><span data-stu-id="7371f-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="7371f-130">Das obige Markup fügt Formularfelder und eine Schaltfläche hinzu, um einen neuen Benutzer zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="7371f-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="7371f-131">Öffnen Sie die Datei *Register.aspx.cs* , und ersetzen Sie den Inhalt der Datei durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="7371f-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="7371f-132">Der obige Code ist eine vereinfachte Version der *Register.aspx.cs* -Datei, die erstellt wird, wenn Sie ein neues ASP.net-Web Forms Projekt erstellen.</span><span class="sxs-lookup"><span data-stu-id="7371f-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="7371f-133">Die *identityuser* -Klasse ist die Standard Implementierung von EntityFramework der *iuser* -Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="7371f-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="7371f-134">*Iuser* Interface ist die minimale Benutzeroberfläche für einen Benutzer auf ASP.net Identity Core.</span><span class="sxs-lookup"><span data-stu-id="7371f-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="7371f-135">Die *userstore* -Klasse ist die Standard Implementierung von EntityFramework eines Benutzer Stores.</span><span class="sxs-lookup"><span data-stu-id="7371f-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="7371f-136">Diese Klasse implementiert die minimalen Schnittstellen des ASP.net Identity-Kerns: *iuserstore*, *iuserloginstore*, *iuserclaimstore* und *iuserrolestore*.</span><span class="sxs-lookup"><span data-stu-id="7371f-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="7371f-137">Die *usermanager* -Klasse macht Benutzer bezogene APIs verfügbar, die automatisch Änderungen am *userstore*speichern.</span><span class="sxs-lookup"><span data-stu-id="7371f-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="7371f-138">Die *identityresult* -Klasse stellt das Ergebnis einer Identitäts Operation dar.</span><span class="sxs-lookup"><span data-stu-id="7371f-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="7371f-139">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und wählen Sie **Hinzufügen**, **Ordner ASP.net** und dann **App\_Daten**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="7371f-140">Öffnen Sie die Datei *Web. config* , und fügen Sie einen Eintrag für die Verbindungs Zeichenfolge für die Datenbank hinzu, in der die Benutzerinformationen gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="7371f-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="7371f-141">Die Datenbank wird zur Laufzeit von EntityFramework für die Identitäts Entitäten erstellt.</span><span class="sxs-lookup"><span data-stu-id="7371f-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="7371f-142">Die Verbindungs Zeichenfolge ähnelt der für Sie erstellte Verbindungs Zeichenfolge, wenn Sie ein neues Web Forms Projekt erstellen.</span><span class="sxs-lookup"><span data-stu-id="7371f-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="7371f-143">Der hervorgehobene Code zeigt das Markup, das Sie hinzufügen sollten:</span><span class="sxs-lookup"><span data-stu-id="7371f-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="7371f-144">Ersetzen Sie in Visual Studio 2015 oder höher `(localdb)\v11.0` durch `(localdb)\MSSQLLocalDB` in der Verbindungs Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="7371f-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="7371f-145">Klicken Sie im Projekt mit der rechten Maustaste auf File *Register. aspx* , und wählen Sie **als Start Seite festlegen**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="7371f-146">Drücken Sie STRG + F5, um die Webanwendung zu erstellen und auszuführen.</span><span class="sxs-lookup"><span data-stu-id="7371f-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="7371f-147">Geben Sie einen neuen Benutzernamen und ein Kennwort ein, und wählen Sie dann **registrieren**.</span><span class="sxs-lookup"><span data-stu-id="7371f-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="7371f-148">ASP.net Identity bietet Unterstützung für die Validierung, und in diesem Beispiel können Sie das Standardverhalten für Benutzer-und Kenn Wort Validierungs Steuerelemente überprüfen, die aus dem Identitäts Kern Paket stammen.</span><span class="sxs-lookup"><span data-stu-id="7371f-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="7371f-149">Das standardmäßige Validierungs Steuerelement für den Benutzer (`UserValidator`) verfügt über eine Eigenschaft `AllowOnlyAlphanumericUserNames`, für die der Standardwert `true`festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="7371f-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="7371f-150">Das standardmäßige Validierungs Steuerelement für das Kennwort (`MinimumLengthValidator`) stellt sicher, dass das Kennwort mindestens 6 Zeichen umfasst.</span><span class="sxs-lookup"><span data-stu-id="7371f-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="7371f-151">Diese Validierungs Steuerelemente sind Eigenschaften auf `UserManager`, die überschrieben werden können, wenn Sie über eine benutzerdefinierte Validierung verfügen möchten.</span><span class="sxs-lookup"><span data-stu-id="7371f-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="7371f-152">Überprüfen der durch Entity Framework generierten localdb-Identitätsdatenbank und-Tabellen</span><span class="sxs-lookup"><span data-stu-id="7371f-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="7371f-153">Wählen Sie im Menü **Ansicht** die Option **Server-Explorer**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="7371f-154">Erweitern Sie **DefaultConnection (webformsidentity)** , erweitern Sie **Tabellen**, klicken Sie mit der rechten Maustaste auf **aspnettusers** , und wählen Sie dann **Tabellendaten anzeigen**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="7371f-155">Konfigurieren der Anwendung für die owin-Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="7371f-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="7371f-156">An dieser Stelle haben wir nur die Unterstützung für das Erstellen von Benutzern hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="7371f-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="7371f-157">Nun zeigen wir, wie wir eine Authentifizierung zum Anmelden eines Benutzers hinzufügen können.</span><span class="sxs-lookup"><span data-stu-id="7371f-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="7371f-158">ASP.net Identity verwendet die Microsoft owin-Authentifizierungs Middleware für die Formular Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="7371f-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="7371f-159">Die owin-Cookieauthentifizierung ist ein cookiebasierter und Anspruchs basierter Authentifizierungsmechanismus, der von allen unter [owin](https://msdn.microsoft.com/magazine/dn451439.aspx) oder IIS gehosteten Frameworks verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7371f-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="7371f-160">Mit diesem Modell können die gleichen Authentifizierungs Pakete in mehreren Frameworks verwendet werden, einschließlich ASP.NET MVC und Web Forms.</span><span class="sxs-lookup"><span data-stu-id="7371f-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="7371f-161">Weitere Informationen zu Project Katana und zum Ausführen von Middleware in einem Host agnostisch finden Sie unter [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="7371f-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="7371f-162">Installieren von Authentifizierungs Paketen für Ihre Anwendung</span><span class="sxs-lookup"><span data-stu-id="7371f-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="7371f-163">Klicken Sie in Projektmappen-Explorer mit der rechten Maustaste auf das Projekt, und wählen Sie **nuget-Pakete verwalten**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="7371f-164">Suchen Sie nach dem Paket ***Microsoft. Aspnet. Identity. owin*** , und installieren Sie es.</span><span class="sxs-lookup"><span data-stu-id="7371f-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="7371f-165">Suchen Sie nach dem Paket ***Microsoft. owin. Host. systemWeb*** , und installieren Sie es.</span><span class="sxs-lookup"><span data-stu-id="7371f-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="7371f-166">Das Paket " **Microsoft. Aspnet. Identity. owin** " enthält einen Satz von owin-Erweiterungs Klassen zum Verwalten und Konfigurieren der owin-Authentifizierungs Middleware, die von ASP.net Identity Core-Paketen verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="7371f-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="7371f-167">Das **Microsoft. owin. Host. systemWeb** -Paket enthält einen owin-Server, der das Ausführen von owin-basierten Anwendungen auf IIS mithilfe der ASP.net Request-Pipeline ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="7371f-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="7371f-168">Weitere Informationen finden Sie [unter owin-Middleware in der integrierten IIS-Pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="7371f-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="7371f-169">Hinzufügen von owin-Konfigurations Klassen für Start und Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="7371f-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="7371f-170">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, wählen Sie **Hinzufügen**und dann **Neues Element hinzufügen**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="7371f-171">Geben Sie im Dialogfeld Such Textfeld den Text "*owin*" ein.</span><span class="sxs-lookup"><span data-stu-id="7371f-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="7371f-172">Benennen Sie die Klasse "*Startup*", und wählen Sie **Hinzufügen**aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="7371f-173">Fügen Sie in der Datei Startup.cs den unten gezeigten hervorgehobenen Code hinzu, um die owin-Cookie-Authentifizierung zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="7371f-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="7371f-174">Diese Klasse enthält das `OwinStartup` Attribut zum Angeben der owin-Startklasse.</span><span class="sxs-lookup"><span data-stu-id="7371f-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="7371f-175">Jede owin-Anwendung verfügt über eine Startup-Klasse, in der Sie Komponenten für die Anwendungs Pipeline angeben.</span><span class="sxs-lookup"><span data-stu-id="7371f-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="7371f-176">Weitere Informationen zu diesem Modell finden Sie unter [owin-Startklassen Erkennung](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) .</span><span class="sxs-lookup"><span data-stu-id="7371f-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="7371f-177">Hinzufügen von Web Forms zum Registrieren und Anmelden von Benutzern</span><span class="sxs-lookup"><span data-stu-id="7371f-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="7371f-178">Öffnen Sie die Datei *Register.aspx.cs* , und fügen Sie folgenden Code hinzu, der den Benutzer anmeldet, wenn die Registrierung erfolgreich ist.</span><span class="sxs-lookup"><span data-stu-id="7371f-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="7371f-179">Da ASP.net Identity und die owin-Cookieauthentifizierung Anspruchs basiertes System sind, erfordert das Framework, dass der App-Entwickler eine " [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) " für den Benutzer generiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="7371f-180">ClaimsIdentity enthält Informationen über alle Ansprüche für den Benutzer, z. b. die Rollen, denen der Benutzer angehört.</span><span class="sxs-lookup"><span data-stu-id="7371f-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="7371f-181">Sie können in dieser Phase auch weitere Ansprüche für den Benutzer hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7371f-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="7371f-182">Sie können den Benutzer anmelden, indem Sie den AuthenticationManager von owin verwenden und `SignIn` aufrufen und die ClaimsIdentity übergeben, wie oben gezeigt.</span><span class="sxs-lookup"><span data-stu-id="7371f-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="7371f-183">Mit diesem Code wird der Benutzer angemeldet und auch ein Cookie generiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="7371f-184">Dieser Befehl ist analog zu [formauthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) , das vom [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) -Modul verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7371f-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="7371f-185">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, wählen Sie **Hinzufügen**und dann **Web Form aus**.</span><span class="sxs-lookup"><span data-stu-id="7371f-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="7371f-186">Benennen Sie den Webformular- **Anmelde**Namen.</span><span class="sxs-lookup"><span data-stu-id="7371f-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="7371f-187">Ersetzen Sie den Inhalt der *Login. aspx* -Datei durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="7371f-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="7371f-188">Ersetzen Sie den Inhalt der *Login.aspx.cs* -Datei durch Folgendes:</span><span class="sxs-lookup"><span data-stu-id="7371f-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="7371f-189">Der `Page_Load` prüft jetzt den Status des aktuellen Benutzers und führt basierend auf seinem `Context.User.Identity.IsAuthenticated` Status Aktionen aus.</span><span class="sxs-lookup"><span data-stu-id="7371f-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="7371f-190">**Angemeldeter Benutzer Name anzeigen** : das Microsoft ASP.net Identity Framework hat Erweiterungs Methoden für [System. Security. Principal. IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) hinzugefügt, die es Ihnen ermöglichen, die `UserName` und `UserId` für den angemeldeten Benutzer zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="7371f-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="7371f-191">Diese Erweiterungs Methoden werden in der `Microsoft.AspNet.Identity.Core`-Assembly definiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="7371f-192">Diese Erweiterungs Methoden sind die Ersetzung für [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="7371f-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="7371f-193">SignIn-Methode: `This`-Methode ersetzt die vorherige `CreateUser_Click`-Methode in diesem Beispiel und meldet den Benutzer ab, nachdem der Benutzer erfolgreich erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="7371f-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="7371f-194">Das Microsoft owin-Framework hat Erweiterungs Methoden auf `System.Web.HttpContext` hinzugefügt, mit denen Sie einen Verweis auf eine `IOwinContext`erhalten können.</span><span class="sxs-lookup"><span data-stu-id="7371f-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="7371f-195">Diese Erweiterungs Methoden werden in `Microsoft.Owin.Host.SystemWeb` Assembly definiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="7371f-196">Die `OwinContext`-Klasse macht eine `IAuthenticationManager`-Eigenschaft verfügbar, die die für die aktuelle Anforderung Verfügbare Authentifizierungs Middleware-Funktionalität darstellt.</span><span class="sxs-lookup"><span data-stu-id="7371f-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="7371f-197">Sie können den Benutzer mit dem `AuthenticationManager` von owin anmelden und `SignIn` aufrufen und die `ClaimsIdentity` wie oben gezeigt übergeben.</span><span class="sxs-lookup"><span data-stu-id="7371f-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="7371f-198">Da ASP.net Identity-und owin-Cookieauthentifizierung Anspruchs basiertes System sind, erfordert das Framework, dass die APP eine `ClaimsIdentity` für den Benutzer generiert.</span><span class="sxs-lookup"><span data-stu-id="7371f-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="7371f-199">Der `ClaimsIdentity` enthält Informationen über alle Ansprüche für den Benutzer, z. b. die Rollen, denen der Benutzer angehört.</span><span class="sxs-lookup"><span data-stu-id="7371f-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="7371f-200">Sie können in dieser Phase auch weitere Ansprüche für den Benutzer hinzufügen. dieser Code meldet den Benutzer an und generiert auch ein Cookie.</span><span class="sxs-lookup"><span data-stu-id="7371f-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="7371f-201">Dieser Befehl ist analog zu [formauthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) , das vom [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) -Modul verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7371f-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="7371f-202">`SignOut`-Methode: Ruft einen Verweis auf die `AuthenticationManager` von owin ab und ruft `SignOut`auf.</span><span class="sxs-lookup"><span data-stu-id="7371f-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="7371f-203">Dies entspricht der [FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) -Methode, die vom [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) -Modul verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7371f-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="7371f-204">Drücken Sie **STRG + F5** , um die Webanwendung zu erstellen und auszuführen.</span><span class="sxs-lookup"><span data-stu-id="7371f-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="7371f-205">Geben Sie einen neuen Benutzernamen und ein Kennwort ein, und wählen Sie dann **registrieren**.</span><span class="sxs-lookup"><span data-stu-id="7371f-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="7371f-206">Hinweis: an diesem Punkt wird der neue Benutzer erstellt und angemeldet.</span><span class="sxs-lookup"><span data-stu-id="7371f-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="7371f-207">Wählen Sie die Schaltfläche **Abmelden aus** .</span><span class="sxs-lookup"><span data-stu-id="7371f-207">Select the **Log out** button.</span></span> <span data-ttu-id="7371f-208">Sie werden zum Anmeldeformular umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="7371f-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="7371f-209">Geben Sie einen ungültigen Benutzernamen oder ein Kennwort ein, und wählen Sie die Schaltfläche **Anmelden**</span><span class="sxs-lookup"><span data-stu-id="7371f-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="7371f-210">Die `UserManager.Find`-Methode gibt NULL zurück, und die Fehlermeldung " *Ungültiger Benutzername oder Kennwort* " wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="7371f-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
