---
uid: identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
title: Migrieren einer vorhandenen Website von der SQL-Mitgliedschaft zu ASP.net Identity-ASP.NET 4. x
author: Rick-Anderson
description: In diesem Tutorial werden die Schritte zum Migrieren einer vorhandenen Webanwendung mit Benutzer-und Rollen Daten veranschaulicht, die mithilfe der SQL-Mitgliedschaft zum neuen ASP.net Identity s erstellt wurden...
ms.author: riande
ms.date: 12/19/2014
ms.custom: seoapril2019
ms.assetid: 220d3d75-16b2-4240-beae-a5b534f06419
msc.legacyurl: /identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 633229cc4311d151121bf6a91b9fa8aeecca1197
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471633"
---
# <a name="migrating-an-existing-website-from-sql-membership-to-aspnet-identity"></a><span data-ttu-id="8c92f-103">Migrieren einer vorhandenen Website von einem SQL-Mitgliedschaftsanbieter zu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="8c92f-103">Migrating an Existing Website from SQL Membership to ASP.NET Identity</span></span>

<span data-ttu-id="8c92f-104">von [Rick Anderson](https://twitter.com/RickAndMSFT), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="8c92f-104">by [Rick Anderson](https://twitter.com/RickAndMSFT), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="8c92f-105">In diesem Tutorial werden die Schritte zum Migrieren einer vorhandenen Webanwendung mit Benutzer-und Rollen Daten erläutert, die mit der SQL-Mitgliedschaft für das neue ASP.net Identity System erstellt wurden</span><span class="sxs-lookup"><span data-stu-id="8c92f-105">This tutorial illustrates the steps to migrate an existing web application with user and role data created using SQL Membership to the new ASP.NET Identity system.</span></span> <span data-ttu-id="8c92f-106">Diese Vorgehensweise umfasst das Ändern des vorhandenen Datenbankschemas in das, das von der ASP.net Identity benötigt wird, und das Hook in den alten bzw. neuen Klassen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-106">This approach involves changing the existing database schema to the one needed by the ASP.NET Identity and hook in the old/new classes to it.</span></span> <span data-ttu-id="8c92f-107">Nachdem Sie diesen Ansatz übernommen haben, werden zukünftige Updates der Identität nach der Migration der Datenbank mühelos behandelt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-107">After you adopt this approach, once your database is migrated, future updates to Identity will be handled effortlessly.</span></span>

<span data-ttu-id="8c92f-108">In diesem Tutorial erstellen wir eine webanwendungvorlage (Web Forms), die mithilfe von Visual Studio 2010 erstellt wird, um Benutzer-und Rollen Daten zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-108">For this tutorial, we will take a web application template (Web Forms) created using Visual Studio 2010 to create user and role data.</span></span> <span data-ttu-id="8c92f-109">Anschließend werden SQL-Skripts verwendet, um die vorhandene Datenbank zu den vom Identitätssystem benötigten Tabellen zu migrieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-109">We will then use SQL scripts to migrate the existing database to tables needed by the Identity system.</span></span> <span data-ttu-id="8c92f-110">Als nächstes installieren Sie die erforderlichen nuget-Pakete und fügen neue Kontoverwaltungsseiten hinzu, die das Identitätssystem für die Mitgliedschafts Verwaltung verwenden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-110">Next we'll install the necessary NuGet packages and add new account management pages which use the Identity system for membership management.</span></span> <span data-ttu-id="8c92f-111">Als Migrationstest sollten Benutzer, die mithilfe der SQL-Mitgliedschaft erstellt wurden, sich anmelden können, und neue Benutzer sollten sich registrieren können.</span><span class="sxs-lookup"><span data-stu-id="8c92f-111">As a test of migration, users created using SQL membership should be able to log in and new users should be able to register.</span></span> <span data-ttu-id="8c92f-112">Das vollständige Beispiel finden Sie [hier](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/).</span><span class="sxs-lookup"><span data-stu-id="8c92f-112">You can find the complete sample [here](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/).</span></span> <span data-ttu-id="8c92f-113">Siehe auch [Migrieren von ASP.NET Mitgliedschaft zu ASP.net Identity](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span><span class="sxs-lookup"><span data-stu-id="8c92f-113">See also [Migrating from ASP.NET Membership to ASP.NET Identity](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span></span>

## <a name="getting-started"></a><span data-ttu-id="8c92f-114">Erste Schritte</span><span class="sxs-lookup"><span data-stu-id="8c92f-114">Getting started</span></span>

### <a name="creating-an-application-with-sql-membership"></a><span data-ttu-id="8c92f-115">Erstellen einer Anwendung mit SQL-Mitgliedschaft</span><span class="sxs-lookup"><span data-stu-id="8c92f-115">Creating an application with SQL Membership</span></span>

1. <span data-ttu-id="8c92f-116">Wir müssen mit einer vorhandenen Anwendung beginnen, die die SQL-Mitgliedschaft verwendet und über Benutzer-und Rollen Daten verfügt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-116">We need to start with an existing application that uses SQL membership and has user and role data.</span></span> <span data-ttu-id="8c92f-117">Im Rahmen dieses Artikels erstellen wir eine Webanwendung in Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="8c92f-117">For the purpose of this article, let's create a web application in Visual Studio 2010.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="8c92f-118">Erstellen Sie mit dem ASP.NET-Konfigurationstool 2 Benutzer: **oldadminuser** und **olduser.**</span><span class="sxs-lookup"><span data-stu-id="8c92f-118">Using the ASP.NET Configuration tool, create 2 users: **oldAdminUser** and **oldUser.**</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.jpg)
3. <span data-ttu-id="8c92f-119">Erstellen Sie eine Rolle mit dem Namen admin, und fügen Sie in dieser Rolle "oldadminuser" als Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="8c92f-119">Create a role named Admin and add 'oldAdminUser' as a user in that role.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.png)
4. <span data-ttu-id="8c92f-120">Erstellen Sie einen Administrator Abschnitt der Site mit der Standardeinstellung. aspx.</span><span class="sxs-lookup"><span data-stu-id="8c92f-120">Create an Admin section of the site with a Default.aspx.</span></span> <span data-ttu-id="8c92f-121">Legen Sie das Autorisierungs-Tag in der Datei "Web. config" fest, um den Zugriff nur Benutzern in Administrator Rollen zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-121">Set the authorization tag in the web.config file to enable access only to users in Admin roles.</span></span> <span data-ttu-id="8c92f-122">Weitere Informationen finden Sie hier [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8c92f-122">More information can be found here [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.png)
5. <span data-ttu-id="8c92f-123">Zeigen Sie die Datenbank in Server-Explorer an, um die vom SQL-Mitgliedschaftssystem erstellten Tabellen zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-123">View the database in Server Explorer to understand the tables created by the SQL membership system.</span></span> <span data-ttu-id="8c92f-124">Die Benutzer Anmeldedaten werden in den ASPNET-\_Benutzer-und ASPNET-\_Mitgliedschafts Tabellen gespeichert, während Rollen Daten in der Tabelle "ASPNET\_Rollen" gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-124">The user login data is stored in the aspnet\_Users and aspnet\_Membership tables, while role data is stored in the aspnet\_Roles table.</span></span> <span data-ttu-id="8c92f-125">Informationen dazu, in welchen Benutzern Rollen in der Tabelle ASPNET\_usersinrollen gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-125">Information about which users are in which roles is stored in the aspnet\_UsersInRoles table.</span></span> <span data-ttu-id="8c92f-126">Bei der grundlegenden Verwaltung ist es ausreichend, die Informationen in den obigen Tabellen auf das ASP.net Identity System zu portieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-126">For basic membership management it is sufficient to port the information in the above tables to the ASP.NET Identity system.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.png)

### <a name="migrating-to-visual-studio-2013"></a><span data-ttu-id="8c92f-127">Migrieren zu Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="8c92f-127">Migrating to Visual Studio 2013</span></span>

1. <span data-ttu-id="8c92f-128">Installieren Sie Visual Studio Express 2013 für Web oder Visual Studio 2013 zusammen mit den [neuesten Updates](https://www.microsoft.com/download/details.aspx?id=44921).</span><span class="sxs-lookup"><span data-stu-id="8c92f-128">Install Visual Studio Express 2013 for Web or Visual Studio 2013 along with the [latest updates](https://www.microsoft.com/download/details.aspx?id=44921).</span></span>
2. <span data-ttu-id="8c92f-129">Öffnen Sie das obige Projekt in der installierten Version von Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8c92f-129">Open the above project in your installed version of Visual Studio.</span></span> <span data-ttu-id="8c92f-130">Wenn SQL Server Express nicht auf dem Computer installiert ist, wird eine Eingabeaufforderung angezeigt, wenn Sie das Projekt öffnen, da die Verbindungs Zeichenfolge SQL Express verwendet.</span><span class="sxs-lookup"><span data-stu-id="8c92f-130">If SQL Server Express is not installed on the machine, a prompt is displayed when you open the project, since the connection string uses SQL Express.</span></span> <span data-ttu-id="8c92f-131">Sie können entweder SQL Express installieren oder die Verbindungs Zeichenfolge in localdb ändern.</span><span class="sxs-lookup"><span data-stu-id="8c92f-131">You can either choose to install SQL Express or as work around change the connection string to LocalDb.</span></span> <span data-ttu-id="8c92f-132">In diesem Artikel wird der Wert in localdb geändert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-132">For this article we'll change it to LocalDb.</span></span>
3. <span data-ttu-id="8c92f-133">Öffnen Sie Web. config, und ändern Sie die Verbindungs Zeichenfolge von. SQLExpress zu (localdb) v 11.0.</span><span class="sxs-lookup"><span data-stu-id="8c92f-133">Open web.config and change the connection string from .SQLExpress to (LocalDb)v11.0.</span></span> <span data-ttu-id="8c92f-134">Entfernen Sie "User Instance = true" aus der Verbindungs Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="8c92f-134">Remove 'User Instance=true' from the connection string.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.jpg)
4. <span data-ttu-id="8c92f-135">Öffnen Sie Server-Explorer, und überprüfen Sie, ob das Tabellen Schema und die Daten beobachtet werden können.</span><span class="sxs-lookup"><span data-stu-id="8c92f-135">Open Server Explorer and verify that the table schema and data can be observed.</span></span>
5. <span data-ttu-id="8c92f-136">Das ASP.net Identity System kann mit Version 4,5 oder höher des Frameworks verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-136">The ASP.NET Identity system works with version 4.5 or higher of the framework.</span></span> <span data-ttu-id="8c92f-137">Richten Sie die Anwendung erneut auf 4,5 oder höher aus.</span><span class="sxs-lookup"><span data-stu-id="8c92f-137">Retarget the application to 4.5 or higher.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image5.png)

    <span data-ttu-id="8c92f-138">Erstellen Sie das Projekt, um sicherzustellen, dass keine Fehler vorliegen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-138">Build the project to verify that there are no errors.</span></span>

### <a name="installing-the-nuget-packages"></a><span data-ttu-id="8c92f-139">Installieren von nuget-Paketen</span><span class="sxs-lookup"><span data-stu-id="8c92f-139">Installing the Nuget packages</span></span>

1. <span data-ttu-id="8c92f-140">Klicken Sie in Projektmappen-Explorer mit der rechten Maustaste auf das Projekt &gt; **nuget-Pakete verwalten**.</span><span class="sxs-lookup"><span data-stu-id="8c92f-140">In Solution Explorer, right-click the project &gt; **Manage NuGet Packages**.</span></span> <span data-ttu-id="8c92f-141">Geben Sie im Suchfeld "ASP.net Identity" ein.</span><span class="sxs-lookup"><span data-stu-id="8c92f-141">In the search box, enter "Asp.net Identity".</span></span> <span data-ttu-id="8c92f-142">Wählen Sie das Paket in der Liste der Ergebnisse aus, und klicken Sie auf installieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-142">Select the package in the list of results and click install.</span></span> <span data-ttu-id="8c92f-143">Akzeptieren Sie den Lizenzvertrag, indem Sie auf die Schaltfläche "Ich stimme zu" klicken.</span><span class="sxs-lookup"><span data-stu-id="8c92f-143">Accept the license agreement by clicking on "I Accept" button.</span></span> <span data-ttu-id="8c92f-144">Beachten Sie, dass mit diesem Paket die Abhängigkeits Pakete installiert werden: EntityFramework und Microsoft ASP.net Identity Core.</span><span class="sxs-lookup"><span data-stu-id="8c92f-144">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span> <span data-ttu-id="8c92f-145">Installieren Sie auf ähnliche Weise die folgenden Pakete (überspringen Sie die letzten vier owin-Pakete, wenn Sie die OAuth-Anmeldung nicht aktivieren möchten):</span><span class="sxs-lookup"><span data-stu-id="8c92f-145">Similarly install the following packages (skip the last 4 OWIN packages if you don't want to enable OAuth log-in):</span></span>

   - <span data-ttu-id="8c92f-146">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="8c92f-146">Microsoft.AspNet.Identity.Owin</span></span>
   - <span data-ttu-id="8c92f-147">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="8c92f-147">Microsoft.Owin.Host.SystemWeb</span></span>
   - <span data-ttu-id="8c92f-148">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="8c92f-148">Microsoft.Owin.Security.Facebook</span></span>
   - <span data-ttu-id="8c92f-149">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="8c92f-149">Microsoft.Owin.Security.Google</span></span>
   - <span data-ttu-id="8c92f-150">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="8c92f-150">Microsoft.Owin.Security.MicrosoftAccount</span></span>
   - <span data-ttu-id="8c92f-151">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="8c92f-151">Microsoft.Owin.Security.Twitter</span></span>

     ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image6.png)

### <a name="migrate-database-to-the-new-identity-system"></a><span data-ttu-id="8c92f-152">Migrieren der Datenbank zum neuen Identitätssystem</span><span class="sxs-lookup"><span data-stu-id="8c92f-152">Migrate database to the new Identity system</span></span>

<span data-ttu-id="8c92f-153">Der nächste Schritt besteht darin, die vorhandene Datenbank zu einem Schema zu migrieren, das für das ASP.net Identity System erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="8c92f-153">The next step is to migrate the existing database to a schema required by the ASP.NET Identity system.</span></span> <span data-ttu-id="8c92f-154">Um dies zu erreichen, führen wir ein SQL-Skript aus, das über eine Reihe von Befehlen zum Erstellen neuer Tabellen und zum Migrieren vorhandener Benutzerinformationen zu den neuen Tabellen verfügt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-154">To achieve this we run a SQL script which has a set of commands to create new tables and migrate existing user information to the new tables.</span></span> <span data-ttu-id="8c92f-155">Die Skriptdatei finden Sie [hier](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span><span class="sxs-lookup"><span data-stu-id="8c92f-155">The script file can be found [here](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span></span>

<span data-ttu-id="8c92f-156">Diese Skriptdatei ist spezifisch für dieses Beispiel.</span><span class="sxs-lookup"><span data-stu-id="8c92f-156">This script file is specific to this sample.</span></span> <span data-ttu-id="8c92f-157">Wenn das Schema für die mit der SQL-Mitgliedschaft erstellten Tabellen angepasst oder geändert wird, müssen die Skripts entsprechend geändert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-157">If the schema for the tables created using SQL membership is customized or modified the scripts need to be changed accordingly.</span></span>

### <a name="how-to-generate-the-sql-script-for-schema-migration"></a><span data-ttu-id="8c92f-158">Generieren des SQL-Skripts für die Schema Migration</span><span class="sxs-lookup"><span data-stu-id="8c92f-158">How to generate the SQL script for schema migration</span></span>

<span data-ttu-id="8c92f-159">Damit ASP.net Identity Klassen mit den Daten vorhandener Benutzer standardmäßig arbeiten können, müssen wir das Datenbankschema zu dem ASP.net Identity migrieren, das von benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="8c92f-159">For ASP.NET Identity classes to work out of the box with the data of existing users, we need to migrate the database schema to the one needed by ASP.NET Identity.</span></span> <span data-ttu-id="8c92f-160">Hierzu können Sie neue Tabellen hinzufügen und die vorhandenen Informationen in diese Tabellen kopieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-160">We can do this by adding new tables and copying the existing information to those tables.</span></span> <span data-ttu-id="8c92f-161">Standardmäßig verwendet ASP.net Identity EntityFramework, um die Identitäts Modellklassen wieder der Datenbank zuzuordnen, um Informationen zu speichern/abzurufen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-161">By default ASP.NET Identity uses EntityFramework to map the Identity model classes back to the database to store/retrieve information.</span></span> <span data-ttu-id="8c92f-162">Diese Modellklassen implementieren die wichtigsten Identitäts Schnittstellen, die Benutzer-und Rollen Objekte definieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-162">These model classes implement the core Identity interfaces defining user and role objects.</span></span> <span data-ttu-id="8c92f-163">Die Tabellen und die Spalten in der Datenbank basieren auf diesen Modellklassen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-163">The tables and the columns in the database are based on these model classes.</span></span> <span data-ttu-id="8c92f-164">Die EntityFramework-Modellklassen in Identity v 2.1.0 und deren Eigenschaften sind wie unten definiert definiert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-164">The EntityFramework model classes in Identity v2.1.0 and their properties are as defined below</span></span>

| <span data-ttu-id="8c92f-165">**Identityuser**</span><span class="sxs-lookup"><span data-stu-id="8c92f-165">**IdentityUser**</span></span> | <span data-ttu-id="8c92f-166">**Typ**</span><span class="sxs-lookup"><span data-stu-id="8c92f-166">**Type**</span></span> | <span data-ttu-id="8c92f-167">**Identityrole**</span><span class="sxs-lookup"><span data-stu-id="8c92f-167">**IdentityRole**</span></span> | <span data-ttu-id="8c92f-168">**Identityuserrole**</span><span class="sxs-lookup"><span data-stu-id="8c92f-168">**IdentityUserRole**</span></span> | <span data-ttu-id="8c92f-169">**Identityuserlogin**</span><span class="sxs-lookup"><span data-stu-id="8c92f-169">**IdentityUserLogin**</span></span> | <span data-ttu-id="8c92f-170">**Identityuserclaim**</span><span class="sxs-lookup"><span data-stu-id="8c92f-170">**IdentityUserClaim**</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="8c92f-171">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-171">Id</span></span> | <span data-ttu-id="8c92f-172">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-172">string</span></span> | <span data-ttu-id="8c92f-173">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-173">Id</span></span> | <span data-ttu-id="8c92f-174">RoleId</span><span class="sxs-lookup"><span data-stu-id="8c92f-174">RoleId</span></span> | <span data-ttu-id="8c92f-175">Providerkey</span><span class="sxs-lookup"><span data-stu-id="8c92f-175">ProviderKey</span></span> | <span data-ttu-id="8c92f-176">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-176">Id</span></span> |
| <span data-ttu-id="8c92f-177">Username</span><span class="sxs-lookup"><span data-stu-id="8c92f-177">Username</span></span> | <span data-ttu-id="8c92f-178">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-178">string</span></span> | <span data-ttu-id="8c92f-179">Name</span><span class="sxs-lookup"><span data-stu-id="8c92f-179">Name</span></span> | <span data-ttu-id="8c92f-180">UserId</span><span class="sxs-lookup"><span data-stu-id="8c92f-180">UserId</span></span> | <span data-ttu-id="8c92f-181">UserId</span><span class="sxs-lookup"><span data-stu-id="8c92f-181">UserId</span></span> | <span data-ttu-id="8c92f-182">ClaimType</span><span class="sxs-lookup"><span data-stu-id="8c92f-182">ClaimType</span></span> |
| <span data-ttu-id="8c92f-183">PasswordHash</span><span class="sxs-lookup"><span data-stu-id="8c92f-183">PasswordHash</span></span> | <span data-ttu-id="8c92f-184">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-184">string</span></span> |  |  | <span data-ttu-id="8c92f-185">LoginProvider</span><span class="sxs-lookup"><span data-stu-id="8c92f-185">LoginProvider</span></span> | <span data-ttu-id="8c92f-186">ClaimValue</span><span class="sxs-lookup"><span data-stu-id="8c92f-186">ClaimValue</span></span> |
| <span data-ttu-id="8c92f-187">Securitystamp</span><span class="sxs-lookup"><span data-stu-id="8c92f-187">SecurityStamp</span></span> | <span data-ttu-id="8c92f-188">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-188">string</span></span> |  |  |  | <span data-ttu-id="8c92f-189">Benutzer\_-ID</span><span class="sxs-lookup"><span data-stu-id="8c92f-189">User\_Id</span></span> |
| <span data-ttu-id="8c92f-190">E-Mail</span><span class="sxs-lookup"><span data-stu-id="8c92f-190">Email</span></span> | <span data-ttu-id="8c92f-191">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-191">string</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-192">Emailbestätigt</span><span class="sxs-lookup"><span data-stu-id="8c92f-192">EmailConfirmed</span></span> | <span data-ttu-id="8c92f-193">bool</span><span class="sxs-lookup"><span data-stu-id="8c92f-193">bool</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-194">PhoneNumber</span><span class="sxs-lookup"><span data-stu-id="8c92f-194">PhoneNumber</span></span> | <span data-ttu-id="8c92f-195">string</span><span class="sxs-lookup"><span data-stu-id="8c92f-195">string</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-196">PhoneNumberConfirmed</span><span class="sxs-lookup"><span data-stu-id="8c92f-196">PhoneNumberConfirmed</span></span> | <span data-ttu-id="8c92f-197">bool</span><span class="sxs-lookup"><span data-stu-id="8c92f-197">bool</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-198">LockoutEnabled</span><span class="sxs-lookup"><span data-stu-id="8c92f-198">LockoutEnabled</span></span> | <span data-ttu-id="8c92f-199">bool</span><span class="sxs-lookup"><span data-stu-id="8c92f-199">bool</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-200">LockoutEndDate</span><span class="sxs-lookup"><span data-stu-id="8c92f-200">LockoutEndDate</span></span> | <span data-ttu-id="8c92f-201">DateTime</span><span class="sxs-lookup"><span data-stu-id="8c92f-201">DateTime</span></span> |  |  |  |  |
| <span data-ttu-id="8c92f-202">AccessFailedCount</span><span class="sxs-lookup"><span data-stu-id="8c92f-202">AccessFailedCount</span></span> | <span data-ttu-id="8c92f-203">int</span><span class="sxs-lookup"><span data-stu-id="8c92f-203">int</span></span> |  |  |  |  |

<span data-ttu-id="8c92f-204">Wir müssen für jedes dieser Modelle Tabellen mit Spalten aufweisen, die den Eigenschaften entsprechen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-204">We need to have tables for each of these models with columns corresponding to the properties.</span></span> <span data-ttu-id="8c92f-205">Die Zuordnung zwischen Klassen und Tabellen wird in der `OnModelCreating`-Methode der `IdentityDBContext`definiert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-205">The mapping between classes and tables is defined in the `OnModelCreating` method of the `IdentityDBContext`.</span></span> <span data-ttu-id="8c92f-206">Dies wird als fließende API-Methode der Konfiguration bezeichnet. Weitere Informationen finden Sie [hier](https://msdn.microsoft.com/data/jj591617.aspx).</span><span class="sxs-lookup"><span data-stu-id="8c92f-206">This is known as the fluent API method of configuration and more information can be found [here](https://msdn.microsoft.com/data/jj591617.aspx).</span></span> <span data-ttu-id="8c92f-207">Die Konfiguration für die Klassen ist wie unten beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8c92f-207">The configuration for the classes is as mentioned below</span></span>

| <span data-ttu-id="8c92f-208">**Klasse**</span><span class="sxs-lookup"><span data-stu-id="8c92f-208">**Class**</span></span> | <span data-ttu-id="8c92f-209">**Table**</span><span class="sxs-lookup"><span data-stu-id="8c92f-209">**Table**</span></span> | <span data-ttu-id="8c92f-210">**Primärschlüssel**</span><span class="sxs-lookup"><span data-stu-id="8c92f-210">**Primary key**</span></span> | <span data-ttu-id="8c92f-211">**Fremdschlüssel**</span><span class="sxs-lookup"><span data-stu-id="8c92f-211">**Foreign key**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8c92f-212">IdentityUser</span><span class="sxs-lookup"><span data-stu-id="8c92f-212">IdentityUser</span></span> | <span data-ttu-id="8c92f-213">AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="8c92f-213">AspnetUsers</span></span> | <span data-ttu-id="8c92f-214">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-214">Id</span></span> |  |
| <span data-ttu-id="8c92f-215">IdentityRole</span><span class="sxs-lookup"><span data-stu-id="8c92f-215">IdentityRole</span></span> | <span data-ttu-id="8c92f-216">AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="8c92f-216">AspnetRoles</span></span> | <span data-ttu-id="8c92f-217">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-217">Id</span></span> |  |
| <span data-ttu-id="8c92f-218">IdentityUserRole</span><span class="sxs-lookup"><span data-stu-id="8c92f-218">IdentityUserRole</span></span> | <span data-ttu-id="8c92f-219">AspnetUserRole</span><span class="sxs-lookup"><span data-stu-id="8c92f-219">AspnetUserRole</span></span> | <span data-ttu-id="8c92f-220">UserID + RoleID</span><span class="sxs-lookup"><span data-stu-id="8c92f-220">UserId + RoleId</span></span> | <span data-ttu-id="8c92f-221">Benutzer\_-ID-&gt;aspnettusers RoleID-&gt;aspnettroles</span><span class="sxs-lookup"><span data-stu-id="8c92f-221">User\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span></span> |
| <span data-ttu-id="8c92f-222">IdentityUserLogin</span><span class="sxs-lookup"><span data-stu-id="8c92f-222">IdentityUserLogin</span></span> | <span data-ttu-id="8c92f-223">AspnetUserLogins</span><span class="sxs-lookup"><span data-stu-id="8c92f-223">AspnetUserLogins</span></span> | <span data-ttu-id="8c92f-224">Providerkey + UserID und loginprovider</span><span class="sxs-lookup"><span data-stu-id="8c92f-224">ProviderKey+UserId + LoginProvider</span></span> | <span data-ttu-id="8c92f-225">UserID-&gt;aspnettusers</span><span class="sxs-lookup"><span data-stu-id="8c92f-225">UserId-&gt;AspnetUsers</span></span> |
| <span data-ttu-id="8c92f-226">IdentityUserClaim</span><span class="sxs-lookup"><span data-stu-id="8c92f-226">IdentityUserClaim</span></span> | <span data-ttu-id="8c92f-227">AspnetUserClaims</span><span class="sxs-lookup"><span data-stu-id="8c92f-227">AspnetUserClaims</span></span> | <span data-ttu-id="8c92f-228">Id</span><span class="sxs-lookup"><span data-stu-id="8c92f-228">Id</span></span> | <span data-ttu-id="8c92f-229">Benutzer\_ID-&gt;aspnettusers</span><span class="sxs-lookup"><span data-stu-id="8c92f-229">User\_Id-&gt;AspnetUsers</span></span> |

<span data-ttu-id="8c92f-230">Mit diesen Informationen können wir SQL-Anweisungen erstellen, um neue Tabellen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-230">With this information we can create SQL statements to create new tables.</span></span> <span data-ttu-id="8c92f-231">Wir können entweder jede Anweisung einzeln schreiben oder das gesamte Skript mithilfe von EntityFramework PowerShell-Befehlen generieren, die wir dann nach Bedarf bearbeiten können.</span><span class="sxs-lookup"><span data-stu-id="8c92f-231">We can either write each statement individually or generate the entire script using EntityFramework PowerShell commands which we can then edit as required.</span></span> <span data-ttu-id="8c92f-232">Öffnen Sie hierzu in Visual Studio die **Paket-Manager-Konsole** über das Menü " **Ansicht** " oder " **Tools** ".</span><span class="sxs-lookup"><span data-stu-id="8c92f-232">To do this, in VS open the **Package Manager Console** from the **View** or **Tools** menu</span></span>

- <span data-ttu-id="8c92f-233">Führen Sie den Befehl "Enable-Migrationen" zum Aktivieren von EntityFramework-Migrationen aus</span><span class="sxs-lookup"><span data-stu-id="8c92f-233">Run command "Enable-Migrations" to enable EntityFramework migrations.</span></span>
- <span data-ttu-id="8c92f-234">Führen Sie den Befehl "Add-Migration Initial" aus, mit dem der anfängliche Setup Code zum C#Erstellen der Datenbank in/VB. erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="8c92f-234">Run command "Add-migration initial" which creates the initial setup code to create the database in C#/VB.</span></span>
- <span data-ttu-id="8c92f-235">Der letzte Schritt besteht darin, den Befehl "Update-Database – Script" auszuführen, der das SQL-Skript basierend auf den Modellklassen generiert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-235">The final step is to run "Update-Database –Script" command that generates the SQL script based on the model classes.</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

<span data-ttu-id="8c92f-236">Dieses Daten Bank Generierungs Skript kann als Start verwendet werden, bei dem wir zusätzliche Änderungen vornehmen, um neue Spalten hinzuzufügen und Daten zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-236">This database generation script can be used as a start where we'll be making additional changes to add new columns and copy data.</span></span> <span data-ttu-id="8c92f-237">Der Vorteil besteht darin, dass die `_MigrationHistory` Tabelle generiert wird, die von EntityFramework verwendet wird, um das Datenbankschema zu ändern, wenn sich die Modellklassen für zukünftige Versionen der Identitäts Releases ändern.</span><span class="sxs-lookup"><span data-stu-id="8c92f-237">The advantage of this is that we generate the `_MigrationHistory` table which is used by EntityFramework to modify the database schema when the model classes change for future versions of Identity releases.</span></span>

<span data-ttu-id="8c92f-238">Die Informationen zu den SQL-Mitgliedschafts Benutzern waren zusätzlich zu den in der Identitäts Benutzer Modell-Klasse genannten Eigenschaften, z. b. e-Mail, Kenn Wort Versuche, letztes Anmeldungs Datum, letztes Sperr Datum usw. Dies sind nützliche Informationen, die wir auf das Identitätssystem übertragen möchten.</span><span class="sxs-lookup"><span data-stu-id="8c92f-238">The SQL membership user information had other properties in addition to the ones in the Identity user model class namely email, password attempts, last login date, last lock-out date etc. This is useful information and we would like it to be carried over to the Identity system.</span></span> <span data-ttu-id="8c92f-239">Dies können Sie erreichen, indem Sie dem Benutzer Modell weitere Eigenschaften hinzufügen und diese den Tabellen Spalten in der Datenbank wieder zuordnen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-239">This can be done by adding additional properties to the user model and mapping them back to the table columns in the database.</span></span> <span data-ttu-id="8c92f-240">Hierfür können Sie eine Klasse hinzufügen, die das `IdentityUser` Modell Unterklassen unterteilt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-240">We can do this by adding a class that subclasses the `IdentityUser` model.</span></span> <span data-ttu-id="8c92f-241">Wir können dieser benutzerdefinierten Klasse die Eigenschaften hinzufügen und das SQL-Skript bearbeiten, um beim Erstellen der Tabelle die entsprechenden Spalten hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-241">We can add the properties to this custom class and edit the SQL script to add the corresponding columns when creating the table.</span></span> <span data-ttu-id="8c92f-242">Der Code für diese Klasse wird weiter unten in diesem Artikel beschrieben.</span><span class="sxs-lookup"><span data-stu-id="8c92f-242">The code for this class is described further in the article.</span></span> <span data-ttu-id="8c92f-243">Das SQL-Skript zum Erstellen der `AspnetUsers` Tabelle nach dem Hinzufügen der neuen Eigenschaften wäre</span><span class="sxs-lookup"><span data-stu-id="8c92f-243">The SQL script for creating the `AspnetUsers` table after adding the new properties would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample1.sql)]

<span data-ttu-id="8c92f-244">Als nächstes müssen die vorhandenen Informationen aus der SQL-Mitgliedschafts Datenbank in die neu hinzugefügten Tabellen für die Identität kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-244">Next we need to copy the existing information from the SQL membership database to the newly added tables for Identity.</span></span> <span data-ttu-id="8c92f-245">Dies kann mithilfe von SQL erreicht werden, indem Daten direkt aus einer Tabelle in eine andere kopiert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-245">This can be done through SQL by copying data directly from one table to another.</span></span> <span data-ttu-id="8c92f-246">Zum Hinzufügen von Daten zu den Zeilen der Tabelle verwenden wir das `INSERT INTO [Table]`-Konstrukt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-246">To add data into the rows of table, we use the `INSERT INTO [Table]` construct.</span></span> <span data-ttu-id="8c92f-247">Zum Kopieren aus einer anderen Tabelle können wir die `INSERT INTO`-Anweisung zusammen mit der `SELECT`-Anweisung verwenden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-247">To copy from another table we can use the `INSERT INTO` statement along with the `SELECT` statement.</span></span> <span data-ttu-id="8c92f-248">Um alle Benutzerinformationen zu erhalten, müssen wir die *ASPNET-\_Benutzer* und *ASPNET\_Mitgliedschafts* Tabellen Abfragen und die Daten in die *aspnettusers* -Tabelle kopieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-248">To get all the user information we need to query the *aspnet\_Users* and *aspnet\_Membership* tables and copy the data to the *AspNetUsers* table.</span></span> <span data-ttu-id="8c92f-249">Die `INSERT INTO` und `SELECT` werden zusammen mit `JOIN`-und `LEFT OUTER JOIN`-Anweisungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="8c92f-249">We use the `INSERT INTO` and `SELECT` along with `JOIN` and `LEFT OUTER JOIN` statements.</span></span> <span data-ttu-id="8c92f-250">Weitere Informationen zum Abfragen und Kopieren von Daten zwischen Tabellen finden Sie unter [diesem](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) Link.</span><span class="sxs-lookup"><span data-stu-id="8c92f-250">For more information about querying and copying data between tables, refer to [this](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) link.</span></span> <span data-ttu-id="8c92f-251">Außerdem sind die aspnettuserlogins-Tabelle und die aspnettuserclaims-Tabelle leer, damit Sie mit beginnen, da in der SQL-Mitgliedschaft keine Informationen vorhanden sind, die dieser standardmäßig zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="8c92f-251">Additionally the AspnetUserLogins and AspnetUserClaims tables are empty to begin with since there is no information in SQL membership that maps to this by default.</span></span> <span data-ttu-id="8c92f-252">Die einzigen kopierten Informationen sind für Benutzer und Rollen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-252">The only information copied is for users and roles.</span></span> <span data-ttu-id="8c92f-253">Für das Projekt, das in den vorherigen Schritten erstellt wurde, würde die SQL-Abfrage zum Kopieren von Informationen in die Tabelle "Benutzer" lauten.</span><span class="sxs-lookup"><span data-stu-id="8c92f-253">For the project created in the previous steps, the SQL query to copy information to the users table would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample2.sql)]

<span data-ttu-id="8c92f-254">In der obigen SQL-Anweisung werden Informationen zu jedem Benutzer aus der *ASPNET-\_Benutzer* und *ASPNET\_Mitgliedschafts* Tabellen in die Spalten der *aspnettusers* -Tabelle kopiert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-254">In the above SQL statement, information about each user from the *aspnet\_Users* and *aspnet\_Membership* tables is copied into the columns of the *AspnetUsers* table.</span></span> <span data-ttu-id="8c92f-255">Die einzige Änderung, die hier vorgenommen wird, ist das Kopieren des Kennworts.</span><span class="sxs-lookup"><span data-stu-id="8c92f-255">The only modification done here is when we copy the password.</span></span> <span data-ttu-id="8c92f-256">Da der Verschlüsselungsalgorithmus für Kenn Wörter in der SQL-Mitgliedschaft ' PasswordSalt ' und ' PasswordFormat ' verwendet hat, kopieren wir das ebenfalls zusammen mit dem Hashwert-Kennwort, damit es zum Entschlüsseln des Kennworts nach Identität verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="8c92f-256">Since the encryption algorithm for passwords in SQL membership used 'PasswordSalt' and 'PasswordFormat', we copy that too along with the hashed password so that it can be used to decrypt the password by Identity.</span></span> <span data-ttu-id="8c92f-257">Dies wird weiter unten in diesem Artikel erläutert, wenn Sie ein benutzerdefiniertes Kennwort für das Kennwort einbinden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-257">This is explained further in the article when hooking up a custom password hasher.</span></span>

<span data-ttu-id="8c92f-258">Diese Skriptdatei ist spezifisch für dieses Beispiel.</span><span class="sxs-lookup"><span data-stu-id="8c92f-258">This script file is specific to this sample.</span></span> <span data-ttu-id="8c92f-259">Bei Anwendungen mit zusätzlichen Tabellen können Entwickler einem ähnlichen Ansatz folgen, um zusätzliche Eigenschaften für die Benutzer Modell Klasse hinzuzufügen und diese Spalten in der Tabelle "aspnettusers" zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-259">For applications which have additional tables, developers can follow a similar approach to add additional properties on the user model class and map them to columns in the AspnetUsers table.</span></span> <span data-ttu-id="8c92f-260">So führen Sie das Skript aus</span><span class="sxs-lookup"><span data-stu-id="8c92f-260">To run the script,</span></span>

1. <span data-ttu-id="8c92f-261">Öffnen Sie Server-Explorer.</span><span class="sxs-lookup"><span data-stu-id="8c92f-261">Open Server Explorer.</span></span> <span data-ttu-id="8c92f-262">Erweitern Sie die ApplicationServices-Verbindung, um die Tabellen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-262">Expand the 'ApplicationServices' connection to display the tables.</span></span> <span data-ttu-id="8c92f-263">Klicken Sie mit der rechten Maustaste auf den Knoten Tabellen, und wählen Sie die Option Neue Abfrage aus.</span><span class="sxs-lookup"><span data-stu-id="8c92f-263">Right click on the Tables node and select the 'New Query' option</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image7.png)
2. <span data-ttu-id="8c92f-264">Kopieren Sie im Abfragefenster das gesamte SQL-Skript, und fügen Sie es aus der Datei Migrationen. SQL ein.</span><span class="sxs-lookup"><span data-stu-id="8c92f-264">In the query window, copy and paste the entire SQL script from the Migrations.sql file.</span></span> <span data-ttu-id="8c92f-265">Führen Sie die Skriptdatei aus, indem Sie auf die Schaltfläche "ausführen" klicken.</span><span class="sxs-lookup"><span data-stu-id="8c92f-265">Run the script file by hitting the 'Execute' arrow button.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.jpg)

    <span data-ttu-id="8c92f-266">Aktualisieren Sie das Fenster Server-Explorer.</span><span class="sxs-lookup"><span data-stu-id="8c92f-266">Refresh the Server Explorer window.</span></span> <span data-ttu-id="8c92f-267">In der Datenbank werden fünf neue Tabellen erstellt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-267">Five new tables are created in the database.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image8.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image9.png)

    <span data-ttu-id="8c92f-268">Im folgenden wird erläutert, wie die Informationen in den SQL-Mitgliedschafts Tabellen dem neuen Identitätssystem zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-268">Below is how the information in the SQL membership tables are mapped to the new Identity system.</span></span>

    <span data-ttu-id="8c92f-269">ASPNET-\_Rollen--&gt; aspnettroles</span><span class="sxs-lookup"><span data-stu-id="8c92f-269">aspnet\_Roles --&gt; AspNetRoles</span></span>

    <span data-ttu-id="8c92f-270">ASP\_nettusers und ASP\_netmembership--&gt; aspnettusers</span><span class="sxs-lookup"><span data-stu-id="8c92f-270">asp\_netUsers and asp\_netMembership --&gt; AspNetUsers</span></span>

    <span data-ttu-id="8c92f-271">ASPNET\_userinrollen--&gt; aspnettuserrollen</span><span class="sxs-lookup"><span data-stu-id="8c92f-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span></span>

    <span data-ttu-id="8c92f-272">Wie im obigen Abschnitt erläutert, sind die aspnettuserclaims-Tabelle und die aspnettuserlogins-Tabelle leer.</span><span class="sxs-lookup"><span data-stu-id="8c92f-272">As explained in the above section, the AspNetUserClaims and AspNetUserLogins tables are empty.</span></span> <span data-ttu-id="8c92f-273">Das Feld "Diskriminator" in der Tabelle "aspnettuser" sollte dem Modellklassen Namen entsprechen, der als nächster Schritt definiert ist.</span><span class="sxs-lookup"><span data-stu-id="8c92f-273">The 'Discriminator' field in the AspNetUser table should match the model class name which is defined as a next step.</span></span> <span data-ttu-id="8c92f-274">Die Spalte "PasswordHash" hat außerdem das Format "verschlüsseltes Kennwort | Kennwort Salt | Kenn Wort Format".</span><span class="sxs-lookup"><span data-stu-id="8c92f-274">Also the PasswordHash column is in the form 'encrypted password |password salt|password format'.</span></span> <span data-ttu-id="8c92f-275">Dies ermöglicht Ihnen die Verwendung einer speziellen kryptografielogik der SQL-Mitgliedschaft, sodass Sie alte Kenn Wörter wieder verwenden können.</span><span class="sxs-lookup"><span data-stu-id="8c92f-275">This enables you to use special SQL membership crypto logic so that you can reuse old passwords.</span></span> <span data-ttu-id="8c92f-276">Dies wird weiter unten in diesem Artikel erläutert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-276">That is explained in later in the article.</span></span>

### <a name="creating-models-and-membership-pages"></a><span data-ttu-id="8c92f-277">Erstellen von Modellen und Mitgliedschafts Seiten</span><span class="sxs-lookup"><span data-stu-id="8c92f-277">Creating models and membership pages</span></span>

<span data-ttu-id="8c92f-278">Wie bereits erwähnt, verwendet die IDENTITY-Funktion Entity Framework, um mit der Datenbank zu kommunizieren, um standardmäßig Kontoinformationen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8c92f-278">As mentioned earlier, the Identity feature uses Entity Framework to talk to the database for storing account information by default.</span></span> <span data-ttu-id="8c92f-279">Um mit vorhandenen Daten in der Tabelle arbeiten zu können, müssen Modellklassen erstellt werden, die den Tabellen wieder zugeordnet und im Identitätssystem eingebunden werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-279">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="8c92f-280">Als Teil des Identitäts Vertrags sollten die Modellklassen entweder die in der Identity. Core-DLL definierten Schnittstellen implementieren oder die vorhandene Implementierung dieser Schnittstellen erweitern, die in Microsoft. Aspnet. Identity. EntityFramework verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="8c92f-280">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span>

<span data-ttu-id="8c92f-281">In unserem Beispiel verfügen die aspnettroles-, aspnettuserclaims-, aspnetlogins-und aspnettuserrole-Tabellen über Spalten, die der vorhandenen Implementierung des Identitäts Systems ähneln.</span><span class="sxs-lookup"><span data-stu-id="8c92f-281">In our sample, the AspNetRoles, AspNetUserClaims, AspNetLogins and AspNetUserRole tables have columns that are similar to the existing implementation of the Identity system.</span></span> <span data-ttu-id="8c92f-282">Daher können wir die vorhandenen Klassen für die Zuordnung zu diesen Tabellen wieder verwenden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-282">Hence we can reuse the existing classes to map to these tables.</span></span> <span data-ttu-id="8c92f-283">Die aspnettuser-Tabelle enthält einige zusätzliche Spalten, die zum Speichern zusätzlicher Informationen aus den SQL-Mitgliedschafts Tabellen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-283">The AspNetUser table has some additional columns which are used to store additional information from the SQL membership tables.</span></span> <span data-ttu-id="8c92f-284">Dies kann durch Erstellen einer Modell Klasse, die die vorhandene Implementierung von ' identityuser ' erweitert, zugeordnet werden und die zusätzlichen Eigenschaften hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-284">This can be mapped by creating a model class that extend the existing implementation of 'IdentityUser' and add the additional properties.</span></span>

1. <span data-ttu-id="8c92f-285">Erstellen Sie im Projekt einen Ordner Modelle, und fügen Sie einen Klassen Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="8c92f-285">Create a Models folder in the project and add a class User.</span></span> <span data-ttu-id="8c92f-286">Der Name der Klasse sollte mit den in der Spalte "Diskriminator" der Tabelle "aspnettusers" hinzugefügten Daten identisch sein.</span><span class="sxs-lookup"><span data-stu-id="8c92f-286">The name of the class should match the data added in the 'Discriminator' column of 'AspnetUsers' table.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image10.png)

    <span data-ttu-id="8c92f-287">Die User-Klasse sollte die identityuser-Klasse erweitern, die in der *Microsoft. Aspnet. Identity. EntityFramework* -dll enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="8c92f-287">The User class should extend the IdentityUser class found in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="8c92f-288">Deklarieren Sie die Eigenschaften in der Klasse, die den aspnettuser-Spalten wieder zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-288">Declare the properties in class that map back to the AspNetUser columns.</span></span> <span data-ttu-id="8c92f-289">Die Eigenschaften "ID", "username", "PasswordHash" und "securitystamp" sind im identityuser definiert und werden daher ausgelassen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-289">The properties ID, Username, PasswordHash and SecurityStamp are defined in the IdentityUser and so are omitted.</span></span> <span data-ttu-id="8c92f-290">Im folgenden finden Sie den Code für die User-Klasse, die alle Eigenschaften enthält.</span><span class="sxs-lookup"><span data-stu-id="8c92f-290">Below is the code for the User class that has all the properties</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample3.cs)]
2. <span data-ttu-id="8c92f-291">Eine Entity Framework dbcontext-Klasse ist erforderlich, um Daten in Modellen zurück in Tabellen zu speichern und Daten aus Tabellen abzurufen, um die Modelle aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-291">An Entity Framework DbContext class is required in order to persist data in models back to tables and retrieve data from tables to populate the models.</span></span> <span data-ttu-id="8c92f-292">Die *Microsoft. Aspnet. Identity. EntityFramework* -dll definiert die identitydbcontext-Klasse, die mit den Identitäts Tabellen interagiert, um Informationen abzurufen und zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8c92f-292">*Microsoft.AspNet.Identity.EntityFramework* dll defines the IdentityDbContext class which interacts with the Identity tables to retrieve and store information.</span></span> <span data-ttu-id="8c92f-293">Der identitydbcontext-&lt;tuser-&gt; nimmt eine tuser-Klasse an, die jede Klasse sein kann, die die identityuser-Klasse erweitert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-293">The IdentityDbContext&lt;tuser&gt; takes a 'TUser' class which can be any class that extends the IdentityUser class.</span></span>

    <span data-ttu-id="8c92f-294">Erstellen Sie eine neue applicationdbcontext-Klasse, die identitydbcontext im Ordner "Models" erweitert und die in Schritt 1 erstellte Benutzerklasse übergibt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-294">Create a new class ApplicationDBContext that extends IdentityDbContext under the 'Models' folder, passing in the 'User' class created in step 1</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample4.cs)]
3. <span data-ttu-id="8c92f-295">Die Benutzerverwaltung im neuen Identitätssystem erfolgt mithilfe der in der *Microsoft. Aspnet. Identity. EntityFramework* -dll definierten "usermanager"-&lt;tuser-&gt; Klasse.</span><span class="sxs-lookup"><span data-stu-id="8c92f-295">User management in the new Identity system is done using the UserManager&lt;tuser&gt; class defined in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="8c92f-296">Wir müssen eine benutzerdefinierte Klasse erstellen, die den usermanager erweitert und die in Schritt 1 erstellte Benutzerklasse übergibt.</span><span class="sxs-lookup"><span data-stu-id="8c92f-296">We need to create a custom class that extends UserManager, passing in the 'User' class created in step 1.</span></span>

    <span data-ttu-id="8c92f-297">Erstellen Sie im Ordner Models eine neue Klasse usermanager, die Benutzer-Manager&lt;Benutzer erweitert&gt;</span><span class="sxs-lookup"><span data-stu-id="8c92f-297">In the Models folder create a new class UserManager that extends UserManager&lt;user&gt;</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample5.cs)]
4. <span data-ttu-id="8c92f-298">Die Kenn Wörter der Benutzer der Anwendung werden verschlüsselt und in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-298">The passwords of the users of the application are encrypted and stored in the database.</span></span> <span data-ttu-id="8c92f-299">Der Kryptografiealgorithmus, der in der SQL-Mitgliedschaft verwendet wird, unterscheidet sich von dem in der neuen Identitätssystem</span><span class="sxs-lookup"><span data-stu-id="8c92f-299">The crypto algorithm used in SQL membership is different from the one in the new Identity system.</span></span> <span data-ttu-id="8c92f-300">Um alte Kenn Wörter wiederzuverwenden, müssen wir Kenn Wörter selektiv entschlüsseln, wenn sich alte Benutzer mithilfe des SQL-Mitgliedschafts Algorithmus anmelden, während der Kryptografiealgorithmus in der Identität für die neuen Benutzer verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="8c92f-300">To reuse old passwords we need to selectively decrypt passwords when old users log in using the SQL memberships algorithm while using the crypto algorithm in Identity for the new users.</span></span>

    <span data-ttu-id="8c92f-301">Die usermanager-Klasse verfügt über die Eigenschaft "passwordhasher", die eine Instanz einer Klasse speichert, die die Schnittstelle "ipasswordhasher" implementiert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-301">The UserManager class has a property 'PasswordHasher' which stores an instance of a class that implements the 'IPasswordHasher' interface.</span></span> <span data-ttu-id="8c92f-302">Diese wird zum Verschlüsseln/Entschlüsseln von Kenn Wörtern bei Benutzer Authentifizierungs Transaktionen verwendet.</span><span class="sxs-lookup"><span data-stu-id="8c92f-302">This is used to encrypt/decrypt passwords during user authentication transactions.</span></span> <span data-ttu-id="8c92f-303">Erstellen Sie in der in Schritt 3 definierten usermanager-Klasse eine neue Klasse sqlpasswordhasher, und kopieren Sie den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="8c92f-303">In the UserManager class defined in step 3, create a new class SQLPasswordHasher and copy the below code.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample6.cs)]

    <span data-ttu-id="8c92f-304">Beheben Sie die Kompilierungsfehler, indem Sie die System. Text-und System. Security. Cryptography-Namespaces importieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-304">Resolve the compilation errors by importing the System.Text and System.Security.Cryptography namespaces.</span></span>

    <span data-ttu-id="8c92f-305">Die encodepassword-Methode verschlüsselt das Kennwort gemäß der standardmäßigen kryptografieimplementierung der SQL-Mitgliedschaft.</span><span class="sxs-lookup"><span data-stu-id="8c92f-305">The EncodePassword method encrypts the password according to the default SQL membership crypto implementation.</span></span> <span data-ttu-id="8c92f-306">Dies wird aus der System. Web-dll entnommen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-306">This is taken from the System.Web dll.</span></span> <span data-ttu-id="8c92f-307">Wenn die alte App eine benutzerdefinierte Implementierung verwendet hat, sollte Sie hier reflektiert werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-307">If the old app used a custom implementation then it should be reflected here.</span></span> <span data-ttu-id="8c92f-308">Wir müssen zwei andere Methoden " *hashpassword* " und " *verifyhashedpassword* " definieren, die mit der *encodepassword* -Methode einen Hashwert für ein bestimmtes Kennwort oder ein nur-Text-Kennwort mit dem in der Datenbank vorhandenen Kennwort verwenden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-308">We need to define two other methods *HashPassword* and *VerifyHashedPassword* that use the *EncodePassword* method to hash a given password or verify a plain text password with the one existing in the database.</span></span>

    <span data-ttu-id="8c92f-309">Das SQL-Mitgliedschaftssystem hat PasswordHash, PasswordSalt und passwordFormat verwendet, um das Kennwort zu übertragen, das von Benutzern beim Registrieren oder Ändern des Kennworts eingegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="8c92f-309">The SQL membership system used PasswordHash, PasswordSalt and PasswordFormat to hash the password entered by users when they register or change their password.</span></span> <span data-ttu-id="8c92f-310">Während der Migration werden alle drei Felder in der Spalte "PasswordHash" in der Tabelle "aspnettuser" getrennt durch das Zeichen "|" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-310">During the migration all the three fields are stored in the PasswordHash column in the AspNetUser table separated by the '|' character.</span></span> <span data-ttu-id="8c92f-311">Wenn sich ein Benutzer anmeldet und das Kennwort diese Felder enthält, wird das Kennwort mit der SQL-Mitgliedschafts Kryptografie überprüft. Andernfalls wird das Kennwort mit der standardmäßigen kryptografiesystemverschlüsselung überprüft.</span><span class="sxs-lookup"><span data-stu-id="8c92f-311">When a user logs in and the password has these fields, we use the SQL membership crypto to check the password; otherwise we use the Identity system's default crypto to verify the password.</span></span> <span data-ttu-id="8c92f-312">Auf diese Weise müssten alte Benutzer ihre Kenn Wörter nicht ändern, nachdem die APP migriert wurde.</span><span class="sxs-lookup"><span data-stu-id="8c92f-312">This way old users would not have to change their passwords once the app is migrated.</span></span>
5. <span data-ttu-id="8c92f-313">Deklarieren Sie den Konstruktor für die usermanager-Klasse, und übergeben Sie diesen als sqlpasswordhasher an die-Eigenschaft im-Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="8c92f-313">Declare the constructor for the UserManager class and pass this as the SQLPasswordHasher to the property in the constructor.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample7.cs)]

### <a name="create-new-account-management-pages"></a><span data-ttu-id="8c92f-314">Erstellen von neuen Kontoverwaltungsseiten</span><span class="sxs-lookup"><span data-stu-id="8c92f-314">Create new account management pages</span></span>

<span data-ttu-id="8c92f-315">Der nächste Schritt der Migration besteht darin, Kontoverwaltungsseiten hinzuzufügen, mit denen sich ein Benutzer registrieren und anmelden kann.</span><span class="sxs-lookup"><span data-stu-id="8c92f-315">The next step in the migration is to add account management pages that will let a user register and log in.</span></span> <span data-ttu-id="8c92f-316">Auf den alten Konto Seiten aus der SQL-Mitgliedschaft werden Steuerelemente verwendet, die nicht mit dem neuen Identitätssystem funktionieren.</span><span class="sxs-lookup"><span data-stu-id="8c92f-316">The old account pages from SQL membership use controls that don't work with the new Identity system.</span></span> <span data-ttu-id="8c92f-317">Wenn Sie die neuen Benutzer Verwaltungs Seiten hinzufügen möchten, befolgen Sie das Tutorial unter diesem Link [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) beginnend mit dem Schritt "Hinzufügen von Web Forms für die Registrierung von Benutzern bei Ihrer Anwendung", da wir das Projekt bereits erstellt und die nuget-Pakete hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="8c92f-317">To add the new user management pages follow the tutorial at this link [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) starting from the step 'Adding Web Forms for registering users to your application' since we have already created the project and added the NuGet packages.</span></span>

<span data-ttu-id="8c92f-318">Wir müssen einige Änderungen vornehmen, damit das Beispiel mit dem hier aufgeführten Projekt funktioniert.</span><span class="sxs-lookup"><span data-stu-id="8c92f-318">We need to make some changes for the sample to work with the project we have here.</span></span>

- <span data-ttu-id="8c92f-319">Die Register.aspx.cs-und Login.aspx.cs-Code-Behind-Klassen verwenden den `UserManager` aus den Identitäts Paketen, um einen Benutzer zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-319">The Register.aspx.cs and Login.aspx.cs code behind classes use the `UserManager` from the Identity packages to create a User.</span></span> <span data-ttu-id="8c92f-320">Verwenden Sie für dieses Beispiel den im Ordner Models hinzugefügten Benutzer-Manager, indem Sie die zuvor beschriebenen Schritte ausführen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-320">For this example use the UserManager added in the Models folder by following the steps mentioned earlier.</span></span>
- <span data-ttu-id="8c92f-321">Verwenden Sie die Benutzerklasse, die anstelle von identityuser in Register.aspx.cs-und Login.aspx.cs-Code Behind-Klassen erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="8c92f-321">Use the User class created instead of the IdentityUser in Register.aspx.cs and Login.aspx.cs code behind classes.</span></span> <span data-ttu-id="8c92f-322">Dadurch wird die benutzerdefinierte Benutzerklasse mit dem Identitätssystem verknüpft.</span><span class="sxs-lookup"><span data-stu-id="8c92f-322">This hooks in our custom user class into the Identity system.</span></span>
- <span data-ttu-id="8c92f-323">Der Teil zum Erstellen der Datenbank kann übersprungen werden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-323">The part to create the database can be skipped.</span></span>
- <span data-ttu-id="8c92f-324">Der Entwickler muss die ApplicationId für den neuen Benutzer entsprechend der aktuellen Anwendungs-ID festlegen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-324">The developer needs to set the ApplicationId for the new user to match the current application ID.</span></span> <span data-ttu-id="8c92f-325">Hierzu können Sie die ApplicationId für diese Anwendung Abfragen, bevor ein Benutzerobjekt in der Register.aspx.cs-Klasse erstellt und vor dem Erstellen des Benutzers festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="8c92f-325">This can be done by querying the ApplicationId for this application before a user object is created in the Register.aspx.cs class and setting it before creating user.</span></span>

    <span data-ttu-id="8c92f-326">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="8c92f-326">Example:</span></span>

    <span data-ttu-id="8c92f-327">Definieren Sie eine Methode auf der Register.aspx.cs-Seite, um die ASPNET-\_Anwendungs Tabelle abzufragen und die Anwendungs-ID gemäß dem Anwendungsnamen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="8c92f-327">Define a method in Register.aspx.cs page to query the aspnet\_Applications table and get the application Id according to application name</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample8.cs)]

    <span data-ttu-id="8c92f-328">Legen Sie jetzt diese Einstellung für das User-Objekt fest.</span><span class="sxs-lookup"><span data-stu-id="8c92f-328">Now get set this on the user object</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="8c92f-329">Verwenden Sie den alten Benutzernamen und das Kennwort, um einen vorhandenen Benutzer anzumelden.</span><span class="sxs-lookup"><span data-stu-id="8c92f-329">Use the old username and password to login an existing user.</span></span> <span data-ttu-id="8c92f-330">Verwenden Sie die Seite registrieren, um einen neuen Benutzer zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-330">Use the Register page to create a new user.</span></span> <span data-ttu-id="8c92f-331">Vergewissern Sie sich außerdem, dass die Benutzer wie erwartet in den Rollen sind.</span><span class="sxs-lookup"><span data-stu-id="8c92f-331">Also verify that the users are in roles as expected.</span></span>

<span data-ttu-id="8c92f-332">Das Portieren auf das Identitätssystem unterstützt den Benutzer beim Hinzufügen offener Authentifizierung (OAuth) zur Anwendung.</span><span class="sxs-lookup"><span data-stu-id="8c92f-332">Porting to the Identity system helps the user add Open Authentication (OAuth) to the application.</span></span> <span data-ttu-id="8c92f-333">Weitere Informationen finden Sie in [diesem Beispiel,](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/) in dem OAuth aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="8c92f-333">Please refer to the sample [here](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/) which has OAuth enabled.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8c92f-334">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="8c92f-334">Next Steps</span></span>

<span data-ttu-id="8c92f-335">In diesem Tutorial wurde gezeigt, wie Sie Benutzer aus der SQL-Mitgliedschaft in ASP.net Identity portieren, aber keine Profildaten.</span><span class="sxs-lookup"><span data-stu-id="8c92f-335">In this tutorial we showed how to port users from SQL membership to ASP.NET Identity, but we didn't port Profile data.</span></span> <span data-ttu-id="8c92f-336">Im nächsten Tutorial wird das Portieren von Profildaten aus der SQL-Mitgliedschaft in das neue Identitätssystem untersucht.</span><span class="sxs-lookup"><span data-stu-id="8c92f-336">In the next tutorial we'll look into porting Profile data from SQL membership to the new Identity system.</span></span>

<span data-ttu-id="8c92f-337">Sie können das Feedback am Ende dieses Artikels hinterlassen.</span><span class="sxs-lookup"><span data-stu-id="8c92f-337">You can leave feedback at the bottom of this article.</span></span>

<span data-ttu-id="8c92f-338">*Vielen Dank, dass Tom Dykstra und Rick Anderson den Artikel überprüft haben.*</span><span class="sxs-lookup"><span data-stu-id="8c92f-338">*Thanks to Tom Dykstra and Rick Anderson for reviewing the article.*</span></span>
