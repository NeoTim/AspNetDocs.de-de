---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrieren von Daten eines universellen Anbieters für Mitgliedschaften und Benutzerprofilen nach ASP.NET Identity (C#) – ASP.NET 4.x
author: rustd
description: In diesem Tutorial wird beschrieben, die erforderlichen Schritte zum Migrieren von Benutzer und Daten der Rolle und Benutzerprofildaten, die mit der Universal Providers einer vorhandenen App erstellt wird...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 1043dce4cdd62f94ae9d2344a9301c1b03426f3d
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/17/2019
ms.locfileid: "59422264"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="84b8a-103">Migrieren von Daten eines universellen Anbieters in Bezug auf Mitgliedschaften und Benutzerprofilen zu ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="84b8a-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="84b8a-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="84b8a-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="84b8a-105">In diesem Tutorial wird beschrieben, die erforderlichen Schritte zum Migrieren von Benutzer und Daten der Rolle und Benutzerprofildaten, die mit der Universal Providers einer vorhandenen Anwendung für das ASP.NET Identity-Modell erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="84b8a-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="84b8a-106">Der Ansatz wird hier erwähnt, zum Migrieren von Benutzerprofildaten, die in einer Anwendung mit einer SQL-Mitgliedschaft auch verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="84b8a-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>


<span data-ttu-id="84b8a-107">Mit der Veröffentlichung von Visual Studio 2013, das ASP.NET-Team ein neues ASP.NET Identity-System eingeführt, und erfahren Sie mehr über diese Version [hier](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="84b8a-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="84b8a-108">Anschluss an die im Artikel zum Migrieren von Webanwendungen vor [SQL-Mitgliedschaft in der neuen Identitätssystem](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), dieser Artikel beschreibt die Schritte zur Migration vorhandener Anwendungen, die Folgen des Anbieter-Modells für Benutzer-und Rollenverwaltung das neue Identitätsmodell.</span><span class="sxs-lookup"><span data-stu-id="84b8a-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="84b8a-109">Der Schwerpunkt in diesem Tutorial werden in erster Linie auf die Migration von der Benutzerprofildaten, um nahtlos in das neue System zu verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="84b8a-110">Migrieren von Informationen für Benutzer und Rollen ist ähnlich für die SQL-Mitgliedschaft.</span><span class="sxs-lookup"><span data-stu-id="84b8a-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="84b8a-111">Der Ansatz befolgt, um die Profildaten zu migrieren, kann in einer Anwendung mit SQL-Mitgliedschaft auch verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="84b8a-112">Als Beispiel beginnen wir mit einer Web-app erstellt haben, mithilfe von Visual Studio 2012 die das Anbieter-Modell verwendet.</span><span class="sxs-lookup"><span data-stu-id="84b8a-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="84b8a-113">Wir werden dann fügen Sie Code für die Verwaltung von Profilen, registrieren Sie einen Benutzer, Profildaten für den Benutzer hinzufügen, migrieren das Datenbankschema und ändern Sie dann die Anwendung das Identitätssystem für Benutzer-und Rollenverwaltung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="84b8a-114">Zum Testen der Migration erstellt, mit der Universal Providers Benutzer sollten in der Lage, melden Sie sich, und neue Benutzer sollten in der Lage, zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="84b8a-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="84b8a-115">Sie finden das vollständige Beispiel am [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="84b8a-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>


## <a name="profile-data-migration-summary"></a><span data-ttu-id="84b8a-116">Data Migration-Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="84b8a-116">Profile data migration summary</span></span>

<span data-ttu-id="84b8a-117">Bevor Sie beginnen mit den Migrationen, wir sehen uns nun der Ablauf der Speichern von Profildaten in die Anbieter-Modell.</span><span class="sxs-lookup"><span data-stu-id="84b8a-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="84b8a-118">Profildaten für die Anwendung aus, die Benutzern auf verschiedene Weisen gespeichert werden können, die am häufigsten verwendeten untereinander wird mithilfe von integrierten Profilanbieter zusammen mit der Universal Providers ausgeliefert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="84b8a-119">Die Schritte sind.</span><span class="sxs-lookup"><span data-stu-id="84b8a-119">The steps would include</span></span>

1. <span data-ttu-id="84b8a-120">Fügen Sie eine Klasse, die Eigenschaften, die zum Speichern von Profildaten verwendet hat.</span><span class="sxs-lookup"><span data-stu-id="84b8a-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="84b8a-121">Fügen Sie eine Klasse, die 'ProfileBase' erweitert und implementiert Methoden, um die oben genannten Profildaten für den Benutzer zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="84b8a-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="84b8a-122">Aktivieren mithilfe von Standard-Profilanbieter in die *"Web.config"* Datei, und definieren Sie die Klasse, die in Schritt #2 verwendet werden, den Zugriff auf Informationen zum Eigenschaftsprofil deklariert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="84b8a-123">Die Profilinformationen wird als serialisierte Xml und binäre Daten in der Tabelle "Profile" in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="84b8a-124">Nach der Migration der Anwendung zur Verwendung der neuen ASP.NET Identity-Systems an, wird die Profilinformationen deserialisiert und als Eigenschaften auf der Klasse gespeichert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="84b8a-125">Jede Eigenschaft können Sie dann auf Spalten in der Benutzertabelle zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="84b8a-126">Dies hat den Vorteil, dass die Eigenschaften bearbeitet werden können, auf die Klasse in Ergänzung nicht zu serialisieren/Deserialisieren von Dateninformationen direkt mit Uhrzeit darauf zugreift.</span><span class="sxs-lookup"><span data-stu-id="84b8a-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="84b8a-127">Erste Schritte</span><span class="sxs-lookup"><span data-stu-id="84b8a-127">Getting Started</span></span>

1. <span data-ttu-id="84b8a-128">Erstellen Sie eine neue ASP.NET 4.5 Web Forms-Anwendung in Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="84b8a-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="84b8a-129">Das aktuelle Beispiel verwendet die Web Forms-Vorlage, aber Sie können auch MVC-Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="84b8a-130">Erstellen Sie einen neuen Ordner "Modelle" zum Speichern von Profilinformationen</span><span class="sxs-lookup"><span data-stu-id="84b8a-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="84b8a-131">Beispielsweise können wir kein speichern Sie Datum Geburtsdatum, City, Höhe und die Gewichtung des Benutzers im Profil.</span><span class="sxs-lookup"><span data-stu-id="84b8a-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="84b8a-132">Die Höhe und Breite werden als eine benutzerdefinierte Klasse namens "PersonalStats" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="84b8a-133">Speichern und rufen Sie das Profil, benötigen wir eine Klasse, die "ProfileBase" Erweitert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="84b8a-134">Wir erstellen eine neue Klasse "AppProfile" abrufen und speichern Profilinformationen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="84b8a-135">Aktivieren des Profils in der *"Web.config"* Datei.</span><span class="sxs-lookup"><span data-stu-id="84b8a-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="84b8a-136">Geben Sie den Klassennamen an, die verwendet werden, um Speicher/Abrufen von Benutzerinformationen, die in Schritt #3 erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="84b8a-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="84b8a-137">Fügen Sie eine Web Forms-Seite im Ordner "'Account'" auf den Profildaten des Benutzers abrufen und speichern Sie sie hinzu.</span><span class="sxs-lookup"><span data-stu-id="84b8a-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="84b8a-138">Klicken Sie mit der rechten Maustaste auf Projekt, und wählen Sie "Neues Element hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="84b8a-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="84b8a-139">Fügen Sie eine neue Web Forms-Seite mit der Masterseite "AddProfileData.aspx".</span><span class="sxs-lookup"><span data-stu-id="84b8a-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="84b8a-140">Kopieren Sie im Abschnitt "MainContent" Folgendes ein:</span><span class="sxs-lookup"><span data-stu-id="84b8a-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="84b8a-141">Fügen Sie den folgenden Code im CodeBehind:</span><span class="sxs-lookup"><span data-stu-id="84b8a-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="84b8a-142">Fügen Sie den Namespace, die unter der, den appprofile Klasse definiert ist, um Kompilierungsfehler zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="84b8a-143">Führen Sie die app, und erstellen Sie einen neuen Benutzer mit dem Benutzernamen "**Olduser".**</span><span class="sxs-lookup"><span data-stu-id="84b8a-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="84b8a-144">Navigieren Sie zur Seite "AddProfileData", und fügen Sie Profilinformationen für den Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="84b8a-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="84b8a-145">Sie können überprüfen, ob die Daten im serialisierten XML-Format in der Tabelle "Profile", die mit dem Server-Explorer-Fenster gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="84b8a-146">Wählen Sie in Visual Studio im Menü 'Ansicht' "Server-Explorer" ein.</span><span class="sxs-lookup"><span data-stu-id="84b8a-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="84b8a-147">Muss eine Datenverbindung für die Datenbank definiert, der *"Web.config"* Datei.</span><span class="sxs-lookup"><span data-stu-id="84b8a-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="84b8a-148">Durch Klicken auf die Datenverbindung zeigt die verschiedenen Unterkategorien.</span><span class="sxs-lookup"><span data-stu-id="84b8a-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="84b8a-149">Erweitern Sie "Tabellen" Anzeigen der verschiedenen Tabellen in der Datenbank, und klicken Sie mit der rechten Maustaste auf 'Profile' aus, und wählen "Tabellendaten anzeigen", zum Anzeigen der Profildaten, die in der Profile-Tabelle gespeichert.</span><span class="sxs-lookup"><span data-stu-id="84b8a-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="84b8a-150">Migrieren des Datenbankschemas</span><span class="sxs-lookup"><span data-stu-id="84b8a-150">Migrating database schema</span></span>

<span data-ttu-id="84b8a-151">Damit wird die vorhandene Datenbank mit der Identity-System arbeiten, müssen Sie das Schema in der Datenbank Identität, um die Felder zu unterstützen, die wir, mit der ursprünglichen Datenbank hinzugefügt aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="84b8a-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="84b8a-152">Dies kann erfolgen mithilfe von SQL-Skripts zum Erstellen neuer Tabellen und kopieren Sie die vorhandene Informationen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="84b8a-153">Erweitern Sie im Fenster "Server-Explorer" "DefaultConnection", um die Tabellen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="84b8a-154">Klicken Sie mit der rechten Maustaste auf die Tabellen aus, und wählen Sie "Neue Abfrage"</span><span class="sxs-lookup"><span data-stu-id="84b8a-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="84b8a-155">Fügen Sie das SQL-Skript aus [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) und führen Sie sie.</span><span class="sxs-lookup"><span data-stu-id="84b8a-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="84b8a-156">Wenn die "DefaultConnection" aktualisiert wird, sehen wir, dass die neuen Tabellen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="84b8a-157">Sie können überprüfen, dass die Daten in den Tabellen zu erkennen, dass die Informationen migriert wurde.</span><span class="sxs-lookup"><span data-stu-id="84b8a-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="84b8a-158">Migrieren der Anwendung zur Verwendung von ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="84b8a-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="84b8a-159">Installieren Sie die Nuget-Pakete, die für ASP.NET Identity erforderlich sind:</span><span class="sxs-lookup"><span data-stu-id="84b8a-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="84b8a-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="84b8a-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="84b8a-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="84b8a-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="84b8a-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="84b8a-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="84b8a-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="84b8a-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="84b8a-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="84b8a-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="84b8a-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="84b8a-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="84b8a-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="84b8a-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="84b8a-167">Weitere Informationen zum Verwalten von Nuget-Pakete finden Sie [hier](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="84b8a-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="84b8a-168">Um mit vorhandenen Daten in der Tabelle arbeiten zu können, müssen wir ViewModel-Klassen zu erstellen, die an die Tabellen zugeordnet, und verknüpfen sie in das Identitätssystem.</span><span class="sxs-lookup"><span data-stu-id="84b8a-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="84b8a-169">Als Teil des Vertrags Identität die Modellklassen sollten entweder die Schnittstellen in der Dll Identity.Core implementieren oder erweitern können, die vorhandene Implementierung dieser Schnittstellen in "Microsoft.Aspnet.Identity.EntityFramework" verfügbar.</span><span class="sxs-lookup"><span data-stu-id="84b8a-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="84b8a-170">Wir werden die vorhandenen Klassen für die Rolle, die benutzeranmeldungen und die Ansprüche des Benutzers verwenden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="84b8a-171">Wir müssen einen eigenen Benutzer für unser Beispiel zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="84b8a-172">Klicken Sie mit der rechten Maustaste auf das Projekt, und erstellen Sie neuen Ordner "IdentityModels".</span><span class="sxs-lookup"><span data-stu-id="84b8a-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="84b8a-173">Fügen Sie eine neue 'User'-Klasse, wie unten dargestellt:</span><span class="sxs-lookup"><span data-stu-id="84b8a-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="84b8a-174">Beachten Sie, dass die "ProfileInfo" nun eine Eigenschaft für die Klasse ist.</span><span class="sxs-lookup"><span data-stu-id="84b8a-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="84b8a-175">Daher können wir die User-Klasse verwenden, direkt mit Profildaten zu arbeiten.</span><span class="sxs-lookup"><span data-stu-id="84b8a-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="84b8a-176">Kopieren Sie die Dateien in die **IdentityModels** und **IdentityAccount** Ordner aus der Quelle herunterladen ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="84b8a-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="84b8a-177">Sie verfügen über die verbleibenden Modellklassen und die neuen Seiten, die für Benutzer- und Rollenverwaltung mithilfe der ASP.NET Identity-APIs benötigt.</span><span class="sxs-lookup"><span data-stu-id="84b8a-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="84b8a-178">Der verwendete Ansatz ähnelt der SQL-Mitgliedschaft und finden Sie ausführliche erläuterungen [hier](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="84b8a-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="84b8a-179">Kopieren von Profildaten in die neuen Tabellen</span><span class="sxs-lookup"><span data-stu-id="84b8a-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="84b8a-180">Wie bereits erwähnt, müssen wir deserialisiert die XML-Daten in den Tabellen der Profile aus, und speichern Sie sie in den Spalten der Tabelle "aspnetusers".</span><span class="sxs-lookup"><span data-stu-id="84b8a-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="84b8a-181">Die neuen Spalten wurden in der Tabelle im vorherigen Schritt erstellt, also nur noch die Spalten mit den erforderlichen Daten zu füllen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="84b8a-182">Zu diesem Zweck verwenden wir eine Konsolenanwendung das einmal zum Auffüllen der neu erstellten Spalten in der Tabelle ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="84b8a-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="84b8a-183">Erstellen Sie eine neue Konsolenanwendung in der vorhandenen Projektmappe ein.</span><span class="sxs-lookup"><span data-stu-id="84b8a-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="84b8a-184">Installieren Sie die neueste Version des Entity Framework-Pakets.</span><span class="sxs-lookup"><span data-stu-id="84b8a-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="84b8a-185">Fügen Sie die Webanwendung, die als Verweis auf die Konsolenanwendung zuvor erstellte hinzu.</span><span class="sxs-lookup"><span data-stu-id="84b8a-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="84b8a-186">Hierzu dies mit der rechten Maustaste auf das Projekt, und klicken Sie dann "Verweise hinzufügen", klicken Sie dann die Projektmappe, klicken Sie auf das Projekt, und klicken Sie auf OK.</span><span class="sxs-lookup"><span data-stu-id="84b8a-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="84b8a-187">Kopieren der folgenden Code in der Datei "Program.cs"-Klasse.</span><span class="sxs-lookup"><span data-stu-id="84b8a-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="84b8a-188">Diese Logik liest Profildaten für jeden Benutzer, serialisiert es als 'ProfileInfo'-Objekt und speichert sie in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="84b8a-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="84b8a-189">Einige der verwendeten Modelle werden im Ordner "IdentityModels" das Webanwendungsprojekt, definiert, daher müssen Sie die zugehörigen Namespaces einschließen.</span><span class="sxs-lookup"><span data-stu-id="84b8a-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="84b8a-190">Der obige Code funktioniert, auf die Datenbankdatei in der App\_Ordner das Webanwendungsprojekt "Data", die in den vorherigen Schritten erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="84b8a-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="84b8a-191">Aktualisieren Sie die Verbindungszeichenfolge in der Datei "App.config" der Konsolenanwendung, die auf, durch die Verbindungszeichenfolge in der Datei web.config der Webanwendung.</span><span class="sxs-lookup"><span data-stu-id="84b8a-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="84b8a-192">Geben Sie auch des vollständigen physischen Pfads, in der Eigenschaft "AttachDbFilename" ein.</span><span class="sxs-lookup"><span data-stu-id="84b8a-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="84b8a-193">Öffnen Sie eine Eingabeaufforderung, und navigieren Sie zu dem Ordner "Bin" der oben genannten Konsolenanwendung.</span><span class="sxs-lookup"><span data-stu-id="84b8a-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="84b8a-194">Führen Sie die ausführbare Datei, und überprüfen Sie die Ausgabe des Protokolls, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="84b8a-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="84b8a-195">Öffnen Sie in der Tabelle "AspNetUsers" im Server-Explorer aus, und überprüfen Sie die Daten in die neuen Spalten, die die Eigenschaften enthalten.</span><span class="sxs-lookup"><span data-stu-id="84b8a-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="84b8a-196">Sie sollten mit der entsprechenden Eigenschaftswerte aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="84b8a-197">Überprüfen der Funktionalität</span><span class="sxs-lookup"><span data-stu-id="84b8a-197">Verify functionality</span></span>

<span data-ttu-id="84b8a-198">Verwenden Sie die neu hinzugefügte Mitgliedschaftsseiten, die mithilfe von ASP.NET Identity Anmelden ein Benutzers aus der alten Datenbank implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="84b8a-199">Der Benutzer sollte mit den gleichen Anmeldeinformationen anmelden können.</span><span class="sxs-lookup"><span data-stu-id="84b8a-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="84b8a-200">Die anderen Funktionen wie das Hinzufügen von OAuth, Erstellen eines neuen Benutzers ein, das Ändern des Kennworts, Hinzufügen von Rollen, versuchen Sie es Hinzufügen von Benutzern zu Rollen usw.</span><span class="sxs-lookup"><span data-stu-id="84b8a-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="84b8a-201">Die Profildaten für den alten Benutzer und die neuen Benutzer sollten abgerufen und in der Tabelle gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="84b8a-202">Die alte Tabelle darf nicht mehr verwiesen werden.</span><span class="sxs-lookup"><span data-stu-id="84b8a-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="84b8a-203">Schlussbemerkung</span><span class="sxs-lookup"><span data-stu-id="84b8a-203">Conclusion</span></span>

<span data-ttu-id="84b8a-204">Der Artikel wurde beschrieben, den Prozess der Migration von Webanwendungen, die das Anbietermodell für die Mitgliedschaft in ASP.NET Identity verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="84b8a-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="84b8a-205">Im Artikel beschriebenen darüber Migrieren von Profildaten für Benutzer in das Identitätssystem eingebunden werden soll.</span><span class="sxs-lookup"><span data-stu-id="84b8a-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="84b8a-206">Hinterlassen Sie Kommentare unten für Fragen und Probleme bei der Migration Ihrer app.</span><span class="sxs-lookup"><span data-stu-id="84b8a-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="84b8a-207">*Vielen Dank Rick Anderson und Robert McMurray für die im Artikel.*</span><span class="sxs-lookup"><span data-stu-id="84b8a-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
