---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrieren von universellen Anbieter Daten für Mitgliedschafts-und BenutzerC#Profile zu ASP.net Identity ()-ASP.NET 4. x
author: rustd
description: In diesem Tutorial werden die Schritte beschrieben, die zum Migrieren von Benutzer-und Rollen Daten und Benutzerprofil Daten erforderlich sind, die mit universelle Anbieter einer vorhandenen App erstellt wurden...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 31f02a0cec3c531c45c37b7aad8456e01e80b5ea
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456113"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="bc0fa-103">Migrieren von Daten eines universellen Anbieters in Bezug auf Mitgliedschaften und Benutzerprofilen zu ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="bc0fa-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="bc0fa-104">von [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="bc0fa-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="bc0fa-105">In diesem Tutorial werden die Schritte beschrieben, die zum Migrieren von Benutzer-und Rollen Daten und Benutzerprofil Daten, die mit universelle Anbieter einer vorhandenen Anwendung erstellt wurden, in das ASP.net Identity Modell erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="bc0fa-106">Der hier erwähnte Ansatz zum Migrieren von Benutzerprofil Daten kann auch in einer Anwendung mit SQL-Mitgliedschaft verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="bc0fa-107">Mit der Veröffentlichung von Visual Studio 2013 hat das ASP.net-Team ein neues ASP.net Identity System eingeführt. Weitere Informationen zu dieser Version finden Sie [hier](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="bc0fa-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="bc0fa-108">In diesem Artikel werden die Schritte zum Migrieren von Webanwendungen aus der [SQL-Mitgliedschaft zum neuen Identitätssystem](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md)erläutert. in diesem Artikel werden die Schritte zum Migrieren vorhandener Anwendungen erläutert, die dem Anbieter Modell für die Benutzer-und Rollen Verwaltung im neuen Identitäts Modell folgen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="bc0fa-109">Der Schwerpunkt dieses Tutorials liegt hauptsächlich auf der Migration der Benutzerprofil Daten, um Sie nahtlos mit dem neuen System zu verbinden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="bc0fa-110">Die Migration von Benutzer-und Rollen Informationen ähnelt der SQL-Mitgliedschaft.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="bc0fa-111">Der Ansatz, der zum Migrieren von Profildaten folgt, kann auch in einer Anwendung mit SQL-Mitgliedschaft verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="bc0fa-112">Als Beispiel beginnen wir mit einer Web-App, die mit Visual Studio 2012 erstellt wird und das Provider-Modell verwendet.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="bc0fa-113">Fügen Sie dann Code für die Profilverwaltung hinzu, registrieren Sie einen Benutzer, fügen Sie Profildaten für die Benutzer hinzu, migrieren Sie das Datenbankschema, und ändern Sie dann die Anwendung, sodass Sie das Identitätssystem für die Benutzer-und Rollen Verwaltung verwendet.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="bc0fa-114">Als Migrationstest sollten Benutzer, die mithilfe von universelle Anbieter erstellt wurden, sich anmelden können, und neue Benutzer sollten sich registrieren können.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="bc0fa-115">Das komplette Beispiel finden Sie unter [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="bc0fa-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>

## <a name="profile-data-migration-summary"></a><span data-ttu-id="bc0fa-116">Zusammenfassung der Profildaten Migration</span><span class="sxs-lookup"><span data-stu-id="bc0fa-116">Profile data migration summary</span></span>

<span data-ttu-id="bc0fa-117">Bevor wir mit den Migrationen beginnen, sehen wir uns die Funktionen zum Speichern von Profildaten im Anbieter Modell an.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="bc0fa-118">Profildaten für Anwendungs Benutzer können auf verschiedene Weise gespeichert werden, wobei es sich bei den am häufigsten verwendeten Profil Anbietern um die zusammen mit dem universelle Anbieter handelt.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="bc0fa-119">Die Schritte umfassen</span><span class="sxs-lookup"><span data-stu-id="bc0fa-119">The steps would include</span></span>

1. <span data-ttu-id="bc0fa-120">Fügen Sie eine Klasse hinzu, die über Eigenschaften zum Speichern von Profildaten verfügt.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="bc0fa-121">Fügen Sie eine Klasse hinzu, die "ProfileBase" erweitert, und implementiert Methoden, um die obigen Profildaten für den Benutzer zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="bc0fa-122">Aktivieren Sie die Verwendung von Standardprofil Anbietern in der Datei " *Web. config* ", und definieren Sie die in Schritt #2 deklarierte Klasse für den Zugriff auf Profilinformationen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="bc0fa-123">Die Profilinformationen werden als serialisierte XML-und Binärdaten in der Tabelle "Profiles" in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="bc0fa-124">Nachdem die Anwendung zur Verwendung des neuen ASP.net Identity Systems migriert wurde, werden die Profilinformationen deserialisiert und als Eigenschaften in der User-Klasse gespeichert.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="bc0fa-125">Jede Eigenschaft kann dann Spalten in der Benutzertabelle zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="bc0fa-126">Der Vorteil hierbei ist, dass die Eigenschaften direkt mithilfe der User-Klasse bearbeitet werden können, wenn Sie nicht jedes Mal, wenn Sie darauf zugreifen, Daten Informationen serialisieren/deserialisieren müssen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="bc0fa-127">Erste Schritte</span><span class="sxs-lookup"><span data-stu-id="bc0fa-127">Getting Started</span></span>

1. <span data-ttu-id="bc0fa-128">Erstellen Sie eine neue 4,5 ASP.net-Web Forms-Anwendung in Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="bc0fa-129">Im aktuellen Beispiel wird die Web Forms-Vorlage verwendet, aber Sie können auch die MVC-Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="bc0fa-130">Erstellen Sie einen neuen Ordner "Models", um Profilinformationen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="bc0fa-131">Als Beispiel können wir das Geburtsdatum, den Ort, die Höhe und die Gewichtung des Benutzers im Profil speichern.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="bc0fa-132">Die Höhe und Gewichtung werden als benutzerdefinierte Klasse mit dem Namen "Personal Stats" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="bc0fa-133">Zum Speichern und Abrufen des Profils benötigen wir eine Klasse, die "ProfileBase" erweitert.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="bc0fa-134">Wir erstellen nun eine neue Klasse "appprofile", um Profilinformationen zu erhalten und zu speichern.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="bc0fa-135">Aktivieren Sie das Profil in der Datei " *Web. config* ".</span><span class="sxs-lookup"><span data-stu-id="bc0fa-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="bc0fa-136">Geben Sie den Klassennamen ein, der zum Speichern/Abrufen von Benutzerinformationen verwendet wird, die in Schritt #3 erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="bc0fa-137">Fügen Sie im Ordner "Account" eine Web Forms-Seite hinzu, um die Profildaten vom Benutzer zu erhalten und zu speichern.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="bc0fa-138">Klicken Sie mit der rechten Maustaste auf Projekt, und wählen Sie "Neues Element hinzufügen"</span><span class="sxs-lookup"><span data-stu-id="bc0fa-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="bc0fa-139">Fügen Sie eine neue WebForms-Seite mit der Master Seite "addprofiledata. aspx" hinzu.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="bc0fa-140">Kopieren Sie Folgendes in den Abschnitt "mainContent":</span><span class="sxs-lookup"><span data-stu-id="bc0fa-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="bc0fa-141">Fügen Sie im Code Behind den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="bc0fa-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="bc0fa-142">Fügen Sie den Namespace hinzu, unter dem appprofile-Klasse definiert ist, um die Kompilierungsfehler zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="bc0fa-143">Führen Sie die APP aus, und erstellen Sie einen neuen Benutzer mit dem Benutzernamen "**olduser".**</span><span class="sxs-lookup"><span data-stu-id="bc0fa-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="bc0fa-144">Navigieren Sie zur Seite "addprofiledata", und fügen Sie Profilinformationen für den Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="bc0fa-145">Mithilfe des Server-Explorer Fensters können Sie überprüfen, ob die Daten als serialisiertes XML in der Tabelle "Profile" gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="bc0fa-146">Wählen Sie in Visual Studio im Menü "Ansicht" die Option "Server-Explorer" aus.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="bc0fa-147">Es sollte eine Datenverbindung für die in der Datei " *Web. config* " definierte Datenbank vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="bc0fa-148">Wenn Sie auf die Datenverbindung klicken, werden unterschiedliche Unterkategorien angezeigt.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="bc0fa-149">Erweitern Sie "Tables", um die verschiedenen Tabellen in der Datenbank anzuzeigen. Klicken Sie dann mit der rechten Maustaste auf "Profiles", und wählen Sie "Tabellendaten anzeigen", um die in der Tabelle "Profile" gespeicherten Profildaten anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="bc0fa-150">Migrationsdaten Bank Schema</span><span class="sxs-lookup"><span data-stu-id="bc0fa-150">Migrating database schema</span></span>

<span data-ttu-id="bc0fa-151">Damit die vorhandene Datenbank mit dem Identitätssystem zusammenarbeiten kann, müssen wir das Schema in der Identitätsdatenbank aktualisieren, um die Felder zu unterstützen, die wir der ursprünglichen Datenbank hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="bc0fa-152">Hierzu können Sie SQL-Skripts verwenden, um neue Tabellen zu erstellen und die vorhandenen Informationen zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="bc0fa-153">Erweitern Sie im Fenster "Server-Explorer" den Eintrag "DefaultConnection", um die Tabellen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="bc0fa-154">Klicken Sie mit der rechten Maustaste auf Tabellen, und wählen Sie neue Abfrage</span><span class="sxs-lookup"><span data-stu-id="bc0fa-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="bc0fa-155">Fügen Sie das SQL-Skript aus [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) ein und führen Sie es aus.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="bc0fa-156">Wenn "DefaultConnection" aktualisiert wird, können Sie sehen, dass die neuen Tabellen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="bc0fa-157">Sie können die Daten in den Tabellen überprüfen, um festzustellen, ob die Informationen migriert wurden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="bc0fa-158">Migrieren der Anwendung zur Verwendung ASP.net Identity</span><span class="sxs-lookup"><span data-stu-id="bc0fa-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="bc0fa-159">Installieren Sie die nuget-Pakete, die für ASP.net Identity benötigt werden:</span><span class="sxs-lookup"><span data-stu-id="bc0fa-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="bc0fa-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="bc0fa-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="bc0fa-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="bc0fa-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="bc0fa-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="bc0fa-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="bc0fa-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="bc0fa-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="bc0fa-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="bc0fa-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="bc0fa-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="bc0fa-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="bc0fa-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="bc0fa-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="bc0fa-167">Weitere Informationen zum Verwalten von nuget-Paketen finden Sie [hier](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog) .</span><span class="sxs-lookup"><span data-stu-id="bc0fa-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="bc0fa-168">Um mit vorhandenen Daten in der Tabelle arbeiten zu können, müssen Modellklassen erstellt werden, die den Tabellen wieder zugeordnet und im Identitätssystem eingebunden werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="bc0fa-169">Als Teil des Identitäts Vertrags sollten die Modellklassen entweder die in der Identity. Core-DLL definierten Schnittstellen implementieren oder die vorhandene Implementierung dieser Schnittstellen erweitern, die in Microsoft. Aspnet. Identity. EntityFramework verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="bc0fa-170">Wir verwenden die vorhandenen Klassen für Rollen, Benutzeranmeldungen und Benutzer Ansprüche.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="bc0fa-171">Wir müssen für unser Beispiel einen benutzerdefinierten Benutzer verwenden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="bc0fa-172">Klicken Sie mit der rechten Maustaste auf das Projekt, und erstellen Sie den neuen Ordner identitymodels.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="bc0fa-173">Fügen Sie eine neue Benutzerklasse hinzu, wie unten gezeigt:</span><span class="sxs-lookup"><span data-stu-id="bc0fa-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="bc0fa-174">Beachten Sie, dass "profilerfo" jetzt eine Eigenschaft für die Benutzerklasse ist.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="bc0fa-175">Daher können wir die User-Klasse verwenden, um direkt mit Profildaten zu arbeiten.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="bc0fa-176">Kopieren Sie die Dateien in den Ordnern " **identitymodels** " und " **identityaccount** " aus der Download Quelle ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="bc0fa-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="bc0fa-177">Diese verfügen über die verbleibenden Modellklassen und die neuen Seiten, die für die Benutzer-und Rollen Verwaltung mithilfe der ASP.net Identity-APIs benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="bc0fa-178">Der verwendete Ansatz ähnelt der SQL-Mitgliedschaft, und die ausführliche Erläuterung finden Sie [hier](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="bc0fa-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="bc0fa-179">Kopieren von Profildaten in die neuen Tabellen</span><span class="sxs-lookup"><span data-stu-id="bc0fa-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="bc0fa-180">Wie bereits erwähnt, müssen die XML-Daten in den Profil Tabellen deserialisiert und in den Spalten der Tabelle "aspnettusers" gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="bc0fa-181">Die neuen Spalten wurden im vorherigen Schritt in der Tabelle Benutzer erstellt, sodass Sie nur noch die Spalten mit den erforderlichen Daten auffüllen müssen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="bc0fa-182">Zu diesem Zweck verwenden wir eine Konsolenanwendung, die einmal ausgeführt wird, um die neu erstellten Spalten in der Benutzertabelle aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="bc0fa-183">Erstellen Sie in der Projekt Mappe eine neue Konsolenanwendung.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="bc0fa-184">Installieren Sie die neueste Version des Entity Framework Pakets.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="bc0fa-185">Fügen Sie die oben erstellte Webanwendung als Verweis auf die Konsolenanwendung hinzu.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="bc0fa-186">Klicken Sie dazu mit der rechten Maustaste auf "Projekt" und dann auf "Verweise hinzufügen". Klicken Sie dann auf das Projekt, und klicken Sie auf OK.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="bc0fa-187">Kopieren Sie den folgenden Code in die Program.cs-Klasse.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="bc0fa-188">Diese Logik liest Profildaten für jeden Benutzer, serialisiert sie als ProfileInfo-Objekt und speichert Sie wieder in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="bc0fa-189">Einige der verwendeten Modelle werden im Ordner "identitymodels" des Webanwendungs Projekts definiert, sodass Sie die entsprechenden Namespaces einschließen müssen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="bc0fa-190">Der obige Code funktioniert in der Datenbankdatei im Ordner App\_Data des Webanwendungs Projekts, das in den vorherigen Schritten erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="bc0fa-191">Um darauf zu verweisen, aktualisieren Sie die Verbindungs Zeichenfolge in der Datei app. config der Konsolenanwendung mit der Verbindungs Zeichenfolge in der Datei Web. config der Webanwendung.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="bc0fa-192">Geben Sie außerdem den gesamten physischen Pfad in der Eigenschaft "AttachDBFilename" an.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="bc0fa-193">Öffnen Sie eine Eingabeaufforderung, und navigieren Sie zum Ordner bin der obigen Konsolenanwendung.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="bc0fa-194">Führen Sie die ausführbare Datei aus, und überprüfen Sie die Protokoll Ausgabe wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="bc0fa-195">Öffnen Sie die Tabelle "aspnettusers" im Server-Explorer, und überprüfen Sie die Daten in den neuen Spalten, die die Eigenschaften enthalten.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="bc0fa-196">Sie sollten mit den entsprechenden Eigenschafts Werten aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="bc0fa-197">Überprüfen der Funktionalität</span><span class="sxs-lookup"><span data-stu-id="bc0fa-197">Verify functionality</span></span>

<span data-ttu-id="bc0fa-198">Verwenden Sie die neu hinzugefügten Mitgliedschafts Seiten, die mit ASP.net Identity implementiert werden, um einen Benutzer aus der alten Datenbank anzumelden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="bc0fa-199">Der Benutzer sollte sich mit denselben Anmelde Informationen anmelden können.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="bc0fa-200">Testen Sie die anderen Funktionen wie das Hinzufügen von OAuth, das Erstellen eines neuen Benutzers, das Ändern eines Kennworts, das Hinzufügen von Rollen und das Hinzufügen von Benutzern zu Rollen</span><span class="sxs-lookup"><span data-stu-id="bc0fa-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="bc0fa-201">Die Profildaten für den alten Benutzer und die neuen Benutzer müssen abgerufen und in der Tabelle "Benutzer" gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="bc0fa-202">Auf die alte Tabelle sollte nicht mehr verwiesen werden.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="bc0fa-203">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="bc0fa-203">Conclusion</span></span>

<span data-ttu-id="bc0fa-204">Der Artikel beschreibt den Prozess der Migration von Webanwendungen, die das Anbieter Modell für die Mitgliedschaft in ASP.net Identity verwendet haben.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="bc0fa-205">Der Artikel erläutert außerdem das Migrieren von Profildaten für Benutzer, die in das Identitätssystem eingebunden werden sollen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="bc0fa-206">Wenn Sie Ihre APP migrieren, sollten Sie die folgenden Kommentare für Fragen und Probleme hinterlassen.</span><span class="sxs-lookup"><span data-stu-id="bc0fa-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="bc0fa-207">*Vielen Dank, dass Rick Anderson und Robert McMurray den Artikel überprüft haben.*</span><span class="sxs-lookup"><span data-stu-id="bc0fa-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
