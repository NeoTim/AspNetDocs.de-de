---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application
title: 'Tutorial: Verwenden von Async-und gespeicherten Prozeduren mit EF in einer ASP.NET MVC-App'
description: In diesem Tutorial erfahren Sie, wie Sie das asynchrone Programmiermodell implementieren und erfahren, wie Sie gespeicherte Prozeduren verwenden.
author: tdykstra
ms.author: riande
ms.date: 01/18/2019
ms.topic: tutorial
ms.assetid: 27d110fc-d1b7-4628-a763-26f1e6087549
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 5612f2f25d06feb904a205505ed8f048d2263266
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471387"
---
# <a name="tutorial-use-async-and-stored-procedures-with-ef-in-an-aspnet-mvc-app"></a><span data-ttu-id="4c19f-103">Tutorial: Verwenden von Async-und gespeicherten Prozeduren mit EF in einer ASP.NET MVC-App</span><span class="sxs-lookup"><span data-stu-id="4c19f-103">Tutorial: Use async and stored procedures with EF in an ASP.NET MVC App</span></span>

<span data-ttu-id="4c19f-104">In den vorherigen Tutorials haben Sie gelernt, wie Sie Daten mit dem synchronen Programmiermodell lesen und aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="4c19f-104">In earlier tutorials you learned how to read and update data using the synchronous programming model.</span></span> <span data-ttu-id="4c19f-105">In diesem Tutorial erfahren Sie, wie Sie das asynchrone Programmiermodell implementieren.</span><span class="sxs-lookup"><span data-stu-id="4c19f-105">In this tutorial you see how to implement the asynchronous programming model.</span></span> <span data-ttu-id="4c19f-106">Mithilfe von asynchronem Code kann eine Anwendung besser funktionieren, da Server Ressourcen besser genutzt werden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-106">Asynchronous code can help an application perform better because it makes better use of server resources.</span></span>

<span data-ttu-id="4c19f-107">In diesem Tutorial erfahren Sie auch, wie Sie gespeicherte Prozeduren für Einfüge-, Aktualisierungs-und Löschvorgänge für eine Entität verwenden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-107">In this tutorial you also see how to use stored procedures for insert, update, and delete operations on an entity.</span></span>

<span data-ttu-id="4c19f-108">Schließlich stellen Sie die Anwendung zusammen mit allen Daten Bank Änderungen, die Sie seit der erstmaligen Bereitstellung implementiert haben, in Azure erneut bereit.</span><span class="sxs-lookup"><span data-stu-id="4c19f-108">Finally, you redeploy the application to Azure, along with all of the database changes that you've implemented since the first time you deployed.</span></span>

<span data-ttu-id="4c19f-109">In den folgenden Abbildungen werden die Seiten dargestellt, mit denen Sie arbeiten werden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-109">The following illustrations show some of the pages that you'll work with.</span></span>

![Abteilungs Seite](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

![Abteilung erstellen](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="4c19f-112">In diesem Tutorial führen Sie Folgendes durch:</span><span class="sxs-lookup"><span data-stu-id="4c19f-112">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="4c19f-113">Weitere Informationen zu asynchronem Code</span><span class="sxs-lookup"><span data-stu-id="4c19f-113">Learn about asynchronous code</span></span>
> * <span data-ttu-id="4c19f-114">Erstellen eines Abteilungs Controllers</span><span class="sxs-lookup"><span data-stu-id="4c19f-114">Create a Department controller</span></span>
> * <span data-ttu-id="4c19f-115">Gespeicherte Prozeduren verwenden</span><span class="sxs-lookup"><span data-stu-id="4c19f-115">Use stored procedures</span></span>
> * <span data-ttu-id="4c19f-116">Bereitstellung in Azure</span><span class="sxs-lookup"><span data-stu-id="4c19f-116">Deploy to Azure</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4c19f-117">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="4c19f-117">Prerequisites</span></span>

* [<span data-ttu-id="4c19f-118">Aktualisieren von relevanten Daten</span><span class="sxs-lookup"><span data-stu-id="4c19f-118">Updating Related Data</span></span>](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="why-use-asynchronous-code"></a><span data-ttu-id="4c19f-119">Gründe für die Verwendung von asynchronem Code</span><span class="sxs-lookup"><span data-stu-id="4c19f-119">Why use asynchronous code</span></span>

<span data-ttu-id="4c19f-120">Der Webserver verfügt nur über eine begrenzte Anzahl von Threads. Daher werden bei hoher Auslastung möglicherweise alle verfügbaren Threads gleichzeitig verwendet.</span><span class="sxs-lookup"><span data-stu-id="4c19f-120">A web server has a limited number of threads available, and in high load situations all of the available threads might be in use.</span></span> <span data-ttu-id="4c19f-121">Wenn dies der Fall ist, kann der Server keine neuen Anforderungen verarbeiten, bis die Threads wieder freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-121">When that happens, the server can't process new requests until the threads are freed up.</span></span> <span data-ttu-id="4c19f-122">Wenn synchroner Code verwendet wird, kann es sein, dass zwar viele Threads belegt sind, diese aber keine Vorgänge ausführen, da sie auf den Abschluss der E/A-Vorgänge warten.</span><span class="sxs-lookup"><span data-stu-id="4c19f-122">With synchronous code, many threads may be tied up while they aren't actually doing any work because they're waiting for I/O to complete.</span></span> <span data-ttu-id="4c19f-123">Wenn asynchroner Code verwendet wird, werden Threads für den Server freigegeben, wenn diese nur auf den Abschluss der E/A-Vorgänge warten, damit andere Anforderungen verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="4c19f-123">With asynchronous code, when a process is waiting for I/O to complete, its thread is freed up for the server to use for processing other requests.</span></span> <span data-ttu-id="4c19f-124">Folglich ermöglicht der asynchrone Code die effizientere Verwendung von Server Ressourcen, und der Server ist für die Verarbeitung von mehr Datenverkehr ohne Verzögerungen aktiviert.</span><span class="sxs-lookup"><span data-stu-id="4c19f-124">As a result, asynchronous code enables server resources to be use more efficiently, and the server is enabled to handle more traffic without delays.</span></span>

<span data-ttu-id="4c19f-125">In früheren Versionen von .net war das Schreiben und Testen von asynchronem Code komplex, fehleranfällig und schwer zu debuggen.</span><span class="sxs-lookup"><span data-stu-id="4c19f-125">In earlier versions of .NET, writing and testing asynchronous code was complex, error prone, and hard to debug.</span></span> <span data-ttu-id="4c19f-126">In .NET 4,5 ist das Schreiben, testen und Debuggen von asynchronem Code sehr viel einfacher, wenn Sie in der Regel asynchronen Code schreiben sollten, es sei denn, Sie haben einen Grund für nicht.</span><span class="sxs-lookup"><span data-stu-id="4c19f-126">In .NET 4.5, writing, testing, and debugging asynchronous code is so much easier that you should generally write asynchronous code unless you have a reason not to.</span></span> <span data-ttu-id="4c19f-127">Der asynchrone Code führt zu einem geringen Aufwand, aber bei Problemen mit geringem Datenverkehr ist die Leistungseinbußen unerheblich, und bei großen Datenverkehrs Fällen ist die potenzielle Leistungsverbesserung beträchtlich.</span><span class="sxs-lookup"><span data-stu-id="4c19f-127">Asynchronous code does introduce a small amount of overhead, but for low traffic situations the performance hit is negligible, while for high traffic situations, the potential performance improvement is substantial.</span></span>

<span data-ttu-id="4c19f-128">Weitere Informationen zur asynchronen Programmierung finden Sie unter [Verwenden der async-Unterstützung von .NET 4.5, um blockierende Aufrufe zu vermeiden](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices.md#async).</span><span class="sxs-lookup"><span data-stu-id="4c19f-128">For more information about asynchronous programming, see [Use .NET 4.5's async support to avoid blocking calls](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices.md#async).</span></span>

## <a name="create-department-controller"></a><span data-ttu-id="4c19f-129">Abteilungs Controller erstellen</span><span class="sxs-lookup"><span data-stu-id="4c19f-129">Create Department controller</span></span>

<span data-ttu-id="4c19f-130">Erstellen Sie einen Abteilungs Controller auf die gleiche Weise wie die früheren Controller, und aktivieren Sie das Kontrollkästchen **Async Controller-Aktionen verwenden** .</span><span class="sxs-lookup"><span data-stu-id="4c19f-130">Create a Department controller the same way you did the earlier controllers, except this time select the **Use async controller actions** check box.</span></span>

<span data-ttu-id="4c19f-131">Die folgenden Highlights zeigen, was dem synchronen Code für die `Index`-Methode hinzugefügt wurde, um Sie asynchron zu machen:</span><span class="sxs-lookup"><span data-stu-id="4c19f-131">The following highlights show what was added to the synchronous code for the `Index` method to make it asynchronous:</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs?highlight=1,4)]

<span data-ttu-id="4c19f-132">Es wurden vier Änderungen angewendet, um die asynchrone Ausführung der Entity Framework Datenbankabfrage zu ermöglichen:</span><span class="sxs-lookup"><span data-stu-id="4c19f-132">Four changes were applied to enable the Entity Framework database query to execute asynchronously:</span></span>

- <span data-ttu-id="4c19f-133">Die-Methode wird mit dem `async`-Schlüsselwort gekennzeichnet, das den Compiler anweist, Rückrufe für Teile des Methoden Texts zu generieren und automatisch das `Task<ActionResult>` Objekt zu erstellen, das zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-133">The method is marked with the `async` keyword, which tells the compiler to generate callbacks for parts of the method body and to automatically create the `Task<ActionResult>` object that is returned.</span></span>
- <span data-ttu-id="4c19f-134">Der Rückgabetyp wurde von `ActionResult` in `Task<ActionResult>`geändert.</span><span class="sxs-lookup"><span data-stu-id="4c19f-134">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="4c19f-135">Der `Task<T>`-Typ stellt laufende Arbeit mit einem Ergebnis vom Typ `T`dar.</span><span class="sxs-lookup"><span data-stu-id="4c19f-135">The `Task<T>` type represents ongoing work with a result of type `T`.</span></span>
- <span data-ttu-id="4c19f-136">Das `await`-Schlüsselwort wurde auf den Webdienst aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="4c19f-136">The `await` keyword was applied to the web service call.</span></span> <span data-ttu-id="4c19f-137">Wenn der Compiler dieses Schlüsselwort sieht, wird die Methode im Hintergrund in zwei Teile aufgeteilt.</span><span class="sxs-lookup"><span data-stu-id="4c19f-137">When the compiler sees this keyword, behind the scenes it splits the method into two parts.</span></span> <span data-ttu-id="4c19f-138">Der erste Teil endet mit dem Vorgang, der asynchron gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-138">The first part ends with the operation that is started asynchronously.</span></span> <span data-ttu-id="4c19f-139">Der zweite Teil wird in eine Rückruf Methode eingefügt, die aufgerufen wird, wenn der Vorgang abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-139">The second part is put into a callback method that is called when the operation completes.</span></span>
- <span data-ttu-id="4c19f-140">Die asynchrone Version der `ToList` Erweiterungsmethode wurde aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="4c19f-140">The asynchronous version of the `ToList` extension method was called.</span></span>

<span data-ttu-id="4c19f-141">Warum wird die `departments.ToList`-Anweisung geändert, aber nicht die `departments = db.Departments`-Anweisung?</span><span class="sxs-lookup"><span data-stu-id="4c19f-141">Why is the `departments.ToList` statement modified but not the `departments = db.Departments` statement?</span></span> <span data-ttu-id="4c19f-142">Der Grund hierfür ist, dass nur Anweisungen, die dazu führen, dass Abfragen oder Befehle an die Datenbank gesendet werden, asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-142">The reason is that only statements that cause queries or commands to be sent to the database are executed asynchronously.</span></span> <span data-ttu-id="4c19f-143">Die `departments = db.Departments`-Anweisung richtet eine Abfrage ein, die Abfrage wird jedoch erst ausgeführt, wenn die `ToList`-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-143">The `departments = db.Departments` statement sets up a query but the query is not executed until the `ToList` method is called.</span></span> <span data-ttu-id="4c19f-144">Daher wird nur die `ToList`-Methode asynchron ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="4c19f-144">Therefore, only the `ToList` method is executed asynchronously.</span></span>

<span data-ttu-id="4c19f-145">In den Methoden `Details` und `HttpGet` `Edit` und `Delete` ist die `Find`-Methode die Methode, die bewirkt, dass eine Abfrage an die Datenbank gesendet wird. Dies ist also die Methode, die asynchron ausgeführt wird:</span><span class="sxs-lookup"><span data-stu-id="4c19f-145">In the `Details` method and the `HttpGet` `Edit` and `Delete` methods, the `Find` method is the one that causes a query to be sent to the database, so that's the method that gets executed asynchronously:</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs?highlight=7)]

<span data-ttu-id="4c19f-146">In den Methoden `Create`, `HttpPost Edit`und `DeleteConfirmed` ist es der `SaveChanges` Methodenaufrufe, der bewirkt, dass ein Befehl ausgeführt wird, und keine Anweisungen wie `db.Departments.Add(department)`, die nur die Änderung von Entitäten im Arbeitsspeicher bewirken.</span><span class="sxs-lookup"><span data-stu-id="4c19f-146">In the `Create`, `HttpPost Edit`, and `DeleteConfirmed` methods, it is the `SaveChanges` method call that causes a command to be executed, not statements such as `db.Departments.Add(department)` which only cause entities in memory to be modified.</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs?highlight=6)]

<span data-ttu-id="4c19f-147">Öffnen Sie *views\department\index.cshtml*, und ersetzen Sie den Vorlagen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="4c19f-147">Open *Views\Department\Index.cshtml*, and replace the template code with the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cshtml?highlight=3,5,20-22,36-38)]

<span data-ttu-id="4c19f-148">Dieser Code ändert den Titel von Index in Abteilungen, verschiebt den Administrator Namen nach rechts und gibt den vollständigen Namen des Administrators an.</span><span class="sxs-lookup"><span data-stu-id="4c19f-148">This code changes the title from Index to Departments, moves the Administrator name to the right, and provides the full name of the administrator.</span></span>

<span data-ttu-id="4c19f-149">Ändern Sie in den Ansichten erstellen, löschen, Details und bearbeiten die Beschriftung für das Feld `InstructorID` auf die gleiche Weise, wie Sie in den Kurs Ansichten das Feld Abteilungs Name in "Abteilung" geändert haben.</span><span class="sxs-lookup"><span data-stu-id="4c19f-149">In the Create, Delete, Details, and Edit views, change the caption for the `InstructorID` field to "Administrator" the same way you changed the department name field to "Department" in the Course views.</span></span>

<span data-ttu-id="4c19f-150">Verwenden Sie in den Ansichten erstellen und bearbeiten den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="4c19f-150">In the Create and Edit views use the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml)]

<span data-ttu-id="4c19f-151">Verwenden Sie in den Ansichten "Löschen" und "Details" den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="4c19f-151">In the Delete and Details views use the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cshtml)]

<span data-ttu-id="4c19f-152">Führen Sie die Anwendung aus, und klicken Sie auf die Registerkarte **Abteilungen** .</span><span class="sxs-lookup"><span data-stu-id="4c19f-152">Run the application, and click the **Departments** tab.</span></span>

<span data-ttu-id="4c19f-153">Alles funktioniert genauso wie in den anderen Controllern, aber in diesem Controller werden alle SQL-Abfragen asynchron ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="4c19f-153">Everything works the same as in the other controllers, but in this controller all of the SQL queries are executing asynchronously.</span></span>

<span data-ttu-id="4c19f-154">Einige Dinge, die Sie beachten sollten, wenn Sie die asynchrone Programmierung mit dem Entity Framework verwenden:</span><span class="sxs-lookup"><span data-stu-id="4c19f-154">Some things to be aware of when you are using asynchronous programming with the Entity Framework:</span></span>

- <span data-ttu-id="4c19f-155">Der Async-Code ist nicht Thread sicher.</span><span class="sxs-lookup"><span data-stu-id="4c19f-155">The async code is not thread safe.</span></span> <span data-ttu-id="4c19f-156">Anders ausgedrückt: versuchen Sie nicht, mehrere Vorgänge parallel mithilfe derselben Kontext Instanz auszuführen.</span><span class="sxs-lookup"><span data-stu-id="4c19f-156">In other words, in other words, don't try to do multiple operations in parallel using the same context instance.</span></span>
- <span data-ttu-id="4c19f-157">Wenn Sie von den Leistungsvorteilen des asynchronen Codes profitieren möchten, vergewissern Sie sich, dass auch alle Bibliothekspakete, die Sie verwenden (z.B. zum Paging) asynchronen Code verwenden, wenn sie Entity Framework Core-Methoden aufrufen, die Abfragen an die Datenbank senden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-157">If you want to take advantage of the performance benefits of async code, make sure that any library packages that you're using (such as for paging), also use async if they call any Entity Framework methods that cause queries to be sent to the database.</span></span>

## <a name="use-stored-procedures"></a><span data-ttu-id="4c19f-158">Gespeicherte Prozeduren verwenden</span><span class="sxs-lookup"><span data-stu-id="4c19f-158">Use stored procedures</span></span>

<span data-ttu-id="4c19f-159">Einige Entwickler und DBAs bevorzugen die Verwendung gespeicherter Prozeduren für den Datenbankzugriff.</span><span class="sxs-lookup"><span data-stu-id="4c19f-159">Some developers and DBAs prefer to use stored procedures for database access.</span></span> <span data-ttu-id="4c19f-160">In früheren Versionen von Entity Framework Sie Daten mithilfe einer gespeicherten Prozedur abrufen, indem Sie eine unformatierte [SQL-Abfrage ausführen](advanced-entity-framework-scenarios-for-an-mvc-web-application.md). Sie können EF jedoch nicht anweisen, gespeicherte Prozeduren für Aktualisierungs Vorgänge zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-160">In earlier versions of Entity Framework you can retrieve data using a stored procedure by [executing a raw SQL query](advanced-entity-framework-scenarios-for-an-mvc-web-application.md), but you can't instruct EF to use stored procedures for update operations.</span></span> <span data-ttu-id="4c19f-161">In EF 6 ist es einfach, Code First für die Verwendung gespeicherter Prozeduren zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="4c19f-161">In EF 6 it's easy to configure Code First to use stored procedures.</span></span>

1. <span data-ttu-id="4c19f-162">Fügen Sie in " *dal\schoolcontext.cs*" den hervorgehobenen Code der `OnModelCreating`-Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="4c19f-162">In *DAL\SchoolContext.cs*, add the highlighted code to the `OnModelCreating` method.</span></span>

    [!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs?highlight=9)]

    <span data-ttu-id="4c19f-163">Dieser Code weist Entity Framework an, gespeicherte Prozeduren für Einfüge-, Aktualisierungs-und Löschvorgänge für die `Department` Entität zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-163">This code instructs Entity Framework to use stored procedures for insert, update, and delete operations on the `Department` entity.</span></span>
2. <span data-ttu-id="4c19f-164">Geben Sie in der Konsole Package Manage den folgenden Befehl ein:</span><span class="sxs-lookup"><span data-stu-id="4c19f-164">In Package Manage Console, enter the following command:</span></span>

    `add-migration DepartmentSP`

    <span data-ttu-id="4c19f-165">Öffnen Sie *Migrationen\\&lt;Zeitstempel&gt;\_DepartmentSP.cs* , um den Code in der `Up`-Methode anzuzeigen, mit der gespeicherte Prozeduren zum Einfügen, aktualisieren und löschen erstellt werden:</span><span class="sxs-lookup"><span data-stu-id="4c19f-165">Open *Migrations\\&lt;timestamp&gt;\_DepartmentSP.cs* to see the code in the `Up` method that creates Insert, Update, and Delete stored procedures:</span></span>

    [!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs?highlight=3-4,26-27,42-43)]
3. <span data-ttu-id="4c19f-166">Geben Sie in der Konsole Package Manage den folgenden Befehl ein:</span><span class="sxs-lookup"><span data-stu-id="4c19f-166">In Package Manage Console, enter the following command:</span></span>

     `update-database`
4. <span data-ttu-id="4c19f-167">Führen Sie die Anwendung im Debugmodus aus, klicken Sie auf die Registerkarte **Abteilungen** und dann auf **neu erstellen**.</span><span class="sxs-lookup"><span data-stu-id="4c19f-167">Run the application in debug mode, click the **Departments** tab, and then click **Create New**.</span></span>
5. <span data-ttu-id="4c19f-168">Geben Sie Daten für eine neue Abteilung ein, und klicken Sie dann auf **Erstellen**.</span><span class="sxs-lookup"><span data-stu-id="4c19f-168">Enter data for a new department, and then click **Create**.</span></span>

6. <span data-ttu-id="4c19f-169">Überprüfen Sie in Visual Studio die Protokolle im **Ausgabe** Fenster, um zu sehen, dass eine gespeicherte Prozedur zum Einfügen der neuen Abteilungs Zeile verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="4c19f-169">In Visual Studio, look at the logs in the **Output** window to see that a stored procedure was used to insert the new Department row.</span></span>

     ![SP der Abteilung einfügen](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="4c19f-171">Code First erstellt Standardnamen für gespeicherte Prozeduren.</span><span class="sxs-lookup"><span data-stu-id="4c19f-171">Code First creates default stored procedure names.</span></span> <span data-ttu-id="4c19f-172">Wenn Sie eine vorhandene Datenbank verwenden, müssen Sie ggf. die Namen der gespeicherten Prozeduren anpassen, damit Sie bereits in der Datenbank definierte gespeicherte Prozeduren verwenden können.</span><span class="sxs-lookup"><span data-stu-id="4c19f-172">If you are using an existing database, you might need to customize the stored procedure names in order to use stored procedures already defined in the database.</span></span> <span data-ttu-id="4c19f-173">Weitere Informationen hierzu finden Sie unter [Entity Framework Code First Einfügen/Aktualisieren/Löschen gespeicherter Prozeduren](https://msdn.microsoft.com/data/dn468673).</span><span class="sxs-lookup"><span data-stu-id="4c19f-173">For information about how to do that, see [Entity Framework Code First Insert/Update/Delete Stored Procedures](https://msdn.microsoft.com/data/dn468673).</span></span>

<span data-ttu-id="4c19f-174">Wenn Sie anpassen möchten, welche generierten gespeicherten Prozeduren Sie ausführen, können Sie den Gerüst Code für die Migrationen `Up` Methode bearbeiten, mit der die gespeicherte Prozedur erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-174">If you want to customize what generated stored procedures do, you can edit the scaffolded code for the migrations `Up` method that creates the stored procedure.</span></span> <span data-ttu-id="4c19f-175">Auf diese Weise werden Ihre Änderungen bei jedem Ausführen der Migration reflektiert und auf die Produktionsdatenbank angewendet, wenn Migrationen nach der Bereitstellung automatisch in der Produktionsumgebung ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4c19f-175">That way your changes are reflected whenever that migration is run and will be applied to your production database when migrations runs automatically in production after deployment.</span></span>

<span data-ttu-id="4c19f-176">Wenn Sie eine vorhandene gespeicherte Prozedur ändern möchten, die in einer vorherigen Migration erstellt wurde, können Sie mit dem Befehl Add-Migration eine leere Migration generieren und dann manuell Code schreiben, der die [alterstoredprocedure](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.alterstoredprocedure.aspx) -Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="4c19f-176">If you want to change an existing stored procedure that was created in a previous migration, you can use the Add-Migration command to generate a blank migration, and then manually write code that calls the [AlterStoredProcedure](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.alterstoredprocedure.aspx) method.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="4c19f-177">Bereitstellung in Azure</span><span class="sxs-lookup"><span data-stu-id="4c19f-177">Deploy to Azure</span></span>

<span data-ttu-id="4c19f-178">In diesem Abschnitt ist es erforderlich, dass Sie den Abschnitt optionale Bereitstellung **der APP für Azure** im Tutorial [Migrationen und Bereitstellung](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application.md) dieser Reihe abgeschlossen haben.</span><span class="sxs-lookup"><span data-stu-id="4c19f-178">This section requires you to have completed the optional **Deploying the app to Azure** section in the [Migrations and Deployment](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial of this series.</span></span> <span data-ttu-id="4c19f-179">Wenn Migrations Fehler aufgetreten sind, die Sie durch Löschen der Datenbank im lokalen Projekt aufgelöst haben, überspringen Sie diesen Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="4c19f-179">If you had migrations errors that you resolved by deleting the database in your local project, skip this section.</span></span>

1. <span data-ttu-id="4c19f-180">Klicken Sie im **Projektmappen-Explorer** von Visual Studio mit der rechten Maustaste auf das Projekt, und wählen Sie im Kontextmenü **Veröffentlichen** aus.</span><span class="sxs-lookup"><span data-stu-id="4c19f-180">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>
2. <span data-ttu-id="4c19f-181">Klicken Sie auf **Veröffentlichen**.</span><span class="sxs-lookup"><span data-stu-id="4c19f-181">Click **Publish**.</span></span>

    <span data-ttu-id="4c19f-182">Visual Studio stellt die Anwendung in Azure bereit, und die Anwendung wird in Ihrem Standardbrowser geöffnet, der in Azure ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="4c19f-182">Visual Studio deploys the application to Azure, and the application opens in your default browser, running in Azure.</span></span>
3. <span data-ttu-id="4c19f-183">Testen Sie die Anwendung, um zu überprüfen, ob Sie funktioniert.</span><span class="sxs-lookup"><span data-stu-id="4c19f-183">Test the application to verify it's working.</span></span>

    <span data-ttu-id="4c19f-184">Wenn Sie zum ersten Mal eine Seite ausführen, die auf die Datenbank zugreift, führt die Entity Framework alle Migrationen `Up` Methoden aus, die erforderlich sind, um die Datenbank mit dem aktuellen Datenmodell auf den neuesten Stand zu bringen.</span><span class="sxs-lookup"><span data-stu-id="4c19f-184">The first time you run a page that accesses the database, the Entity Framework runs all of the migrations `Up` methods required to bring the database up to date with the current data model.</span></span> <span data-ttu-id="4c19f-185">Sie können jetzt alle Webseiten verwenden, die Sie seit der letzten Bereitstellung hinzugefügt haben, einschließlich der Abteilungs Seiten, die Sie in diesem Tutorial hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="4c19f-185">You can now use all of the web pages that you added since the last time you deployed, including the Department pages that you added in this tutorial.</span></span>

## <a name="get-the-code"></a><span data-ttu-id="4c19f-186">Abrufen des Codes</span><span class="sxs-lookup"><span data-stu-id="4c19f-186">Get the code</span></span>

[<span data-ttu-id="4c19f-187">Herunterladen des abgeschlossenen Projekts</span><span class="sxs-lookup"><span data-stu-id="4c19f-187">Download the Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="4c19f-188">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="4c19f-188">Additional resources</span></span>

<span data-ttu-id="4c19f-189">Links zu anderen Entity Framework Ressourcen finden Sie unter [ASP.NET Data Access-Empfohlene Ressourcen](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="4c19f-189">Links to other Entity Framework resources can be found in the [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="4c19f-190">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="4c19f-190">Next steps</span></span>

<span data-ttu-id="4c19f-191">In diesem Tutorial führen Sie Folgendes durch:</span><span class="sxs-lookup"><span data-stu-id="4c19f-191">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="4c19f-192">Erlernen von asynchronem Code</span><span class="sxs-lookup"><span data-stu-id="4c19f-192">Learned about asynchronous code</span></span>
> * <span data-ttu-id="4c19f-193">Erstellen eines Abteilungs Controllers</span><span class="sxs-lookup"><span data-stu-id="4c19f-193">Created a Department controller</span></span>
> * <span data-ttu-id="4c19f-194">Verwendete gespeicherte Prozeduren</span><span class="sxs-lookup"><span data-stu-id="4c19f-194">Used stored procedures</span></span>
> * <span data-ttu-id="4c19f-195">Bereitstellung in Azure</span><span class="sxs-lookup"><span data-stu-id="4c19f-195">Deployed to Azure</span></span>

<span data-ttu-id="4c19f-196">Im nächsten Artikel erfahren Sie, wie Sie Konflikte behandeln, wenn mehrere Benutzer gleichzeitig dieselbe Entität aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="4c19f-196">Advance to the next article to learn how to handle conflicts when multiple users update the same entity at the same time.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="4c19f-197">Behandeln von Parallelität</span><span class="sxs-lookup"><span data-stu-id="4c19f-197">Handling concurrency</span></span>](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)
