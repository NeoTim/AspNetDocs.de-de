---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: 'Iteration #5 – Erstellen von Komponententests (VB) | Microsoft Docs'
author: rick-anderson
description: In der fünften Iteration erleichtern wir die Wartung und Änderung unserer Anwendung durch Hinzufügen von Komponententests. Wir verspotten unsere Datenmodellklassen und erstellen Komponententests für o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: cc5425de86e7481894fbea242fa555b5598167f6
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542338"
---
# <a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="7ae7e-104">Iteration 5 – Erstellen von Komponententests (VB)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-104">Iteration #5 – Create unit tests (VB)</span></span>

<span data-ttu-id="7ae7e-105">von [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="7ae7e-106">Code herunterladen</span><span class="sxs-lookup"><span data-stu-id="7ae7e-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="7ae7e-107">In der fünften Iteration erleichtern wir die Wartung und Änderung unserer Anwendung durch Hinzufügen von Komponententests.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="7ae7e-108">Wir verspotten unsere Datenmodellklassen und erstellen Komponententests für unsere Controller und Validierungslogik.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="7ae7e-109">Erstellen einer Kontaktverwaltungs- ASP.NET MVC-Anwendung (VB)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="7ae7e-110">In dieser Reihe von Tutorials erstellen wir eine gesamte Contact Management-Anwendung von Anfang bis Ende.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="7ae7e-111">Mit der Kontakt-Manager-Anwendung können Sie Kontaktinformationen - Namen, Telefonnummern und E-Mail-Adressen - für eine Personenliste speichern.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="7ae7e-112">Wir erstellen die Anwendung über mehrere Iterationen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="7ae7e-113">Mit jeder Iteration verbessern wir die Anwendung schrittweise.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="7ae7e-114">Das Ziel dieses Ansatzes mit mehreren Iterationen besteht darin, den Grund für jede Änderung zu verstehen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="7ae7e-115">Iteration #1 - Erstellen Sie die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="7ae7e-116">In der ersten Iteration erstellen wir den Contact Manager auf einfachste Weise.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="7ae7e-117">Wir fügen Unterstützung für grundlegende Datenbankvorgänge hinzu: Erstellen, Lesen, Aktualisieren und Löschen (CRUD).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="7ae7e-118">Iteration #2 - Machen Sie die Anwendung schön aussehen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="7ae7e-119">In dieser Iteration verbessern wir das Erscheinungsbild der Anwendung, indem wir die Standard-ASP.NET MVC-Ansichtsmasterseite und des kaskadierenden Stylesheets ändern.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="7ae7e-120">Iteration #3 - Formularüberprüfung hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="7ae7e-121">In der dritten Iteration fügen wir eine grundlegende Formularvalidierung hinzu.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="7ae7e-122">Wir verhindern, dass Personen ein Formular einreichen, ohne die erforderlichen Formularfelder ausfüllen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="7ae7e-123">Wir validieren auch E-Mail-Adressen und Telefonnummern.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="7ae7e-124">Iteration #4 - Machen Sie die Anwendung lose gekoppelt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="7ae7e-125">In dieser vierten Iteration nutzen wir mehrere Softwareentwurfsmuster, um die Wartung und Änderung der Contact Manager-Anwendung zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="7ae7e-126">Beispielsweise gestalten wir unsere Anwendung so um, dass sie das Repository-Muster und das Abhängigkeitsinjektionsmuster verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="7ae7e-127">Iteration #5 - Erstellen von Komponententests.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="7ae7e-128">In der fünften Iteration erleichtern wir die Wartung und Änderung unserer Anwendung durch Hinzufügen von Komponententests.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="7ae7e-129">Wir verspotten unsere Datenmodellklassen und erstellen Komponententests für unsere Controller und Validierungslogik.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="7ae7e-130">Iteration #6 - Verwenden Sie die testgesteuerte Entwicklung.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="7ae7e-131">In dieser sechsten Iteration fügen wir unserer Anwendung neue Funktionen hinzu, indem wir zuerst Komponententests schreiben und Code für die Komponententests schreiben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="7ae7e-132">In dieser Iteration fügen wir Kontaktgruppen hinzu.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="7ae7e-133">Iteration #7 - Ajax-Funktionalität hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="7ae7e-134">In der siebten Iteration verbessern wir die Reaktionsfähigkeit und Leistung unserer Anwendung, indem wir Unterstützung für Ajax hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="7ae7e-135">Diese Iteration</span><span class="sxs-lookup"><span data-stu-id="7ae7e-135">This Iteration</span></span>

<span data-ttu-id="7ae7e-136">In der vorherigen Iteration der Contact Manager-Anwendung haben wir die Anwendung so umgestaltet, dass sie lockerer gekoppelt ist.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="7ae7e-137">Wir haben die Anwendung in unterschiedliche Controller-, Service- und Repository-Layer unterteilt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="7ae7e-138">Jede Ebene interagiert über Schnittstellen mit der darunter liegenden Ebene.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="7ae7e-139">Wir haben die Anwendung umgestaltet, um die Anwendung einfacher zu warten und zu modifizieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="7ae7e-140">Wenn wir beispielsweise eine neue Datenzugriffstechnologie verwenden müssen, können wir einfach die Repository-Schicht ändern, ohne den Controller oder die Service-Ebene zu berühren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="7ae7e-141">Indem wir den Contact Manager lose gekoppelt haben, haben wir die Anwendung widerstandsfähiger für Änderungen gemacht.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="7ae7e-142">Aber was passiert, wenn wir der Contact Manager-Anwendung eine neue Funktion hinzufügen müssen?</span><span class="sxs-lookup"><span data-stu-id="7ae7e-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="7ae7e-143">Oder was passiert, wenn wir einen Fehler beheben?</span><span class="sxs-lookup"><span data-stu-id="7ae7e-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="7ae7e-144">Eine traurige, aber gut bewiesene Wahrheit beim Schreiben von Code ist, dass, wenn Sie Code berühren, Sie das Risiko der Einführung neuer Fehler schaffen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="7ae7e-145">An einem schönen Tag kann Ihr Vorgesetzter Sie beispielsweise bitten, dem Kontakt-Manager eine neue Funktion hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="7ae7e-146">Sie möchte, dass Sie Unterstützung für Kontaktgruppen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="7ae7e-147">Sie möchte, dass Sie Benutzern ermöglichen, ihre Kontakte in Gruppen wie Freunde, Unternehmen usw. zu organisieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="7ae7e-148">Um diese neue Funktion zu implementieren, müssen Sie alle drei Layer der Contact Manager-Anwendung ändern.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="7ae7e-149">Sie müssen den Controllern, dem Service-Layer und dem Repository neue Funktionen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="7ae7e-150">Sobald Sie mit dem Ändern von Code beginnen, besteht die Gefahr, dass Die zuvor funktionierenden Funktionen beeinträchtigt werden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="7ae7e-151">Die Umgestaltung unserer Anwendung in separate Ebenen, wie wir es in der vorherigen Iteration getan haben, war eine gute Sache.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="7ae7e-152">Es war eine gute Sache, weil es uns ermöglicht, Änderungen an ganzen Ebenen vorzunehmen, ohne den Rest der Anwendung zu berühren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="7ae7e-153">Wenn Sie jedoch den Code innerhalb einer Ebene einfacher verwalten und ändern möchten, müssen Sie Komponententests für den Code erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="7ae7e-154">Sie verwenden einen Komponententest, um eine einzelne Codeeinheit zu testen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="7ae7e-155">Diese Codeeinheiten sind kleiner als die gesamten Anwendungsebenen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="7ae7e-156">In der Regel verwenden Sie einen Komponententest, um zu überprüfen, ob sich eine bestimmte Methode im Code so verhält, wie Sie es erwarten.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="7ae7e-157">Sie würden z. B. einen Komponententest für die CreateContact()-Methode erstellen, die von der ContactManagerService-Klasse verfügbar gemacht wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="7ae7e-158">Die Komponententests für eine Anwendung funktionieren wie ein Sicherheitsnetz.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="7ae7e-159">Wenn Sie Code in einer Anwendung ändern, können Sie eine Reihe von Komponententests ausführen, um zu überprüfen, ob die Änderung vorhandene Funktionen beeinträchtigt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="7ae7e-160">Komponententests machen den Code sicher zu ändern.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="7ae7e-161">Komponententests machen den gesamten Code in Ihrer Anwendung widerstandsfähiger für Änderungen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="7ae7e-162">In dieser Iteration fügen wir Komponententests zu unserer Contact Manager-Anwendung hinzu.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="7ae7e-163">Auf diese Weise können wir in der nächsten Iteration Kontaktgruppen zu unserer Anwendung hinzufügen, ohne sich Gedanken über die Verletzung vorhandener Funktionen machen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="7ae7e-164">Es gibt eine Vielzahl von Komponententestframeworks, einschließlich NUnit, xUnit.net und MbUnit.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="7ae7e-165">In diesem Tutorial verwenden wir das in Visual Studio enthaltene Komponententestframework.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="7ae7e-166">Sie können jedoch genauso einfach einen dieser alternativen Frameworks verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="7ae7e-167">Was getestet wird</span><span class="sxs-lookup"><span data-stu-id="7ae7e-167">What Gets Tested</span></span>

<span data-ttu-id="7ae7e-168">In der perfekten Welt würde Ihr codealler Code durch Komponententests abgedeckt werden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="7ae7e-169">In der perfekten Welt hätten Sie das perfekte Sicherheitsnetz.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="7ae7e-170">Sie könnten jede Codezeile in Ihrer Anwendung ändern und sofort durch ausführen der Komponententests wissen, ob die Änderung die vorhandene Funktionalität gebrochen hat.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="7ae7e-171">Wir leben jedoch nicht in einer perfekten Welt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="7ae7e-172">In der Praxis konzentrieren Sie sich beim Schreiben von Komponententests auf das Schreiben von Tests für Ihre Geschäftslogik (z. B. Validierungslogik).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="7ae7e-173">Insbesondere schreiben Sie *keine* Komponententests für Ihre Datenzugriffslogik oder Ihre Ansichtslogik.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="7ae7e-174">Um nützlich zu sein, müssen Komponententests sehr schnell ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="7ae7e-175">Sie können problemlos Hunderte (oder sogar Tausende) von Komponententests für eine Anwendung ansammeln.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="7ae7e-176">Wenn die Ausführung der Komponententests lange dauert, vermeiden Sie die Ausführung.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="7ae7e-177">Mit anderen Worten, lange laufende Komponententests sind für tägliche Codierungszwecke nutzlos.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="7ae7e-178">Aus diesem Grund schreiben Sie in der Regel keine Komponententests für Code, der mit einer Datenbank interagiert.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="7ae7e-179">Das Ausführen von Hunderten von Komponententests für eine Live-Datenbank wäre zu langsam.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="7ae7e-180">Stattdessen verspotten Sie Ihre Datenbank und schreiben Code, der mit der Mock-Datenbank interagiert (wir besprechen das Verspotten einer Datenbank unten).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="7ae7e-181">Aus einem ähnlichen Grund schreiben Sie in der Regel keine Komponententests für Ansichten.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="7ae7e-182">Um eine Ansicht zu testen, müssen Sie einen Webserver ausdrehen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="7ae7e-183">Da das Aufdrehen eines Webservers ein relativ langsamer Prozess ist, wird das Erstellen von Komponententests für Ihre Ansichten nicht empfohlen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="7ae7e-184">Wenn Ihre Ansicht komplizierte Logik enthält, sollten Sie erwägen, die Logik in Helper-Methoden zu verschieben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="7ae7e-185">Sie können Komponententests für Helper-Methoden schreiben, die ausgeführt werden, ohne einen Webserver zu drehen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="7ae7e-186">Während das Schreiben von Tests für Datenzugriffslogik oder Ansichtslogik keine gute Idee beim Schreiben von Komponententests ist, können diese Tests beim Erstellen von Funktions- oder Integrationstests sehr wertvoll sein.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="7ae7e-187">ASP.NET MVC ist die Web Forms View Engine.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="7ae7e-188">Während das Web Forms View Engine von einem Webserver abhängig ist, sind andere Ansichtsmodule dies möglicherweise nicht.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="7ae7e-189">Verwenden eines Mock-Objektframeworks</span><span class="sxs-lookup"><span data-stu-id="7ae7e-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="7ae7e-190">Beim Erstellen von Komponententests müssen Sie fast immer ein Mock Object-Framework nutzen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="7ae7e-191">Mit einem Mock Object-Framework können Sie Mocks und Stubs für die Klassen in Ihrer Anwendung erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="7ae7e-192">Sie können z. B. ein Mock Object-Framework verwenden, um eine Mock-Version Ihrer Repository-Klasse zu generieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="7ae7e-193">Auf diese Weise können Sie die Mock-Repository-Klasse anstelle der echten Repository-Klasse in Ihren Komponententests verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="7ae7e-194">Durch die Verwendung des Mock-Repositorys können Sie die Ausführung von Datenbankcode beim Ausführen eines Komponententests vermeiden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="7ae7e-195">Visual Studio enthält kein Mock Object-Framework.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="7ae7e-196">Es stehen jedoch mehrere kommerzielle und Open-Source-Mock-Objekt-Frameworks für das .NET-Framework zur Verfügung:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="7ae7e-197">Moq - Dieses Framework ist unter der Open-Source-BSD-Lizenz verfügbar.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="7ae7e-198">Sie können Moq [https://code.google.com/p/moq/](https://code.google.com/p/moq/)von herunterladen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="7ae7e-199">Rhino Mocks - Dieses Framework ist unter der Open-Source-BSD-Lizenz verfügbar.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="7ae7e-200">Sie können Rhino Mocks von [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)herunterladen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="7ae7e-201">Typemock Isolator - Dies ist ein kommerzieller Rahmen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="7ae7e-202">Sie können eine Testversion von [http://www.typemock.com/](http://www.typemock.com/)herunterladen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="7ae7e-203">In diesem Tutorial habe ich beschlossen, Moq zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="7ae7e-204">Sie können jedoch genauso einfach Rhino Mocks oder Typemock Isolator verwenden, um die Mock-Objekte für die Contact Manager-Anwendung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="7ae7e-205">Bevor Sie Moq verwenden können, müssen Sie die folgenden Schritte ausführen:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="7ae7e-206">.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-206">.</span></span>
2. <span data-ttu-id="7ae7e-207">Bevor Sie den Download entpacken, stellen Sie sicher, dass Sie mit der rechten Maustaste auf die Datei klicken und auf die Schaltfläche **"Entsperren"** klicken (siehe Abbildung 1).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="7ae7e-208">Entpacken Sie den Download.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-208">Unzip the download.</span></span>
4. <span data-ttu-id="7ae7e-209">Fügen Sie dem Testprojekt einen Verweis auf die Moq-Baugruppe hinzu, indem Sie die Menüoption **Projekt, Referenz hinzufügen auswählen,** um das Dialogfeld **Referenz hinzufügen** zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="7ae7e-210">Navigieren Sie auf der Registerkarte Durchsuchen zu dem Ordner, in dem Sie Moq entpackt haben, und wählen Sie die Moq.dll-Assembly aus.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="7ae7e-211">Klicken Sie auf die Schaltfläche **OK** (siehe Abbildung 2).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-211">Click the **OK** button (see Figure 2).</span></span>

<span data-ttu-id="7ae7e-212">[![Entsperren von Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-212">[![Unblocking Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span></span>

<span data-ttu-id="7ae7e-213">**Abbildung 01**: Entsperren von Moq([Klicken Sie hier, um das Bild in voller Größe anzuzeigen](iteration-5-create-unit-tests-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="7ae7e-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>

<span data-ttu-id="7ae7e-214">[![Referenzen nach dem Hinzufügen von Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-214">[![References after adding Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span></span>

<span data-ttu-id="7ae7e-215">**Abbildung 02**: Referenzen nach dem Hinzufügen von Moq([Klicken Sie hier, um das Bild in voller Größe anzuzeigen](iteration-5-create-unit-tests-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="7ae7e-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="7ae7e-216">Erstellen von Komponententests für die Dienstschicht</span><span class="sxs-lookup"><span data-stu-id="7ae7e-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="7ae7e-217">Beginnen wir mit dem Erstellen einer Reihe von Komponententests für die Serviceschicht unserer Contact Manager-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="7ae7e-218">Wir verwenden diese Tests, um unsere Validierungslogik zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="7ae7e-219">Erstellen Sie im ContactManager.Tests-Projekt einen neuen Ordner mit dem Namen "Modelle".</span><span class="sxs-lookup"><span data-stu-id="7ae7e-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="7ae7e-220">Klicken Sie als Nächstes mit der rechten Maustaste auf den Ordner "Modelle" und wählen Sie **Hinzufügen, Neuer Test**aus.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="7ae7e-221">Das Dialogfeld **"Neuer Test hinzufügen"** in Abbildung 3 wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="7ae7e-222">Wählen Sie die **Komponententestvorlage** aus, und benennen Sie den neuen Test ContactManagerServiceTest.vb.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="7ae7e-223">Klicken Sie auf die Schaltfläche **OK,** um den neuen Test zu Ihrem Testprojekt hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="7ae7e-224">Im Allgemeinen soll die Ordnerstruktur des Testprojekts mit der Ordnerstruktur Ihres ASP.NET MVC-Projekts übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="7ae7e-225">Beispielsweise platzieren Sie Controllertests in einem Controllerordner, Modelltests in einem Ordner "Modelle" usw.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="7ae7e-226">[![Modelle-KontaktManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span></span>

<span data-ttu-id="7ae7e-227">**Abbildung 03**: Models-ContactManagerServiceTest.cs([Klicken Sie hier, um das Bild in voller Größe anzuzeigen)](iteration-5-create-unit-tests-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>

<span data-ttu-id="7ae7e-228">Zunächst möchten wir die CreateContact()-Methode testen, die von der ContactManagerService-Klasse verfügbar gemacht wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="7ae7e-229">Wir erstellen die folgenden fünf Tests:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="7ae7e-230">CreateContact() - Tests, die CreateContact() gibt den Wert true zurück, wenn ein gültiger Kontakt an die Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="7ae7e-231">CreateContactRequiredFirstName() - Testet, ob eine Fehlermeldung zum Modellstatus hinzugefügt wird, wenn ein Kontakt mit einem fehlenden Vornamen an die CreateContact()-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="7ae7e-232">CreateContactRequiredLastName() - Testet, ob eine Fehlermeldung zum Modellstatus hinzugefügt wird, wenn ein Kontakt mit einem fehlenden Nachnamen an die CreateContact()-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-232">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="7ae7e-233">CreateContactInvalidPhone() - Testet, ob dem Modellstatus eine Fehlermeldung hinzugefügt wird, wenn ein Kontakt mit einer ungültigen Telefonnummer an die CreateContact()-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="7ae7e-234">CreateContactInvalidEmail() - Testet, ob dem Modellstatus eine Fehlermeldung hinzugefügt wird, wenn ein Kontakt mit einer ungültigen E-Mail-Adresse an die CreateContact()-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="7ae7e-235">Der erste Test überprüft, ob ein gültiger Kontakt keinen Validierungsfehler generiert.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="7ae7e-236">Die verbleibenden Tests überprüfen die einzelnen Validierungsregeln.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="7ae7e-237">Der Code für diese Tests ist in Liste 1 enthalten.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-237">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="7ae7e-238">**Auflisten 1 - Modelle-ContactManagerServiceTest.vb**</span><span class="sxs-lookup"><span data-stu-id="7ae7e-238">**Listing 1 - Models\ContactManagerServiceTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]

<span data-ttu-id="7ae7e-239">Da wir die Contact-Klasse in Liste 1 verwenden, müssen wir unserem Testprojekt einen Verweis auf das Microsoft Entity Framework hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="7ae7e-240">Fügen Sie einen Verweis auf die System.Data.Entity-Assembly hinzu.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-240">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="7ae7e-241">Liste 1 enthält eine Methode mit dem Namen Initialize(), die mit dem Attribut [TestInitialize] versehen ist.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="7ae7e-242">Diese Methode wird automatisch aufgerufen, bevor jeder komponententest ausgeführt wird (es wird 5 Mal direkt vor jedem Komponententest aufgerufen).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="7ae7e-243">Die Initialize()-Methode erstellt ein Mock-Repository mit der folgenden Codezeile:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="7ae7e-244">Diese Codezeile verwendet das Moq-Framework, um ein Mock-Repository über die IContactManagerRepository-Schnittstelle zu generieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="7ae7e-245">Das Mock-Repository wird anstelle des eigentlichen EntityContactManagerRepository verwendet, um den Zugriff auf die Datenbank zu vermeiden, wenn jeder Komponententest ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="7ae7e-246">Das Mock-Repository implementiert die Methoden der IContactManagerRepository-Schnittstelle, aber die Methoden tun eigentlich nichts.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="7ae7e-247">Bei Verwendung des Moq-Frameworks \_wird zwischen \_mockRepository und mockRepository.Object unterschieden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="7ae7e-248">Erstere bezieht sich auf die Mock(Of IContactManagerRepository)-Klasse, die Methoden zum Angeben des Verhaltens des Mock-Repositorys enthält.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="7ae7e-249">Letzteres bezieht sich auf das eigentliche Mock-Repository, das die IContactManagerRepository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="7ae7e-250">Das Mock-Repository wird in der Initialize()-Methode beim Erstellen einer Instanz der ContactManagerService-Klasse verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="7ae7e-251">Alle einzelnen Komponententests verwenden diese Instanz der ContactManagerService-Klasse.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="7ae7e-252">Liste 1 enthält fünf Methoden, die jedem komponententest entsprechen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="7ae7e-253">Jede dieser Methoden ist mit dem Attribut [TestMethod] versehen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="7ae7e-254">Wenn Sie die Komponententests ausführen, wird jede Methode mit diesem Attribut aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="7ae7e-255">Mit anderen Worten, jede Methode, die mit dem [TestMethod]-Attribut versehen ist, ist ein Komponententest.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="7ae7e-256">Der erste Komponententest mit dem Namen CreateContact() überprüft, ob der Aufruf von CreateContact() den Wert true zurückgibt, wenn eine gültige Instanz der Contact-Klasse an die Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="7ae7e-257">Der Test erstellt eine Instanz der Contact-Klasse, ruft die CreateContact()-Methode auf und überprüft, ob CreateContact() den Wert true zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="7ae7e-258">Die verbleibenden Tests überprüfen, dass beim Aufruf der CreateContact(-Methode mit einem ungültigen Kontakt die Methode false zurückgibt und die erwartete Validierungsfehlermeldung dem Modellstatus hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="7ae7e-259">Beispielsweise erstellt der CreateContactRequiredFirstName()-Test eine Instanz der Contact-Klasse mit einer leeren Zeichenfolge für ihre FirstName-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="7ae7e-260">Als Nächstes wird die CreateContact()-Methode mit dem ungültigen Kontakt aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="7ae7e-261">Schließlich überprüft der Test, ob CreateContact() false zurückgibt und dass der Modellstatus die erwartete Validierungsfehlermeldung "Vorname ist erforderlich" enthält.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="7ae7e-262">Sie können die Komponententests in Liste 1 ausführen, indem Sie die Menüoption **Testen, Ausführen, Alle Tests in Lösung (STRG+R, A)** auswählen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="7ae7e-263">Die Ergebnisse der Tests werden im Fenster Testergebnisse angezeigt (siehe Abbildung 4).</span><span class="sxs-lookup"><span data-stu-id="7ae7e-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="7ae7e-264">[![Testergebnisse](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-264">[![Test Results](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span></span>

<span data-ttu-id="7ae7e-265">**Abbildung 04**: Testergebnisse ([Klicken Sie hier, um das Bild in voller Größe anzuzeigen](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="7ae7e-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="7ae7e-266">Erstellen von Komponententests für Controller</span><span class="sxs-lookup"><span data-stu-id="7ae7e-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="7ae7e-267">ASP.NET MVC-Anwendung steuert den Fluss der Benutzerinteraktion.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="7ae7e-268">Beim Testen eines Controllers möchten Sie testen, ob der Controller das richtige Aktionsergebnis zurückgibt, und Daten anzeigen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="7ae7e-269">Sie können auch testen, ob ein Controller mit Modellklassen in der erwarteten Weise interagiert.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="7ae7e-270">Beispielsweise enthält Liste 2 zwei Komponententests für die Contact Controller Create()-Methode.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="7ae7e-271">Der erste Komponententest überprüft, ob die Create(-Methode an die Index-Aktion umgeleitet wird, wenn ein gültiger Kontakt an die Create()-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="7ae7e-272">Mit anderen Worten, wenn ein gültiger Kontakt übergeben wird, sollte die Create()-Methode ein RedirectToRouteResult zurückgeben, das die Indexaktion darstellt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="7ae7e-273">Wir möchten die ContactManager-Dienstschicht nicht testen, wenn wir die Controllerschicht testen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="7ae7e-274">Daher spotten wir die Dienstschicht mit dem folgenden Code in der Initialize-Methode:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="7ae7e-275">Im Komponententest CreateValidContact() wird das Verhalten des Aufrufens der Service-Layer-Methode CreateContact() mit der folgenden Codezeile verspottet:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="7ae7e-276">Diese Codezeile bewirkt, dass der mock ContactManager-Dienst den Wert true zurückgibt, wenn seine CreateContact()-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="7ae7e-277">Durch Mocking auf der Dienstebene können wir das Verhalten unseres Controllers testen, ohne Code in der Dienstebene ausführen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="7ae7e-278">Der zweite Komponententest überprüft, ob die Aktion Create() die Ansicht Erstellen zurückgibt, wenn ein ungültiger Kontakt an die Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="7ae7e-279">Wir bewirken, dass die Service-Layer-Methode CreateContact() den Wert false mit der folgenden Codezeile zurückgibt:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="7ae7e-280">Wenn sich die Create()-Methode wie erwartet verhält, sollte sie die Ansicht Erstellen zurückgeben, wenn der Service-Layer den Wert false zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="7ae7e-281">Auf diese Weise kann der Controller die Validierungsfehlermeldungen in der Ansicht Erstellen anzeigen, und der Benutzer hat die Möglichkeit, diese ungültigen Kontakteigenschaften zu korrigieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="7ae7e-282">Wenn Sie Komponententests für Ihre Controller erstellen möchten, müssen Sie explizite Ansichtsnamen aus den Controlleraktionen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="7ae7e-283">Geben Sie z. B. eine Ansicht wie folgt nicht zurück:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="7ae7e-284">Rücklaufansicht()</span><span class="sxs-lookup"><span data-stu-id="7ae7e-284">Return View()</span></span>

<span data-ttu-id="7ae7e-285">Geben Sie stattdessen die Ansicht wie folgt zurück:</span><span class="sxs-lookup"><span data-stu-id="7ae7e-285">Instead, return the view like this:</span></span>

<span data-ttu-id="7ae7e-286">Rückgabeansicht("Erstellen")</span><span class="sxs-lookup"><span data-stu-id="7ae7e-286">Return View("Create")</span></span>

<span data-ttu-id="7ae7e-287">Wenn Sie beim Zurückgeben einer Ansicht nicht explizit sind, gibt die ViewResult.ViewName-Eigenschaft eine leere Zeichenfolge zurück.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="7ae7e-288">**Auflisten 2 - Controller-KontaktControllerTest.vb**</span><span class="sxs-lookup"><span data-stu-id="7ae7e-288">**Listing 2 - Controllers\ContactControllerTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="7ae7e-289">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="7ae7e-289">Summary</span></span>

<span data-ttu-id="7ae7e-290">In dieser Iteration haben wir Komponententests für unsere Contact Manager-Anwendung erstellt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="7ae7e-291">Wir können diese Komponententests jederzeit ausführen, um zu überprüfen, ob sich unsere Anwendung weiterhin so verhält, wie wir es erwarten.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="7ae7e-292">Die Komponententests dienen als Sicherheitsnetz für unsere Anwendung und ermöglichen es uns, unsere Anwendung in Zukunft sicher zu modifizieren.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="7ae7e-293">Wir haben zwei Sätze von Komponententests erstellt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-293">We created two sets of unit tests.</span></span> <span data-ttu-id="7ae7e-294">Zuerst haben wir unsere Validierungslogik getestet, indem wir Komponententests für unsere Serviceschicht erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="7ae7e-295">Als nächstes haben wir unsere Flusssteuerungslogik getestet, indem wir Komponententests für unsere Controller-Schicht erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="7ae7e-296">Beim Testen unserer Service-Schicht haben wir unsere Tests für unsere Service-Schicht von unserer Repository-Schicht isoliert, indem wir unsere Repository-Schicht verspottet haben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="7ae7e-297">Beim Testen der Controller-Schicht haben wir unsere Tests für unsere Controller-Schicht isoliert, indem wir die Service-Schicht verspottet haben.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="7ae7e-298">In der nächsten Iteration ändern wir die Contact Manager-Anwendung so, dass sie Kontaktgruppen unterstützt.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="7ae7e-299">Wir fügen diese neue Funktionalität zu unserer Anwendung hinzu, indem wir einen Softwaredesignprozess namens Test-gesteuerte Entwicklung verwenden.</span><span class="sxs-lookup"><span data-stu-id="7ae7e-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7ae7e-300">[Zurück](iteration-4-make-the-application-loosely-coupled-vb.md)
> [Weiter](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7ae7e-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
