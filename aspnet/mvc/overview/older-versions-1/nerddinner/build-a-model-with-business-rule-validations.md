---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Erstellen eines Modells mit Geschäftsregel Überprüfungen | Microsoft-Dokumentation
author: microsoft
description: In Schritt 3 wird gezeigt, wie ein Modell erstellt wird, das zum Abfragen und Aktualisieren der Datenbank für die "nerddinner"-Anwendung verwendet werden kann.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 6ebf1b71c089229ba9139ff7dc788b8978724046
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78435579"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="39642-103">Erstellen eines Modells mit Geschäftsregelüberprüfungen</span><span class="sxs-lookup"><span data-stu-id="39642-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="39642-104">von [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="39642-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="39642-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="39642-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="39642-106">Dies ist Schritt 3 des kostenlosen ["nerddinner"](introducing-the-nerddinner-tutorial.md) -Lernprogramms, in dem erläutert wird, wie eine kleine, aber komplette Webanwendung mit ASP.NET MVC 1 erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="39642-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="39642-107">In Schritt 3 wird gezeigt, wie ein Modell erstellt wird, das zum Abfragen und Aktualisieren der Datenbank für die "nerddinner"-Anwendung verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="39642-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="39642-108">Wenn Sie ASP.NET MVC 3 verwenden, empfiehlt es sich, die Tutorials " [Getting Started with MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) " oder " [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) " zu befolgen.</span><span class="sxs-lookup"><span data-stu-id="39642-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="39642-109">Nerddinner Step 3: Aufbau des Modells</span><span class="sxs-lookup"><span data-stu-id="39642-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="39642-110">In einem Model-View-Controller-Framework bezieht sich der Begriff "Model" auf die Objekte, die die Daten der Anwendung darstellen, sowie auf die entsprechende Domänen Logik, die Validierungs-und Geschäftsregeln damit integriert.</span><span class="sxs-lookup"><span data-stu-id="39642-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="39642-111">Das Modell ist in vielerlei Hinsicht das "Herz" einer MVC-basierten Anwendung, und wie wir später sehen werden, wird das Verhalten der Anwendung im Grunde genommen.</span><span class="sxs-lookup"><span data-stu-id="39642-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="39642-112">Das ASP.NET-MVC-Framework unterstützt die Verwendung beliebiger Datenzugriffs Technologien, und Entwickler können aus einer Vielzahl von Rich .NET-Daten Optionen wählen, um Ihre Modelle zu implementieren. dazu gehören: LINQ to Entities, LINQ to SQL, NHibernate, llblgen pro, Subsonic, wilsonorm oder einfach RAW ADO. NET DataReaders oder Datasets.</span><span class="sxs-lookup"><span data-stu-id="39642-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="39642-113">Für unsere "nerddinner"-Anwendung verwenden wir LINQ to SQL, um ein einfaches Modell zu erstellen, das dem Daten bankentwurf relativ genau entspricht, und fügt einige benutzerdefinierte Validierungs Logik und Geschäftsregeln hinzu.</span><span class="sxs-lookup"><span data-stu-id="39642-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="39642-114">Anschließend implementieren wir eine Repository-Klasse, mit der die Implementierung der Daten Persistenz aus dem Rest der Anwendung abstrahiert werden kann. so können wir den Komponenten Test problemlos durchführen.</span><span class="sxs-lookup"><span data-stu-id="39642-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="39642-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="39642-115">LINQ to SQL</span></span>

<span data-ttu-id="39642-116">LINQ to SQL ist ein ORM (Object Relational Mapper), der als Teil von .NET 3,5 ausgeliefert wird.</span><span class="sxs-lookup"><span data-stu-id="39642-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="39642-117">LINQ to SQL bietet eine einfache Möglichkeit zum Zuordnen von Datenbanktabellen zu .NET-Klassen, mit denen Sie Code codieren können.</span><span class="sxs-lookup"><span data-stu-id="39642-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="39642-118">Für unsere "nerddinner"-Anwendung verwenden wir diese, um die Dinner-und RSVP-Tabellen in der Datenbank den Dinner-und RSVP-Klassen zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="39642-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="39642-119">Die Spalten der Dinner-und RSVP-Tabellen entsprechen den Eigenschaften der Dinner-und RSVP-Klassen.</span><span class="sxs-lookup"><span data-stu-id="39642-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="39642-120">Jedes Dinner-und RSVP-Objekt stellt eine separate Zeile in den Dinner-oder RSVP-Tabellen in der Datenbank dar.</span><span class="sxs-lookup"><span data-stu-id="39642-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="39642-121">LINQ to SQL ermöglicht es uns, keine SQL-Anweisungen zum Abrufen und Aktualisieren von Dinner-und RSVP-Objekten mit Datenbankdaten manuell zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="39642-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="39642-122">Stattdessen definieren wir die Dinner-und RSVP-Klassen, ihre Zuordnung zu bzw. aus der Datenbank sowie die Beziehungen zwischen Ihnen.</span><span class="sxs-lookup"><span data-stu-id="39642-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="39642-123">LINQ to SQL übernimmt dann die Erstellung der entsprechenden SQL-Ausführungs Logik, die zur Laufzeit verwendet werden soll, wenn wir interagieren und verwenden.</span><span class="sxs-lookup"><span data-stu-id="39642-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="39642-124">Wir können die LINQ-Sprachunterstützung in VB und C# verwenden, um ausdrucksstarke Abfragen zu schreiben, mit denen Dinner-und RSVP-Objekte aus der Datenbank abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="39642-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="39642-125">Dies minimiert die Menge an Daten, die wir schreiben müssen, und ermöglicht es uns, wirklich saubere Anwendungen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="39642-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="39642-126">Hinzufügen von LINQ to SQL Klassen zum Projekt</span><span class="sxs-lookup"><span data-stu-id="39642-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="39642-127">Beginnen Sie mit der rechten Maustaste auf den Ordner "Models" in unserem Projekt, und wählen Sie den Menübefehl **Add-&gt;New Item** :</span><span class="sxs-lookup"><span data-stu-id="39642-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="39642-128">Dadurch wird das Dialogfeld "Neues Element hinzufügen" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="39642-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="39642-129">Wir Filtern nach der Kategorie "Data" und wählen die Vorlage "LINQ to SQL Classes" aus:</span><span class="sxs-lookup"><span data-stu-id="39642-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="39642-130">Wir geben dem Element den Namen "nerddinner" und klicken auf die Schaltfläche "Add" (hinzufügen).</span><span class="sxs-lookup"><span data-stu-id="39642-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="39642-131">Visual Studio fügt eine Datei "nerddinner. dbml" in das Verzeichnis "\models" ein und öffnet dann den relationalen Designer des LINQ to SQL Objekts:</span><span class="sxs-lookup"><span data-stu-id="39642-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="39642-132">Erstellen von Datenmodell Klassen mit LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="39642-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="39642-133">LINQ to SQL ermöglicht es uns, schnell Datenmodell Klassen aus einem vorhandenen Datenbankschema zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="39642-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="39642-134">Zu diesem Zweck öffnen Sie die Datenbank "nerddinner" im Server-Explorer und wählen die Tabellen aus, die in Ihr modelliert werden sollen:</span><span class="sxs-lookup"><span data-stu-id="39642-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="39642-135">Anschließend können Sie die Tabellen auf die LINQ to SQL Designer-Oberfläche ziehen.</span><span class="sxs-lookup"><span data-stu-id="39642-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="39642-136">Wenn wir dies tun, erstellt LINQ to SQL automatisch Dinner-und RSVP-Klassen mit dem Schema der Tabellen (mit Klasseneigenschaften, die den Spalten der Datenbanktabelle zugeordnet werden):</span><span class="sxs-lookup"><span data-stu-id="39642-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="39642-137">Standardmäßig werden Tabellen-und Spaltennamen vom LINQ to SQL-Designer automatisch "pluralisiert", wenn Klassen basierend auf einem Datenbankschema erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="39642-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="39642-138">Beispiel: die Tabelle "Dinner" in unserem obigen Beispiel führte zu einer "Dinner"-Klasse.</span><span class="sxs-lookup"><span data-stu-id="39642-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="39642-139">Diese benennungsklasse trägt dazu bei, dass unsere Modelle mit den .net-Benennungs Konventionen konsistent sind, und ich finde, dass der Designer dies bequem beheben kann (insbesondere beim Hinzufügen von vielen Tabellen).</span><span class="sxs-lookup"><span data-stu-id="39642-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="39642-140">Wenn Sie den Namen einer Klasse oder Eigenschaft, die der Designer generiert, nicht kennen, können Sie Sie jederzeit überschreiben und in einen beliebigen Namen ändern.</span><span class="sxs-lookup"><span data-stu-id="39642-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="39642-141">Hierzu können Sie entweder den Entitäts-/Eigenschaftennamen innerhalb des Designers inline bearbeiten oder ihn über das Eigenschaften Raster ändern.</span><span class="sxs-lookup"><span data-stu-id="39642-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="39642-142">Standardmäßig überprüft der LINQ to SQL-Designer auch die Primärschlüssel-/Fremdschlüssel Beziehungen der Tabellen und erstellt automatisch standardmäßige "Beziehungs Zuordnungen" zwischen den verschiedenen Modellklassen, die er erstellt.</span><span class="sxs-lookup"><span data-stu-id="39642-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="39642-143">Wenn wir z. b. die Dinner-und RSVP-Tabellen auf den LINQ to SQL-Designer gezogen haben, wurde eine 1: n-Beziehungs Zuordnung zwischen den beiden abgeleitet, basierend darauf, dass die RSVP-Tabelle einen Fremdschlüssel für die Dinner-Tabelle enthielt (Dies wird durch den Pfeil im -Designer):</span><span class="sxs-lookup"><span data-stu-id="39642-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="39642-144">Die obige Zuordnung bewirkt, dass LINQ to SQL eine stark typisierte "Dinner"-Eigenschaft zur RSVP-Klasse hinzufügt, die Entwickler verwenden können, um auf das Dinner zuzugreifen, das mit einer bestimmten RSVP verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="39642-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="39642-145">Außerdem bewirkt dies, dass die Dinner-Klasse über eine "RSVPs"-Auflistungs Eigenschaft verfügt, mit der Entwickler RSVP-Objekte abrufen und aktualisieren können, die einem bestimmten Dinner zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="39642-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="39642-146">Im folgenden finden Sie ein Beispiel für IntelliSense in Visual Studio, wenn wir ein neues RSVP-Objekt erstellen und es der RSVPs-Sammlung eines Dinner hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="39642-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="39642-147">Beachten Sie, dass LINQ to SQL automatisch eine "RSVPs"-Sammlung für das Dinner-Objekt hinzugefügt hat:</span><span class="sxs-lookup"><span data-stu-id="39642-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="39642-148">Durch das Hinzufügen des RSVP-Objekts zur RSVPs-Auflistung des Dinner wird LINQ to SQL angewiesen, eine Fremdschlüssel Beziehung zwischen dem Dinner-und der RSVP-Zeile in unserer Datenbank zuzuordnen:</span><span class="sxs-lookup"><span data-stu-id="39642-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="39642-149">Wenn Sie nicht möchten, wie der Designer eine Tabellen Zuordnung modelliert oder benannt hat, können Sie Sie überschreiben.</span><span class="sxs-lookup"><span data-stu-id="39642-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="39642-150">Klicken Sie im Designer einfach auf den Zuordnungs Pfeil, und greifen Sie über das Eigenschaften Raster auf seine Eigenschaften zu, um es umzubenennen, zu löschen oder zu ändern.</span><span class="sxs-lookup"><span data-stu-id="39642-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="39642-151">Für unsere "nerddinner"-Anwendung funktionieren die Standard Zuordnungs Regeln jedoch gut für die Datenmodell Klassen, die wir aufbauen, und wir können einfach das Standardverhalten verwenden.</span><span class="sxs-lookup"><span data-stu-id="39642-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="39642-152">Nerddinnerdatacontext-Klasse</span><span class="sxs-lookup"><span data-stu-id="39642-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="39642-153">Visual Studio erstellt automatisch .NET-Klassen, die die Modelle und Daten Bankbeziehungen darstellen, die mit dem LINQ to SQL-Designer definiert werden.</span><span class="sxs-lookup"><span data-stu-id="39642-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="39642-154">Eine LINQ to SQL DataContext-Klasse wird auch für jede LINQ to SQL Designer-Datei generiert, die der Projekt Mappe hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="39642-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="39642-155">Da wir unser LINQ to SQL-Klassen Element "nerddinner" genannt haben, wird die erstellte DataContext-Klasse als "nerddinnerdatacontext" bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="39642-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="39642-156">Diese nerddinnerdatacontext-Klasse ist die primäre Methode, mit der die Datenbank interagiert.</span><span class="sxs-lookup"><span data-stu-id="39642-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="39642-157">Unsere Klasse "nerddinnerdatacontext" macht zwei Eigenschaften verfügbar: "Dinner" und "RSVPs", die die beiden Tabellen darstellen, die in der Datenbank modelliert wurden.</span><span class="sxs-lookup"><span data-stu-id="39642-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="39642-158">Wir können verwenden C# , um LINQ-Abfragen für diese Eigenschaften zu schreiben, um Dinner-und RSVP-Objekte aus der Datenbank abzufragen und abzurufen.</span><span class="sxs-lookup"><span data-stu-id="39642-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="39642-159">Der folgende Code veranschaulicht, wie ein "nerddinnerdatacontext"-Objekt instanziiert und eine LINQ-Abfrage ausgeführt wird, um eine Sequenz von Abendessen zu erhalten, die in der Zukunft auftreten.</span><span class="sxs-lookup"><span data-stu-id="39642-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="39642-160">Visual Studio stellt beim Schreiben der LINQ-Abfrage eine vollständige IntelliSense-Funktion bereit, und die von ihr zurückgegebenen Objekte sind stark typisiert und unterstützen auch IntelliSense:</span><span class="sxs-lookup"><span data-stu-id="39642-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="39642-161">Ein "nerddinnerdatacontext" ermöglicht nicht nur die Abfrage von Dinner-und RSVP-Objekten, sondern auch automatisch alle Änderungen, die wir anschließend an den Dinner-und RSVP-Objekten vornehmen, die wir durch die Tabelle abrufen.</span><span class="sxs-lookup"><span data-stu-id="39642-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="39642-162">Wir können diese Funktion verwenden, um die Änderungen problemlos in der Datenbank zu speichern, ohne expliziten SQL-Update Code schreiben zu müssen.</span><span class="sxs-lookup"><span data-stu-id="39642-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="39642-163">Der folgende Code veranschaulicht z. b., wie eine LINQ-Abfrage verwendet wird, um ein einzelnes Dinner-Objekt aus der Datenbank abzurufen, zwei der Dinner-Eigenschaften zu aktualisieren und die Änderungen dann in der Datenbank wieder zu speichern:</span><span class="sxs-lookup"><span data-stu-id="39642-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="39642-164">Das Objekt "nerddinnerdatacontext" im obigen Code hat die an dem Dinner-Objekt vorgenommenen Eigenschaften Änderungen, die wir daraus abgerufen haben, automatisch nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="39642-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="39642-165">Wenn wir die Methode "SubmitChanges ()" aufgerufen haben, wird eine entsprechende SQL-Anweisung "Update" für die Datenbank ausgeführt, um die aktualisierten Werte wieder zu speichern.</span><span class="sxs-lookup"><span data-stu-id="39642-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="39642-166">Erstellen einer dinnerrepository-Klasse</span><span class="sxs-lookup"><span data-stu-id="39642-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="39642-167">Bei kleinen Anwendungen ist es manchmal gut, dass Controller direkt für eine LINQ to SQL DataContext-Klasse funktionieren und LINQ-Abfragen innerhalb der Controller einbetten.</span><span class="sxs-lookup"><span data-stu-id="39642-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="39642-168">Wenn Anwendungen jedoch größer werden, wird dieser Ansatz für die Wartung und den Test mühsam.</span><span class="sxs-lookup"><span data-stu-id="39642-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="39642-169">Dies kann auch dazu führen, dass wir dieselben LINQ-Abfragen an mehreren Stellen duplizieren.</span><span class="sxs-lookup"><span data-stu-id="39642-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="39642-170">Ein Ansatz, mit dem Anwendungen leichter zu verwalten und zu testen sind, ist die Verwendung eines "Repository"-Musters.</span><span class="sxs-lookup"><span data-stu-id="39642-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="39642-171">Eine Repository-Klasse unterstützt das Kapseln von Daten Abfragen und Persistenzlogik und abstrahiert die Implementierungsdetails der Daten Persistenz aus der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="39642-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="39642-172">Mit einem Repository-Muster können Sie nicht nur Anwendungs Codes bereinigen, sondern auch das Ändern von Daten Speicherungs Implementierungen in Zukunft vereinfachen und das Komponenten Testen einer Anwendung vereinfachen, ohne dass eine echte Datenbank erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="39642-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="39642-173">Für unsere "nerddinner"-Anwendung definieren wir eine dinnerrepository-Klasse mit der folgenden Signatur:</span><span class="sxs-lookup"><span data-stu-id="39642-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="39642-174">*Hinweis: später in diesem Kapitel extrahieren wir eine idinnerrepository-Schnittstelle aus dieser Klasse und aktivieren die Abhängigkeitsinjektion mit ihr auf unseren Controllern. Zunächst einmal beginnen wir mit der Verwendung von Simple und arbeiten einfach direkt mit der dinnerrepository-Klasse.*</span><span class="sxs-lookup"><span data-stu-id="39642-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="39642-175">Um diese Klasse zu implementieren, klicken Sie mit der rechten Maustaste auf den Ordner "Models", und wählen Sie den Menübefehl **Add-&gt;New Item** aus.</span><span class="sxs-lookup"><span data-stu-id="39642-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="39642-176">Im Dialogfeld "Neues Element hinzufügen" wählen Sie die Vorlage "Class" aus und benennen die Datei "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="39642-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="39642-177">Anschließend können wir unsere dinnerrepository-Klasse mithilfe des folgenden Codes implementieren:</span><span class="sxs-lookup"><span data-stu-id="39642-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="39642-178">Abrufen, aktualisieren, einfügen und löschen mithilfe der dinnerrepository-Klasse</span><span class="sxs-lookup"><span data-stu-id="39642-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="39642-179">Nachdem wir nun unsere dinnerrepository-Klasse erstellt haben, sehen wir uns einige Codebeispiele an, in denen häufige Aufgaben veranschaulicht werden, die wir damit ausführen können:</span><span class="sxs-lookup"><span data-stu-id="39642-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="39642-180">Abfragen von Beispielen</span><span class="sxs-lookup"><span data-stu-id="39642-180">Querying Examples</span></span>

<span data-ttu-id="39642-181">Der folgende Code Ruft ein einzelnes Dinner mit dem dinnerid-Wert ab:</span><span class="sxs-lookup"><span data-stu-id="39642-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="39642-182">Der folgende Code Ruft alle bevorstehenden Abendessen ab und durchläuft Sie:</span><span class="sxs-lookup"><span data-stu-id="39642-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="39642-183">INSERT-und Update-Beispiele</span><span class="sxs-lookup"><span data-stu-id="39642-183">Insert and Update Examples</span></span>

<span data-ttu-id="39642-184">Der folgende Code veranschaulicht das Hinzufügen von zwei neuen Abendessen.</span><span class="sxs-lookup"><span data-stu-id="39642-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="39642-185">Ergänzungen/Änderungen am Repository werden erst in der Datenbank ausgeführt, wenn die "Save ()"-Methode dafür aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="39642-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="39642-186">LINQ to SQL automatisch alle Änderungen in einer Datenbanktransaktion umschließt – so werden entweder alle Änderungen durchgeführt, oder keine von Ihnen, wenn unser Repository speichert:</span><span class="sxs-lookup"><span data-stu-id="39642-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="39642-187">Der folgende Code Ruft ein vorhandenes Dinner-Objekt ab und ändert zwei Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="39642-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="39642-188">Die Änderungen werden an die Datenbank zurückgestellt, wenn die "Save ()"-Methode in unserem Repository aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="39642-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="39642-189">Der folgende Code Ruft ein Dinner ab und fügt ihm dann eine RSVP hinzu.</span><span class="sxs-lookup"><span data-stu-id="39642-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="39642-190">Dies erfolgt mithilfe der RSVPs-Auflistung auf dem Dinner-Objekt, das für uns erstellt LINQ to SQL (weil es eine Primärschlüssel-/Fremdschlüssel Beziehung zwischen den beiden in der Datenbank gibt).</span><span class="sxs-lookup"><span data-stu-id="39642-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="39642-191">Diese Änderung wird als neue RSVP-Tabellenzeile wieder in der Datenbank gespeichert, wenn die "Save ()"-Methode für das Repository aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="39642-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="39642-192">DELETE-Beispiel</span><span class="sxs-lookup"><span data-stu-id="39642-192">Delete Example</span></span>

<span data-ttu-id="39642-193">Der folgende Code Ruft ein vorhandenes Dinner-Objekt ab und kennzeichnet es als Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="39642-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="39642-194">Wenn die "Save ()"-Methode für das Repository aufgerufen wird, wird der Löschvorgang für den Löschvorgang wieder in die Datenbank durchführt:</span><span class="sxs-lookup"><span data-stu-id="39642-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="39642-195">Integrieren von Validierungs-und Geschäftsregel Logik in Modellklassen</span><span class="sxs-lookup"><span data-stu-id="39642-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="39642-196">Das Integrieren von Validierungs-und Geschäftsregel Logik ist ein wichtiger Bestandteil jeder Anwendung, die mit Daten arbeitet.</span><span class="sxs-lookup"><span data-stu-id="39642-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="39642-197">Schema Validierung</span><span class="sxs-lookup"><span data-stu-id="39642-197">Schema Validation</span></span>

<span data-ttu-id="39642-198">Wenn Modellklassen mit dem LINQ to SQL-Designer definiert werden, entsprechen die Datentypen der Eigenschaften in den Datenmodell Klassen den Datentypen der Datenbanktabelle.</span><span class="sxs-lookup"><span data-stu-id="39642-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="39642-199">Beispiel: Wenn die Spalte "eventdate" in der Tabelle "Dinners" ein "DateTime" ist, ist die von LINQ to SQL erstellte Datenmodell Klasse vom Typ "DateTime" (ein integrierter .NET-Datentyp).</span><span class="sxs-lookup"><span data-stu-id="39642-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="39642-200">Dies bedeutet, dass Sie Kompilierungsfehler erhalten, wenn Sie versuchen, eine ganze Zahl oder einen booleschen Wert aus dem Code zuzuweisen, und es wird automatisch ein Fehler ausgegeben, wenn Sie versuchen, einen nicht gültigen Zeichen Folgentyp zur Laufzeit implizit zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="39642-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="39642-201">LINQ to SQL werden bei der Verwendung von Zeichen folgen auch automatisch Escapesequenzen von SQL für Sie behandelt, was Sie bei der Verwendung von SQL-Injection-Angriffen schützt.</span><span class="sxs-lookup"><span data-stu-id="39642-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="39642-202">Validierungs-und Geschäftsregel Logik</span><span class="sxs-lookup"><span data-stu-id="39642-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="39642-203">Die Schema Validierung ist als erster Schritt nützlich, aber nur selten genug.</span><span class="sxs-lookup"><span data-stu-id="39642-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="39642-204">In den meisten realen Szenarios ist es möglich, eine umfassendere Validierungs Logik anzugeben, die mehrere Eigenschaften umfassen, Code ausführen und häufig den Status eines Modells überprüfen kann (z. b., wenn er erstellt wird/updated/Deleted oder innerhalb eines domänenspezifischen Zustands wie "archiviert").</span><span class="sxs-lookup"><span data-stu-id="39642-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="39642-205">Es gibt eine Vielzahl von verschiedenen Mustern und Frameworks, die zum Definieren und Anwenden von Validierungsregeln für Modellklassen verwendet werden können. es gibt mehrere .NET-basierte Frameworks, die dazu verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="39642-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="39642-206">Sie können in ASP.NET MVC-Anwendungen beliebig viele verwenden.</span><span class="sxs-lookup"><span data-stu-id="39642-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="39642-207">Für die Zwecke unserer "nerddinner"-Anwendung verwenden wir ein verhältnismäßig einfaches und geradliniges Muster, bei dem wir eine IsValid-Eigenschaft und eine getruleverletzungs ()-Methode für das Dinner Model-Objekt verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="39642-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="39642-208">Die IsValid-Eigenschaft gibt "true" oder "false" zurück, je nachdem, ob die Validierungs-und Geschäftsregeln gültig sind.</span><span class="sxs-lookup"><span data-stu-id="39642-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="39642-209">Die getruleverstöße ()-Methode gibt eine Liste aller Regel Fehler zurück.</span><span class="sxs-lookup"><span data-stu-id="39642-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="39642-210">Wir implementieren "IsValid" und "getruletemplates ()" für unser Dinner Model, indem wir dem Projekt eine "partielle Klasse" hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="39642-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="39642-211">Partielle Klassen können verwendet werden, um Methoden/Eigenschaften/Ereignisse zu Klassen hinzuzufügen, die von einem vs-Designer verwaltet werden (wie z. b. die Dinner-Klasse, die vom LINQ to SQL-Designer generiert wird)</span><span class="sxs-lookup"><span data-stu-id="39642-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="39642-212">Wir können dem Projekt eine neue partielle Klasse hinzufügen, indem Sie mit der rechten Maustaste auf den Ordner "\models" klicken und dann den Menübefehl "Neues Element hinzufügen" auswählen.</span><span class="sxs-lookup"><span data-stu-id="39642-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="39642-213">Anschließend können Sie im Dialogfeld "Neues Element hinzufügen" die Vorlage "Klasse" auswählen und ihr den Namen "Dinner.cs" geben.</span><span class="sxs-lookup"><span data-stu-id="39642-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="39642-214">Wenn Sie auf die Schaltfläche "hinzufügen" klicken, wird dem Projekt eine Dinner.cs-Datei hinzugefügt und in der IDE geöffnet.</span><span class="sxs-lookup"><span data-stu-id="39642-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="39642-215">Anschließend können wir mithilfe des folgenden Codes ein grundlegendes Framework für die Regel-/validierungsdurchsetzung implementieren:</span><span class="sxs-lookup"><span data-stu-id="39642-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="39642-216">Einige Hinweise zum obigen Code:</span><span class="sxs-lookup"><span data-stu-id="39642-216">A few notes about the above code:</span></span>

- <span data-ttu-id="39642-217">Der Dinner-Klasse wird ein partielles Schlüsselwort vorangestellt – Dies bedeutet, dass der darin enthaltene Code mit der vom LINQ to SQL-Designer generierten/verwalteten Klasse kombiniert und in eine einzelne Klasse kompiliert wird.</span><span class="sxs-lookup"><span data-stu-id="39642-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="39642-218">Die ruleverletzungs-Klasse ist eine Hilfsklasse, die wir dem Projekt hinzufügen, das es uns ermöglicht, weitere Details zu einer Regelverletzung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="39642-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="39642-219">Die Dinner. getruleverletzungs ()-Methode bewirkt, dass unsere Validierungs-und Geschäftsregeln ausgewertet werden (wir werden Sie in Kürze implementieren).</span><span class="sxs-lookup"><span data-stu-id="39642-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="39642-220">Anschließend wird eine Sequenz von ruleverletzungs-Objekten zurückgegeben, die ausführlichere Informationen zu Regel Fehlern bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="39642-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="39642-221">Die Dinner. IsValid-Eigenschaft stellt eine bequeme Hilfseigenschaft bereit, die angibt, ob das Dinner-Objekt über aktive ruleverstöße verfügt.</span><span class="sxs-lookup"><span data-stu-id="39642-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="39642-222">Sie kann von Entwicklern proaktiv überprüft werden, indem Sie das Dinner-Objekt jederzeit verwenden (und keine Ausnahme auslöst).</span><span class="sxs-lookup"><span data-stu-id="39642-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="39642-223">Die partielle Dinner. OnValidate ()-Methode ist ein Hook, den LINQ to SQL bereitstellt, mit dem wir jederzeit benachrichtigt werden können, wenn das Dinner-Objekt in der Datenbank persistent gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="39642-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="39642-224">Unsere oben genannte OnValidate ()-Implementierung stellt sicher, dass für das Dinner keine ruleverletzungs Verletzungen vorliegen, bevor es gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="39642-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="39642-225">Wenn Sie sich in einem ungültigen Zustand befindet, wird eine Ausnahme ausgelöst, die dazu führt, dass LINQ to SQL die Transaktion abbricht.</span><span class="sxs-lookup"><span data-stu-id="39642-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="39642-226">Diese Vorgehensweise bietet ein einfaches Framework, in das wir Validierungs-und Geschäftsregeln integrieren können.</span><span class="sxs-lookup"><span data-stu-id="39642-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="39642-227">Nun fügen wir die unten aufgeführten Regeln zur getruleverletzungs ()-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="39642-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="39642-228">Wir verwenden die Funktion "yield return" von C# , um eine Sequenz von ruleverstößen zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="39642-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="39642-229">Die ersten sechs Regelprüfungen oben erzwingen einfach, dass die Zeichen folgen Eigenschaften in unserem Dinner nicht NULL oder leer sein dürfen.</span><span class="sxs-lookup"><span data-stu-id="39642-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="39642-230">Die letzte Regel ist ein wenig interessanter und ruft eine phonevalidator. isvalidnumber ()-Hilfsmethode auf, die wir dem Projekt hinzufügen können, um zu überprüfen, ob das contactphone-Zahlenformat mit dem Land des Abendessens übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="39642-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="39642-231">Wir können verwenden. Unterstützung für reguläre Ausdrücke von NET zur Implementierung dieser Telefon Validierungs Unterstützung.</span><span class="sxs-lookup"><span data-stu-id="39642-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="39642-232">Im folgenden finden Sie eine einfache phonevalidator-Implementierung, die wir dem Projekt hinzufügen können, mit der wir länderspezifische Regex-Muster Überprüfungen hinzufügen können:</span><span class="sxs-lookup"><span data-stu-id="39642-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="39642-233">Behandeln von Validierungs-und Geschäftslogik Verstößen</span><span class="sxs-lookup"><span data-stu-id="39642-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="39642-234">Nachdem wir nun den obigen Validierungs-und Geschäftsregel Code hinzugefügt haben, werden wir jedes Mal, wenn wir versuchen, ein Dinner zu erstellen oder zu aktualisieren, die Regeln für die Validierungs Logik ausgewertet und erzwungen.</span><span class="sxs-lookup"><span data-stu-id="39642-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="39642-235">Entwickler können wie unten beschrieben Code schreiben, um proaktiv festzustellen, ob ein Dinner-Objekt gültig ist, und eine Liste aller Verstöße darin abrufen, ohne Ausnahmen zu verursachen:</span><span class="sxs-lookup"><span data-stu-id="39642-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="39642-236">Wenn Sie versuchen, ein Dinner in einem ungültigen Zustand zu speichern, wird eine Ausnahme ausgelöst, wenn die Save ()-Methode für das dinnerrepository aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="39642-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="39642-237">Der Grund hierfür ist, dass LINQ to SQL die partielle Dinner. OnValidate ()-Methode automatisch aufruft, bevor die Änderungen am Dinner gespeichert werden, und wir haben Code zu Dinner. OnValidate () hinzugefügt, um eine Ausnahme zu verursachen, wenn Regel Verletzungen im Abendessen vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="39642-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="39642-238">Wir können diese Ausnahme abfangen und eine Liste der zu befolgenden Verstöße reaktiv abrufen:</span><span class="sxs-lookup"><span data-stu-id="39642-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="39642-239">Da unsere Validierungs-und Geschäftsregeln innerhalb unserer Modell Ebene und nicht innerhalb der UI-Schicht implementiert werden, werden Sie in allen Szenarien in unserer Anwendung angewendet und verwendet.</span><span class="sxs-lookup"><span data-stu-id="39642-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="39642-240">Wir können später Geschäftsregeln ändern oder hinzufügen, sodass der gesamte Code, der mit unseren Dinner-Objekten zusammenarbeitet, Sie berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="39642-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="39642-241">Die Flexibilität, Geschäftsregeln an einem Ort zu ändern, ohne dass diese Änderungen in der gesamten Anwendungs-und Benutzeroberflächen Logik durchgeführt werden, ist ein Vorzeichen für eine gut geschriebene Anwendung und ein Vorteil, dass ein MVC-Framework ermutigt wird.</span><span class="sxs-lookup"><span data-stu-id="39642-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="39642-242">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="39642-242">Next Step</span></span>

<span data-ttu-id="39642-243">Wir haben nun ein Modell, mit dem wir unsere Datenbank Abfragen und aktualisieren können.</span><span class="sxs-lookup"><span data-stu-id="39642-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="39642-244">Nun fügen wir dem Projekt einige Controller und Ansichten hinzu, die wir verwenden können, um eine HTML-Benutzeroberfläche für die Benutzeroberfläche zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="39642-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="39642-245">[Zurück](create-a-database.md)
> [Weiter](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="39642-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
