---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Erstellen eines Modells mit Geschäftsregelüberprüfungen | Microsoft-Dokumentation
author: microsoft
description: Schritt 3 veranschaulicht, wie ein Modell zu erstellen, können wir, um beide Abfragen verwenden und aktualisieren Sie die Datenbank für die NerdDinner-Anwendung.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 078614c6e7ba18ac09bbd5e23b90b08c97aee658
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/09/2019
ms.locfileid: "59387294"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="a4f88-103">Erstellen eines Modells mit Geschäftsregelüberprüfungen</span><span class="sxs-lookup"><span data-stu-id="a4f88-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="a4f88-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="a4f88-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="a4f88-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="a4f88-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="a4f88-106">Dies ist Schritt 3 ein kostenloses ["NerdDinner"-webanwendungstutorial](introducing-the-nerddinner-tutorial.md) , die führt – Exemplarische Vorgehensweise erstellen eine kleine, jedoch abgeschlossen haben, Web-Anwendung mithilfe von ASP.NET MVC-1.</span><span class="sxs-lookup"><span data-stu-id="a4f88-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="a4f88-107">Schritt 3 veranschaulicht, wie ein Modell zu erstellen, können wir, um beide Abfragen verwenden und aktualisieren Sie die Datenbank für die NerdDinner-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="a4f88-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="a4f88-108">Wenn Sie ASP.NET MVC 3 verwenden, sollten Sie Sie folgen den [erste Schritte mit MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oder [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) Tutorials.</span><span class="sxs-lookup"><span data-stu-id="a4f88-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="a4f88-109">NerdDinner, Schritt 3: Beim Erstellen des Modells</span><span class="sxs-lookup"><span data-stu-id="a4f88-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="a4f88-110">In einem Model-View-Controller-Framework bezieht sich der Begriff "Model" auf die Objekte, die darstellen, die Daten von der Anwendung sowie die zugehörige Domänenlogik, die überprüfungs- und Geschäftsregeln er integriert ein.</span><span class="sxs-lookup"><span data-stu-id="a4f88-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="a4f88-111">Das Modell ist in vielerlei Hinsicht das "Herz" einer MVC-basierten Anwendung, und später im Wesentlichen sehen steuert das Verhalten des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="a4f88-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="a4f88-112">ASP.NET MVC-Framework unterstützt die Verwendung jeder neue datenzugriffstechnologie, und Entwickler können aus einer Vielzahl von umfangreichen .NET Datenoptionen, implementieren Sie ihre Modelle, einschließlich: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, oder nur unformatierten ADO.NET DataReader oder DataSets zu</span><span class="sxs-lookup"><span data-stu-id="a4f88-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="a4f88-113">Für die NerdDinner-Anwendung werden wir LINQ to SQL verwenden, um ein einfaches Modell zu erstellen, das unsere Datenbankentwurf ziemlich genau entspricht, und fügt einige benutzerdefinierte Validierungsregeln Datenlogik und Geschäftsregeln.</span><span class="sxs-lookup"><span data-stu-id="a4f88-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="a4f88-114">Wir klicken Sie dann Implementieren einer Repository-Klasse, die abstrakte sofort hilft Implementierung des Persistenz vom Rest der Anwendung und ermöglicht es uns ganz einfach Einheit testen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="a4f88-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="a4f88-115">LINQ to SQL</span></span>

<span data-ttu-id="a4f88-116">LINQ to SQL ist ein ORM (Object relational Mapper), die als Teil von .NET 3.5 enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="a4f88-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="a4f88-117">LINQ to SQL bietet eine einfache Möglichkeit, die Datenbanktabellen .NET Klassen zugeordnet werden, die wir für code können.</span><span class="sxs-lookup"><span data-stu-id="a4f88-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="a4f88-118">Für die NerdDinner-Anwendung wird es verwendet, um die Dinner und RSVP-Tabellen in unserer Datenbank Dinner und RSVP-Klassen zuordnen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="a4f88-119">Die Spalten der Dinner und RSVP Tabellen entsprechen den Eigenschaften für die Dinner und RSVP-Klassen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="a4f88-120">Jedes Objekt Dinner und RSVP stellt eine separate Zeile innerhalb der Dinner oder RSVP Tabellen in der Datenbank dar.</span><span class="sxs-lookup"><span data-stu-id="a4f88-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="a4f88-121">LINQ to SQL ermöglicht uns, um zu vermeiden, dass SQL-Anweisungen zum Abrufen und Aktualisieren von Dinner und RSVP manuell zu erstellen Objekte mit Datenbankdaten.</span><span class="sxs-lookup"><span data-stu-id="a4f88-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="a4f88-122">Stattdessen werden wir die Dinner und RSVP-Klassen, deren Zuordnung/aus der Datenbank und die Beziehungen zwischen ihnen definieren.</span><span class="sxs-lookup"><span data-stu-id="a4f88-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="a4f88-123">LINQ to SQL wird dann übernimmt die Betreuung der Generieren der entsprechenden SQL-Ausführungslogik, die zur Laufzeit verwendet werden soll, wenn wir interagieren und diese verwenden.</span><span class="sxs-lookup"><span data-stu-id="a4f88-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="a4f88-124">Wir können die LINQ-sprachunterstützung in VB und c# verwenden, um ausdrucksvolle Abfragen schreiben, die Dinner und RSVP abrufen Objekte aus der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="a4f88-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="a4f88-125">Dies minimiert die Menge an Datencode zu schreiben, wir müssen uns ermöglicht, wirklich fehlerfrei Anwendungen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="a4f88-126">Hinzufügen von LINQ to SQL-Klassen zu Ihrem Projekt</span><span class="sxs-lookup"><span data-stu-id="a4f88-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="a4f88-127">Wir beginnen, indem Sie mit der rechten Maustaste auf den Ordner "Models" in das Projekt, und wählen die **Add-&gt;neues Element** Menübefehl:</span><span class="sxs-lookup"><span data-stu-id="a4f88-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="a4f88-128">Hierdurch wird das Dialogfeld "Neues Element hinzufügen" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="a4f88-129">Wir filtern, indem Sie die Kategorie "Data" und wählen Sie die Vorlage "LINQ to SQL-Klassen" darin:</span><span class="sxs-lookup"><span data-stu-id="a4f88-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="a4f88-130">Wir nennen Sie das Element "NerdDinner" und klicken Sie auf die Schaltfläche "Hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="a4f88-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="a4f88-131">Visual Studio fügen Sie eine Datei NerdDinner.dbml unsere \Models-Verzeichnis, und öffnen Sie dann auf die LINQ to SQL Objektrelationaler Designer:</span><span class="sxs-lookup"><span data-stu-id="a4f88-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="a4f88-132">Erstellen von Datenmodellklassen mit LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="a4f88-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="a4f88-133">LINQ to SQL ermöglicht Data Model-Klassen aus vorhandenen Datenbankschema schnell zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="a4f88-134">To-do dies wir öffnen Sie die NerdDinner-Datenbank im Server-Explorer, und wählen Sie die Tabellen wir darin modellieren möchten:</span><span class="sxs-lookup"><span data-stu-id="a4f88-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="a4f88-135">Wir können dann die Tabellen in der LINQ auf SQL-Designeroberfläche ziehen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="a4f88-136">Wenn der wir diese LINQ to SQL erstellt automatisch Dinner und RSVP-Klassen, die mit dem Schema der Tabellen (mit der Eigenschaften der Klasse, die den Spalten der Datenbanktabelle zugeordnet):</span><span class="sxs-lookup"><span data-stu-id="a4f88-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="a4f88-137">Standardmäßig ist die LINQ to SQL "in plural-Designer automatisch" Tabellen- und Spaltennamen beim Erstellen von Klassen auf Grundlage eines Datenbankschemas.</span><span class="sxs-lookup"><span data-stu-id="a4f88-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="a4f88-138">Zum Beispiel: in der Tabelle "Dinner" im obigen Beispiel hat eine "Dinner"-Klasse.</span><span class="sxs-lookup"><span data-stu-id="a4f88-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="a4f88-139">Benennen von dieser Klasse kann die Modelle mit .NET Benennungskonventionen konsistent zu machen und in der Regel finde, dass durch den Designer Fix dies sich praktisch (insbesondere, wenn viele Tabellen hinzufügen).</span><span class="sxs-lookup"><span data-stu-id="a4f88-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="a4f88-140">Wenn Ihnen nicht gefällt, dass der Name einer Klasse oder Eigenschaft, die der Designer generiert jedoch, Sie können immer überschreiben, und ändern Sie ihn in einen beliebigen Namen gewünschten.</span><span class="sxs-lookup"><span data-stu-id="a4f88-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="a4f88-141">Sie können dies entweder durch Bearbeiten der Entität bzw. der Eigenschaft Name inline innerhalb des Designers oder ändern ihn über das Eigenschaftenraster vornehmen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="a4f88-142">Wird standardmäßig die LINQ to SQL-Designer auch der Primär-/Fremdschlüssel-Beziehungen der Tabellen überprüft und automatisch basierend darauf erstellt "Beziehung sicherheitszuordnungen" zwischen den verschiedenen Modellklassen, die sie erstellt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="a4f88-143">Beispielsweise, wenn wir die Dinner gezogen und RSVP, der auf die LINQ to SQL-Designer eine Zuordnung 1: n Beziehung zwischen den beiden Tabellen wurde abgeleitet basiert auf der Tatsache, dass die RSVP-Tabelle einen Fremdschlüssel für die Dinner-Tabelle haben (Dies wird angegeben, durch den Pfeil in der -Designer):</span><span class="sxs-lookup"><span data-stu-id="a4f88-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="a4f88-144">Die oben genannten Zuordnung führt dazu, dass LINQ to SQL eine stark typisierte "Dinner"-Eigenschaft der RSVP-Klasse hinzufügen, mit denen Entwickler auf der Dinner einer bestimmten RSVP zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="a4f88-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="a4f88-145">Es wird auch dazu führen, dass die Dinner-Klasse, um eine Auflistungseigenschaft "RSVPs" zu erhalten, mit der Entwickler zum Abrufen und Aktualisieren von RSVP-Objekten, die ein bestimmtes Essen zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="a4f88-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="a4f88-146">Im folgenden sehen Sie ein Beispiel für Intellisense in Visual Studio beim Erstellen wir ein neues RSVP-Objekt und einem Dinner Bestätigungen Auflistung hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="a4f88-147">Beachten Sie, wie LINQ to SQL automatisch eine Auflistung von "Bestätigungen" das Dinner-Objekt hinzugefügt wird:</span><span class="sxs-lookup"><span data-stu-id="a4f88-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="a4f88-148">Durch Hinzufügen des RSVP-Objekts auf der Dinner Bestätigungen Auflistung sagen wir LINQ to SQL, um eine fremdschlüsselbeziehung zwischen der Dinner und der RSVP-Zeile in der Datenbank zuzuordnen:</span><span class="sxs-lookup"><span data-stu-id="a4f88-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="a4f88-149">Wenn Ihnen nicht gefallen wie der Designer modelliert oder mit dem Namen einer Tabelle Zuordnung verfügt, können Sie sie überschreiben.</span><span class="sxs-lookup"><span data-stu-id="a4f88-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="a4f88-150">Nur klicken Sie auf den Pfeil "Zuordnung" im Designer und den Zugriff auf seine Eigenschaften über das Eigenschaftenraster umbenennen, löschen oder ändern Sie sie.</span><span class="sxs-lookup"><span data-stu-id="a4f88-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="a4f88-151">Für die NerdDinner-Anwendung jedoch die Standardregeln für die Zuordnung eignen sich gut für die Data-Model-Klassen, die wir erstellen und verwenden wir nur das Standardverhalten.</span><span class="sxs-lookup"><span data-stu-id="a4f88-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="a4f88-152">NerdDinnerDataContext-Klasse</span><span class="sxs-lookup"><span data-stu-id="a4f88-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="a4f88-153">Visual Studio erstellt automatisch .NET Klassen, die die Modelle und datenbankbeziehungen mit LINQ to SQL-Designer definiert darstellen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="a4f88-154">Für jede LINQ to SQL-Designer-Datei der Projektmappe hinzugefügt wird auch eine LINQ to SQL-DataContext-Klasse generiert.</span><span class="sxs-lookup"><span data-stu-id="a4f88-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="a4f88-155">Da wir unsere LINQ to SQL-Klassenelements "NerdDinner" benannt haben, wird die DataContext-Klasse erstellt "NerdDinnerDataContext" aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="a4f88-156">Diese Klasse NerdDinnerDataContext ist der einfachste Weg, die wir mit der Datenbank interagiert.</span><span class="sxs-lookup"><span data-stu-id="a4f88-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="a4f88-157">Unsere NerdDinnerDataContext-Klasse macht zwei Eigenschaften: "Dinner" und "RSVPs -" mit den beiden Tabellen, die wir in der Datenbank erstellt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="a4f88-158">Wir können c# Sie um LINQ-Abfragen für diese Eigenschaften in der Abfrage und Abrufen von Dinner und RSVP Objekten aus der Datenbank zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="a4f88-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="a4f88-159">Der folgende Code veranschaulicht, wie ein NerdDinnerDataContext-Objekt instanziiert, und führen Sie eine LINQ-Abfrage für sie um eine Sequenz von Dinner zu erhalten, die in der Zukunft liegen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="a4f88-160">Visual Studio bietet vollständiges Intellisense, wenn die LINQ-Abfrage schreiben, und die von ihm zurückgegebenen Objekte sind stark typisiert und unterstützt auch Intellisense:</span><span class="sxs-lookup"><span data-stu-id="a4f88-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="a4f88-161">Zusätzlich zu der es uns ermöglicht, Abfragen für Dinner und RSVP-Objekte, verfolgt einen NerdDinnerDataContext automatisch auch alle Änderungen, die wir anschließend an die Dinner und RSVP-Objekte, die wir über sie abrufen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="a4f88-162">Wir können diese Funktion verwenden, um ganz einfach die Änderungen zu speichern, in der Datenbank – ohne explizite SQL Update Code schreiben zu müssen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="a4f88-163">Der folgende Code zeigt beispielsweise, wie mit einer LINQ-Abfrage ein einzelnes Dinner-Objekt aus der Datenbank abrufen, aktualisieren zwei Eigenschaften Dinner und speichern Sie die Änderungen in der Datenbank:</span><span class="sxs-lookup"><span data-stu-id="a4f88-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="a4f88-164">Das NerdDinnerDataContext-Objekt im Code über verfolgt automatisch die an die Dinner-Objekt, das wir von ihm abgerufenen vorgenommenen eigenschaftenänderungen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="a4f88-165">Wenn wir die Methode "SubmitChanges()" aufgerufen wird, führt es eine entsprechende SQL "UPDATE"-Anweisung, mit der Datenbank beibehalten, werden die aktualisierten Werte zurück.</span><span class="sxs-lookup"><span data-stu-id="a4f88-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="a4f88-166">Erstellen einer "dinnerrepository"-Klasse</span><span class="sxs-lookup"><span data-stu-id="a4f88-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="a4f88-167">Für kleine Anwendungen ist es mitunter zu Controller funktioniert direkt mit einer LINQ to SQL-DataContext-Klasse, und betten Sie LINQ-Abfragen in den Controllern haben.</span><span class="sxs-lookup"><span data-stu-id="a4f88-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="a4f88-168">Wenn Anwendungen größer werden, wird dieser Ansatz jedoch mühsam, verwalten und testen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="a4f88-169">Sie können auch an die gleiche LINQ-Abfragen an mehreren Orten duplizieren führen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="a4f88-170">Ein Ansatz, mit denen kann Anwendungen einfacher zu verwalten und Testen ist ein Muster "Repository" verwendet.</span><span class="sxs-lookup"><span data-stu-id="a4f88-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="a4f88-171">Eine repositoryklasse kann Abfragen von Daten und Logik der Datenpersistenz und abstrahiert die Implementierungsdetails der Persistenz von Daten aus der Anwendung kapseln.</span><span class="sxs-lookup"><span data-stu-id="a4f88-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="a4f88-172">Zusätzlich zum Anwendungscode sauberer ist mit einem Repositorymuster können sie leichter datenspeicherimplementierungen Daten in der Zukunft ändern, und es kann eine Anwendung ohne eine echte Datenbank Komponententests erleichtern.</span><span class="sxs-lookup"><span data-stu-id="a4f88-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="a4f88-173">Für die NerdDinner-Anwendung definieren wir eine DinnerRepository-Klasse, mit der folgenden Signatur:</span><span class="sxs-lookup"><span data-stu-id="a4f88-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

*<span data-ttu-id="a4f88-174">Hinweis: In diesem Kapitel wir eine "idinnerrepository"-Schnittstelle von dieser Klasse extrahieren und Abhängigkeitsinjektion mit ihm auf unsere-Controller zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="a4f88-174">Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers.</span></span> <span data-ttu-id="a4f88-175">Zunächst werden jedoch Wir fangen Sie einfach und direkt mit der Klasse "dinnerrepository" funktioniert.</span><span class="sxs-lookup"><span data-stu-id="a4f88-175">To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.</span></span>*

<span data-ttu-id="a4f88-176">Diese Klasse implementieren wir mit der rechten Maustaste auf den Ordner "Models" und wählen Sie die **Add-&gt;neues Element** Menübefehl.</span><span class="sxs-lookup"><span data-stu-id="a4f88-176">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="a4f88-177">Das Dialogfeld "Neues Element hinzufügen" in "Wir wählen Sie die Vorlage"Class"und nennen Sie die Datei"DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="a4f88-177">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="a4f88-178">Wir können unsere "dinnerrepository"-Klasse, die anhand des folgenden Codes implementieren:</span><span class="sxs-lookup"><span data-stu-id="a4f88-178">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="a4f88-179">Abrufen, aktualisieren, einfügen und Löschen mithilfe der Klasse "dinnerrepository"</span><span class="sxs-lookup"><span data-stu-id="a4f88-179">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="a4f88-180">Nun, wir unsere Klasse "dinnerrepository" erstellt haben, sehen wir uns einige Codebeispiele, in denen häufige Aufgaben veranschaulicht, die wir damit tun können:</span><span class="sxs-lookup"><span data-stu-id="a4f88-180">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="a4f88-181">Beispiele für Abfragen</span><span class="sxs-lookup"><span data-stu-id="a4f88-181">Querying Examples</span></span>

<span data-ttu-id="a4f88-182">Der folgende Code Ruft die einem einzelnen Dinner unter Verwendung des Werts DinnerID ab:</span><span class="sxs-lookup"><span data-stu-id="a4f88-182">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="a4f88-183">Der folgende Code Ruft alle anstehenden Dinner und Schleifen über diese ab:</span><span class="sxs-lookup"><span data-stu-id="a4f88-183">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="a4f88-184">INSERT- und Update-Beispiele</span><span class="sxs-lookup"><span data-stu-id="a4f88-184">Insert and Update Examples</span></span>

<span data-ttu-id="a4f88-185">Der folgende Code veranschaulicht das Hinzufügen von zwei neuen Dinner.</span><span class="sxs-lookup"><span data-stu-id="a4f88-185">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="a4f88-186">Ergänzungen/Änderungen im Repository nicht mit der Datenbank ein Commit ausgeführt, bis auf die Methode "Save()""aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="a4f88-186">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="a4f88-187">LINQ to SQL wird automatisch alle Änderungen in einer Datenbanktransaktion – umgebrochen, damit alle Änderungen auftreten oder keine von ihnen tun, wenn es sich bei unserem Repository speichert:</span><span class="sxs-lookup"><span data-stu-id="a4f88-187">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="a4f88-188">Der folgende Code Ruft ein vorhandenes Dinner-Objekt und zwei Eigenschaften ändert.</span><span class="sxs-lookup"><span data-stu-id="a4f88-188">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="a4f88-189">Die Änderungen sind in der Datenbank ein Commit ausgeführt, wenn die Methode "Save()""für unsere Repositorys aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="a4f88-189">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="a4f88-190">Der folgende Code Ruft die einem Dinner ab, und klicken Sie dann eine Antwort hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-190">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="a4f88-191">Dies geschieht mithilfe der Bestätigungen-Auflistung auf der Dinner-Objekt, das LINQ to SQL für uns erstellt wird (da es eine Primärschlüssel-Schlüssel/Fremdschlüssel-Beziehung zwischen den beiden in der Datenbank ist).</span><span class="sxs-lookup"><span data-stu-id="a4f88-191">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="a4f88-192">Diese Änderung wird an die Datenbank als neue Zeile RSVP Tabelle beibehalten, wenn die Methode "Save()""für das Repository aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="a4f88-192">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="a4f88-193">DELETE-Beispiel</span><span class="sxs-lookup"><span data-stu-id="a4f88-193">Delete Example</span></span>

<span data-ttu-id="a4f88-194">Der folgende Code Ruft ein vorhandenes Dinner-Objekt ab, und klicken Sie dann markiert es gelöscht werden soll.</span><span class="sxs-lookup"><span data-stu-id="a4f88-194">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="a4f88-195">Wenn die Methode "Save()"", auf das Repository aufgerufen wird wird es den Löschvorgang in der Datenbank committen:</span><span class="sxs-lookup"><span data-stu-id="a4f88-195">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="a4f88-196">Integrieren von Überprüfung und Geschäftslogik für die Regel ViewModel-Klassen</span><span class="sxs-lookup"><span data-stu-id="a4f88-196">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="a4f88-197">Die Integration von Validierungs- und Business-Regel, dass die Logik ein wichtiger Bestandteil einer beliebigen Anwendung ist, die mit Daten arbeitet.</span><span class="sxs-lookup"><span data-stu-id="a4f88-197">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="a4f88-198">Schema-Validierung</span><span class="sxs-lookup"><span data-stu-id="a4f88-198">Schema Validation</span></span>

<span data-ttu-id="a4f88-199">Wenn Modellklassen mit LINQ to SQL-Designer definiert sind, entsprechen die Datentypen der Eigenschaften in den datenmodellklassen die Datentypen der Datenbanktabelle.</span><span class="sxs-lookup"><span data-stu-id="a4f88-199">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="a4f88-200">Zum Beispiel: Wenn die Spalte "EventDate" in der Tabelle "Dinner" ein "Datetime" ist, werden die Data Model-Klasse, die von LINQ to SQL erstellt vom Typ "DateTime" (die einen integrierten .NET-Datentyp).</span><span class="sxs-lookup"><span data-stu-id="a4f88-200">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="a4f88-201">Dies bedeutet, dass Sie Kompilierungsfehler angezeigt werden, wenn Sie versuchen, eine ganze Zahl oder einen booleschen Wert aus Code zuzuweisen, und es Fehler automatisch ausgelöst werden, wenn Sie versuchen, einen ungültigen Zeichenfolgentyp implizit, zur Laufzeit zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="a4f88-201">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="a4f88-202">LINQ to SQL wird auch automatisch übernimmt Escapezeichen SQL-Werten für Sie nach der Verwendung von Zeichenfolgen – um Sie vor SQL Injection-Angriffen zu schützen, wenn es verwendet.</span><span class="sxs-lookup"><span data-stu-id="a4f88-202">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="a4f88-203">Überprüfung und Geschäftslogik für die Regel</span><span class="sxs-lookup"><span data-stu-id="a4f88-203">Validation and Business Rule Logic</span></span>

<span data-ttu-id="a4f88-204">Schema-Validation eignet sich als ersten Schritt, aber nur selten reicht.</span><span class="sxs-lookup"><span data-stu-id="a4f88-204">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="a4f88-205">Die meisten realen Szenarien erfordern die Fähigkeit, umfangreichere Validierungslogik angeben, die umfassen mehrere Eigenschaften, führen Sie Code und haben häufig Informationen zu einem Modellzustand können (z. B.: wird es erstellt/aktualisiert/gelöscht oder in einem Zustand mit Domänenspezifischer wie "archiviert").</span><span class="sxs-lookup"><span data-stu-id="a4f88-205">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="a4f88-206">Es gibt eine Vielzahl von verschiedenen Mustern und Frameworks, die zum Definieren und Anwenden von Validierungsregeln auf ViewModel-Klassen verwendet werden können, und es gibt mehrere .NET Framework-basierte Frameworks, die verwendet werden können, um dies zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-206">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="a4f88-207">Sie können praktisch alle der in ASP.NET MVC-Anwendungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="a4f88-207">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="a4f88-208">Im Rahmen unserer NerdDinner-Anwendung verwenden wir ein Muster für relativ einfache und unkomplizierte, in denen verfügbar zu machen wir eine "IsValid"-Eigenschaft und eine GetRuleViolations()-Methode für das Dinner-Modell-Objekt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-208">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="a4f88-209">Die Eigenschaft "IsValid" gibt "true" oder "false", je nachdem, ob die Überprüfung und Geschäftsregeln gültig sind.</span><span class="sxs-lookup"><span data-stu-id="a4f88-209">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="a4f88-210">Die GetRuleViolations()-Methode gibt eine Liste der Regelfehler zurück.</span><span class="sxs-lookup"><span data-stu-id="a4f88-210">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="a4f88-211">Wir werden "IsValid" und GetRuleViolations() für unser Modell Dinner implementieren, indem Sie eine "partielle Klasse" Unser Projekt hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-211">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="a4f88-212">Partielle Klassen können verwendet werden, um das Hinzufügen von Methoden/Eigenschaften/Ereignisse für Klassen, die von einem Visual Studio-Designer (z. B. die Dinner-Klasse, die von der LINQ to SQL-Designer generierten) verwaltet und das Tool aus, Sie müssen sich mit unserem Code vermeiden.</span><span class="sxs-lookup"><span data-stu-id="a4f88-212">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="a4f88-213">Wir können unser Projekt mit der rechten Maustaste auf den Ordner "\Models" eine neue partielle Klasse hinzugefügt, und wählen Sie dann auf den Menübefehl "Neues Element hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="a4f88-213">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="a4f88-214">Wir können dann wählen Sie die Vorlage "Class" im Dialogfeld "Neues Element hinzufügen" und nennen Sie sie Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="a4f88-214">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="a4f88-215">Klicken Sie auf die Schaltfläche "Hinzufügen" wird eine Dinner.cs-Datei Ihrem Projekt hinzufügen, und öffnen sie in der IDE.</span><span class="sxs-lookup"><span data-stu-id="a4f88-215">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="a4f88-216">Wir können dann implementieren, eine grundlegende Regel Erzwingung Framework verwendet den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a4f88-216">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="a4f88-217">Einige Hinweise zu den obigen Code:</span><span class="sxs-lookup"><span data-stu-id="a4f88-217">A few notes about the above code:</span></span>

- <span data-ttu-id="a4f88-218">Die Dinner-Klasse ist mit einem "partiell" Schlüsselwort – vorangestellt, was bedeutet der darin enthaltene Code kombiniert mit der Klasse generiert/verwaltet vom LINQ to SQL-Designer und in einer einzelnen Klasse kompiliert.</span><span class="sxs-lookup"><span data-stu-id="a4f88-218">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="a4f88-219">Die RuleViolation-Klasse ist eine Hilfsklasse, die wir dem Projekt hinzufügen, die wir weitere Details zu einem Verstoß gegen bereitstellen können.</span><span class="sxs-lookup"><span data-stu-id="a4f88-219">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="a4f88-220">Die Dinner.GetRuleViolations()-Methode führt dazu, dass unsere Validierung und Geschäftsregeln ausgewertet werden soll (wir implementieren sie in Kürze).</span><span class="sxs-lookup"><span data-stu-id="a4f88-220">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="a4f88-221">Wird dann wieder eine Sequenz von RuleViolation-Objekten, die weitere Details zu Regelfehlern bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-221">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="a4f88-222">Die Dinner.IsValid-Eigenschaft enthält eine praktische Hilfsfunktion-Eigenschaft, die angibt, ob die Dinner-Objekt alle aktiven RuleViolations verfügt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-222">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="a4f88-223">Sie können proaktiv von einem Entwickler, die unter Verwendung des Dinner-Objekts zu einem beliebigen Zeitpunkt überprüft werden (und löst keine Ausnahme).</span><span class="sxs-lookup"><span data-stu-id="a4f88-223">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="a4f88-224">Die Dinner.OnValidate() partielle Methode ist ein Hook, den LINQ to SQL bietet, mit der wir um benachrichtigt zu werden jedes Mal, wenn das Dinner-Objekt wird in der Datenbank persistent gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="a4f88-224">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="a4f88-225">Unsere OnValidate()"-Implementierung, die oben genannten wird sichergestellt, dass die Dinner keine RuleViolations verfügt, bevor es gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="a4f88-225">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="a4f88-226">Wenn es in einem ungültigen Zustand ist es eine Ausnahme auslöst, dadurch LINQ to SQL die Transaktion abgebrochen wird.</span><span class="sxs-lookup"><span data-stu-id="a4f88-226">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="a4f88-227">Dieser Ansatz bietet ein einfaches Framework, dem wir die überprüfungs- und Geschäftsregeln in integrieren können.</span><span class="sxs-lookup"><span data-stu-id="a4f88-227">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="a4f88-228">Fügen Sie jetzt die folgenden Regeln, um unsere GetRuleViolations()-Methode:</span><span class="sxs-lookup"><span data-stu-id="a4f88-228">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="a4f88-229">Wir verwenden die "yield Return"-Funktion von C#-, um eine Sequenz von jedem RuleViolations zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a4f88-229">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="a4f88-230">Die ersten sechs regelüberprüfungen, die oben genannten erzwingen einfach, dass die Eigenschaften auf unsere Dinner null oder leer sein darf nicht.</span><span class="sxs-lookup"><span data-stu-id="a4f88-230">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="a4f88-231">Die letzte Regel ist ein wenig interessanter und Aufrufe PhoneValidator.IsValidNumber(), um eine Hilfsmethode, dass wir unser Projekt zu überprüfen, ob die ContactPhone hinzufügen können Zahl Format entspricht der Dinner Land.</span><span class="sxs-lookup"><span data-stu-id="a4f88-231">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="a4f88-232">Wir können. NET Unterstützung von regulären Ausdrücken zur Implementierung dieser Unterstützung der Phone-Überprüfung.</span><span class="sxs-lookup"><span data-stu-id="a4f88-232">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="a4f88-233">Im folgenden finden Sie eine einfache PhoneValidator-Implementierung, die wir hinzufügen können auf das Projekt, das wir länderspezifische Regex-Muster Überprüfungen hinzufügen kann:</span><span class="sxs-lookup"><span data-stu-id="a4f88-233">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="a4f88-234">Behandeln von Überprüfung und Business Logic Verstöße</span><span class="sxs-lookup"><span data-stu-id="a4f88-234">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="a4f88-235">Nun, wir obigen Validierung und Business-Regelcode jederzeit, die wir versuchen hinzugefügt haben, erstellen oder zu eine Dinner zu aktualisieren, werden unsere Logik Validierungsregeln ausgewertet und erzwungen werden soll.</span><span class="sxs-lookup"><span data-stu-id="a4f88-235">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="a4f88-236">Entwickler können code wie unten proaktiv zu bestimmen, ob es sich bei einem Dinner-Objekt gültig ist, und rufen Sie eine Liste alle Verstöße gegen die darin ohne Auslösen von Ausnahmen schreiben:</span><span class="sxs-lookup"><span data-stu-id="a4f88-236">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="a4f88-237">Wenn wir versuchen, eine Dinner in einem ungültigen Zustand zu speichern, wird eine Ausnahme ausgelöst werden, wenn wir die Save() auf die "dinnerrepository" aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-237">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="a4f88-238">Dies tritt auf, da LINQ to SQL wird automatisch unsere Dinner.OnValidate() partielle Methode aufruft, bevor er die Dinner Änderungen speichert, und wir Code, um Dinner.OnValidate() zum Auslösen einer Ausnahme hinzugefügt, wenn Verletzungen der Schwellenwertregeln in das Dinner vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="a4f88-238">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="a4f88-239">Wir können diese Ausnahme abfangen und reaktiv Abrufen einer Liste Verstöße gegen die Fehler beheben:</span><span class="sxs-lookup"><span data-stu-id="a4f88-239">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="a4f88-240">Da unsere Validierung und Geschäftsregeln unsere Modellschicht, und nicht innerhalb der UI-Ebene implementiert werden, werden sie angewendet und in allen Szenarien innerhalb der Anwendung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a4f88-240">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="a4f88-241">Wir können später ändern oder Hinzufügen von Geschäftsregeln und gesamten Code, arbeitet mit unseren Dinner-Objekten, die sie berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-241">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="a4f88-242">Die Flexibilität, Geschäftsregeln an einem Ort ändern ist, ohne diese Änderungen in der Anwendung und die UI-Logik ripple ein Anzeichen für eine gut geschriebene Anwendung und ein Vorteil, den ein MVC-Framework unterstützt empfehlen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-242">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="a4f88-243">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="a4f88-243">Next Step</span></span>

<span data-ttu-id="a4f88-244">Wir haben jetzt ein Modell, mit denen wir sowohl Abfragen und Aktualisieren der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="a4f88-244">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="a4f88-245">Lassen Sie uns nun einige Controller und Ansichten zum Projekt hinzufügen, das wir verwenden können, um eine HTML-UI-Erfahrung, um es herum zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="a4f88-245">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a4f88-246">[Zurück](create-a-database.md)
> [Weiter](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="a4f88-246">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
