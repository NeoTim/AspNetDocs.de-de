---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Automatisierte Komponententests aktivieren | Microsoft Docs
author: rick-anderson
description: Schritt 12 zeigt, wie Sie eine Reihe von automatisierten Komponententests entwickeln, die unsere NerdDinner-Funktionalität überprüfen und uns das Vertrauen geben, Änderungen vorzunehmen...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 7fe84efd9e4cc359c19d5ab9e22c579b80207e9c
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541467"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="abe19-103">Aktivieren von automatisierten Komponententests</span><span class="sxs-lookup"><span data-stu-id="abe19-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="abe19-104">von [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="abe19-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="abe19-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="abe19-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="abe19-106">Dies ist Schritt 12 eines kostenlosen ["NerdDinner" Anwendungs-Tutorials,](introducing-the-nerddinner-tutorial.md) das durch die Erstellung einer kleinen, aber vollständigen Webanwendung mit ASP.NET MVC 1 führt.</span><span class="sxs-lookup"><span data-stu-id="abe19-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="abe19-107">Schritt 12 zeigt, wie Sie eine Reihe von automatisierten Komponententests entwickeln, die unsere NerdDinner-Funktionalität überprüfen und uns das Vertrauen geben, in Zukunft Änderungen und Verbesserungen an der Anwendung vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="abe19-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="abe19-108">Wenn Sie ASP.NET MVC 3 verwenden, empfehlen wir Ihnen, die Tutorials [Erste Schritte mit MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oder [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) zu befolgen.</span><span class="sxs-lookup"><span data-stu-id="abe19-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="abe19-109">NerdDinner Schritt 12: Komponententests</span><span class="sxs-lookup"><span data-stu-id="abe19-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="abe19-110">Lassen Sie uns eine Reihe von automatisierten Komponententests entwickeln, die unsere NerdDinner-Funktionalität überprüfen und uns das Vertrauen geben, in Zukunft Änderungen und Verbesserungen an der Anwendung vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="abe19-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="abe19-111">Warum Komponententest?</span><span class="sxs-lookup"><span data-stu-id="abe19-111">Why Unit Test?</span></span>

<span data-ttu-id="abe19-112">Auf der Fahrt zur Arbeit eines Morgens haben Sie einen plötzlichen Blitz der Inspiration über eine Anwendung, an der Sie arbeiten.</span><span class="sxs-lookup"><span data-stu-id="abe19-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="abe19-113">Sie erkennen, dass es eine Änderung gibt, die Sie implementieren können, die die Anwendung dramatisch verbessern wird.</span><span class="sxs-lookup"><span data-stu-id="abe19-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="abe19-114">Es kann sich um eine Umgestaltung handelt, die den Code behebt, eine neue Funktion hinzufügt oder einen Fehler behebt.</span><span class="sxs-lookup"><span data-stu-id="abe19-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="abe19-115">Die Frage, die Sie konfrontiert, wenn Sie an Ihrem Computer ankommen, ist: "Wie sicher ist es, diese Verbesserung zu machen?"</span><span class="sxs-lookup"><span data-stu-id="abe19-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="abe19-116">Was ist, wenn die Änderung Nebenwirkungen hat oder etwas bricht?</span><span class="sxs-lookup"><span data-stu-id="abe19-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="abe19-117">Die Änderung ist möglicherweise einfach und dauert nur wenige Minuten, aber was ist, wenn es Stunden dauert, um alle Anwendungsszenarien manuell zu testen?</span><span class="sxs-lookup"><span data-stu-id="abe19-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="abe19-118">Was passiert, wenn Sie vergessen, ein Szenario abzudecken und eine fehlerhafte Anwendung in die Produktion geht?</span><span class="sxs-lookup"><span data-stu-id="abe19-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="abe19-119">Lohnt sich diese Verbesserung wirklich?</span><span class="sxs-lookup"><span data-stu-id="abe19-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="abe19-120">Automatisierte Komponententests können ein Sicherheitsnetz bieten, mit dem Sie Ihre Anwendungen kontinuierlich verbessern und keine Angst vor dem Code haben, an dem Sie arbeiten.</span><span class="sxs-lookup"><span data-stu-id="abe19-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="abe19-121">Durch automatisierte Tests, die die Funktionalität schnell überprüfen, können Sie sicher programmieren – und Sie in die Lage versetzen, Verbesserungen vorzunehmen, die Sie sonst vielleicht nicht bequem gemacht hätten.</span><span class="sxs-lookup"><span data-stu-id="abe19-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="abe19-122">Sie helfen auch, Lösungen zu schaffen, die besser bedienbar sind und eine längere Lebensdauer haben - was zu einer viel höheren Rendite führt.</span><span class="sxs-lookup"><span data-stu-id="abe19-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="abe19-123">Das ASP.NET MVC Framework macht es einfach und natürlich, die Anwendungsfunktionalität von Komponenten zu testen.</span><span class="sxs-lookup"><span data-stu-id="abe19-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="abe19-124">Es ermöglicht auch einen TDD-Workflow (Test Driven Development), der die Test-First-basierte Entwicklung ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="abe19-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="abe19-125">NerdDinner.Tests Projekt</span><span class="sxs-lookup"><span data-stu-id="abe19-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="abe19-126">Als wir unsere NerdDinner-Anwendung zu Beginn dieses Tutorials erstellt enden, wurden wir mit einem Dialog gefragt, ob wir ein Komponententestprojekt erstellen möchten, um mit dem Anwendungsprojekt zu gehen:</span><span class="sxs-lookup"><span data-stu-id="abe19-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="abe19-127">Wir haben den "Ja, erstellen Sie ein Komponententestprojekt" ausgewählt – was dazu führte, dass ein "NerdDinner.Tests"-Projekt zu unserer Lösung hinzugefügt wurde:</span><span class="sxs-lookup"><span data-stu-id="abe19-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="abe19-128">Das NerdDinner.Tests-Projekt verweist auf die NerdDinner-Anwendungsprojektassembly und ermöglicht es uns, ihm problemlos automatisierte Tests hinzuzufügen, die die Anwendungsfunktionalität überprüfen.</span><span class="sxs-lookup"><span data-stu-id="abe19-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="abe19-129">Erstellen von Komponententests für unsere Dinner-Modellklasse</span><span class="sxs-lookup"><span data-stu-id="abe19-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="abe19-130">Fügen wir unserem NerdDinner.Tests-Projekt einige Tests hinzu, die die Dinner-Klasse überprüfen, die wir beim Erstellen unserer Modellebene erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="abe19-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="abe19-131">Wir beginnen mit der Erstellung eines neuen Ordners in unserem Testprojekt namens "Modelle", in dem wir unsere modellbezogenen Tests platzieren.</span><span class="sxs-lookup"><span data-stu-id="abe19-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="abe19-132">Wir klicken dann mit der rechten Maustaste auf den Ordner und wählen den Befehl **&gt;"Neuer Test hinzufügen".**</span><span class="sxs-lookup"><span data-stu-id="abe19-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="abe19-133">Dadurch wird das Dialogfeld "Neuer Test hinzufügen" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abe19-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="abe19-134">Wir erstellen einen "Komponententest" und nennen ihn "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="abe19-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="abe19-135">Wenn wir auf die Schaltfläche "OK" klicken, fügt Visual Studio dem Projekt eine DinnerTest.cs Datei hinzu (und öffnet sie):</span><span class="sxs-lookup"><span data-stu-id="abe19-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="abe19-136">Die standardmäßige Visual Studio-Komponententestvorlage enthält eine Reihe von Kesselplattencodes, die ich ein wenig chaotisch finde.</span><span class="sxs-lookup"><span data-stu-id="abe19-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="abe19-137">Lassen Sie uns es bereinigen, um nur den folgenden Code zu enthalten:</span><span class="sxs-lookup"><span data-stu-id="abe19-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="abe19-138">Das [TestClass]-Attribut in der oben genannten DinnerTest-Klasse identifiziert es als Klasse, die Tests sowie optionalen Testinitialisierungs- und Teardowncode enthält.</span><span class="sxs-lookup"><span data-stu-id="abe19-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="abe19-139">Wir können darin Tests definieren, indem wir öffentliche Methoden hinzufügen, auf denen ein [TestMethod]-Attribut enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="abe19-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="abe19-140">Im Folgenden finden Sie den ersten von zwei Tests, die wir hinzufügen werden, dass unsere Dinner-Klasse trainieren.</span><span class="sxs-lookup"><span data-stu-id="abe19-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="abe19-141">Der erste Test bestätigt, dass unser Dinner ungültig ist, wenn ein neues Dinner erstellt wird, ohne dass alle Eigenschaften richtig eingestellt werden.</span><span class="sxs-lookup"><span data-stu-id="abe19-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="abe19-142">Der zweite Test bestätigt, ob unser Dinner gültig ist, wenn bei einem Dinner alle Eigenschaften mit gültigen Werten festgelegt wurden:</span><span class="sxs-lookup"><span data-stu-id="abe19-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="abe19-143">Sie werden oben feststellen, dass unsere Testnamen sehr explizit (und etwas ausführlich) sind.</span><span class="sxs-lookup"><span data-stu-id="abe19-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="abe19-144">Wir tun dies, weil wir am Ende Hunderte oder Tausende von kleinen Tests erstellen könnten, und wir möchten es einfach machen, die Absicht und das Verhalten jedes einzelnen von ihnen schnell zu bestimmen (besonders, wenn wir eine Liste von Fehlern in einem Testläufer durchsehen).</span><span class="sxs-lookup"><span data-stu-id="abe19-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="abe19-145">Die Testnamen sollten nach der Funktionalität benannt werden, die sie testen.</span><span class="sxs-lookup"><span data-stu-id="abe19-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="abe19-146">Oben verwenden wir ein\_"Noun Should\_Verb" Namensmuster.</span><span class="sxs-lookup"><span data-stu-id="abe19-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="abe19-147">Wir strukturieren die Tests nach dem "AAA"-Testmuster – das steht für "Arrange, Act, Assert":</span><span class="sxs-lookup"><span data-stu-id="abe19-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="abe19-148">Anordnen: Einrichten des zu testenden Geräts</span><span class="sxs-lookup"><span data-stu-id="abe19-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="abe19-149">Akt: Übung der zu prüfenden Einheit und Erfassung der Ergebnisse</span><span class="sxs-lookup"><span data-stu-id="abe19-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="abe19-150">Assert: Überprüfen des Verhaltens</span><span class="sxs-lookup"><span data-stu-id="abe19-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="abe19-151">Wenn wir Tests schreiben, wollen wir vermeiden, dass die einzelnen Tests zu viel tun.</span><span class="sxs-lookup"><span data-stu-id="abe19-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="abe19-152">Stattdessen sollte jeder Test nur ein einziges Konzept überprüfen (was es viel einfacher macht, die Ursache von Fehlern zu ermitteln).</span><span class="sxs-lookup"><span data-stu-id="abe19-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="abe19-153">Eine gute Richtlinie ist, zu versuchen, nur eine einzige Assertionsanweisung für jeden Test zu haben.</span><span class="sxs-lookup"><span data-stu-id="abe19-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="abe19-154">Wenn Sie mehr als eine Assert-Anweisung in einer Testmethode haben, stellen Sie sicher, dass sie alle zum Testen desselben Konzepts verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="abe19-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="abe19-155">Machen Sie im Zweifelsfall einen weiteren Test.</span><span class="sxs-lookup"><span data-stu-id="abe19-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="abe19-156">Tests werden ausgeführt</span><span class="sxs-lookup"><span data-stu-id="abe19-156">Running Tests</span></span>

<span data-ttu-id="abe19-157">Visual Studio 2008 Professional (und höhere Editionen) enthält einen integrierten Testrunner, der zum Ausführen von Visual Studio Unit Test-Projekten innerhalb der IDE verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="abe19-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="abe19-158">Wir können den Menübefehl **Test-&gt;Run-&gt;All Tests in Solution** (oder Strg R, A) auswählen, um alle unsere Komponententests auszuführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="abe19-159">Alternativ können wir unseren Cursor innerhalb einer bestimmten Testklasse oder Testmethode positionieren und den Menübefehl **Test-&gt;Run-&gt;Tests in Current Context** (oder Typ Strg R, T) verwenden, um eine Teilmenge der Komponententests auszuführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="abe19-160">Positionieren wir unseren Cursor innerhalb der DinnerTest-Klasse und geben Sie "Strg R, T" ein, um die beiden Tests auszuführen, die wir gerade definiert haben.</span><span class="sxs-lookup"><span data-stu-id="abe19-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="abe19-161">Wenn wir dies tun, wird in Visual Studio ein Fenster "Testergebnisse" angezeigt, in dem die Ergebnisse unseres Testlaufs aufgeführt sind:</span><span class="sxs-lookup"><span data-stu-id="abe19-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="abe19-162">*Hinweis: Im VS-Testergebnisfenster wird standardmäßig nicht die Spalte Klassenname angezeigt. Sie können dies hinzufügen, indem Sie im Fenster Testergebnisse mit der rechten Maustaste klicken und den Menübefehl Spalten hinzufügen/entfernen verwenden.*</span><span class="sxs-lookup"><span data-stu-id="abe19-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="abe19-163">Unsere beiden Tests dauerten nur einen Bruchteil einer Sekunde, um zu laufen – und wie Sie sehen können, bestanden sie beide.</span><span class="sxs-lookup"><span data-stu-id="abe19-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="abe19-164">Wir können sie nun weiter ausführen und erweitern, indem wir zusätzliche Tests erstellen, die bestimmte Regelvalidierungen überprüfen und die beiden Hilfsmethoden - IsUserHost() und IsUserRegistered() – abdecken, die wir der Dinner-Klasse hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="abe19-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="abe19-165">Mit all diesen Tests für die Dinner-Klasse wird es viel einfacher und sicherer, neue Geschäftsregeln und Validierungen hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="abe19-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="abe19-166">Wir können unsere neue Regellogik zu Dinner hinzufügen und dann innerhalb von Sekunden überprüfen, ob diese keine unserer vorherigen Logikfunktionen gebrochen hat.</span><span class="sxs-lookup"><span data-stu-id="abe19-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="abe19-167">Beachten Sie, wie die Verwendung eines beschreibenden Testnamens es einfach macht, schnell zu verstehen, was jeder Test überprüft.</span><span class="sxs-lookup"><span data-stu-id="abe19-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="abe19-168">Ich empfehle, den Menübefehl **Extras-&gt;Optionen zu** verwenden, den Konfigurationsbildschirm Testwerkzeuge -&gt;Testausführung zu öffnen und das Kontrollkästchen "Doppelklicken auf ein fehlgeschlagenes oder nicht schlüssiges Komponententestergebnis" anzuzeigen, der den Fehlerpunkt im Test anzeigt.</span><span class="sxs-lookup"><span data-stu-id="abe19-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="abe19-169">Auf diese Weise können Sie auf einen Fehler im Testergebnisfenster doppelklicken und sofort zum Assertionsfehler springen.</span><span class="sxs-lookup"><span data-stu-id="abe19-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="abe19-170">Erstellen von DinnersController-Komponententests</span><span class="sxs-lookup"><span data-stu-id="abe19-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="abe19-171">Lassen Sie uns nun einige Komponententests erstellen, die unsere DinnersController-Funktionalität überprüfen.</span><span class="sxs-lookup"><span data-stu-id="abe19-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="abe19-172">Wir beginnen mit einem Rechtsklick auf den Ordner "Controller" in unserem Testprojekt und wählen dann den Menübefehl **&gt;"Neuer Test hinzufügen".**</span><span class="sxs-lookup"><span data-stu-id="abe19-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="abe19-173">Wir erstellen einen "Einheitstest" und nennen ihn "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="abe19-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="abe19-174">Wir erstellen zwei Testmethoden, die die Aktionsmethode Details() auf dem DinnersController überprüfen.</span><span class="sxs-lookup"><span data-stu-id="abe19-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="abe19-175">Die erste überprüft, ob eine Ansicht zurückgegeben wird, wenn ein vorhandenes Abendessen angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="abe19-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="abe19-176">Die zweite überprüft, ob eine "NotFound"-Ansicht zurückgegeben wird, wenn ein nicht vorhandenes Abendessen angefordert wird:</span><span class="sxs-lookup"><span data-stu-id="abe19-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="abe19-177">Der obige Code kompiliert clean.</span><span class="sxs-lookup"><span data-stu-id="abe19-177">The above code compiles clean.</span></span> <span data-ttu-id="abe19-178">Wenn wir die Tests ausführen, schlagen beide jedoch fehl:</span><span class="sxs-lookup"><span data-stu-id="abe19-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="abe19-179">Wenn wir uns die Fehlermeldungen ansehen, werden wir feststellen, dass der Grund für den Fehler der Tests darin lag, dass unsere DinnersRepository-Klasse keine Verbindung mit einer Datenbank herstellen konnte.</span><span class="sxs-lookup"><span data-stu-id="abe19-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="abe19-180">Unsere NerdDinner-Anwendung verwendet eine Verbindungszeichenfolge zu einer lokalen SQL Server\_Express-Datei, die sich unter dem Verzeichnis "App Data" des NerdDinner-Anwendungsprojekts befindet.</span><span class="sxs-lookup"><span data-stu-id="abe19-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="abe19-181">Da unser NerdDinner.Tests-Projekt in einem anderen Verzeichnis als dem Anwendungsprojekt kompiliert und ausgeführt wird, ist der relative Pfadspeicherort unserer Verbindungszeichenfolge falsch.</span><span class="sxs-lookup"><span data-stu-id="abe19-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="abe19-182">Wir *könnten* dies beheben, indem wir die SQL Express-Datenbankdatei in unser Testprojekt kopieren und dann in der App.config unseres Testprojekts eine entsprechende Testverbindungszeichenfolge hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="abe19-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="abe19-183">Dadurch würden die oben genannten Tests aufgehoben und ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="abe19-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="abe19-184">Komponententestcodes, die eine echte Datenbank verwenden, bringen jedoch eine Reihe von Herausforderungen mit sich.</span><span class="sxs-lookup"><span data-stu-id="abe19-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="abe19-185">Dies gilt insbesondere in folgenden Fällen:</span><span class="sxs-lookup"><span data-stu-id="abe19-185">Specifically:</span></span>

- <span data-ttu-id="abe19-186">Es verlangsamt die Ausführungszeit von Komponententests erheblich.</span><span class="sxs-lookup"><span data-stu-id="abe19-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="abe19-187">Je länger es dauert, Tests auszuführen, desto geringer ist die Wahrscheinlichkeit, dass Sie sie häufig ausführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="abe19-188">Im Idealfall möchten Sie, dass Ihre Komponententests in Sekundenschnelle ausgeführt werden können – und sie so natürlich wie das Kompilieren des Projekts machen.</span><span class="sxs-lookup"><span data-stu-id="abe19-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="abe19-189">Es erschwert die Einrichtungs- und Bereinigungslogik innerhalb von Tests.</span><span class="sxs-lookup"><span data-stu-id="abe19-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="abe19-190">Sie möchten, dass jeder Komponententest isoliert und unabhängig von anderen ist (ohne Nebenwirkungen oder Abhängigkeiten).</span><span class="sxs-lookup"><span data-stu-id="abe19-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="abe19-191">Wenn Sie mit einer echten Datenbank arbeiten, müssen Sie auf den Zustand achten und ihn zwischen den Tests zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="abe19-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="abe19-192">Sehen wir uns ein Entwurfsmuster namens "Abhängigkeitsinjektion" an, das uns helfen kann, diese Probleme zu umgehen und die Notwendigkeit zu vermeiden, eine echte Datenbank mit unseren Tests zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="abe19-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="abe19-193">Dependency Injection</span><span class="sxs-lookup"><span data-stu-id="abe19-193">Dependency Injection</span></span>

<span data-ttu-id="abe19-194">Im Moment ist DinnersController eng mit der DinnerRepository-Klasse "gekoppelt".</span><span class="sxs-lookup"><span data-stu-id="abe19-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="abe19-195">"Koppeln" bezieht sich auf eine Situation, in der eine Klasse explizit auf eine andere Klasse angewiesen ist, um zu arbeiten:</span><span class="sxs-lookup"><span data-stu-id="abe19-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="abe19-196">Da die DinnerRepository-Klasse Zugriff auf eine Datenbank erfordert, erfordert die eng gekoppelte Abhängigkeit der DinnersController-Klasse vom DinnerRepository eine Datenbank, damit die DinnersController-Aktionsmethoden getestet werden können.</span><span class="sxs-lookup"><span data-stu-id="abe19-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="abe19-197">Wir können dies umgehen, indem wir ein Entwurfsmuster namens "Abhängigkeitsinjektion" verwenden – ein Ansatz, bei dem Abhängigkeiten (wie Repository-Klassen, die Datenzugriff bereitstellen) nicht mehr implizit innerhalb von Klassen erstellt werden, die sie verwenden.</span><span class="sxs-lookup"><span data-stu-id="abe19-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="abe19-198">Stattdessen können Abhängigkeiten explizit an die Klasse übergeben werden, die sie mithilfe von Konstruktorargumenten verwendet.</span><span class="sxs-lookup"><span data-stu-id="abe19-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="abe19-199">Wenn die Abhängigkeiten mithilfe von Schnittstellen definiert werden, haben wir die Flexibilität, "gefälschte" Abhängigkeitsimplementierungen für Komponententestszenarien zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="abe19-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="abe19-200">Auf diese Weise können wir testspezifische Abhängigkeitsimplementierungen erstellen, die eigentlich keinen Zugriff auf eine Datenbank erfordern.</span><span class="sxs-lookup"><span data-stu-id="abe19-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="abe19-201">Um dies in Aktion zu sehen, implementieren wir Abhängigkeitsinjektion mit unserem DinnersController.</span><span class="sxs-lookup"><span data-stu-id="abe19-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="abe19-202">Extrahieren einer IDinnerRepository-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="abe19-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="abe19-203">Unser erster Schritt wird darin bestehen, eine neue IDinnerRepository-Schnittstelle zu erstellen, die den Repository-Vertrag kapselt, den unsere Controller zum Abrufen und Aktualisieren von Dinners benötigen.</span><span class="sxs-lookup"><span data-stu-id="abe19-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="abe19-204">Wir können diesen Schnittstellenvertrag manuell definieren, indem wir mit der rechten Maustaste auf den Ordner "Modelle" klicken und dann den Menübefehl **&gt;"Neues Element hinzufügen"** auswählen und eine neue Schnittstelle mit dem Namen IDinnerRepository.cs erstellen.</span><span class="sxs-lookup"><span data-stu-id="abe19-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="abe19-205">Alternativ können wir die in Visual Studio Professional (und höheren Editionen) integrierten Umgestaltungstools verwenden, um automatisch eine Schnittstelle für uns aus unserer vorhandenen DinnerRepository-Klasse zu extrahieren und zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="abe19-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="abe19-206">Um diese Schnittstelle mit VS zu extrahieren, positionieren Sie einfach den Cursor im Texteditor in der DinnerRepository-Klasse, und klicken Sie dann mit der rechten Maustaste und wählen Sie den Menübefehl **"Refactor-&gt;Extract Interface":**</span><span class="sxs-lookup"><span data-stu-id="abe19-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="abe19-207">Dadurch wird das Dialogfeld "Schnittstelle extrahieren" gestartet und wir werden aufgefordert, den Namen der zu erstellenden Schnittstelle zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="abe19-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="abe19-208">Es wird standardmäßig auf IDinnerRepository verwendet und wählt automatisch alle öffentlichen Methoden für die vorhandene DinnerRepository-Klasse aus, die der Schnittstelle hinzugefügt werden sollen:</span><span class="sxs-lookup"><span data-stu-id="abe19-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="abe19-209">Wenn wir auf die Schaltfläche "OK" klicken, fügt Visual Studio unserer Anwendung eine neue IDinnerRepository-Schnittstelle hinzu:</span><span class="sxs-lookup"><span data-stu-id="abe19-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="abe19-210">Und unsere bestehende DinnerRepository-Klasse wird aktualisiert, sodass sie die Schnittstelle implementiert:</span><span class="sxs-lookup"><span data-stu-id="abe19-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="abe19-211">Aktualisieren von DinnersController zur Unterstützung der Konstruktorinjektion</span><span class="sxs-lookup"><span data-stu-id="abe19-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="abe19-212">Wir aktualisieren nun die DinnersController-Klasse, um die neue Schnittstelle zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="abe19-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="abe19-213">Derzeit ist DinnersController so hartcodiert, dass das Feld "dinnerRepository" immer eine DinnerRepository-Klasse ist:</span><span class="sxs-lookup"><span data-stu-id="abe19-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="abe19-214">Wir ändern es so, dass das Feld "dinnerRepository" vom Typ IDinnerRepository anstelle von DinnerRepository ist.</span><span class="sxs-lookup"><span data-stu-id="abe19-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="abe19-215">Wir fügen dann zwei öffentliche DinnersController-Konstruktoren hinzu.</span><span class="sxs-lookup"><span data-stu-id="abe19-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="abe19-216">Einer der Konstruktoren ermöglicht das Übergeben eines IDinnerRepository als Argument.</span><span class="sxs-lookup"><span data-stu-id="abe19-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="abe19-217">Der andere ist ein Standardkonstruktor, der unsere vorhandene DinnerRepository-Implementierung verwendet:</span><span class="sxs-lookup"><span data-stu-id="abe19-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="abe19-218">Da ASP.NET MVC standardmäßig Controllerklassen mit Standardkonstruktoren erstellt, verwendet unser DinnersController zur Laufzeit weiterhin die DinnerRepository-Klasse, um datenzugriff durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="abe19-219">Wir können nun jedoch unsere Komponententests aktualisieren, um eine "gefälschte" Dinner-Repository-Implementierung mit dem Parameterkonstruktor zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="abe19-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="abe19-220">Dieses "gefälschte" Dinner-Repository erfordert keinen Zugriff auf eine echte Datenbank und verwendet stattdessen In-Memory-Beispieldaten.</span><span class="sxs-lookup"><span data-stu-id="abe19-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="abe19-221">Erstellen der FakeDinnerRepository-Klasse</span><span class="sxs-lookup"><span data-stu-id="abe19-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="abe19-222">Erstellen wir eine FakeDinnerRepository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="abe19-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="abe19-223">Wir beginnen mit der Erstellung eines "Fakes"-Verzeichnisses in unserem NerdDinner.Tests-Projekt und fügen dann eine neue FakeDinnerRepository-Klasse hinzu (mit der rechten Maustaste auf den Ordner klicken und **Add-&gt;New Class**auswählen):</span><span class="sxs-lookup"><span data-stu-id="abe19-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="abe19-224">Wir aktualisieren den Code, sodass die FakeDinnerRepository-Klasse die IDinnerRepository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="abe19-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="abe19-225">Wir können dann mit der rechten Maustaste darauf klicken und den Kontextmenübefehl "Implement interface IDinnerRepository" auswählen:</span><span class="sxs-lookup"><span data-stu-id="abe19-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="abe19-226">Dies führt dazu, dass Visual Studio automatisch alle IDinnerRepository-Schnittstellenmember zu unserer FakeDinnerRepository-Klasse mit standardmäßigen "stub out"-Implementierungen hinzufügt:</span><span class="sxs-lookup"><span data-stu-id="abe19-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="abe19-227">Wir können dann die FakeDinnerRepository-Implementierung aktualisieren, um&lt;&gt; eine Speicherlisten-Dinner-Auflistung abzuarbeiten, die als Konstruktorargument an sie übergeben wurde:</span><span class="sxs-lookup"><span data-stu-id="abe19-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="abe19-228">Wir haben jetzt eine gefälschte IDinnerRepository-Implementierung, die keine Datenbank benötigt, und können stattdessen eine In-Memory-Liste von Dinner-Objekten ausarbeiten.</span><span class="sxs-lookup"><span data-stu-id="abe19-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="abe19-229">Verwenden des FakeDinnerRepository mit Komponententests</span><span class="sxs-lookup"><span data-stu-id="abe19-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="abe19-230">Kehren wir zu den DinnersController-Komponententests zurück, die zuvor fehlgeschlagen sind, da die Datenbank nicht verfügbar war.</span><span class="sxs-lookup"><span data-stu-id="abe19-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="abe19-231">Wir können die Testmethoden aktualisieren, um ein FakeDinnerRepository zu verwenden, das mit Beispiel-In-Memory-Dinner-Daten auf dem DinnersController aufgefüllt wird, indem wir den folgenden Code verwenden:</span><span class="sxs-lookup"><span data-stu-id="abe19-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="abe19-232">Und jetzt, wenn wir diese Tests ausführen, bestehen sie beide:</span><span class="sxs-lookup"><span data-stu-id="abe19-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="abe19-233">Das Beste daran ist, dass sie nur einen Bruchteil einer Sekunde benötigen, um ausgeführt zu werden, und erfordern keine komplizierte Setup-/Bereinigungslogik.</span><span class="sxs-lookup"><span data-stu-id="abe19-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="abe19-234">Wir können jetzt unseren gesamten DinnersController-Aktionsmethodencode (einschließlich Auflistung, Paging, Details, Erstellen, Aktualisieren und Löschen) testen, ohne jemals eine Verbindung zu einer echten Datenbank herstellen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="abe19-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="abe19-235">**Nebenthema: Dependency Injection Frameworks**</span><span class="sxs-lookup"><span data-stu-id="abe19-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="abe19-236">Die manuelle Abhängigkeitsinjektion (wie oben) funktioniert gut, ist jedoch schwieriger zu verwalten, wenn die Anzahl der Abhängigkeiten und Komponenten in einer Anwendung zunimmt.</span><span class="sxs-lookup"><span data-stu-id="abe19-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="abe19-237">Für .NET gibt es mehrere Abhängigkeitsinjektionsframeworks, die dazu beitragen können, noch mehr Flexibilität bei der Abhängigkeitsverwaltung zu bieten.</span><span class="sxs-lookup"><span data-stu-id="abe19-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="abe19-238">Diese Frameworks, die manchmal auch als "Inversion of Control"(IoC)-Container bezeichnet werden, bieten Mechanismen, die eine zusätzliche Ebene der Konfigurationsunterstützung für das Angeben und Übergeben von Abhängigkeiten an Objekte zur Laufzeit ermöglichen (am häufigsten mithilfe der Konstruktorinjektion).</span><span class="sxs-lookup"><span data-stu-id="abe19-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="abe19-239">Einige der beliebtesten OSS Dependency Injection / IOC Frameworks in .NET sind: AutoFac, Ninject, Spring.NET, StructureMap und Windsor.</span><span class="sxs-lookup"><span data-stu-id="abe19-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="abe19-240">ASP.NET MVC macht Erweiterbarkeits-APIs verfügbar, die es Entwicklern ermöglichen, an der Auflösung und Instanziierung von Controllern teilzunehmen, und die es ermöglicht, Dependency Injection / IoC-Frameworks sauber in diesen Prozess zu integrieren.</span><span class="sxs-lookup"><span data-stu-id="abe19-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="abe19-241">Die Verwendung eines DI/IOC-Frameworks würde es uns auch ermöglichen, den Standardkonstruktor aus unserem DinnersController zu entfernen – was die Kopplung zwischen dem DinnerRepository vollständig entfernen würde.</span><span class="sxs-lookup"><span data-stu-id="abe19-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="abe19-242">Wir werden keine Abhängigkeitsinjektion / IOC-Framework mit unserer NerdDinner-Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="abe19-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="abe19-243">Aber es ist etwas, das wir für die Zukunft in Betracht ziehen könnten, wenn die NerdDinner-Codebasis und die Funktionen wachsen würden.</span><span class="sxs-lookup"><span data-stu-id="abe19-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="abe19-244">Erstellen von Edit Action Unit-Tests</span><span class="sxs-lookup"><span data-stu-id="abe19-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="abe19-245">Lassen Sie uns nun einige Komponententests erstellen, die die Edit-Funktionalität des DinnersControllers überprüfen.</span><span class="sxs-lookup"><span data-stu-id="abe19-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="abe19-246">Wir beginnen mit dem Testen der HTTP-GET-Version unserer Edit-Aktion:</span><span class="sxs-lookup"><span data-stu-id="abe19-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="abe19-247">Wir erstellen einen Test, der überprüft, ob eine Ansicht, die von einem DinnerFormViewModel-Objekt unterstützt wird, wieder gerendert wird, wenn ein gültiges Abendessen angefordert wird:</span><span class="sxs-lookup"><span data-stu-id="abe19-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="abe19-248">Wenn wir den Test ausführen, werden wir jedoch feststellen, dass er fehlschlägt, da eine Nullverweisausnahme ausgelöst wird, wenn die Edit-Methode auf die User.Identity.Name-Eigenschaft zugreift, um die Dinner.IsHostedBy()-Prüfung durchzuführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="abe19-249">Das User-Objekt in der Controller-Basisklasse kapselt Details über den angemeldeten Benutzer und wird von ASP.NET MVC aufgefüllt, wenn es den Controller zur Laufzeit erstellt.</span><span class="sxs-lookup"><span data-stu-id="abe19-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="abe19-250">Da wir den DinnersController außerhalb einer Webserverumgebung testen, ist das User-Objekt nicht festgelegt (daher die Nullverweisausnahme).</span><span class="sxs-lookup"><span data-stu-id="abe19-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="abe19-251">Verspottung der User.Identity.Name-Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="abe19-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="abe19-252">Mocking-Frameworks erleichtern das Testen, da wir dynamisch gefälschte Versionen abhängiger Objekte erstellen können, die unsere Tests unterstützen.</span><span class="sxs-lookup"><span data-stu-id="abe19-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="abe19-253">Beispielsweise können wir in unserem Aktionstest Bearbeiten ein Mocking-Framework verwenden, um dynamisch ein User-Objekt zu erstellen, mit dem unser DinnersController einen simulierten Benutzernamen suchen kann.</span><span class="sxs-lookup"><span data-stu-id="abe19-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="abe19-254">Dadurch wird verhindert, dass beim Ausführen des Tests ein Nullverweis ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="abe19-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="abe19-255">Es gibt viele .NET-Mocking-Frameworks, die mit ASP.NET MVC verwendet [http://www.mockframeworks.com/](http://www.mockframeworks.com/)werden können (eine Liste davon finden Sie hier: ).</span><span class="sxs-lookup"><span data-stu-id="abe19-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="abe19-256">Zum Testen unserer NerdDinner-Anwendung verwenden wir ein Open-Source-Mocking-Framework namens [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq)"Moq", das kostenlos von heruntergeladen werden kann.</span><span class="sxs-lookup"><span data-stu-id="abe19-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="abe19-257">Nach dem Herunterladen fügen wir der Moq.dll-Assembly eine Referenz in unserem NerdDinner.Tests-Projekt hinzu:</span><span class="sxs-lookup"><span data-stu-id="abe19-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="abe19-258">Anschließend fügen wir unserer Testklasse eine "CreateDinnersControllerAs(username)"-Hilfsmethode hinzu, die einen Benutzernamen als Parameter verwendet und dann die User.Identity.Name-Eigenschaft in der DinnersController-Instanz "verspottet":</span><span class="sxs-lookup"><span data-stu-id="abe19-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="abe19-259">Oben verwenden wir Moq, um ein Mock-Objekt zu erstellen, das ein ControllerContext-Objekt fälscht (was ASP.NET MVC an Controller-Klassen übergibt, um Laufzeitobjekte wie Benutzer, Anforderung, Antwort und Sitzung verfügbar zu machen).</span><span class="sxs-lookup"><span data-stu-id="abe19-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="abe19-260">Wir rufen die "SetupGet"-Methode auf dem Mock auf, um anzugeben, dass die HttpContext.User.Identity.Name-Eigenschaft in ControllerContext die Benutzername-Zeichenfolge zurückgeben soll, die wir an die Hilfsmethode übergeben haben.</span><span class="sxs-lookup"><span data-stu-id="abe19-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="abe19-261">Wir können eine beliebige Anzahl von ControllerContext-Eigenschaften und -Methoden verspotten.</span><span class="sxs-lookup"><span data-stu-id="abe19-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="abe19-262">Um dies zu veranschaulichen, habe ich auch einen SetupGet()-Aufruf für die Request.IsAuthenticated-Eigenschaft hinzugefügt (die für die folgenden Tests nicht benötigt wird – aber sie hilft zu veranschaulichen, wie Sie Request-Eigenschaften verspotten können).</span><span class="sxs-lookup"><span data-stu-id="abe19-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="abe19-263">Wenn wir fertig sind, weisen wir dem DinnersController eine Instanz des ControllerContext-Mocks zu, die unsere Hilfsmethode zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="abe19-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="abe19-264">Wir können jetzt Komponententests schreiben, die diese Hilfsmethode verwenden, um Bearbeitungsszenarien zu testen, an denen verschiedene Benutzer beteiligt sind:</span><span class="sxs-lookup"><span data-stu-id="abe19-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="abe19-265">Und jetzt, wenn wir die Tests ausführen, bestehen sie:</span><span class="sxs-lookup"><span data-stu-id="abe19-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="abe19-266">Testen von UpdateModel()-Szenarien</span><span class="sxs-lookup"><span data-stu-id="abe19-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="abe19-267">Wir haben Tests erstellt, die die HTTP-GET-Version der Edit-Aktion abdecken.</span><span class="sxs-lookup"><span data-stu-id="abe19-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="abe19-268">Lassen Sie uns nun einige Tests erstellen, die die HTTP-POST-Version der Edit-Aktion überprüfen:</span><span class="sxs-lookup"><span data-stu-id="abe19-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="abe19-269">Das interessante neue Testszenario, das wir mit dieser Aktionsmethode unterstützen können, ist die Verwendung der UpdateModel()-Hilfsmethode in der Controller-Basisklasse.</span><span class="sxs-lookup"><span data-stu-id="abe19-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="abe19-270">Wir verwenden diese Hilfsmethode, um Formular-Post-Werte an unsere Dinner-Objektinstanz zu binden.</span><span class="sxs-lookup"><span data-stu-id="abe19-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="abe19-271">Im Folgenden finden Sie zwei Tests, die zeigen, wie wir formulargepostete Werte für die zu verwendende UpdateModel()-Hilfsmethode bereitstellen können.</span><span class="sxs-lookup"><span data-stu-id="abe19-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="abe19-272">Dazu erstellen und füllen wir ein FormCollection-Objekt aus, und weisen es dann der Eigenschaft "ValueProvider" auf dem Controller zu.</span><span class="sxs-lookup"><span data-stu-id="abe19-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="abe19-273">Der erste Test überprüft, ob bei einem erfolgreichen Speichern der Browser auf die Detailaktion umgeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="abe19-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="abe19-274">Der zweite Test überprüft, ob die Aktion beim Anzeigen ungültiger Eingaben die Bearbeitungsansicht erneut mit einer Fehlermeldung anzeigt.</span><span class="sxs-lookup"><span data-stu-id="abe19-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="abe19-275">Testen von Wrap-Up</span><span class="sxs-lookup"><span data-stu-id="abe19-275">Testing Wrap-Up</span></span>

<span data-ttu-id="abe19-276">Wir haben die Kernkonzepte von Komponententestcontrollerklassen behandelt.</span><span class="sxs-lookup"><span data-stu-id="abe19-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="abe19-277">Wir können diese Techniken verwenden, um ganz einfach Hunderte von einfachen Tests zu erstellen, die das Verhalten unserer Anwendung überprüfen.</span><span class="sxs-lookup"><span data-stu-id="abe19-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="abe19-278">Da unsere Controller- und Modelltests keine echte Datenbank erfordern, sind sie extrem schnell und einfach auszuführen.</span><span class="sxs-lookup"><span data-stu-id="abe19-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="abe19-279">Wir werden in der Lage sein, Hunderte von automatisierten Tests in Sekunden auszuführen und sofort Feedback zu erhalten, ob eine Änderung, die wir vorgenommen haben, etwas kaputt gemacht hat.</span><span class="sxs-lookup"><span data-stu-id="abe19-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="abe19-280">Dies wird uns das Vertrauen geben, unsere Anwendung kontinuierlich zu verbessern, umzugestalten und zu verfeinern.</span><span class="sxs-lookup"><span data-stu-id="abe19-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="abe19-281">Wir haben das Testen als letztes Thema in diesem Kapitel behandelt – aber nicht, weil Sie am Ende eines Entwicklungsprozesses testen sollten!</span><span class="sxs-lookup"><span data-stu-id="abe19-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="abe19-282">Im Gegenteil, Sie sollten automatisierte Tests so früh wie möglich in Ihrem Entwicklungsprozess schreiben.</span><span class="sxs-lookup"><span data-stu-id="abe19-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="abe19-283">Auf diese Weise erhalten Sie sofortiges Feedback, während Sie sich entwickeln, hilft Ihnen, über die Anwendungsszenarien Ihrer Anwendung nachdenklich zu denken, und leitet Sie bei der Gestaltung Ihrer Anwendung mit Blick auf saubere Schichtung und Kopplung.</span><span class="sxs-lookup"><span data-stu-id="abe19-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="abe19-284">In einem späteren Kapitel des Buches wird Test Driven Development (TDD) erläutert und erläutert, wie sie mit ASP.NET MVC verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="abe19-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="abe19-285">TDD ist eine iterative Codierungspraxis, bei der Sie zuerst die Tests schreiben, die Ihr resultierender Code erfüllt.</span><span class="sxs-lookup"><span data-stu-id="abe19-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="abe19-286">Mit TDD beginnen Sie mit jedem Feature, indem Sie einen Test erstellen, der die Funktionalität überprüft, die Sie implementieren möchten.</span><span class="sxs-lookup"><span data-stu-id="abe19-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="abe19-287">Wenn Sie den Komponententest zuerst schreiben, können Sie das Feature und seine Funktionsweise klar verstehen.</span><span class="sxs-lookup"><span data-stu-id="abe19-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="abe19-288">Erst nachdem der Test geschrieben wurde (und Sie haben überprüft, dass er fehlschlägt), implementieren Sie dann die tatsächliche Funktionalität, die der Test überprüft.</span><span class="sxs-lookup"><span data-stu-id="abe19-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="abe19-289">Da Sie bereits zeitübersam über den Anwendungsfall nachgedacht haben, wie die Funktion funktionieren soll, haben Sie ein besseres Verständnis der Anforderungen und deren optimale Implementierung.</span><span class="sxs-lookup"><span data-stu-id="abe19-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="abe19-290">Wenn Sie mit der Implementierung fertig sind, können Sie den Test erneut ausführen – und sofort Feedback erhalten, ob die Funktion korrekt funktioniert.</span><span class="sxs-lookup"><span data-stu-id="abe19-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="abe19-291">Wir behandeln TDD mehr in Kapitel 10.</span><span class="sxs-lookup"><span data-stu-id="abe19-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="abe19-292">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="abe19-292">Next Step</span></span>

<span data-ttu-id="abe19-293">Einige abschließende Wrap-Up-Kommentare.</span><span class="sxs-lookup"><span data-stu-id="abe19-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="abe19-294">[Zurück](use-ajax-to-implement-mapping-scenarios.md)
> [Weiter](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="abe19-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
