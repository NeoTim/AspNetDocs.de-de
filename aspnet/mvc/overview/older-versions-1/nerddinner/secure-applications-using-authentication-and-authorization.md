---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Sichern von Anwendungen mithilfe von Authentifizierung und Autorisierung | Microsoft-Dokumentation
author: microsoft
description: In Schritt 9 erfahren Sie, wie Sie die Authentifizierung und Autorisierung zum Schutz unserer "nerddinner"-Anwendung hinzufügen, sodass sich Benutzer registrieren und sich bei der Website anmelden müssen, um Sie zu erstellen.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78486423"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="11bfe-103">Sichern von Anwendungen mithilfe von Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="11bfe-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="11bfe-104">von [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="11bfe-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="11bfe-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="11bfe-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="11bfe-106">Dies ist Schritt 9 des kostenlosen ["nerddinner"](introducing-the-nerddinner-tutorial.md) -Lernprogramms, in dem erläutert wird, wie eine kleine, aber komplette Webanwendung mit ASP.NET MVC 1 erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="11bfe-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="11bfe-107">In Schritt 9 erfahren Sie, wie Sie die Authentifizierung und Autorisierung zum Schutz unserer "nerddinner"-Anwendung hinzufügen, damit Benutzer sich registrieren und sich bei der Website anmelden müssen, um neue Abendessen zu erstellen</span><span class="sxs-lookup"><span data-stu-id="11bfe-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="11bfe-108">Wenn Sie ASP.NET MVC 3 verwenden, empfiehlt es sich, die Tutorials " [Getting Started with MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) " oder " [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) " zu befolgen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="11bfe-109">Nerddinner Step 9: Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="11bfe-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="11bfe-110">Momentan gewährt unsere "nerddinner"-Anwendung allen Personen, die die Website besuchen, die Möglichkeit, die Details eines beliebigen Dinner zu erstellen und zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="11bfe-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="11bfe-111">Ändern wir dies, damit Benutzer sich registrieren und sich bei der Website anmelden müssen, um neue Abendessen zu erstellen, und eine Einschränkung hinzufügen, sodass nur der Benutzer, der ein Dinner als Host erstellt, ihn später bearbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="11bfe-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="11bfe-112">Um dies zu ermöglichen, verwenden wir die Authentifizierung und Autorisierung, um die Anwendung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="11bfe-113">Grundlegendes zur Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="11bfe-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="11bfe-114">Bei der *Authentifizierung* wird die Identität eines Clients, der auf eine Anwendung zugreift, identifiziert und überprüft.</span><span class="sxs-lookup"><span data-stu-id="11bfe-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="11bfe-115">Genauer ausgedrückt: Es geht darum, den Endbenutzer zu identifizieren, wenn er eine Website besucht.</span><span class="sxs-lookup"><span data-stu-id="11bfe-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="11bfe-116">ASP.NET unterstützt mehrere Möglichkeiten, Browser Benutzer zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="11bfe-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="11bfe-117">Bei Internet Webanwendungen wird der am häufigsten verwendete Authentifizierungs Ansatz als "Formular Authentifizierung" bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="11bfe-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="11bfe-118">Die Formular Authentifizierung ermöglicht es einem Entwickler, ein HTML-Anmeldeformular innerhalb der Anwendung zu erstellen und dann den Benutzernamen/das Kennwort zu überprüfen, den ein Endbenutzer an eine Datenbank oder einen anderen Kenn Wort Anmelde Informationsspeicher übermittelt.</span><span class="sxs-lookup"><span data-stu-id="11bfe-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="11bfe-119">Wenn die Kombination aus Benutzername und Kennwort richtig ist, kann der Entwickler dann ASP.net auffordern, ein verschlüsseltes HTTP-Cookie auszugeben, um den Benutzer über zukünftige Anforderungen zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="11bfe-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="11bfe-120">Wir verwenden die Formular Authentifizierung mit unserer "nerddinner"-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="11bfe-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="11bfe-121">*Autorisierung* ist der Prozess der Bestimmung, ob ein authentifizierter Benutzer über die Berechtigung zum Zugreifen auf eine bestimmte URL/Ressource verfügt, oder um eine Aktion auszuführen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="11bfe-122">Beispielsweise möchten wir innerhalb unserer nerddinner-Anwendung autorisieren, dass nur Benutzer, die angemeldet sind, auf die */Dinners/Create* -URL zugreifen und neue Dinner-Daten erstellen können.</span><span class="sxs-lookup"><span data-stu-id="11bfe-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="11bfe-123">Wir möchten auch Autorisierungs Logik hinzufügen, sodass nur der Benutzer, der ein Dinner-Hosting durchläuft, ihn bearbeiten kann – und den Bearbeitungs Zugriff für alle anderen Benutzer verweigern.</span><span class="sxs-lookup"><span data-stu-id="11bfe-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="11bfe-124">Formular Authentifizierung und AccountController</span><span class="sxs-lookup"><span data-stu-id="11bfe-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="11bfe-125">Die standardmäßige Visual Studio-Projektvorlage für ASP.NET MVC aktiviert automatisch die Formular Authentifizierung, wenn neue ASP.NET MVC-Anwendungen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="11bfe-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="11bfe-126">Außerdem wird dem Projekt automatisch eine vorgefertigte Implementierung der Konto Anmeldeseite hinzugefügt – dadurch ist es wirklich einfach, die Sicherheit innerhalb einer Site zu integrieren.</span><span class="sxs-lookup"><span data-stu-id="11bfe-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="11bfe-127">Auf der Standardseite Site. Master Master wird oben rechts auf der Website ein Link "Anmelden" angezeigt, wenn der Benutzer, der darauf zugreift, nicht authentifiziert ist:</span><span class="sxs-lookup"><span data-stu-id="11bfe-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="11bfe-128">Wenn Sie auf den Link "Anmelden" klicken, wird ein Benutzer zur */Account/Logon* -URL hinzu:</span><span class="sxs-lookup"><span data-stu-id="11bfe-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="11bfe-129">Besucher, die sich noch nicht registriert haben, können dies erreichen, indem Sie auf den Link "registrieren" klicken – der die */Account/Register* -URL erhält und Ihnen ermöglicht, Konto Details einzugeben:</span><span class="sxs-lookup"><span data-stu-id="11bfe-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="11bfe-130">Wenn Sie auf die Schaltfläche "registrieren" klicken, wird ein neuer Benutzer innerhalb des ASP.net-Mitgliedschafts Systems erstellt, und der Benutzer wird mithilfe der Formular Authentifizierung auf der Website authentifiziert.</span><span class="sxs-lookup"><span data-stu-id="11bfe-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="11bfe-131">Wenn ein Benutzer angemeldet ist, ändert die Website. Master die obere rechte Seite der Seite, um eine "Willkommen [username]!" auszugeben.</span><span class="sxs-lookup"><span data-stu-id="11bfe-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="11bfe-132">und rendert den Link "Abmelden" anstelle eines "Anmelden".</span><span class="sxs-lookup"><span data-stu-id="11bfe-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="11bfe-133">Wenn Sie auf den Link "Abmelden" klicken, wird der Benutzer protokolliert:</span><span class="sxs-lookup"><span data-stu-id="11bfe-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="11bfe-134">Die oben genannten Anmelde-, Abmelde-und Registrierungsfunktionen werden innerhalb der AccountController-Klasse implementiert, die von Visual Studio beim Erstellen des Projekts dem Projekt hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="11bfe-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="11bfe-135">Die Benutzeroberfläche für AccountController wird mithilfe von Ansichts Vorlagen im Verzeichnis "\views\account" implementiert:</span><span class="sxs-lookup"><span data-stu-id="11bfe-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="11bfe-136">Die AccountController-Klasse verwendet das ASP.NET-Formular Authentifizierungssystem, um verschlüsselte Authentifizierungs Cookies auszugeben, und die ASP.net-Mitgliedschafts-API zum Speichern und Überprüfen von Benutzernamen und Kenn Wörtern.</span><span class="sxs-lookup"><span data-stu-id="11bfe-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="11bfe-137">Die ASP.net-Mitgliedschafts-API ist erweiterbar und ermöglicht die Verwendung beliebiger Anmelde Informationsspeicher für Kenn Wörter.</span><span class="sxs-lookup"><span data-stu-id="11bfe-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="11bfe-138">ASP.net wird mit integrierten Mitgliedschafts Anbieter Implementierungen ausgeliefert, die Benutzername/Kennwort in einer SQL-Datenbank oder innerhalb Active Directory speichern.</span><span class="sxs-lookup"><span data-stu-id="11bfe-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="11bfe-139">Wir können den Mitgliedschafts Anbieter konfigurieren, den unsere nerddinner-Anwendung verwenden soll, indem wir die Datei "Web. config" im Stammverzeichnis des Projekts öffnen und den Abschnitt &lt;Mitgliedschaft&gt; darin suchen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="11bfe-140">Die standardmäßige Web. config-Datei, die beim Erstellen des Projekts hinzugefügt wurde, registriert den SQL-Mitgliedschafts Anbieter und konfiguriert sie so, dass eine Verbindungs Zeichenfolge mit dem Namen "ApplicationServices" zum Angeben des Daten Bank Speicher Orts</span><span class="sxs-lookup"><span data-stu-id="11bfe-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="11bfe-141">Die Standard Verbindungs Zeichenfolge "ApplicationServices" (die im Abschnitt "&lt;connectionStrings&gt; der Datei" Web. config "angegeben ist) ist für die Verwendung von SQL Express konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="11bfe-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="11bfe-142">Er verweist auf eine SQL Express-Datenbank mit dem Namen "aspnetdb". MDF "unter dem Verzeichnis" App\_Data "der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="11bfe-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="11bfe-143">Wenn diese Datenbank nicht vorhanden ist, wenn die Mitgliedschafts-API zum ersten Mal innerhalb der Anwendung verwendet wird, erstellt ASP.NET automatisch die Datenbank und stellt das entsprechende Mitgliedschafts Datenbankschema darin bereit:</span><span class="sxs-lookup"><span data-stu-id="11bfe-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="11bfe-144">Wenn Sie anstelle von SQL Express eine vollständige SQL Server Instanz verwenden möchten (oder eine Verbindung mit einer Remote Datenbank herstellen), müssen Sie lediglich die Verbindungs Zeichenfolge "ApplicationServices" in der Datei "Web. config" aktualisieren und sicherstellen, dass das entsprechende Mitgliedschafts Schema wurde der Datenbank hinzugefügt, auf die Sie verweist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="11bfe-145">Sie können das Hilfsprogramm "ASPNET\_RegSql. exe" im Verzeichnis \WINDOWS\Microsoft.NET\Framework\v2.0.50727\ ausführen, um das entsprechende Schema für die Mitgliedschaft und die anderen ASP.NET-Anwendungsdienste zu einer Datenbank hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="11bfe-146">Autorisieren der/Dinners/Create-URL mithilfe des [autorisieren]-Filters</span><span class="sxs-lookup"><span data-stu-id="11bfe-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="11bfe-147">Wir mussten keinen Code schreiben, um eine sichere Implementierung der Authentifizierung und Kontoverwaltung für die "nerddinner"-Anwendung zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="11bfe-148">Benutzer können neue Konten bei unserer Anwendung registrieren und sich bei der Website anmelden/abmelden.</span><span class="sxs-lookup"><span data-stu-id="11bfe-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="11bfe-149">Nun können wir der Anwendung Autorisierungs Logik hinzufügen und den Authentifizierungs Status und den Benutzernamen der Besucher verwenden, um zu steuern, was Sie innerhalb der Site tun dürfen und was nicht.</span><span class="sxs-lookup"><span data-stu-id="11bfe-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="11bfe-150">Fügen Sie zunächst der "Create"-Aktionsmethode der Klasse "dinnerscontroller" eine Autorisierungs Logik hinzu.</span><span class="sxs-lookup"><span data-stu-id="11bfe-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="11bfe-151">Insbesondere ist es erforderlich, dass Benutzer, die auf die */Dinners/Create* -URL zugreifen, angemeldet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="11bfe-152">Wenn Sie nicht angemeldet sind, werden Sie zur Anmeldeseite umgeleitet, damit Sie sich anmelden können.</span><span class="sxs-lookup"><span data-stu-id="11bfe-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="11bfe-153">Das Implementieren dieser Logik ist ziemlich einfach.</span><span class="sxs-lookup"><span data-stu-id="11bfe-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="11bfe-154">Wir müssen lediglich ein [autorisieren]-Filter Attribut zu den Create Action-Methoden wie folgt hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="11bfe-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="11bfe-155">ASP.NET MVC unterstützt die Möglichkeit, "Aktionsfilter" zu erstellen, die verwendet werden können, um wiederverwendbare Logik zu implementieren, die deklarativ auf Aktionsmethoden angewendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="11bfe-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="11bfe-156">Der [Authorization]-Filter ist einer der integrierten Aktionsfilter, die von ASP.NET MVC bereitgestellt werden, und ermöglicht es einem Entwickler, deklarativ Autorisierungs Regeln auf Aktionsmethoden und Controller Klassen anzuwenden.</span><span class="sxs-lookup"><span data-stu-id="11bfe-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="11bfe-157">Beim Anwenden ohne Parameter (wie oben) erzwingt der Filter [autorisieren], dass der Benutzer, der die Anforderung der Aktionsmethode vornimmt, in – protokolliert werden muss, und der Browser wird automatisch an die Anmelde-URL umgeleitet, wenn dies nicht der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="11bfe-158">Bei dieser Umleitung wird die ursprünglich angeforderte URL als QueryString-Argument weitergegeben (z. b.:/Account/LOGON? Rückgab =% 2madinner% 2F Create).</span><span class="sxs-lookup"><span data-stu-id="11bfe-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="11bfe-159">Der AccountController leitet den Benutzer dann nach der Anmeldung an die ursprünglich angeforderte URL zurück.</span><span class="sxs-lookup"><span data-stu-id="11bfe-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="11bfe-160">Der [autorisieren]-Filter unterstützt optional die Möglichkeit, eine Eigenschaft "Benutzer" oder "Rollen" anzugeben, die verwendet werden kann, um anzugeben, dass der Benutzer sowohl in als auch in einer Liste zulässiger Benutzer oder Mitglied einer zulässigen Sicherheitsrolle angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="11bfe-161">Der folgende Code ermöglicht beispielsweise nur zwei bestimmten Benutzern, "scottgu" und "billg", den Zugriff auf die/Dinners/Create-URL:</span><span class="sxs-lookup"><span data-stu-id="11bfe-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="11bfe-162">Das Einbetten bestimmter Benutzernamen in Code ist in der Regel nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="11bfe-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="11bfe-163">Ein besserer Ansatz besteht darin, Rollen höherer Ebene zu definieren, die vom Code überprüft werden, und dann die Benutzer der Rolle entweder mithilfe einer Datenbank oder eines Active Directory-Systems zuzuordnen (sodass die tatsächliche Benutzer Zuordnungs Liste Extern aus dem Code gespeichert werden kann).</span><span class="sxs-lookup"><span data-stu-id="11bfe-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="11bfe-164">ASP.NET enthält eine integrierte Rollen Verwaltungs-API sowie eine integrierte Gruppe von Rollen Anbietern (einschließlich derjenigen für SQL und Active Directory), die bei der Durchführung dieser Benutzer-/Rollenzuordnung helfen können.</span><span class="sxs-lookup"><span data-stu-id="11bfe-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="11bfe-165">Anschließend können wir den Code aktualisieren, sodass nur Benutzer innerhalb einer bestimmten Administrator Rolle auf die/Dinners/Create-URL zugreifen können:</span><span class="sxs-lookup"><span data-stu-id="11bfe-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="11bfe-166">Verwenden der User.Identity.Name-Eigenschaft beim Erstellen von Abendessen</span><span class="sxs-lookup"><span data-stu-id="11bfe-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="11bfe-167">Wir können den Benutzernamen des aktuell angemeldeten Benutzers einer Anforderung mithilfe der User.Identity.Name-Eigenschaft abrufen, die für die Controller-Basisklasse verfügbar gemacht wird.</span><span class="sxs-lookup"><span data-stu-id="11bfe-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="11bfe-168">Früher, als wir die HTTP-Post-Version unserer Create ()-Aktionsmethode implementiert haben, hatten wir die Eigenschaft "hostedby" des Dinner in eine statische Zeichenfolge hart codiert.</span><span class="sxs-lookup"><span data-stu-id="11bfe-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="11bfe-169">Wir können nun diesen Code aktualisieren, um stattdessen die User.Identity.Name-Eigenschaft zu verwenden, und automatisch eine RSVP für den Host hinzufügen, der das Dinner erstellt:</span><span class="sxs-lookup"><span data-stu-id="11bfe-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="11bfe-170">Da wir der Create ()-Methode ein [autorisiert]-Attribut hinzugefügt haben, stellt ASP.NET MVC sicher, dass die Aktionsmethode nur ausgeführt wird, wenn der Benutzer, der die/Dinners/Create-URL besucht, auf der Website angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="11bfe-171">Daher enthält der User.Identity.Name-Eigenschafts Wert immer einen gültigen Benutzernamen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="11bfe-172">Verwenden der User.Identity.Name-Eigenschaft beim Bearbeiten von Abendessen</span><span class="sxs-lookup"><span data-stu-id="11bfe-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="11bfe-173">Nun fügen wir eine Autorisierungs Logik hinzu, mit der Benutzer eingeschränkt werden, sodass Sie nur die Eigenschaften von Abendessen bearbeiten können, die Sie selbst Hosting.</span><span class="sxs-lookup"><span data-stu-id="11bfe-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="11bfe-174">Um dies zu unterstützen, fügen wir dem Dinner-Objekt (innerhalb der Dinner.cs partiellen Klasse, die wir zuvor erstellt haben) zuerst eine "ishostedby (username)"-Hilfsmethode hinzu.</span><span class="sxs-lookup"><span data-stu-id="11bfe-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="11bfe-175">Diese Hilfsmethode gibt true oder false zurück, abhängig davon, ob ein angegebener Benutzername mit der Dinner-by-Eigenschaft übereinstimmt, und kapselt die erforderliche Logik, um einen Zeichen folgen Vergleich mit Berücksichtigung der Groß-/Kleinschreibung zu</span><span class="sxs-lookup"><span data-stu-id="11bfe-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="11bfe-176">Anschließend fügen wir den Edit ()-Aktionsmethoden in unserer dinnerscontroller-Klasse ein Attribut [autorisieren] hinzu.</span><span class="sxs-lookup"><span data-stu-id="11bfe-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="11bfe-177">Dadurch wird sichergestellt, dass Benutzer angemeldet sein müssen, um eine */Dinners/Edit/[ID]* -URL anzufordern.</span><span class="sxs-lookup"><span data-stu-id="11bfe-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="11bfe-178">Wir können dann den Bearbeitungsmethoden Code hinzufügen, der mithilfe der hilfsprogrammmethode Dinner. ishostedby (username) überprüft, ob der angemeldete Benutzer mit dem Dinner Host übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="11bfe-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="11bfe-179">Wenn der Benutzer nicht der Host ist, wird eine "invalidowner"-Ansicht angezeigt, und die Anforderung wird beendet.</span><span class="sxs-lookup"><span data-stu-id="11bfe-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="11bfe-180">Der Code hierfür sieht wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="11bfe-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="11bfe-181">Klicken Sie mit der rechten Maustaste auf das Verzeichnis "\views\dinner", und wählen Sie den Menübefehl Add-&gt;View, um eine neue "invalidowner"-Ansicht zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="11bfe-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="11bfe-182">Wir füllen ihn mit der folgenden Fehlermeldung auf:</span><span class="sxs-lookup"><span data-stu-id="11bfe-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="11bfe-183">Wenn ein Benutzer nun versucht, ein Dinner zu bearbeiten, das er nicht besitzt, erhalten Sie eine Fehlermeldung:</span><span class="sxs-lookup"><span data-stu-id="11bfe-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="11bfe-184">Wir können die gleichen Schritte für die Delete ()-Aktionsmethoden im Controller wiederholen, um die Berechtigung zum Löschen von Abendessen zu sperren, und sicherzustellen, dass nur der Host eines Dinner Sie löschen kann.</span><span class="sxs-lookup"><span data-stu-id="11bfe-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="11bfe-185">Ein-/Ausblenden von Links zum Bearbeiten und löschen</span><span class="sxs-lookup"><span data-stu-id="11bfe-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="11bfe-186">Wir verknüpfen mit der Edit and Delete-Aktionsmethode unserer dinnerscontroller-Klasse aus unserer Details-URL:</span><span class="sxs-lookup"><span data-stu-id="11bfe-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="11bfe-187">Zurzeit zeigen wir die Links zum Bearbeiten und Löschen von Aktionen an, unabhängig davon, ob der Besucher der Detail-URL der Host des Dinner ist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="11bfe-188">Ändern wir dies so, dass die Verknüpfungen nur angezeigt werden, wenn der besuchte Benutzer der Besitzer des Dinner ist.</span><span class="sxs-lookup"><span data-stu-id="11bfe-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="11bfe-189">Die "Details ()"-Aktionsmethode in unserem "dinnerscontroller" Ruft ein Dinner-Objekt ab und übergibt es dann als Modell Objekt an unsere Ansichts Vorlage:</span><span class="sxs-lookup"><span data-stu-id="11bfe-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="11bfe-190">Wir können unsere Ansichts Vorlage aktualisieren, um die Bearbeitungs-und Lösch Links bedingt anzuzeigen/auszublenden, indem wir die Dinner. ishostedby ()-Hilfsmethode wie im folgenden Beispiel verwenden:</span><span class="sxs-lookup"><span data-stu-id="11bfe-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="11bfe-191">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="11bfe-191">Next Steps</span></span>

<span data-ttu-id="11bfe-192">Sehen wir uns nun an, wie wir authentifizierten Benutzern die RSVP für Dinner mit AJAX ermöglichen können.</span><span class="sxs-lookup"><span data-stu-id="11bfe-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="11bfe-193">[Zurück](implement-efficient-data-paging.md)
> [Weiter](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="11bfe-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
