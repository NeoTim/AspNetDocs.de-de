---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Sichern von Anwendungen mithilfe von Authentifizierung und Autorisierung | Microsoft-Dokumentation
author: microsoft
description: Schritt 9 zeigt, wie Authentifizierung und Autorisierung für die NerdDinner-Anwendung schützen hinzufügen, sodass die Benutzer zum Registrieren müssen und melden Sie sich an den Standort erstellen...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/06/2019
ms.locfileid: "65122225"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="af6b2-103">Sichern von Anwendungen mithilfe von Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="af6b2-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="af6b2-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="af6b2-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="af6b2-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="af6b2-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="af6b2-106">Dies ist Schritt 9, der ein kostenloses ["NerdDinner"-webanwendungstutorial](introducing-the-nerddinner-tutorial.md) , die führt – Exemplarische Vorgehensweise erstellen eine kleine, jedoch abgeschlossen haben, Web-Anwendung mithilfe von ASP.NET MVC-1.</span><span class="sxs-lookup"><span data-stu-id="af6b2-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="af6b2-107">Schritt 9 zeigt, wie Authentifizierung und Autorisierung für die NerdDinner-Anwendung schützen hinzufügen, sodass die Benutzer zum Registrieren müssen und Anmeldung auf der Website zum Erstellen von neuen Dinner und nur der Benutzer, die eine Dinner hostet können sie später bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="af6b2-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="af6b2-108">Wenn Sie ASP.NET MVC 3 verwenden, sollten Sie Sie folgen den [erste Schritte mit MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oder [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) Tutorials.</span><span class="sxs-lookup"><span data-stu-id="af6b2-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="af6b2-109">NerdDinner Schritt 9: Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="af6b2-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="af6b2-110">Jetzt Website unsere Anwendung, die jeder Benutzer gewährt NerdDinner für den die Möglichkeit zum Erstellen und bearbeiten die Details jeder Dinner.</span><span class="sxs-lookup"><span data-stu-id="af6b2-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="af6b2-111">Wir ändern das also, dass Benutzer registrieren müssen und melden Sie sich an den Standort zum Erstellen von neuen Dinner und fügen Sie eine Einschränkung hinzu, sodass nur der Benutzer, die eine Dinner zu hosten, ist er später bearbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="af6b2-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="af6b2-112">Um dies zu ermöglichen verwenden Authentifizierung und Autorisierung wir um zu unserer Anwendung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="af6b2-113">Grundlegendes zur Authentifizierung und Autorisierung</span><span class="sxs-lookup"><span data-stu-id="af6b2-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="af6b2-114">*Authentifizierung* ist der Prozess zur Identifizierung und Überprüfung der Identität eines Clients, die auf eine Anwendung zugreifen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="af6b2-115">Einfacher ausgedrückt ist es zum Identifizieren von "Wer der Endbenutzer wird, wenn sie eine Website besuchen".</span><span class="sxs-lookup"><span data-stu-id="af6b2-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="af6b2-116">ASP.NET unterstützt mehrere Möglichkeiten, Browserbenutzer zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="af6b2-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="af6b2-117">Internet-Webanwendungen wird der am häufigsten verwendeten authentifizierungsansatz verwendet "Formularauthentifizierung" bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="af6b2-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="af6b2-118">Formular-Authentifizierung kann es sich um ein Entwickler zum Erstellen einer HTML-Anmeldeformular innerhalb ihrer Anwendung und überprüfen Sie anschließend das Benutzername/Kennwort, die, das ein Endbenutzer auf eine Datenbank oder andere Anmeldeinformationen Kennwortspeicher übermittelt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="af6b2-119">Wenn die Kombination von Benutzername und Kennwort richtig ist, kann der Entwickler anschließend ASP.NET ein verschlüsselte HTTP-Cookie zur Identifizierung des Benutzers für zukünftige Anforderungen ausgeben gefragt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="af6b2-120">Wir senden, durch die Verwendung der Formularauthentifizierung mit unserer NerdDinner-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="af6b2-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="af6b2-121">*Autorisierung* ist der Prozess des bestimmens, ob ein authentifizierter Benutzer berechtigt ist auf eine bestimmte URL-Ressource zuzugreifen oder eine Aktion auszuführen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="af6b2-122">Beispielsweise sollten wir in unserer NerdDinner-Anwendung zu autorisieren, dass nur Benutzer, die angemeldet sind, zugreifen können die */Dinners/erstellen* URL, und erstellen Sie neue Dinner.</span><span class="sxs-lookup"><span data-stu-id="af6b2-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="af6b2-123">Wir möchten auch Autorisierungslogik hinzufügen, damit nur der Benutzer, die eine Dinner gehostet wird – bearbeiten und Zugriff auf alle anderen Benutzer verweigern kann.</span><span class="sxs-lookup"><span data-stu-id="af6b2-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="af6b2-124">Formularauthentifizierung und AccountController-Komponente</span><span class="sxs-lookup"><span data-stu-id="af6b2-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="af6b2-125">Die standardmäßige Visual Studio-Projektvorlage für ASP.NET MVC ermöglicht die Formularauthentifizierung automatisch, wenn neue ASP.NET MVC-Anwendungen erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="af6b2-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="af6b2-126">Er auch automatisch eine vorab erstellte Konto Login-Seite-Implementierung dem Projekt hinzugefügt – Dadurch wird es wirklich einfach, Integration der Sicherheit innerhalb eines Standorts.</span><span class="sxs-lookup"><span data-stu-id="af6b2-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="af6b2-127">Die standardmäßige Stammwebsite zeigt einen Link "Anmelden" in der oberen rechten des Standorts, wenn der Benutzer darauf zugreifen, nicht authentifiziert ist:</span><span class="sxs-lookup"><span data-stu-id="af6b2-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="af6b2-128">Den Link "Anmelden" gelangen Benutzer die */Account/LogOn* URL:</span><span class="sxs-lookup"><span data-stu-id="af6b2-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="af6b2-129">Besucher, die nicht registriert haben dazu werden Sie auf den Link "Register" – in die sie gelangen die */Account/Register* URL und zur Eingabe der Details zu ermöglichen:</span><span class="sxs-lookup"><span data-stu-id="af6b2-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="af6b2-130">Klicken Sie auf die Schaltfläche "Registrieren" wird einen neuen Benutzer in das Mitgliedschaftssystem von ASP.NET erstellen, und authentifiziert den Benutzer auf der Website unter Verwendung der Formularauthentifizierung.</span><span class="sxs-lookup"><span data-stu-id="af6b2-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="af6b2-131">Wenn ein Benutzer angemeldet ist, ändert sich Site.master rechts oben auf der Seite, um eine "Willkommen [Username]!" auszugeben.</span><span class="sxs-lookup"><span data-stu-id="af6b2-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="af6b2-132">anstelle einer "Anmelden" einen verknüpfen Nachricht und rendert eine "Abmelden".</span><span class="sxs-lookup"><span data-stu-id="af6b2-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="af6b2-133">Klicken Sie auf den Link "Abmelden" meldet den Benutzer:</span><span class="sxs-lookup"><span data-stu-id="af6b2-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="af6b2-134">Die obige Funktionalität für Anmeldung, Abmeldung und Registrierung wird innerhalb der AccountController-Klasse implementiert, die von Visual Studio bei der Erstellung des Projekts zu Ihrem Projekt hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="af6b2-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="af6b2-135">Die Benutzeroberfläche für AccountController-Komponente wird mithilfe von Vorlagen anzeigen, innerhalb des Verzeichnisses \Views\Account implementiert:</span><span class="sxs-lookup"><span data-stu-id="af6b2-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="af6b2-136">Die AccountController-Klasse verwendet die ASP.NET-Formularauthentifizierung-System zum Ausstellen von verschlüsselten Authentifizierungscookies und ASP.NET Membership-API zum Speichern und überprüfen Benutzernamen und Kennwörtern.</span><span class="sxs-lookup"><span data-stu-id="af6b2-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="af6b2-137">ASP.NET Membership-API ist erweiterbar und können Anmeldeinformationen Kennwortspeicher verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="af6b2-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="af6b2-138">Im Lieferumfang von ASP.NET sind integrierte Mitgliedschaft providerimplementierungen, in denen ein Benutzername und Kennwort in einer SQL-Datenbank oder in Active Directory gespeichert.</span><span class="sxs-lookup"><span data-stu-id="af6b2-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="af6b2-139">Wir können festlegen, sollten die NerdDinner-Anwendung durch Öffnen der Datei "web.config" im Stammverzeichnis des Projekts, und Suchen nach verwenden, der Membership-Provider die &lt;Mitgliedschaft&gt; Abschnitt darin.</span><span class="sxs-lookup"><span data-stu-id="af6b2-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="af6b2-140">Die standardmäßige Datei "Web.config" hinzugefügt, wenn das Projekt erstellt wurde die SQL-Mitgliedschaftsanbieters registriert und konfiguriert, um eine Verbindungszeichenfolge, mit dem Namen "ApplicationServices" zu verwenden, geben Sie den Speicherort der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="af6b2-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="af6b2-141">Die Standardverbindungszeichenfolge für die "ApplicationServices" (die wird angegeben, in der &lt;ConnectionStrings&gt; -Abschnitt der Datei "Web.config") ist zur Verwendung von SQL Express konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="af6b2-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="af6b2-142">Es verweist auf eine SQL Express-Datenbank, die mit dem Namen "ASPNETDB. MDF-Datei"unter der Anwendung" App\_Daten "Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="af6b2-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="af6b2-143">Wenn diese Datenbank beim ersten nicht vorhanden ist, die der Membership-API in der Anwendung verwendet wird, ASP.NET automatisch die Datenbank erstellen und Bereitstellen der entsprechenden mitgliedschaftsdatenbankschema, das in diesem:</span><span class="sxs-lookup"><span data-stu-id="af6b2-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="af6b2-144">Wenn anstelle von SQL Express, wir verwenden einer vollständigen SQL Server-Instanz (oder eine Verbindung mit einer Remotedatenbank herstellen) möchten, alle Aufgaben brauchen wir da ist die "ApplicationServices" Verbindungszeichenfolge in der Datei "Web.config" aktualisieren, und stellen Sie sicher, dass das Schema für die entsprechende Mitgliedschaft wurde in der Datenbank hinzugefügt, die es auf zeigt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="af6b2-145">Können Sie ausführen, die "Aspnet\_regsql.exe" Hilfsprogramm im Verzeichnis \Windows\Microsoft.NET\Framework\v2.0.50727\ des entsprechenden Schemas für Mitgliedschaft und die andere ASP.NET-Anwendungsdienste in einer Datenbank hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="af6b2-146">Autorisieren die Dinner/Create-URL mithilfe des Filters [Authorize]</span><span class="sxs-lookup"><span data-stu-id="af6b2-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="af6b2-147">Wir mussten Schreiben beliebigen Code, um eine sichere Authentifizierung und die Implementierung der Konto-Verwaltung für die NerdDinner-Anwendung zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="af6b2-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="af6b2-148">Benutzer können neue Konten mit unserer Anwendung, und klicken Sie auf Anmeldung/Abmeldung von der Website registrieren.</span><span class="sxs-lookup"><span data-stu-id="af6b2-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="af6b2-149">Jetzt können wir Autorisierungslogik zur Anwendung hinzufügen, und verwenden die Authentication-Status und den Benutzernamen der Besucher um zu steuern, welche Inhalte sie innerhalb des Standorts nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="af6b2-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="af6b2-150">Beginnen wir mit der Aktionsmethoden "Erstellen" unserer Klasse "dinnerscontroller" Autorisierungslogik hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="af6b2-151">Insbesondere werden wir benötigen, die Benutzern beim Zugriff auf die */Dinners/erstellen* URL muss angemeldet sein.</span><span class="sxs-lookup"><span data-stu-id="af6b2-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="af6b2-152">Wenn sie angemeldet sind nicht werden wir sie zur Anmeldeseite umleiten, damit sie sich anmelden können.</span><span class="sxs-lookup"><span data-stu-id="af6b2-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="af6b2-153">Implementieren diese Logik ist ziemlich einfach.</span><span class="sxs-lookup"><span data-stu-id="af6b2-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="af6b2-154">Alles, was wir benötigen die to-do ist unsere Aktionsmethoden erstellen ein Filterattribut [Authorize] hinzu wie folgt:</span><span class="sxs-lookup"><span data-stu-id="af6b2-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="af6b2-155">ASP.NET MVC unterstützt die Fähigkeit zum Erstellen von "Aktionsfilter", die verwendet werden können, um wiederverwendbare Logik zu implementieren, die deklarativ auf Aktionsmethoden angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="af6b2-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="af6b2-156">Der [Authorize]-Filter ist einer der von ASP.NET MVC bereitgestellte Filter integrierte Aktion aus, und er ermöglicht dem Entwickler, die deklarativ gelten die Autorisierungsregeln auf Aktionsmethoden und Controllerklassen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="af6b2-157">Bei ohne Parameter (wie weiter oben) erzwingt der Filter [Authorize] an, dass der Benutzer, der Anforderung der Aktionsmethode angemeldet sein muss – und es automatisch der Browser zur Anmelde-URL umgeleitet wird, wenn sie nicht sind.</span><span class="sxs-lookup"><span data-stu-id="af6b2-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="af6b2-158">Beim Ausführen dieser Umleitung, die ursprünglich angeforderte URL als Querystring-Argument übergeben wird (z. B.: / Account/LogOn? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="af6b2-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="af6b2-159">AccountController-Komponente leitet dann den Benutzer zurück zur ursprünglich angeforderten URL, nach der Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="af6b2-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="af6b2-160">Der Filter [Authorize] unterstützt optional die Möglichkeit, eine Eigenschaft "Benutzer" oder "Roles" angeben, die verwendet werden kann, um festzulegen, dass der Benutzer mit sowohl in und in einer Liste von zulässigen Benutzern oder ein Mitglied einer Sicherheitsrolle für die zulässigen angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="af6b2-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="af6b2-161">Der folgende Code ermöglicht beispielsweise nur zwei bestimmte Benutzer, "Scottgu" und "Billg," Zugriff auf die Dinner/Create-URL:</span><span class="sxs-lookup"><span data-stu-id="af6b2-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="af6b2-162">Einbetten von bestimmten Benutzernamen in Code ist jedoch ziemlich nicht verwaltbar sein.</span><span class="sxs-lookup"><span data-stu-id="af6b2-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="af6b2-163">Ein besserer Ansatz ist, um auf höherer Ebene "Roles" zu definieren, die der Code überprüft, und klicken Sie dann zum Zuordnen von Benutzern in der Rolle, die mit einer Datenbank oder active Directory-System (ermöglicht die tatsächliche Zuordnung Benutzerliste aus dem Code extern gespeichert werden).</span><span class="sxs-lookup"><span data-stu-id="af6b2-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="af6b2-164">ASP.NET umfasst eine integrierte Rolle-Verwaltungs-API als auch einen integrierten Satz von Rollenanbietern (einschließlich für SQL und Active Directory), mit die diese Benutzerrolle/Zuordnung vornehmen können.</span><span class="sxs-lookup"><span data-stu-id="af6b2-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="af6b2-165">Wir könnten klicken Sie dann den Code damit, dass nur Benutzer innerhalb einer bestimmten "Admin" Rolle Zugriff auf die Dinner/Create-URL aktualisieren:</span><span class="sxs-lookup"><span data-stu-id="af6b2-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="af6b2-166">Verwenden die Eigenschaft User.Identity.Name beim Erstellen von Dinner</span><span class="sxs-lookup"><span data-stu-id="af6b2-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="af6b2-167">Wir können den Benutzernamen des aktuell angemeldeten Benutzers der eine Anforderung mithilfe der User.Identity.Name-Eigenschaft, die für die Basisklasse für Controller verfügbar gemacht werden, abrufen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="af6b2-168">Weiter oben, wenn wir die HTTP-POST-Version unserer Create() Aktionsmethode implementiert werden musste hartcodiert die Eigenschaft "HostedBy" das Dinner in eine statische Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="af6b2-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="af6b2-169">Wir können jetzt aktualisieren dieser Code stattdessen die User.Identity.Name-Eigenschaft verwendet, als auch automatisch eine Antwort für den Host mit dem Erstellen des Dinner hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="af6b2-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="af6b2-170">Da wir ein [Authorize]-Attribut für die Create()-Methode hinzugefügt haben, wird Sie ASP.NET MVC sichergestellt, dass die Aktionsmethode nur ausgeführt, wenn der Benutzer Zugriff auf die Dinner/Create-URL auf der Website angemeldet ist.</span><span class="sxs-lookup"><span data-stu-id="af6b2-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="af6b2-171">Daher wird der Eigenschaftswert User.Identity.Name immer einen gültigen Benutzernamen enthalten.</span><span class="sxs-lookup"><span data-stu-id="af6b2-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="af6b2-172">Verwenden die User.Identity.Name-Eigenschaft beim Bearbeiten von Dinner</span><span class="sxs-lookup"><span data-stu-id="af6b2-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="af6b2-173">Nun fügen Sie einige Autorisierungslogik, die Benutzer beschränkt, sodass sie nur die Eigenschaften des Dinner bearbeiten können, die sie selbst gehostet werden.</span><span class="sxs-lookup"><span data-stu-id="af6b2-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="af6b2-174">Um dies zu vereinfachen, zunächst fügen wir eine Hilfsmethode "IsHostedBy(username)" auf unserer Dinner-Objekt (innerhalb der partiellen Dinner.cs-Klasse, die wir zuvor erstellt).</span><span class="sxs-lookup"><span data-stu-id="af6b2-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="af6b2-175">Diese Hilfsmethode gibt True oder False, je nachdem, ob ein angegebenen Benutzernamen entspricht die Dinner-HostedBy-Eigenschaft und kapselt die Logik erforderlich, um einen Zeichenfolgenvergleich davon auszuführen:</span><span class="sxs-lookup"><span data-stu-id="af6b2-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="af6b2-176">Wir werden die Edit() Aktionsmethoden in unsere Klasse "dinnerscontroller" klicken Sie dann eine [Authorize]-Attribut hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="af6b2-177">Dadurch wird sichergestellt, dass Benutzer auf Anforderung angemeldet sein müssen, eine *"/ dinners" / Edit / [Id]* URL.</span><span class="sxs-lookup"><span data-stu-id="af6b2-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="af6b2-178">Wir können Sie Code hinzufügen, um unsere Edit-Methoden, die die Dinner.IsHostedBy(username)-Hilfsmethode verwendet, um sicherzustellen, dass die Dinner-Host mit der angemeldeten Benutzer übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="af6b2-179">Wenn der Benutzer nicht der Host ist, wir zeigt ein "InvalidOwner" an und beendet die Anforderung.</span><span class="sxs-lookup"><span data-stu-id="af6b2-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="af6b2-180">Der Code hierfür sieht wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="af6b2-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="af6b2-181">Wir können dann mit der rechten Maustaste auf das Verzeichnis \Views\Dinners und wählen Sie die Add -&gt;Menübefehl zum Erstellen einer neuen "InvalidOwner" Ansicht anzeigen.</span><span class="sxs-lookup"><span data-stu-id="af6b2-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="af6b2-182">Wir werden befüllen Sie sie mit der folgenden Fehlermeldung angezeigt:</span><span class="sxs-lookup"><span data-stu-id="af6b2-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="af6b2-183">Und nun, wenn ein Benutzer versucht, eine Dinner zu bearbeiten, die sie besitzen nicht, sie erhalten eine Fehlermeldung angezeigt:</span><span class="sxs-lookup"><span data-stu-id="af6b2-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="af6b2-184">Wir können die gleichen Schritte für die Aktionsmethoden Delete() wiederholen, in den Controller, Sperren Sie die Berechtigung zum Dinner auch löschen, und stellen Sie sicher, dass nur der Host von einem Dinner gelöscht werden kann.</span><span class="sxs-lookup"><span data-stu-id="af6b2-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="af6b2-185">Anzeigen/ausblenden bearbeiten "und" Links "löschen"</span><span class="sxs-lookup"><span data-stu-id="af6b2-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="af6b2-186">Wir sind von unseren Informationen-URL an die Aktionsmethode bearbeiten und Löschen von unserer Klasse "dinnerscontroller" verknüpfen:</span><span class="sxs-lookup"><span data-stu-id="af6b2-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="af6b2-187">Gegenwärtig werden wir die Aktionslinks bearbeiten und löschen, unabhängig davon, ob der Besucher auf die URL für die Details der Host die Dinner angezeigt.</span><span class="sxs-lookup"><span data-stu-id="af6b2-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="af6b2-188">Lassen Sie uns dies ändern und die Links nur angezeigt werden, wenn der Benutzer aufgerufen. der Besitzer der Dinner ist.</span><span class="sxs-lookup"><span data-stu-id="af6b2-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="af6b2-189">Details() Aktionsmethode in unsere "dinnerscontroller" Ruft ein Objekt Dinner ab und leitet diese dann als das Modellobjekt an unsere Vorlage anzeigen:</span><span class="sxs-lookup"><span data-stu-id="af6b2-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="af6b2-190">Wir können unsere Vorlage anzeigen, um bedingt ein-/ausblenden der Bearbeiten und löschen die Verknüpfungen mit der Hilfsmethode wie die folgende Dinner.IsHostedBy() aktualisieren:</span><span class="sxs-lookup"><span data-stu-id="af6b2-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="af6b2-191">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="af6b2-191">Next Steps</span></span>

<span data-ttu-id="af6b2-192">Jetzt sehen wir uns wie wir authentifizierte Benutzern RSVP für die Verwendung von AJAX Dinner aktivieren können.</span><span class="sxs-lookup"><span data-stu-id="af6b2-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="af6b2-193">[Zurück](implement-efficient-data-paging.md)
> [Weiter](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="af6b2-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
