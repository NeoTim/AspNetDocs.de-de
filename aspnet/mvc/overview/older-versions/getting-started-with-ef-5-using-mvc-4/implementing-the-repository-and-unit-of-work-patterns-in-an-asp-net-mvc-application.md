---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
title: Implementieren von Repository-und Arbeitseinheiten Mustern in einer ASP.NET MVC-Anwendung (9 von 10) | Microsoft-Dokumentation
author: tdykstra
description: Die Beispiel-Webanwendung der Beispiel-Web-App veranschaulicht, wie ASP.NET MVC 4-Anwendungen mithilfe der Entity Framework 5 Code First und Visual Studio erstellt werden...
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 44761193-04ba-4990-9f90-145d3c10a716
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 18de9b125ee5d10795b9ce1a366918dadf4fc4e3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78434379"
---
# <a name="implementing-the-repository-and-unit-of-work-patterns-in-an-aspnet-mvc-application-9-of-10"></a><span data-ttu-id="f2bc8-103">Implementieren von Repository-und Arbeitseinheiten Mustern in einer ASP.NET MVC-Anwendung (9 von 10)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-103">Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application (9 of 10)</span></span>

<span data-ttu-id="f2bc8-104">von [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="f2bc8-105">Herunterladen des abgeschlossenen Projekts</span><span class="sxs-lookup"><span data-stu-id="f2bc8-105">Download Completed Project</span></span>](https://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="f2bc8-106">Die Beispiel-Webanwendung der Beispiel-Web-App veranschaulicht, wie ASP.NET MVC 4-Anwendungen mithilfe der Entity Framework 5 Code First und Visual Studio 2012 erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="f2bc8-107">Informationen zu dieser Tutorialreihe finden Sie im [ersten Tutorial der Reihe](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="f2bc8-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="f2bc8-108">Sie können die tutorialreihe von Anfang an starten oder [ein Starter-Projekt für dieses Kapitel herunterladen](building-the-ef5-mvc4-chapter-downloads.md) und hier beginnen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="f2bc8-109">Wenn Sie auf ein Problem stoßen, das Sie nicht beheben können, [Laden Sie das abgeschlossene Kapitel herunter](building-the-ef5-mvc4-chapter-downloads.md) , und versuchen Sie, das Problem zu reproduzieren.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="f2bc8-110">Im Allgemeinen können Sie die Lösung für das Problem finden, indem Sie Ihren Code mit dem abgeschlossenen Code vergleichen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="f2bc8-111">Informationen zu häufigen Fehlern und deren Lösung finden Sie unter [Fehler und](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors) Problem Umgehungen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>

<span data-ttu-id="f2bc8-112">Im vorherigen Tutorial haben Sie Vererbung verwendet, um redundanten Code in den `Student`-und `Instructor` Entitäts Klassen zu verringern.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-112">In the previous tutorial you used inheritance to reduce redundant code in the `Student` and `Instructor` entity classes.</span></span> <span data-ttu-id="f2bc8-113">In diesem Tutorial sehen Sie einige Möglichkeiten, das Repository und Arbeitseinheiten Muster für CRUD-Vorgänge zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-113">In this tutorial you'll see some ways to use the repository and unit of work patterns for CRUD operations.</span></span> <span data-ttu-id="f2bc8-114">Wie im vorherigen Tutorial ändern Sie in diesem Tutorial die Funktionsweise Ihres Codes mit bereits erstellten Seiten, anstatt neue Seiten zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-114">As in the previous tutorial, in this one you'll change the way your code works with pages you already created rather than creating new pages.</span></span>

## <a name="the-repository-and-unit-of-work-patterns"></a><span data-ttu-id="f2bc8-115">Das Repository und Arbeitseinheits Muster</span><span class="sxs-lookup"><span data-stu-id="f2bc8-115">The Repository and Unit of Work Patterns</span></span>

<span data-ttu-id="f2bc8-116">Die Muster "Repository" und "Arbeitseinheit" dienen dazu, eine Abstraktions Ebene zwischen der Datenzugriffs Schicht und der Geschäftslogik Ebene einer Anwendung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-116">The repository and unit of work patterns are intended to create an abstraction layer between the data access layer and the business logic layer of an application.</span></span> <span data-ttu-id="f2bc8-117">Die Implementierung dieser Muster unterstützt die Isolation Ihrer Anwendung vor Änderungen im Datenspeicher und kann automatisierte Komponententests oder eine testgesteuerte Entwicklung (Test-Driven Development, TDD) erleichtern.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-117">Implementing these patterns can help insulate your application from changes in the data store and can facilitate automated unit testing or test-driven development (TDD).</span></span>

<span data-ttu-id="f2bc8-118">In diesem Tutorial implementieren Sie eine Repository-Klasse für jeden Entitätstyp.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-118">In this tutorial you'll implement a repository class for each entity type.</span></span> <span data-ttu-id="f2bc8-119">Für den `Student` Entitätstyp erstellen Sie eine Repository-Schnittstelle und eine Repository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-119">For the `Student` entity type you'll create a repository interface and a repository class.</span></span> <span data-ttu-id="f2bc8-120">Wenn Sie das Repository in Ihrem Controller instanziieren, verwenden Sie die-Schnittstelle, damit der Controller einen Verweis auf jedes Objekt akzeptiert, das die Repository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-120">When you instantiate the repository in your controller, you'll use the interface so that the controller will accept a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="f2bc8-121">Wenn der Controller unter einem Webserver ausgeführt wird, empfängt er ein Repository, das mit dem Entity Framework funktioniert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-121">When the controller runs under a web server, it receives a repository that works with the Entity Framework.</span></span> <span data-ttu-id="f2bc8-122">Wenn der Controller unter einer Komponenten Testklasse ausgeführt wird, empfängt er ein Repository, das mit Daten funktioniert, die auf eine Weise gespeichert werden, die Sie problemlos für Tests bearbeiten können, z. b. eine Auflistung im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-122">When the controller runs under a unit test class, it receives a repository that works with data stored in a way that you can easily manipulate for testing, such as an in-memory collection.</span></span>

<span data-ttu-id="f2bc8-123">Später in diesem Tutorial verwenden Sie mehrere Depots und eine Arbeitseinheits-Klasse für die `Course`-und `Department` Entitäts Typen im `Course` Controller.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-123">Later in the tutorial you'll use multiple repositories and a unit of work class for the `Course` and `Department` entity types in the `Course` controller.</span></span> <span data-ttu-id="f2bc8-124">Die Unit of Work-Klasse koordiniert die Arbeit mehrerer Depots, indem eine einzelne Daten Bank Kontext Klasse erstellt wird, die von Ihnen gemeinsam genutzt wird.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-124">The unit of work class coordinates the work of multiple repositories by creating a single database context class shared by all of them.</span></span> <span data-ttu-id="f2bc8-125">Wenn Sie in der Lage sein möchten, Automatisierte Komponententests durchzuführen, erstellen und verwenden Sie Schnittstellen für diese Klassen auf die gleiche Weise wie für das `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-125">If you wanted to be able to perform automated unit testing, you'd create and use interfaces for these classes in the same way you did for the `Student` repository.</span></span> <span data-ttu-id="f2bc8-126">Um das Tutorial einfach zu halten, erstellen und verwenden Sie diese Klassen ohne Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-126">However, to keep the tutorial simple, you'll create and use these classes without interfaces.</span></span>

<span data-ttu-id="f2bc8-127">Die folgende Abbildung zeigt eine Möglichkeit, die Beziehungen zwischen dem Controller und den Kontext Klassen zu konzipieren, verglichen mit der Verwendung des-Repository oder der Arbeitseinheits Muster.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-127">The following illustration shows one way to conceptualize the relationships between the controller and context classes compared to not using the repository or unit of work pattern at all.</span></span>

![Repository_pattern_diagram](https://asp.net/media/2578149/Windows-Live-Writer_8c4963ba1fa3_CE3B_Repository_pattern_diagram_1df790d3-bdf2-4c11-9098-946ddd9cd884.png)

<span data-ttu-id="f2bc8-129">In dieser tutorialreihe werden keine Komponententests erstellt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-129">You won't create unit tests in this tutorial series.</span></span> <span data-ttu-id="f2bc8-130">Eine Einführung in TDD mit einer MVC-Anwendung, die das Repository-Muster verwendet, finden Sie unter Exemplarische Vorgehensweise [: Verwenden von TDD mit ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span><span class="sxs-lookup"><span data-stu-id="f2bc8-130">For an introduction to TDD with an MVC application that uses the repository pattern, see [Walkthrough: Using TDD with ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span></span> <span data-ttu-id="f2bc8-131">Weitere Informationen zum Repository-Muster finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-131">For more information about the repository pattern, see the following resources:</span></span>

- <span data-ttu-id="f2bc8-132">[Das Repository-Muster](https://msdn.microsoft.com/library/ff649690.aspx) auf MSDN.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-132">[The Repository Pattern](https://msdn.microsoft.com/library/ff649690.aspx) on MSDN.</span></span>
- <span data-ttu-id="f2bc8-133">[Verwenden von Repository und Arbeitseinheiten Mustern mit Entity Framework 4,0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) im Entity Framework Team Blog.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-133">[Using Repository and Unit of Work patterns with Entity Framework 4.0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) on the Entity Framework team blog.</span></span>
- <span data-ttu-id="f2bc8-134">[Agile-Entity Framework 4-Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) -Reihe von Beiträgen im Blog von Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-134">[Agile Entity Framework 4 Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) series of posts on Julie Lerman's blog.</span></span>
- <span data-ttu-id="f2bc8-135">[Das Konto wird auf einen Blick auf eine HTML5/jQuery-Anwendung](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) im Blog von Dan Wahlin integriert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-135">[Building the Account at a Glance HTML5/jQuery Application](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) on Dan Wahlin's blog.</span></span>

> [!NOTE]
> <span data-ttu-id="f2bc8-136">Es gibt zahlreiche Möglichkeiten, das Repository und Arbeits Einheits Muster zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-136">There are many ways to implement the repository and unit of work patterns.</span></span> <span data-ttu-id="f2bc8-137">Sie können Repository-Klassen mit oder ohne Arbeitseinheits Klasse verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-137">You can use repository classes with or without a unit of work class.</span></span> <span data-ttu-id="f2bc8-138">Sie können ein einzelnes Repository für alle Entitäts Typen oder einen für jeden Typ implementieren.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-138">You can implement a single repository for all entity types, or one for each type.</span></span> <span data-ttu-id="f2bc8-139">Wenn Sie einen für jeden Typ implementieren, können Sie separate Klassen, eine generische Basisklasse und abgeleitete Klassen oder eine abstrakte Basisklasse und abgeleitete Klassen verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-139">If you implement one for each type, you can use separate classes, a generic base class and derived classes, or an abstract base class and derived classes.</span></span> <span data-ttu-id="f2bc8-140">Sie können Geschäftslogik in Ihr Repository einschließen oder auf Datenzugriffs Logik beschränken.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-140">You can include business logic in your repository or restrict it to data access logic.</span></span> <span data-ttu-id="f2bc8-141">Sie können auch eine Abstraktions Ebene in der Daten Bank Kontext Klasse erstellen, indem Sie anstelle von [dbset](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) -Typen für ihre Entitätenmengen [idbset](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) -Schnittstellen verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-141">You can also build an abstraction layer into your database context class by using [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) interfaces there instead of [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) types for your entity sets.</span></span> <span data-ttu-id="f2bc8-142">Der Ansatz für die Implementierung einer in diesem Tutorial gezeigten Abstraktions Ebene ist eine Option, die Sie berücksichtigen sollten, nicht für alle Szenarien und Umgebungen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-142">The approach to implementing an abstraction layer shown in this tutorial is one option for you to consider, not a recommendation for all scenarios and environments.</span></span>

## <a name="creating-the-student-repository-class"></a><span data-ttu-id="f2bc8-143">Erstellen der Student Repository-Klasse</span><span class="sxs-lookup"><span data-stu-id="f2bc8-143">Creating the Student Repository Class</span></span>

<span data-ttu-id="f2bc8-144">Erstellen Sie im Ordner *dal* eine Klassendatei mit dem Namen *IStudentRepository.cs* , und ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-144">In the *DAL* folder, create a class file named *IStudentRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="f2bc8-145">Dieser Code deklariert einen typischen Satz von CRUD-Methoden, einschließlich zwei Read-Methoden – eine, die alle `Student` Entitäten zurückgibt, und eine, die eine einzelne `Student` Entität nach ID findet.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-145">This code declares a typical set of CRUD methods, including two read methods — one that returns all `Student` entities, and one that finds a single `Student` entity by ID.</span></span>

<span data-ttu-id="f2bc8-146">Erstellen Sie im Ordner *dal* eine Klassendatei mit dem Namen *StudentRepository.cs* file.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-146">In the *DAL* folder, create a class file named *StudentRepository.cs* file.</span></span> <span data-ttu-id="f2bc8-147">Ersetzen Sie den vorhandenen Code durch den folgenden Code, der die `IStudentRepository`-Schnittstelle implementiert:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-147">Replace the existing code with the following code, which implements the `IStudentRepository` interface:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="f2bc8-148">Der Daten Bank Kontext wird in einer Klassen Variablen definiert, und der Konstruktor erwartet, dass das aufrufende Objekt eine Instanz des Kontexts übergibt:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-148">The database context is defined in a class variable, and the constructor expects the calling object to pass in an instance of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample3.cs)]

<span data-ttu-id="f2bc8-149">Sie könnten einen neuen Kontext im Repository instanziieren, aber wenn Sie mehrere Repository in einem Controller verwendet haben, würde jeder einen separaten Kontext haben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-149">You could instantiate a new context in the repository, but then if you used multiple repositories in one controller, each would end up with a separate context.</span></span> <span data-ttu-id="f2bc8-150">Später verwenden Sie mehrere Repository im `Course` Controller, und Sie sehen, wie eine Arbeitseinheits Klasse sicherstellen kann, dass alle Depots denselben Kontext verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-150">Later you'll use multiple repositories in the `Course` controller, and you'll see how a unit of work class can ensure that all repositories use the same context.</span></span>

<span data-ttu-id="f2bc8-151">Das Repository implementiert [iverwerfund](https://msdn.microsoft.com/library/system.idisposable.aspx) gibt den Daten Bank kontextfrei, wie zuvor im Controller gesehen, und die CRUD-Methoden führen Aufrufe an den Daten Bank Kontext auf die gleiche Weise aus wie zuvor.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-151">The repository implements [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) and disposes the database context as you saw earlier in the controller, and its CRUD methods make calls to the database context in the same way that you saw earlier.</span></span>

## <a name="change-the-student-controller-to-use-the-repository"></a><span data-ttu-id="f2bc8-152">Ändern Sie den Student Controller, um das Repository zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-152">Change the Student Controller to Use the Repository</span></span>

<span data-ttu-id="f2bc8-153">Ersetzen Sie in *StudentController.cs*den aktuell in der-Klasse aufgeführten Code durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-153">In *StudentController.cs*, replace the code currently in the class with the following code.</span></span> <span data-ttu-id="f2bc8-154">Die Änderungen werden hervorgehoben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-154">The changes are highlighted.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=13-18,44,75,77,102-103,120,137-138,159,172-174,186)]

<span data-ttu-id="f2bc8-155">Der Controller deklariert nun eine Klassen Variable für ein Objekt, das die `IStudentRepository`-Schnittstelle anstelle der Kontext Klasse implementiert:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-155">The controller now declares a class variable for an object that implements the `IStudentRepository` interface instead of the context class:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="f2bc8-156">Der standardmäßige (parameterlose) Konstruktor erstellt eine neue Kontext Instanz, und ein optionaler Konstruktor ermöglicht es dem Aufrufer, eine Kontext Instanz zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-156">The default (parameterless) constructor creates a new context instance, and an optional constructor allows the caller to pass in a context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="f2bc8-157">(Wenn Sie die *Abhängigkeitsinjektion*oder di verwendet haben, benötigen Sie den Standardkonstruktor nicht, da die di-Software sicherstellt, dass immer das korrekte Repository-Objekt bereitgestellt wird.)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-157">(If you were using *dependency injection*, or DI, you wouldn't need the default constructor because the DI software would ensure that the correct repository object would always be provided.)</span></span>

<span data-ttu-id="f2bc8-158">In den CRUD-Methoden wird das Repository nun anstelle des Kontexts aufgerufen:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-158">In the CRUD methods, the repository is now called instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample7.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample8.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample9.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample10.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="f2bc8-159">Die `Dispose`-Methode verwirft nun das Repository anstelle des Kontexts:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-159">And the `Dispose` method now disposes the repository instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="f2bc8-160">Führen Sie die Website aus, und klicken Sie auf die Registerkarte **Studenten**</span><span class="sxs-lookup"><span data-stu-id="f2bc8-160">Run the site and click the **Students** tab.</span></span>

![Students_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="f2bc8-162">Die Seite sieht ordnungsgemäß aus und funktioniert genauso wie vor dem Ändern des Codes, um das Repository zu verwenden, und die anderen Seiten des Studenten funktionieren ebenfalls identisch.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-162">The page looks and works the same as it did before you changed the code to use the repository, and the other Student pages also work the same.</span></span> <span data-ttu-id="f2bc8-163">Es gibt jedoch einen wichtigen Unterschied in der Art und Weise, in der die `Index`-Methode des Controllers filtert und anordnet.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-163">However, there's an important difference in the way the `Index` method of the controller does filtering and ordering.</span></span> <span data-ttu-id="f2bc8-164">Die ursprüngliche Version dieser Methode enthielt den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-164">The original version of this method contained the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample13.cs?highlight=1)]

<span data-ttu-id="f2bc8-165">Die aktualisierte `Index`-Methode enthält den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-165">The updated `Index` method contains the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample14.cs?highlight=1)]

<span data-ttu-id="f2bc8-166">Nur der hervorgehobene Code wurde geändert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-166">Only the highlighted code has changed.</span></span>

<span data-ttu-id="f2bc8-167">In der ursprünglichen Version des Codes ist `students` als `IQueryable`-Objekt typisiert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-167">In the original version of the code, `students` is typed as an `IQueryable` object.</span></span> <span data-ttu-id="f2bc8-168">Die Abfrage wird erst dann an die Datenbank gesendet, wenn Sie mithilfe einer Methode wie `ToList`in eine Auflistung konvertiert wird. Dies geschieht erst, wenn die Index Sicht auf das Student-Modell zugreift.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-168">The query isn't sent to the database until it's converted into a collection using a method such as `ToList`, which doesn't occur until the Index view accesses the student model.</span></span> <span data-ttu-id="f2bc8-169">Die `Where`-Methode im obigen Code wird zu einer `WHERE`-Klausel in der SQL-Abfrage, die an die Datenbank gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-169">The `Where` method in the original code above becomes a `WHERE` clause in the SQL query that is sent to the database.</span></span> <span data-ttu-id="f2bc8-170">Dies bedeutet wiederum, dass nur die ausgewählten Entitäten von der Datenbank zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-170">That in turn means that only the selected entities are returned by the database.</span></span> <span data-ttu-id="f2bc8-171">Aufgrund der Änderung von `context.Students` in `studentRepository.GetStudents()`ist die `students` Variable nach dieser Anweisung jedoch eine `IEnumerable` Auflistung, die alle Studenten in der Datenbank enthält.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-171">However, as a result of changing `context.Students` to `studentRepository.GetStudents()`, the `students` variable after this statement is an `IEnumerable` collection that includes all students in the database.</span></span> <span data-ttu-id="f2bc8-172">Das Endergebnis der Anwendung der `Where` Methode ist identisch, aber jetzt wird die Arbeit im Arbeitsspeicher auf dem Webserver und nicht in der Datenbank ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-172">The end result of applying the `Where` method is the same, but now the work is done in memory on the web server and not by the database.</span></span> <span data-ttu-id="f2bc8-173">Bei Abfragen, die große Datenmengen zurückgeben, kann dies ineffizient sein.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-173">For queries that return large volumes of data, this can be inefficient.</span></span>

> [!TIP]
> 
> <span data-ttu-id="f2bc8-174">**Iquerable im Vergleich zu IEnumerable**</span><span class="sxs-lookup"><span data-stu-id="f2bc8-174">**IQueryable vs. IEnumerable**</span></span>
> 
> <span data-ttu-id="f2bc8-175">Nachdem Sie das Repository wie hier gezeigt implementiert haben, gibt die an SQL Server gesendete Abfrage alle Studenten Zeilen zurück, da **Sie die Such** Kriterien nicht enthält:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-175">After you implement the repository as shown here, even if you enter something in the **Search** box the query sent to SQL Server returns all Student rows because it doesn't include your search criteria:</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image2.png)
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample15.sql)]
> 
> <span data-ttu-id="f2bc8-176">Diese Abfrage gibt alle Studenten Daten zurück, weil das Repository die Abfrage ausgeführt hat, ohne dass die Suchkriterien bekannt sind.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-176">This query returns all of the student data because the repository executed the query without knowing about the search criteria.</span></span> <span data-ttu-id="f2bc8-177">Das Sortieren, Anwenden von Suchkriterien und Auswählen einer Teilmenge der Daten für das Paging (in diesem Fall nur 3 Zeilen) erfolgt später, wenn die `ToPagedList`-Methode für die `IEnumerable` Auflistung aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-177">The process of sorting, applying search criteria, and selecting a subset of the data for paging (showing only 3 rows in this case) is done in memory later when the `ToPagedList` method is called on the `IEnumerable` collection.</span></span>
> 
> <span data-ttu-id="f2bc8-178">In der vorherigen Version des Codes (vor der Implementierung des Repository) wird die Abfrage erst dann an die Datenbank gesendet, wenn Sie die Suchkriterien angewendet haben, wenn `ToPagedList` für das `IQueryable` Objekt aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-178">In the previous version of the code (before you implemented the repository), the query is not sent to the database until after you apply the search criteria, when `ToPagedList` is called on the `IQueryable` object.</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image3.png)
> 
> <span data-ttu-id="f2bc8-179">Wenn topagedlist für ein `IQueryable` Objekt aufgerufen wird, gibt die an SQL Server gesendete Abfrage die Such Zeichenfolge an, und als Ergebnis werden nur Zeilen zurückgegeben, die die Suchkriterien erfüllen, und im Arbeitsspeicher muss keine Filterung durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-179">When ToPagedList is called on an `IQueryable` object, the query sent to SQL Server specifies the search string, and as a result only rows that meet the search criteria are returned, and no filtering needs to be done in memory.</span></span>
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample16.sql)]
> 
> <span data-ttu-id="f2bc8-180">(Im folgenden Tutorial wird erläutert, wie Sie Abfragen untersuchen, die an SQL Server gesendet werden.)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-180">(The following tutorial explains how to examine queries sent to SQL Server.)</span></span>

<span data-ttu-id="f2bc8-181">Der folgende Abschnitt zeigt, wie Sie Repository-Methoden implementieren können, mit denen Sie angeben können, dass diese Arbeit von der Datenbank ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-181">The following section shows how to implement repository methods that enable you to specify that this work should be done by the database.</span></span>

<span data-ttu-id="f2bc8-182">Sie haben jetzt eine Abstraktions Ebene zwischen dem Controller und dem Entity Framework Daten Bank Kontext erstellt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-182">You've now created an abstraction layer between the controller and the Entity Framework database context.</span></span> <span data-ttu-id="f2bc8-183">Wenn Sie automatisierte Komponententests mit dieser Anwendung ausführen, können Sie eine alternative Repository-Klasse in einem Komponenten Testprojekt erstellen, das `IStudentRepository`implementiert *.*</span><span class="sxs-lookup"><span data-stu-id="f2bc8-183">If you were going to perform automated unit testing with this application, you could create an alternative repository class in a unit test project that implements `IStudentRepository`*.*</span></span> <span data-ttu-id="f2bc8-184">Anstatt den Kontext zum Lesen und Schreiben von Daten aufzurufende, könnte diese mockrepository-Klasse in-Memory-Auflistungen manipulieren, um Controller Funktionen zu testen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-184">Instead of calling the context to read and write data, this mock repository class could manipulate in-memory collections in order to test controller functions.</span></span>

## <a name="implement-a-generic-repository-and-a-unit-of-work-class"></a><span data-ttu-id="f2bc8-185">Implementieren Sie ein generisches Repository und eine Arbeitseinheits-Klasse.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-185">Implement a Generic Repository and a Unit of Work Class</span></span>

<span data-ttu-id="f2bc8-186">Das Erstellen einer Repository-Klasse für jeden Entitätstyp kann zu viel redundantem Code führen, was zu Teil Updates führen könnte.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-186">Creating a repository class for each entity type could result in a lot of redundant code, and it could result in partial updates.</span></span> <span data-ttu-id="f2bc8-187">Nehmen Sie beispielsweise an, dass Sie zwei verschiedene Entitäts Typen als Teil derselben Transaktion aktualisieren müssen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-187">For example, suppose you have to update two different entity types as part of the same transaction.</span></span> <span data-ttu-id="f2bc8-188">Wenn jeweils eine separate Daten Bank Kontext Instanz verwendet wird, kann ein Erfolg auftreten, während die andere fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-188">If each uses a separate database context instance, one might succeed and the other might fail.</span></span> <span data-ttu-id="f2bc8-189">Eine Möglichkeit, redundanten Code zu minimieren, ist die Verwendung eines generischen Repository, und eine Möglichkeit, um sicherzustellen, dass alle Depots denselben Daten Bank Kontext verwenden (und somit alle Updates koordiniert), ist die Verwendung einer Arbeitseinheit.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-189">One way to minimize redundant code is to use a generic repository, and one way to ensure that all repositories use the same database context (and thus coordinate all updates) is to use a unit of work class.</span></span>

<span data-ttu-id="f2bc8-190">In diesem Abschnitt des Tutorials erstellen Sie eine `GenericRepository`-Klasse und eine `UnitOfWork`-Klasse und verwenden Sie im `Course` Controller, um sowohl auf die `Department`-als auch auf die `Course`-Entitätenmengen zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-190">In this section of the tutorial, you'll create a `GenericRepository` class and a `UnitOfWork` class, and use them in the `Course` controller to access both the `Department` and the `Course` entity sets.</span></span> <span data-ttu-id="f2bc8-191">Wie bereits erläutert, erstellen Sie keine Schnittstellen für diese Klassen, um diesen Teil des Tutorials einfach zu halten.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-191">As explained earlier, to keep this part of the tutorial simple, you aren't creating interfaces for these classes.</span></span> <span data-ttu-id="f2bc8-192">Wenn Sie Sie jedoch zum Vereinfachen von TDD verwenden, implementieren Sie Sie in der Regel mit Schnittstellen auf die gleiche Weise wie das `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-192">But if you were going to use them to facilitate TDD, you'd typically implement them with interfaces the same way you did the `Student` repository.</span></span>

### <a name="create-a-generic-repository"></a><span data-ttu-id="f2bc8-193">Erstellen eines generischen Repository</span><span class="sxs-lookup"><span data-stu-id="f2bc8-193">Create a Generic Repository</span></span>

<span data-ttu-id="f2bc8-194">Erstellen Sie im Ordner *dal* *GenericRepository.cs* , und ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-194">In the *DAL* folder, create *GenericRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample17.cs)]

<span data-ttu-id="f2bc8-195">Klassen Variablen werden für den Daten Bank Kontext und für die Entitätenmenge deklariert, für die das Repository instanziiert wird:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-195">Class variables are declared for the database context and for the entity set that the repository is instantiated for:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample18.cs)]

<span data-ttu-id="f2bc8-196">Der Konstruktor akzeptiert eine Daten Bank Kontext Instanz und initialisiert die entitätenmengenvariable:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-196">The constructor accepts a database context instance and initializes the entity set variable:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="f2bc8-197">Die `Get`-Methode verwendet Lambda-Ausdrücke, damit der aufrufende Code eine Filterbedingung und eine Spalte angeben kann, nach der die Ergebnisse sortiert werden, und mit einem Zeichen folgen Parameter kann der Aufrufer eine durch Trennzeichen getrennte Liste von Navigations Eigenschaften für Eager Loading bereitstellen:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-197">The `Get` method uses lambda expressions to allow the calling code to specify a filter condition and a column to order the results by, and a string parameter lets the caller provide a comma-delimited list of navigation properties for eager loading:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample20.cs)]

<span data-ttu-id="f2bc8-198">Der Code `Expression<Func<TEntity, bool>> filter` bedeutet, dass der Aufrufer einen Lambda-Ausdruck auf der Grundlage des `TEntity` Typs bereitstellt. dieser Ausdruck gibt einen booleschen Wert zurück.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-198">The code `Expression<Func<TEntity, bool>> filter` means the caller will provide a lambda expression based on the `TEntity` type, and this expression will return a Boolean value.</span></span> <span data-ttu-id="f2bc8-199">Wenn das Repository z. b. für den `Student` Entitätstyp instanziiert wird, kann der Code in der aufrufenden Methode `student => student.LastName == "Smith`&quot; für den `filter`-Parameter angeben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-199">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `student => student.LastName == "Smith`&quot; for the `filter` parameter.</span></span>

<span data-ttu-id="f2bc8-200">Der Code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` auch bedeutet, dass der Aufrufer einen Lambda Ausdruck bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-200">The code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` also means the caller will provide a lambda expression.</span></span> <span data-ttu-id="f2bc8-201">In diesem Fall ist die Eingabe für den Ausdruck jedoch ein `IQueryable` Objekt für den `TEntity`-Typ.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-201">But in this case, the input to the expression is an `IQueryable` object for the `TEntity` type.</span></span> <span data-ttu-id="f2bc8-202">Der Ausdruck gibt eine geordnete Version dieses `IQueryable`-Objekts zurück.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-202">The expression will return an ordered version of that `IQueryable` object.</span></span> <span data-ttu-id="f2bc8-203">Wenn das Repository z. b. für den `Student` Entitätstyp instanziiert wird, kann der Code in der aufrufenden Methode `q => q.OrderBy(s => s.LastName)` für den `orderBy`-Parameter angeben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-203">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `q => q.OrderBy(s => s.LastName)` for the `orderBy` parameter.</span></span>

<span data-ttu-id="f2bc8-204">Der Code in der `Get`-Methode erstellt ein `IQueryable` Objekt und wendet dann den Filter Ausdruck an, falls vorhanden:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-204">The code in the `Get` method creates an `IQueryable` object and then applies the filter expression if there is one:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="f2bc8-205">Als nächstes wendet Sie die Ausdrücke mit unverzüglichem laden nach dem Durchführen der durch Trennzeichen getrennten Liste an:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-205">Next it applies the eager-loading expressions after parsing the comma-delimited list:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample22.cs)]

<span data-ttu-id="f2bc8-206">Schließlich wendet Sie den `orderBy` Ausdruck an, wenn ein solcher vorhanden ist, und gibt die Ergebnisse zurück. Andernfalls werden die Ergebnisse der ungeordneten Abfrage zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-206">Finally, it applies the `orderBy` expression if there is one and returns the results; otherwise it returns the results from the unordered query:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample23.cs)]

<span data-ttu-id="f2bc8-207">Wenn Sie die `Get`-Methode aufzurufen, können Sie die von der-Methode zurückgegebenen `IEnumerable` Auflistung filtern und sortieren, anstatt Parameter für diese Funktionen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-207">When you call the `Get` method, you could do filtering and sorting on the `IEnumerable` collection returned by the method instead of providing parameters for these functions.</span></span> <span data-ttu-id="f2bc8-208">Die Sortier-und Filteraufgaben werden dann im Arbeitsspeicher auf dem Webserver ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-208">But the sorting and filtering work would then be done in memory on the web server.</span></span> <span data-ttu-id="f2bc8-209">Wenn Sie diese Parameter verwenden, stellen Sie sicher, dass die Arbeit von der Datenbank statt vom Webserver ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-209">By using these parameters, you ensure that the work is done by the database rather than the web server.</span></span> <span data-ttu-id="f2bc8-210">Eine Alternative besteht darin, abgeleitete Klassen für bestimmte Entitäts Typen zu erstellen und spezialisierte `Get` Methoden hinzuzufügen, z. b. `GetStudentsInNameOrder` oder `GetStudentsByName`.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-210">An alternative is to create derived classes for specific entity types and add specialized `Get` methods, such as `GetStudentsInNameOrder` or `GetStudentsByName`.</span></span> <span data-ttu-id="f2bc8-211">In einer komplexen Anwendung kann dies jedoch zu einer großen Anzahl von abgeleiteten Klassen und spezialisierten Methoden führen, bei denen es möglicherweise mehr Arbeit gibt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-211">However, in a complex application, this can result in a large number of such derived classes and specialized methods, which could be more work to maintain.</span></span>

<span data-ttu-id="f2bc8-212">Der Code in den `GetByID`-, `Insert`-und `Update`-Methoden ähnelt dem, was Sie im nicht generischen Repository gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-212">The code in the `GetByID`, `Insert`, and `Update` methods is similar to what you saw in the non-generic repository.</span></span> <span data-ttu-id="f2bc8-213">(Sie geben keinen Eager Loading Parameter in der `GetByID` Signatur an, da Sie Eager Loading nicht mit der `Find`-Methode ausführen können.)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-213">(You aren't providing an eager loading parameter in the `GetByID` signature, because you can't do eager loading with the `Find` method.)</span></span>

<span data-ttu-id="f2bc8-214">Für die `Delete`-Methode werden zwei über Ladungen bereitgestellt:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-214">Two overloads are provided for the `Delete` method:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample24.cs)]

<span data-ttu-id="f2bc8-215">Mit einer dieser Informationen können Sie nur die ID der zu löschenden Entität übergeben und eine Entitäts Instanz.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-215">One of these lets you pass in just the ID of the entity to be deleted, and one takes an entity instance.</span></span> <span data-ttu-id="f2bc8-216">Wie Sie im Tutorial zur [Handhabung](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) von Parallelität gesehen haben, benötigen Sie für die Parallelitäts Behandlung eine `Delete` Methode, die eine Entitäts Instanz annimmt, die den ursprünglichen Wert einer nach Verfolgungs Eigenschaft enthält.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-216">As you saw in the [Handling Concurrency](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial, for concurrency handling you need a `Delete` method that takes an entity instance that includes the original value of a tracking property.</span></span>

<span data-ttu-id="f2bc8-217">In diesem generischen Repository werden typische CRUD-Anforderungen behandelt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-217">This generic repository will handle typical CRUD requirements.</span></span> <span data-ttu-id="f2bc8-218">Wenn für einen bestimmten Entitätstyp besondere Anforderungen gelten (z. b. komplexere Filter oder Reihenfolge), können Sie eine abgeleitete Klasse erstellen, die über zusätzliche Methoden für diesen Typ verfügt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-218">When a particular entity type has special requirements, such as more complex filtering or ordering, you can create a derived class that has additional methods for that type.</span></span>

## <a name="creating-the-unit-of-work-class"></a><span data-ttu-id="f2bc8-219">Erstellen der Arbeitseinheits Klasse</span><span class="sxs-lookup"><span data-stu-id="f2bc8-219">Creating the Unit of Work Class</span></span>

<span data-ttu-id="f2bc8-220">Die Unit of Work-Klasse dient einem Zweck: um sicherzustellen, dass Sie bei Verwendung mehrerer Depots einen einzelnen Daten Bank Kontext gemeinsam verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-220">The unit of work class serves one purpose: to make sure that when you use multiple repositories, they share a single database context.</span></span> <span data-ttu-id="f2bc8-221">Wenn eine Arbeitseinheit vollständig ist, können Sie auf diese Weise die `SaveChanges`-Methode für diese Instanz des Kontexts aufzurufen und sicher sein, dass alle zugehörigen Änderungen koordiniert werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-221">That way, when a unit of work is complete you can call the `SaveChanges` method on that instance of the context and be assured that all related changes will be coordinated.</span></span> <span data-ttu-id="f2bc8-222">Die Klasse benötigt lediglich eine `Save`-Methode und eine-Eigenschaft für jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-222">All that the class needs is a `Save` method and a property for each repository.</span></span> <span data-ttu-id="f2bc8-223">Jede Repository-Eigenschaft gibt eine Repository-Instanz zurück, die mit derselben Daten Bank Kontext Instanz wie die anderen Repository-Instanzen instanziiert wurde.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-223">Each repository property returns a repository instance that has been instantiated using the same database context instance as the other repository instances.</span></span>

<span data-ttu-id="f2bc8-224">Erstellen Sie im Ordner *dal* eine Klassendatei mit dem Namen *UnitOfWork.cs* , und ersetzen Sie den Vorlagen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-224">In the *DAL* folder, create a class file named *UnitOfWork.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample25.cs)]

<span data-ttu-id="f2bc8-225">Der Code erstellt Klassen Variablen für den Daten Bank Kontext und jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-225">The code creates class variables for the database context and each repository.</span></span> <span data-ttu-id="f2bc8-226">Für die `context` Variable wird ein neuer Kontext instanziiert:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-226">For the `context` variable, a new context is instantiated:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample26.cs)]

<span data-ttu-id="f2bc8-227">Jede Repository-Eigenschaft überprüft, ob das Repository bereits vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-227">Each repository property checks whether the repository already exists.</span></span> <span data-ttu-id="f2bc8-228">Wenn dies nicht der Fall ist, wird das Repository instanziiert, und die Kontext Instanz wird übergeben.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-228">If not, it instantiates the repository, passing in the context instance.</span></span> <span data-ttu-id="f2bc8-229">Daher verwenden alle Depots die gleiche Kontext Instanz.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-229">As a result, all repositories share the same context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample27.cs)]

<span data-ttu-id="f2bc8-230">Die `Save`-Methode ruft `SaveChanges` im Daten Bank Kontext auf.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-230">The `Save` method calls `SaveChanges` on the database context.</span></span>

<span data-ttu-id="f2bc8-231">Wie jede Klasse, die einen Daten Bank Kontext in einer Klassen Variablen instanziiert, implementiert die `UnitOfWork` Klasse `IDisposable` und gibt den kontextfrei.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-231">Like any class that instantiates a database context in a class variable, the `UnitOfWork` class implements `IDisposable` and disposes the context.</span></span>

### <a name="changing-the-course-controller-to-use-the-unitofwork-class-and-repositories"></a><span data-ttu-id="f2bc8-232">Ändern des Kurs Controllers für die Verwendung der Klasse "Unito fwork" und der Repository</span><span class="sxs-lookup"><span data-stu-id="f2bc8-232">Changing the Course Controller to use the UnitOfWork Class and Repositories</span></span>

<span data-ttu-id="f2bc8-233">Ersetzen Sie den derzeit in *CourseController.cs* aufgeführten Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="f2bc8-233">Replace the code you currently have in *CourseController.cs* with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample28.cs?highlight=15,20,22,31,54-55,70,85-86,101-102,122-124,130)]

<span data-ttu-id="f2bc8-234">Mit diesem Code wird eine Klassen Variable für die `UnitOfWork`-Klasse hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-234">This code adds a class variable for the `UnitOfWork` class.</span></span> <span data-ttu-id="f2bc8-235">(Wenn Sie hier Schnittstellen verwenden, würden Sie die Variable hier nicht initialisieren. stattdessen würden Sie ein Muster von zwei Konstruktoren genauso wie für das `Student` Repository implementieren.)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-235">(If you were using interfaces here, you wouldn't initialize the variable here; instead, you'd implement a pattern of two constructors just as you did for the `Student` repository.)</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample29.cs)]

<span data-ttu-id="f2bc8-236">Im Rest der Klasse werden alle Verweise auf den Daten Bank Kontext durch Verweise auf das entsprechende Repository ersetzt, wobei `UnitOfWork` Eigenschaften für den Zugriff auf das Repository verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-236">In the rest of the class, all references to the database context are replaced by references to the appropriate repository, using `UnitOfWork` properties to access the repository.</span></span> <span data-ttu-id="f2bc8-237">Die `Dispose`-Methode verwirft die `UnitOfWork` Instanz.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-237">The `Dispose` method disposes the `UnitOfWork` instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample30.cs)]

<span data-ttu-id="f2bc8-238">Führen Sie die Website aus, und klicken Sie auf die Registerkarte **Kurse**</span><span class="sxs-lookup"><span data-stu-id="f2bc8-238">Run the site and click the **Courses** tab.</span></span>

![Courses_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="f2bc8-240">Die Seite wird genauso aussehen und funktioniert wie vor Ihren Änderungen, und die anderen Kursseiten funktionieren ebenfalls identisch.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-240">The page looks and works the same as it did before your changes, and the other Course pages also work the same.</span></span>

## <a name="summary"></a><span data-ttu-id="f2bc8-241">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="f2bc8-241">Summary</span></span>

<span data-ttu-id="f2bc8-242">Sie haben nun sowohl das Repository als auch das Arbeits Einheits Muster implementiert.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-242">You have now implemented both the repository and unit of work patterns.</span></span> <span data-ttu-id="f2bc8-243">Sie haben Lambda-Ausdrücke als Methoden Parameter im generischen Repository verwendet.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-243">You have used lambda expressions as method parameters in the generic repository.</span></span> <span data-ttu-id="f2bc8-244">Weitere Informationen zum Verwenden dieser Ausdrücke mit einem `IQueryable`-Objekt finden Sie unter [iquervable (t) Interface (t) Interface (System. Linq)](https://msdn.microsoft.com/library/bb351562.aspx) in der MSDN Library.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-244">For more information about how to use these expressions with an `IQueryable` object, see [IQueryable(T) Interface (System.Linq)](https://msdn.microsoft.com/library/bb351562.aspx) in the MSDN Library.</span></span> <span data-ttu-id="f2bc8-245">Im nächsten Tutorial erfahren Sie, wie einige erweiterte Szenarien behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="f2bc8-245">In the next tutorial you'll learn how to handle some advanced scenarios.</span></span>

<span data-ttu-id="f2bc8-246">Links zu anderen Entity Framework Ressourcen finden Sie in der [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="f2bc8-246">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f2bc8-247">[Zurück](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [Weiter](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="f2bc8-247">[Previous](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
