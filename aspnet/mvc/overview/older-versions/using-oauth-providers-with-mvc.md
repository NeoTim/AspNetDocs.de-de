---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: Verwenden von OAuth-Anbietern mit MVC 4 | Microsoft-Dokumentation
author: Rick-Anderson
description: In diesem Tutorial wird gezeigt, wie Sie eine ASP.NET MVC 4-Webanwendung erstellen, die es Benutzern ermöglicht, sich mit Anmelde Informationen eines externen Anbieters anzumelden, z. b. facebo...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: 5dfd1305376a62f4987caea242ca0f6aac1018e9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78433365"
---
# <a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="d04a6-103">Verwenden von OAuth-Anbietern mit MVC 4</span><span class="sxs-lookup"><span data-stu-id="d04a6-103">Using OAuth Providers with MVC 4</span></span>

<span data-ttu-id="d04a6-104">von [Tom fitzmacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="d04a6-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="d04a6-105">In diesem Tutorial wird gezeigt, wie Sie eine ASP.NET MVC 4-Webanwendung erstellen, die es Benutzern ermöglicht, sich mit Anmelde Informationen eines externen Anbieters anzumelden, wie z. b. Facebook, Twitter, Microsoft oder Google, und dann einige der Funktionen von diesen Anbietern in Ihre Webanwendung.</span><span class="sxs-lookup"><span data-stu-id="d04a6-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="d04a6-106">Der Einfachheit halber konzentriert sich dieses Tutorial auf das Arbeiten mit Anmelde Informationen von Facebook.</span><span class="sxs-lookup"><span data-stu-id="d04a6-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="d04a6-107">Informationen zur Verwendung externer Anmelde Informationen in einer ASP.NET MVC 5-Webanwendung finden Sie [unter Erstellen einer ASP.NET MVC 5-App mit Facebook und Google OAuth2 und OpenID-Anmeldung](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="d04a6-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="d04a6-108">Die Aktivierung dieser Anmelde Informationen auf ihren Websites bietet einen erheblichen Vorteil, da Millionen von Benutzern bereits über Konten mit diesen externen Anbietern verfügen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="d04a6-109">Diese Benutzer sind möglicherweise eher geneigt, sich für Ihre Website zu registrieren, wenn Sie keinen neuen Satz von Anmelde Informationen erstellen und speichern müssen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="d04a6-110">Nachdem sich ein Benutzer über einen dieser Anbieter angemeldet hat, können Sie auch soziale Vorgänge des Anbieters integrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="d04a6-111">Was Sie erstellen</span><span class="sxs-lookup"><span data-stu-id="d04a6-111">What you'll build</span></span>

<span data-ttu-id="d04a6-112">In diesem Tutorial gibt es zwei Hauptziele:</span><span class="sxs-lookup"><span data-stu-id="d04a6-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="d04a6-113">Ermöglicht es Benutzern, sich mit Anmelde Informationen eines OAuth-Anbieters anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="d04a6-114">Rufen Sie Kontoinformationen vom Anbieter ab, und integrieren Sie diese Informationen mit der Kontoregistrierung für Ihren Standort.</span><span class="sxs-lookup"><span data-stu-id="d04a6-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="d04a6-115">Obwohl sich die Beispiele in diesem Tutorial auf die Verwendung von Facebook als Authentifizierungs Anbieter konzentrieren, können Sie den Code so ändern, dass er einen beliebigen Anbieter verwendet.</span><span class="sxs-lookup"><span data-stu-id="d04a6-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="d04a6-116">Die Schritte zum Implementieren eines beliebigen Anbieters ähneln den Schritten, die Sie in diesem Tutorial sehen werden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="d04a6-117">Sie werden nur signifikante Unterschiede bemerken, wenn Sie direkte Aufrufe an den API-Satz des Anbieters senden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="d04a6-118">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="d04a6-118">Prerequisites</span></span>

- <span data-ttu-id="d04a6-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) oder [Microsoft Visual Studio Express 2012 für Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="d04a6-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="d04a6-120">Oder</span><span class="sxs-lookup"><span data-stu-id="d04a6-120">Or</span></span>

- <span data-ttu-id="d04a6-121">Microsoft Visual Studio 2010 SP1 oder [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="d04a6-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="d04a6-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="d04a6-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="d04a6-123">Außerdem wird in diesem Thema davon ausgegangen, dass Sie über grundlegende Kenntnisse über ASP.NET MVC und Visual Studio verfügen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="d04a6-124">Wenn Sie eine Einführung in ASP.NET MVC 4 benötigen, finden Sie weitere Informationen unter Einführung [in ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="d04a6-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="d04a6-125">Erstellen eines Projekts</span><span class="sxs-lookup"><span data-stu-id="d04a6-125">Create the project</span></span>

<span data-ttu-id="d04a6-126">Erstellen Sie in Visual Studio eine neue ASP.NET MVC 4-Webanwendung, und benennen Sie Sie &quot;oauthmvc-&quot;.</span><span class="sxs-lookup"><span data-stu-id="d04a6-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="d04a6-127">Sie können entweder 4,5 oder 4 als Ziel .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d04a6-127">You can target either .NET Framework 4.5 or 4.</span></span>

![Erstellen des Projekts](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="d04a6-129">Wählen Sie im Fenster Neues ASP.NET MVC 4-Projekt die Option **Internet Anwendung** aus, und lassen Sie **Razor** als Ansichts-Engine.</span><span class="sxs-lookup"><span data-stu-id="d04a6-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Internet Anwendung auswählen](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="d04a6-131">Aktivieren eines Anbieters</span><span class="sxs-lookup"><span data-stu-id="d04a6-131">Enable a provider</span></span>

<span data-ttu-id="d04a6-132">Wenn Sie eine MVC 4-Webanwendung mit der Internet Anwendungs Vorlage erstellen, wird das Projekt mit einer Datei namens AuthConfig.cs im Ordner App\_Start erstellt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![AuthConfig-Datei](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="d04a6-134">Die AuthConfig-Datei enthält Code zum Registrieren von Clients für externe Authentifizierungs Anbieter.</span><span class="sxs-lookup"><span data-stu-id="d04a6-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="d04a6-135">Standardmäßig ist dieser Code auskommentiert, sodass keiner der externen Anbieter aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="d04a6-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="d04a6-136">Sie müssen die Auskommentierung dieses Codes aufheben, um den externen Authentifizierungs Client zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="d04a6-137">Entfernen Sie nur die Anbieter, die Sie in Ihre Website einschließen möchten.</span><span class="sxs-lookup"><span data-stu-id="d04a6-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="d04a6-138">Für dieses Tutorial aktivieren Sie nur die Facebook-Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="d04a6-139">Beachten Sie im obigen Beispiel, dass die-Methode leere Zeichen folgen für die Registrierungs Parameter enthält.</span><span class="sxs-lookup"><span data-stu-id="d04a6-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="d04a6-140">Wenn Sie versuchen, die Anwendung jetzt auszuführen, löst die Anwendung eine Argument Ausnahme aus, da leere Zeichen folgen für die Parameter nicht zulässig sind.</span><span class="sxs-lookup"><span data-stu-id="d04a6-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="d04a6-141">Um gültige Werte anzugeben, müssen Sie die Website bei den externen Anbietern registrieren, wie im nächsten Abschnitt gezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="d04a6-142">Registrieren bei einem externen Anbieter</span><span class="sxs-lookup"><span data-stu-id="d04a6-142">Registering with an external provider</span></span>

<span data-ttu-id="d04a6-143">Um Benutzer mit Anmelde Informationen eines externen Anbieters zu authentifizieren, müssen Sie die Website beim Anbieter registrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="d04a6-144">Wenn Sie Ihre Website registrieren, erhalten Sie die Parameter (z. b. Schlüssel oder ID und geheimer Schlüssel), die beim Registrieren des Clients eingeschlossen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="d04a6-145">Sie müssen über ein Konto mit den Anbietern verfügen, die Sie verwenden möchten.</span><span class="sxs-lookup"><span data-stu-id="d04a6-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="d04a6-146">In diesem Tutorial werden nicht alle Schritte erläutert, die Sie ausführen müssen, um sich bei diesen Anbietern zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="d04a6-147">Die Schritte sind in der Regel nicht schwierig.</span><span class="sxs-lookup"><span data-stu-id="d04a6-147">The steps are typically not difficult.</span></span> <span data-ttu-id="d04a6-148">Befolgen Sie die Anweisungen auf diesen Standorten, um Ihre Website erfolgreich zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="d04a6-149">Informationen zu den ersten Schritten beim Registrieren Ihrer Website finden Sie auf der Entwickler Website für:</span><span class="sxs-lookup"><span data-stu-id="d04a6-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="d04a6-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="d04a6-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="d04a6-151">Google</span><span class="sxs-lookup"><span data-stu-id="d04a6-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="d04a6-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="d04a6-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="d04a6-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="d04a6-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="d04a6-154">Wenn Sie Ihre Website bei Facebook registrieren, können Sie &quot;localhost-&quot; für die Website Domäne bereitstellen und für die URL `&quot; http://localhost/&quot;`, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="d04a6-155">Die Verwendung von localhost funktioniert mit den meisten Anbietern, funktioniert aber zurzeit nicht mit dem Microsoft-Anbieter.</span><span class="sxs-lookup"><span data-stu-id="d04a6-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="d04a6-156">Für den Microsoft-Anbieter müssen Sie eine gültige URL für die Website einschließen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![Website registrieren](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="d04a6-158">In der vorherigen Abbildung wurden die Werte für die APP-ID, den geheimen Schlüssel der APP und die Kontakt-e-Mail entfernt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="d04a6-159">Wenn Sie Ihre Website tatsächlich registrieren, werden diese Werte angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="d04a6-160">Sie sollten die Werte für die APP-ID und den geheimen App-Schlüssel notieren, da Sie Sie der Anwendung hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="d04a6-161">Erstellen von Test Benutzern</span><span class="sxs-lookup"><span data-stu-id="d04a6-161">Creating test users</span></span>

<span data-ttu-id="d04a6-162">Wenn Sie kein vorhandenes Facebook-Konto zum Testen Ihrer Website verwenden, können Sie diesen Abschnitt überspringen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="d04a6-163">Auf der Seite für die Verwaltung von Facebook-Apps können Sie problemlos Test Benutzer für Ihre Anwendung erstellen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="d04a6-164">Sie können diese Testkonten verwenden, um sich bei Ihrer Website anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="d04a6-165">Sie erstellen Test Benutzer, indem Sie im linken Navigationsbereich auf den Link **Rollen** und dann auf den Link **Erstellen** klicken.</span><span class="sxs-lookup"><span data-stu-id="d04a6-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![Test Benutzer erstellen](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="d04a6-167">Auf der Facebook-Website wird die Anzahl der von Ihnen angeforderten Testkonten automatisch erstellt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="d04a6-168">Hinzufügen von Anwendungs-ID und geheimer Schlüssel vom Anbieter</span><span class="sxs-lookup"><span data-stu-id="d04a6-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="d04a6-169">Nachdem Sie die ID und den geheimen Schlüssel von Facebook erhalten haben, wechseln Sie zurück zur AuthConfig-Datei, und fügen Sie Sie als Parameterwerte hinzu.</span><span class="sxs-lookup"><span data-stu-id="d04a6-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="d04a6-170">Die unten gezeigten Werte sind keine echten Werte.</span><span class="sxs-lookup"><span data-stu-id="d04a6-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="d04a6-171">Mit externen Anmelde Informationen anmelden</span><span class="sxs-lookup"><span data-stu-id="d04a6-171">Log in with external credentials</span></span>

<span data-ttu-id="d04a6-172">Das ist alles, was Sie tun müssen, um externe Anmelde Informationen auf Ihrer Website zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="d04a6-173">Führen Sie die Anwendung aus, und klicken Sie auf den Anmeldelink in der oberen rechten Ecke.</span><span class="sxs-lookup"><span data-stu-id="d04a6-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="d04a6-174">Die Vorlage erkennt automatisch, dass Sie Facebook als Anbieter registriert haben, und schließt eine Schaltfläche für den Anbieter ein.</span><span class="sxs-lookup"><span data-stu-id="d04a6-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="d04a6-175">Wenn Sie mehrere Anbieter registrieren, wird automatisch eine Schaltfläche eingefügt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![externer Anmelde Name](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="d04a6-177">In diesem Tutorial wird nicht erläutert, wie die Anmelde Schaltflächen für die externen Anbieter angepasst werden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="d04a6-178">Diese Informationen finden Sie unter [Anpassen der Anmelde Benutzeroberfläche bei Verwendung von OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="d04a6-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="d04a6-179">Klicken Sie auf die Facebook-Schaltfläche, um sich mit Facebook-Anmelde Informationen anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="d04a6-180">Wenn Sie einen der externen Anbieter auswählen, werden Sie zu dieser Site umgeleitet und von diesem Dienst aufgefordert, sich anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="d04a6-181">Die folgende Abbildung zeigt den Anmeldebildschirm für Facebook.</span><span class="sxs-lookup"><span data-stu-id="d04a6-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="d04a6-182">Sie werden feststellen, dass Sie Ihr Facebook-Konto verwenden, um sich bei einer Website mit dem Namen oauthmvcexample anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![Facebook-Authentifizierung](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="d04a6-184">Nach der Anmeldung mit Facebook-Anmelde Informationen wird der Benutzer auf einer Seite informiert, dass die Website Zugriff auf grundlegende Informationen hat.</span><span class="sxs-lookup"><span data-stu-id="d04a6-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![Berechtigung anfordern](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="d04a6-186">Nachdem Sie die Option **Gehe zu app**ausgewählt haben, muss sich der Benutzer für die Website registrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="d04a6-187">Die folgende Abbildung zeigt die Registrierungsseite, nachdem sich ein Benutzer mit Facebook-Anmelde Informationen angemeldet hat.</span><span class="sxs-lookup"><span data-stu-id="d04a6-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="d04a6-188">Der Benutzername ist in der Regel mit dem Namen des Anbieters vorab ausgefüllt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-188">The user name is typically pre-filled with a name from the provider.</span></span>

![Registrieren](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="d04a6-190">Klicken Sie auf **registrieren** , um die Registrierung abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="d04a6-191">Schließen Sie den Browser.</span><span class="sxs-lookup"><span data-stu-id="d04a6-191">Close the browser.</span></span>

<span data-ttu-id="d04a6-192">Sie können sehen, dass das neue Konto der Datenbank hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="d04a6-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="d04a6-193">Öffnen Sie in Server-Explorer die Datenbank **DefaultConnection** , und öffnen Sie den Ordner **Tabellen** .</span><span class="sxs-lookup"><span data-stu-id="d04a6-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![Datenbanktabellen](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="d04a6-195">Klicken Sie mit der rechten Maustaste auf die Tabelle **UserProfile** , und wählen Sie **Tabellendaten anzeigen**.</span><span class="sxs-lookup"><span data-stu-id="d04a6-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![Daten anzeigen](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="d04a6-197">Das neue Konto, das Sie hinzugefügt haben, wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-197">You will see the new account you added.</span></span> <span data-ttu-id="d04a6-198">Sehen Sie sich die Daten auf der **Webseite\_oauthmembership** -Tabelle an.</span><span class="sxs-lookup"><span data-stu-id="d04a6-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="d04a6-199">Es werden weitere Daten im Zusammenhang mit dem externen Anbieter für das soeben hinzugefügte Konto angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="d04a6-200">Wenn Sie nur die externe Authentifizierung aktivieren möchten, sind Sie damit abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="d04a6-201">Sie können jedoch weitere Informationen vom Anbieter in den neuen Benutzer Registrierungsprozess integrieren, wie in den folgenden Abschnitten dargestellt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="d04a6-202">Erstellen von Modellen für weitere Benutzerinformationen</span><span class="sxs-lookup"><span data-stu-id="d04a6-202">Create models for additional user information</span></span>

<span data-ttu-id="d04a6-203">Wie Sie in den vorherigen Abschnitten bemerkt haben, müssen Sie keine zusätzlichen Informationen abrufen, damit die integrierte Kontoregistrierung funktioniert.</span><span class="sxs-lookup"><span data-stu-id="d04a6-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="d04a6-204">Bei den meisten externen Anbietern werden jedoch zusätzliche Informationen über den Benutzer zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d04a6-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="d04a6-205">In den folgenden Abschnitten wird gezeigt, wie Sie diese Informationen beibehalten und in einer-Datenbank speichern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="d04a6-206">Insbesondere behalten Sie Werte für den vollständigen Namen des Benutzers, den URI der persönlichen Webseite des Benutzers und einen Wert, der angibt, ob Facebook das Konto überprüft hat.</span><span class="sxs-lookup"><span data-stu-id="d04a6-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="d04a6-207">Sie verwenden [Code First-Migrationen](https://msdn.microsoft.com/data/jj591621) , um eine Tabelle zum Speichern zusätzlicher Benutzerinformationen hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="d04a6-208">Wenn Sie die Tabelle einer vorhandenen Datenbank hinzufügen, müssen Sie zunächst eine Momentaufnahme der aktuellen Datenbank erstellen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="d04a6-209">Wenn Sie eine Momentaufnahme der aktuellen Datenbank erstellen, können Sie später eine Migration erstellen, die nur die neue Tabelle enthält.</span><span class="sxs-lookup"><span data-stu-id="d04a6-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="d04a6-210">So erstellen Sie eine Momentaufnahme der aktuellen Datenbank:</span><span class="sxs-lookup"><span data-stu-id="d04a6-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="d04a6-211">Öffnen der **Paket-Manager-Konsole**</span><span class="sxs-lookup"><span data-stu-id="d04a6-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="d04a6-212">Führen Sie den Befehl **enable-Migrationen** aus.</span><span class="sxs-lookup"><span data-stu-id="d04a6-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="d04a6-213">Führen Sie den Befehl **Add-Migration Initial – ignorechanges** aus.</span><span class="sxs-lookup"><span data-stu-id="d04a6-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="d04a6-214">Ausführen des Befehls " **Update-Database** "</span><span class="sxs-lookup"><span data-stu-id="d04a6-214">Run the command **update-database**</span></span>

<span data-ttu-id="d04a6-215">Nun fügen Sie die neuen Eigenschaften hinzu.</span><span class="sxs-lookup"><span data-stu-id="d04a6-215">Now, you will add the new properties.</span></span> <span data-ttu-id="d04a6-216">Öffnen Sie im Ordner Models die Datei AccountModels.cs, und suchen Sie die registerexternzumodel-Klasse.</span><span class="sxs-lookup"><span data-stu-id="d04a6-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="d04a6-217">Die registerexternzuweisung Model-Klasse enthält Werte, die vom Authentifizierungs Anbieter zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="d04a6-218">Fügen Sie die Eigenschaften "FullName" und "Link" wie unten gezeigt hinzu.</span><span class="sxs-lookup"><span data-stu-id="d04a6-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="d04a6-219">Fügen Sie außerdem in AccountModels.cs eine neue Klasse mit dem Namen extrauserinformation hinzu.</span><span class="sxs-lookup"><span data-stu-id="d04a6-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="d04a6-220">Diese Klasse stellt die neue Tabelle dar, die in der Datenbank erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="d04a6-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="d04a6-221">Fügen Sie in der userscontext-Klasse den unten markierten Code hinzu, um eine dbset-Eigenschaft für die neue Klasse zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="d04a6-222">Nun können Sie die neue Tabelle erstellen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-222">You are now ready to create the new table.</span></span> <span data-ttu-id="d04a6-223">Öffnen Sie die Paket-Manager-Konsole erneut und dieses Mal:</span><span class="sxs-lookup"><span data-stu-id="d04a6-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="d04a6-224">Führen Sie den Befehl **Add-Migration addextrauserinformation** aus.</span><span class="sxs-lookup"><span data-stu-id="d04a6-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="d04a6-225">Ausführen des Befehls " **Update-Database** "</span><span class="sxs-lookup"><span data-stu-id="d04a6-225">Run the command **update-database**</span></span>

<span data-ttu-id="d04a6-226">Die neue Tabelle ist jetzt in der Datenbank vorhanden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="d04a6-227">Abrufen der zusätzlichen Daten</span><span class="sxs-lookup"><span data-stu-id="d04a6-227">Retrieve the additional data</span></span>

<span data-ttu-id="d04a6-228">Es gibt zwei Möglichkeiten, zusätzliche Benutzerdaten abzurufen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="d04a6-229">Die erste Möglichkeit besteht darin, Benutzerdaten beizubehalten, die während der Authentifizierungsanforderung standardmäßig zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="d04a6-230">Die zweite Möglichkeit besteht darin, die Anbieter-API speziell aufzurufen und weitere Informationen anzufordern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="d04a6-231">Werte für FullName und Link werden automatisch von Facebook zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d04a6-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="d04a6-232">Ein Wert, der angibt, ob Facebook überprüft hat, ob das Konto durch einen-Rückruf der Facebook-API abgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="d04a6-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="d04a6-233">Zuerst werden Werte für FullName und Link aufgefüllt, und später wird der überprüfte Wert angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="d04a6-234">Öffnen Sie die Datei **AccountController.cs** im Ordner **Controllers** , um die zusätzlichen Benutzerdaten abzurufen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="d04a6-235">Diese Datei enthält die Logik zum Protokollieren, registrieren und Verwalten von Konten.</span><span class="sxs-lookup"><span data-stu-id="d04a6-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="d04a6-236">Beachten Sie insbesondere die Methoden **externzurückruf** und **externzugbestätigung**.</span><span class="sxs-lookup"><span data-stu-id="d04a6-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="d04a6-237">Innerhalb dieser Methoden können Sie Code hinzufügen, um externe Anmeldevorgänge für Ihre Anwendung anzupassen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="d04a6-238">Die erste Zeile der **externzucallback** -Methode enthält Folgendes:</span><span class="sxs-lookup"><span data-stu-id="d04a6-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="d04a6-239">Zusätzliche Benutzerdaten werden in der **ExtraData** -Eigenschaft des **authenticationresult** -Objekts zurückgegeben, das von der **verifyauthentication** -Methode zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="d04a6-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="d04a6-240">Der Facebook-Client enthält die folgenden Werte in der **ExtraData** -Eigenschaft:</span><span class="sxs-lookup"><span data-stu-id="d04a6-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="d04a6-241">ID</span><span class="sxs-lookup"><span data-stu-id="d04a6-241">id</span></span>
- <span data-ttu-id="d04a6-242">name</span><span class="sxs-lookup"><span data-stu-id="d04a6-242">name</span></span>
- <span data-ttu-id="d04a6-243">link</span><span class="sxs-lookup"><span data-stu-id="d04a6-243">link</span></span>
- <span data-ttu-id="d04a6-244">gender</span><span class="sxs-lookup"><span data-stu-id="d04a6-244">gender</span></span>
- <span data-ttu-id="d04a6-245">Access Token</span><span class="sxs-lookup"><span data-stu-id="d04a6-245">accesstoken</span></span>

<span data-ttu-id="d04a6-246">Andere Anbieter weisen ähnliche, aber etwas andere Daten in der ExtraData-Eigenschaft auf.</span><span class="sxs-lookup"><span data-stu-id="d04a6-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="d04a6-247">Wenn der Benutzer mit der Website neu ist, rufen Sie einige zusätzliche Daten ab, und übergeben Sie diese Daten an die Bestätigungs Ansicht.</span><span class="sxs-lookup"><span data-stu-id="d04a6-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="d04a6-248">Der letzte Codeblock in der-Methode wird nur ausgeführt, wenn der Benutzer mit der Website neu ist.</span><span class="sxs-lookup"><span data-stu-id="d04a6-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="d04a6-249">Ersetzen Sie die folgende Zeile:</span><span class="sxs-lookup"><span data-stu-id="d04a6-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="d04a6-250">Durch diese Zeile:</span><span class="sxs-lookup"><span data-stu-id="d04a6-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="d04a6-251">Diese Änderung schließt nur Werte für die Eigenschaften FullName und Link ein.</span><span class="sxs-lookup"><span data-stu-id="d04a6-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="d04a6-252">Ändern Sie in der Methode **externdepginconfirmation** den Code wie unten gezeigt, um die zusätzlichen Benutzerinformationen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="d04a6-253">Anpassen der Ansicht</span><span class="sxs-lookup"><span data-stu-id="d04a6-253">Adjusting the view</span></span>

<span data-ttu-id="d04a6-254">Die zusätzlichen Benutzerdaten, die Sie vom Anbieter abrufen, werden auf der Registrierungsseite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="d04a6-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="d04a6-255">Öffnen Sie im Ordner **views**/**Account** den Ordner **externzuweisungen Confirmation. cshtml**.</span><span class="sxs-lookup"><span data-stu-id="d04a6-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="d04a6-256">Fügen Sie unter dem vorhandenen Feld für Benutzername Felder für FullName, Link und PictureLink hinzu.</span><span class="sxs-lookup"><span data-stu-id="d04a6-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="d04a6-257">Sie sind jetzt fast bereit, die Anwendung auszuführen und einen neuen Benutzer mit den zusätzlich gespeicherten Informationen zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="d04a6-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="d04a6-258">Sie müssen über ein Konto verfügen, das nicht bereits bei dem Standort registriert ist.</span><span class="sxs-lookup"><span data-stu-id="d04a6-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="d04a6-259">Sie können entweder ein anderes Testkonto verwenden oder die Zeilen in den Tabellen " **UserProfile** " und " **Webseiten"\_"oauthmembership** " für das Konto, das Sie wieder verwenden möchten, löschen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="d04a6-260">Wenn Sie diese Zeilen löschen, stellen Sie sicher, dass das Konto erneut registriert wird.</span><span class="sxs-lookup"><span data-stu-id="d04a6-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="d04a6-261">Führen Sie die Anwendung aus, und registrieren Sie den neuen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="d04a6-261">Run the application and register the new user.</span></span> <span data-ttu-id="d04a6-262">Beachten Sie, dass die Bestätigungsseite dieses Mal mehr Werte enthält.</span><span class="sxs-lookup"><span data-stu-id="d04a6-262">Notice that this time the confirmation page contains more values.</span></span>

![Registrieren](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="d04a6-264">Nachdem Sie die Registrierung abgeschlossen haben, schließen Sie den Browser.</span><span class="sxs-lookup"><span data-stu-id="d04a6-264">After completing registration, close the browser.</span></span> <span data-ttu-id="d04a6-265">Suchen Sie in der Datenbank nach den neuen Werten in der Tabelle **extrauserinformation** .</span><span class="sxs-lookup"><span data-stu-id="d04a6-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="d04a6-266">Installieren des nuget-Pakets für die Facebook-API</span><span class="sxs-lookup"><span data-stu-id="d04a6-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="d04a6-267">Facebook stellt eine [API](https://developers.facebook.com/docs/reference/apis/) zur Verfügung, die Sie zum Ausführen von Vorgängen aufzurufen können.</span><span class="sxs-lookup"><span data-stu-id="d04a6-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="d04a6-268">Sie können die Facebook-API aufrufen, indem Sie das Senden von HTTP-Anforderungen oder das Installieren eines nuget-Pakets, das das Senden dieser Anforderungen erleichtert, verwenden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="d04a6-269">Das Verwenden eines nuget-Pakets wird in diesem Tutorial gezeigt, aber das Installieren des nuget-Pakets ist nicht zwingend erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d04a6-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="d04a6-270">In diesem Tutorial wird gezeigt, wie das C# Facebook SDK-Paket verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="d04a6-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="d04a6-271">Es gibt andere nuget-Pakete, die beim Aufrufen der Facebook-API hilfreich sind.</span><span class="sxs-lookup"><span data-stu-id="d04a6-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="d04a6-272">Wählen Sie im Fenster **nuget-Pakete verwalten** das Facebook C# SDK-Paket aus.</span><span class="sxs-lookup"><span data-stu-id="d04a6-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![Paket installieren](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="d04a6-274">Sie verwenden das Facebook C# -SDK zum Aufrufen eines Vorgangs, der das Zugriffs Token für den Benutzer erfordert.</span><span class="sxs-lookup"><span data-stu-id="d04a6-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="d04a6-275">Im nächsten Abschnitt wird gezeigt, wie Sie das Zugriffs Token abrufen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="d04a6-276">Zugriffs Token abrufen</span><span class="sxs-lookup"><span data-stu-id="d04a6-276">Retrieve access token</span></span>

<span data-ttu-id="d04a6-277">Die meisten externen Anbieter geben ein Zugriffs Token zurück, nachdem die Anmelde Informationen des Benutzers überprüft wurden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="d04a6-278">Dieses Zugriffs Token ist sehr wichtig, da es Ihnen ermöglicht, Vorgänge aufzurufen, die nur für authentifizierte Benutzer verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="d04a6-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="d04a6-279">Daher ist es erforderlich, das Zugriffs Token abzurufen und zu speichern, wenn Sie mehr Funktionalität bereitstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="d04a6-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="d04a6-280">Abhängig vom externen Anbieter ist das Zugriffs Token möglicherweise nur für einen begrenzten Zeitraum gültig.</span><span class="sxs-lookup"><span data-stu-id="d04a6-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="d04a6-281">Um sicherzustellen, dass Sie über ein gültiges Zugriffs Token verfügen, rufen Sie es jedes Mal ab, wenn sich der Benutzer anmeldet, und speichern Sie es als Sitzungs Wert, anstatt es in einer Datenbank zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="d04a6-282">In der **externzurückcallback** -Methode wird das Zugriffs Token auch in der **ExtraData** -Eigenschaft des **authenticationresult** -Objekts zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d04a6-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="d04a6-283">Fügen Sie den hervorgehobenen Code **externzurückcallback** hinzu, um das Zugriffs Token im **Sitzungs** Objekt zu speichern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="d04a6-284">Dieser Code wird jedes Mal ausgeführt, wenn sich der Benutzer mit einem Facebook-Konto anmeldet.</span><span class="sxs-lookup"><span data-stu-id="d04a6-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="d04a6-285">Obwohl in diesem Beispiel ein Zugriffs Token von Facebook abgerufen wird, können Sie das Zugriffs Token von einem beliebigen externen Anbieter über denselben Schlüssel mit dem Namen &quot;Access Token&quot;abrufen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="d04a6-286">Abmelden</span><span class="sxs-lookup"><span data-stu-id="d04a6-286">Logging off</span></span>

<span data-ttu-id="d04a6-287">Mit der **Standardmethode** für die Abmeldung wird der Benutzer von der Anwendung abgemeldet, der Benutzer wird jedoch nicht vom externen Anbieter protokolliert.</span><span class="sxs-lookup"><span data-stu-id="d04a6-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="d04a6-288">Um den Benutzer von Facebook zu protokollieren und zu verhindern, dass das Token beibehalten wird, nachdem sich der Benutzer abgemeldet hat, können Sie den folgenden hervorgehobenen Code der **Logoff** -Methode in AccountController hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="d04a6-289">Der Wert, den Sie im `next`-Parameter angeben, ist die URL, die verwendet werden soll, nachdem sich der Benutzer von Facebook abgemeldet hat.</span><span class="sxs-lookup"><span data-stu-id="d04a6-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="d04a6-290">Wenn Sie auf dem lokalen Computer testen, geben Sie die richtige Portnummer für den lokalen Standort ein.</span><span class="sxs-lookup"><span data-stu-id="d04a6-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="d04a6-291">In der Produktionsumgebung geben Sie eine Standardseite an, z. b. contoso.com.</span><span class="sxs-lookup"><span data-stu-id="d04a6-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="d04a6-292">Abrufen von Benutzerinformationen, für die das Zugriffs Token erforderlich ist</span><span class="sxs-lookup"><span data-stu-id="d04a6-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="d04a6-293">Nachdem Sie nun das Zugriffs Token gespeichert und das Facebook C# SDK-Paket installiert haben, können Sie diese kombinieren, um weitere Benutzerinformationen von Facebook anzufordern.</span><span class="sxs-lookup"><span data-stu-id="d04a6-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="d04a6-294">Erstellen Sie in der **externzuzubestätigungs** -Methode eine Instanz der **facebookclient** -Klasse, indem Sie den Wert des Zugriffs Tokens übergeben.</span><span class="sxs-lookup"><span data-stu-id="d04a6-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="d04a6-295">Fordert den Wert der **verifizierten** Eigenschaft für den aktuellen authentifizierten Benutzer an.</span><span class="sxs-lookup"><span data-stu-id="d04a6-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="d04a6-296">Mit der **verifizierten** Eigenschaft wird angegeben, ob Facebook das Konto auf andere Weise überprüft hat, z. b. das Senden einer Nachricht an ein Mobiltelefon.</span><span class="sxs-lookup"><span data-stu-id="d04a6-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="d04a6-297">Speichern Sie diesen Wert in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="d04a6-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="d04a6-298">Sie müssen die Datensätze in der Datenbank für den Benutzer entweder löschen oder ein anderes Facebook-Konto verwenden.</span><span class="sxs-lookup"><span data-stu-id="d04a6-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="d04a6-299">Führen Sie die Anwendung aus, und registrieren Sie den neuen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="d04a6-299">Run the application, and register the new user.</span></span> <span data-ttu-id="d04a6-300">Sehen Sie sich die Tabelle **extrauserinformation** an, um den Wert für die überprüfte Eigenschaft anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="d04a6-301">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="d04a6-301">Conclusion</span></span>

<span data-ttu-id="d04a6-302">In diesem Tutorial haben Sie eine Website erstellt, die für Benutzerauthentifizierung und Registrierungsdaten in Facebook integriert ist.</span><span class="sxs-lookup"><span data-stu-id="d04a6-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="d04a6-303">Sie haben das Standardverhalten kennengelernt, das für die MVC 4-Webanwendung eingerichtet ist, und wie Sie dieses Standardverhalten anpassen.</span><span class="sxs-lookup"><span data-stu-id="d04a6-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d04a6-304">Verwandte Themen</span><span class="sxs-lookup"><span data-stu-id="d04a6-304">Related topics</span></span>

- [<span data-ttu-id="d04a6-305">Erstellen einer ASP.NET MVC-App mit Authentifizierung, SQL-Datenbank und Bereitstellung in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="d04a6-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
