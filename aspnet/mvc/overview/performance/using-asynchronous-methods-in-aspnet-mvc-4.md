---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: Verwenden von asynchronen Methoden in ASP.NET MVC 4 | Microsoft-Dokumentation
author: Rick-Anderson
description: Dieses Tutorial vermittelt Ihnen die Grundlagen der Entwicklung einer asynchronen ASP.NET MVC-Webanwendung mithilfe von Visual Studio Express 2012 für das Web.
ms.author: riande
ms.date: 06/06/2012
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 15692b18fc112c4c6cce4d50a243a0e8d5fb52a4
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78432885"
---
# <a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="a6e70-103">Verwenden asynchroner Methoden in ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="a6e70-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>

<span data-ttu-id="a6e70-104">von [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="a6e70-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="a6e70-105">Dieses Tutorial vermittelt Ihnen die Grundlagen der Entwicklung einer asynchronen ASP.NET MVC-Webanwendung mithilfe von [Visual Studio Express 2012 für das Web](https://www.microsoft.com/visualstudio/11), eine kostenlose Version von Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a6e70-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="a6e70-106">Sie können auch [Visual Studio 2012](https://www.microsoft.com/visualstudio/11)verwenden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="a6e70-107">Ein umfassendes Beispiel für dieses Tutorial finden Sie auf GitHub [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="a6e70-107">A complete sample is provided for this tutorial on github [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>

<span data-ttu-id="a6e70-108">Mit der ASP.NET MVC 4- [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) Klasse in Kombination von [.NET 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) können Sie asynchrone Aktionsmethoden schreiben, die ein Objekt des Typs [Task&lt;Action result&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx)zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="a6e70-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="a6e70-109">In .NET Framework 4 wurde ein asynchrones Programmier Konzept eingeführt, das als [Aufgabe](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) bezeichnet wird, und ASP.NET MVC 4 unterstützt [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6e70-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="a6e70-110">Tasks werden durch den **Tasktyp und** verwandte Typen im [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) -Namespace dargestellt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="a6e70-111">Der .NET Framework 4,5 baut auf dieser asynchronen Unterstützung mit den Schlüsselwörtern " [Erwartung](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) " und " [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) " auf, die das Arbeiten mit [Aufgaben](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) Objekten wesentlich weniger komplex machen als vorherige asynchrone Ansätze.</span><span class="sxs-lookup"><span data-stu-id="a6e70-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="a6e70-112">Das [Wait](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) -Schlüsselwort ist syntaktische Kurzwort, um anzugeben, dass ein Code Element asynchron auf einen anderen Code Abschnitt warten soll.</span><span class="sxs-lookup"><span data-stu-id="a6e70-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="a6e70-113">Das [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) -Schlüsselwort stellt einen Hinweis dar, den Sie verwenden können, um Methoden als aufgabenbasierte asynchrone Methoden zu markieren.</span><span class="sxs-lookup"><span data-stu-id="a6e70-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="a6e70-114">Die Kombination aus " **warten**", " **Async**" und " **Task** " erleichtert Ihnen das Schreiben von asynchronem Code in .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="a6e70-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="a6e70-115">Das neue Modell für asynchrone Methoden wird als *Task basiertes asynchrones Muster* (**Tap**) bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="a6e70-116">In diesem Tutorial wird davon ausgegangen, dass Sie mit der asynchronen Programmierung mit den Schlüsselwörtern " [Erwartung](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) " und " [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) " und dem [Aufgaben](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) Namespace vertraut sind</span><span class="sxs-lookup"><span data-stu-id="a6e70-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="a6e70-117">Weitere Informationen [zum Verwenden der](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) Schlüsselwörter "References" und " [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) " und des [Aufgaben](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) Namespace finden Sie in den folgenden verweisen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="a6e70-118">Whitepaper: Asynchronität in .net</span><span class="sxs-lookup"><span data-stu-id="a6e70-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="a6e70-119">Häufig gestellte Fragen zu Async/warten</span><span class="sxs-lookup"><span data-stu-id="a6e70-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="a6e70-120">Asynchrone Programmierung in Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a6e70-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="a6e70-121">Verarbeitung von Anforderungen durch den Thread Pool</span><span class="sxs-lookup"><span data-stu-id="a6e70-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="a6e70-122">Auf dem Webserver verwaltet das .NET Framework einen Thread Pool, der zum Service ASP.NET-Anforderungen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="a6e70-123">Wenn eine Anforderung eingeht, wird ein Thread aus dem Pool verteilt, um diese Anforderung zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a6e70-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="a6e70-124">Wenn die Anforderung synchron verarbeitet wird, ist der Thread, der die Anforderung verarbeitet, ausgelastet, während die Anforderung verarbeitet wird, und dieser Thread kann keine andere Anforderung verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a6e70-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="a6e70-125">Dies stellt möglicherweise kein Problem dar, da der Thread Pool groß genug gemacht werden kann, um viele ausgelastete Threads aufnehmen zu können.</span><span class="sxs-lookup"><span data-stu-id="a6e70-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="a6e70-126">Die Anzahl der Threads im Thread Pool ist jedoch begrenzt (der Standardwert für .NET 4,5 ist 5.000).</span><span class="sxs-lookup"><span data-stu-id="a6e70-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="a6e70-127">In großen Anwendungen mit hoher Parallelität von Anforderungen mit langer Ausführungszeit sind möglicherweise alle verfügbaren Threads ausgelastet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="a6e70-128">Diese Bedingung wird als Thread Hunger bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="a6e70-129">Wenn diese Bedingung erreicht wird, werden Anforderungen vom Webserver in die Warteschlange eingereiht.</span><span class="sxs-lookup"><span data-stu-id="a6e70-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="a6e70-130">Wenn die Anforderungs Warteschlange voll ist, lehnt der Webserver Anforderungen mit einem HTTP 503-Status (Server ist zu stark ausgelastet) ab.</span><span class="sxs-lookup"><span data-stu-id="a6e70-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="a6e70-131">Der CLR-Thread Pool weist Einschränkungen bei neuen Thread Spritzen auf.</span><span class="sxs-lookup"><span data-stu-id="a6e70-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="a6e70-132">Wenn die Parallelität burstig ist (d. h., Ihre Website kann plötzlich eine große Anzahl von Anforderungen erhalten), und alle verfügbaren Anforderungs Threads sind aufgrund von Back-End-aufrufen mit hoher Latenzzeit ausgelastet. die eingeschränkte Thread einschleusungs Rate kann dazu führen, dass Ihre Anwendung sehr schlecht reagiert.</span><span class="sxs-lookup"><span data-stu-id="a6e70-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="a6e70-133">Außerdem hat jeder neue dem Thread Pool hinzugefügte Thread mehr Aufwand (z. b. 1 MB Stapel Arbeitsspeicher).</span><span class="sxs-lookup"><span data-stu-id="a6e70-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="a6e70-134">Eine Webanwendung, die synchrone Methoden verwendet, um Aufrufe mit hoher Latenz zu verarbeiten, bei denen der Thread Pool auf den maximalen .NET 4,5-Standardwert von 5 000 Threads ansteigt, beansprucht ungefähr 5 GB mehr Arbeitsspeicher als eine Anwendung, die die gleichen Anforderungen verwendet. asynchrone Methoden und nur 50-Threads.</span><span class="sxs-lookup"><span data-stu-id="a6e70-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="a6e70-135">Wenn Sie asynchrone Aufgaben durcharbeiten, verwenden Sie nicht immer einen Thread.</span><span class="sxs-lookup"><span data-stu-id="a6e70-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="a6e70-136">Wenn Sie z. b. einen asynchronen webService Request erstellen, verwendet ASP.NET keine Threads zwischen dem asynchronen **Methoden** Aufrufvorgang und dem **warten**.</span><span class="sxs-lookup"><span data-stu-id="a6e70-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="a6e70-137">Die Verwendung des Thread Pools für den Einsatz von Anforderungen mit hoher Latenzzeit kann zu einem hohen Speicherbedarf und unzureichender Auslastung der Server Hardware führen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="a6e70-138">Verarbeiten von asynchronen Anforderungen</span><span class="sxs-lookup"><span data-stu-id="a6e70-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="a6e70-139">In einer Web-App, die eine große Anzahl gleichzeitiger Anforderungen beim Start erkennt oder eine bursty Load (bei der die Parallelität plötzlich zunimmt), erhöht sich die Reaktionsfähigkeit der app durch das Ausführen von Webdienst aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-139">In a web app that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous increases the responsiveness of the app.</span></span> <span data-ttu-id="a6e70-140">Die Verarbeitung einer asynchronen Anforderung dauert denselben Zeitraum wie eine synchrone Anforderung.</span><span class="sxs-lookup"><span data-stu-id="a6e70-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="a6e70-141">Wenn eine Anforderung einen Webdienst aufruft, der zwei Sekunden benötigt, dauert die Anforderung zwei Sekunden, unabhängig davon, ob Sie synchron oder asynchron ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-141">If a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it's performed synchronously or asynchronously.</span></span> <span data-ttu-id="a6e70-142">Während eines asynchronen Aufrufes wird jedoch verhindert, dass ein Thread auf andere Anforderungen antwortet, während er auf den Abschluss der ersten Anforderung wartet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-142">However during an asynchronous call, a thread isn't blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="a6e70-143">Daher verhindern asynchrone Anforderungen das Anforderungswarteschlangen-und Thread Pool Wachstum, wenn es viele gleichzeitige Anforderungen gibt, die Vorgänge mit langer Laufzeit aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="a6e70-144">Auswählen von synchronen oder asynchronen Aktionsmethoden</span><span class="sxs-lookup"><span data-stu-id="a6e70-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="a6e70-145">In diesem Abschnitt werden die Richtlinien für den Einsatz von synchronen oder asynchronen Aktionsmethoden aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="a6e70-146">Dies sind nur Richtlinien. untersuchen Sie jede Anwendung einzeln, um zu bestimmen, ob asynchrone Methoden die Leistung unterstützen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="a6e70-147">Verwenden Sie in der Regel synchrone Methoden für die folgenden Bedingungen:</span><span class="sxs-lookup"><span data-stu-id="a6e70-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="a6e70-148">Die Vorgänge sind einfach oder kurz ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="a6e70-149">Einfachheit ist wichtiger als die Effizienz.</span><span class="sxs-lookup"><span data-stu-id="a6e70-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="a6e70-150">Bei den Vorgängen handelt es sich hauptsächlich um CPU-Vorgänge anstelle von Vorgängen, die einen umfangreichen Datenträger</span><span class="sxs-lookup"><span data-stu-id="a6e70-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="a6e70-151">Die Verwendung von asynchronen Aktionsmethoden für CPU-gebundene Vorgänge bietet keine Vorteile und führt zu einem höheren Verwaltungsaufwand.</span><span class="sxs-lookup"><span data-stu-id="a6e70-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="a6e70-152">Im Allgemeinen verwenden Sie asynchrone Methoden für die folgenden Bedingungen:</span><span class="sxs-lookup"><span data-stu-id="a6e70-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="a6e70-153">Sie rufen Dienste auf, die durch asynchrone Methoden genutzt werden können, und Sie verwenden .NET 4,5 oder höher.</span><span class="sxs-lookup"><span data-stu-id="a6e70-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="a6e70-154">Die Vorgänge sind Netzwerk gebunden oder e/a-gebunden anstatt CPU-gebunden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="a6e70-155">Parallelität ist wichtiger als die Einfachheit des Codes.</span><span class="sxs-lookup"><span data-stu-id="a6e70-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="a6e70-156">Sie möchten einen Mechanismus bereitstellen, mit dem Benutzer eine Anforderung mit langer Ausführungszeit abbrechen können.</span><span class="sxs-lookup"><span data-stu-id="a6e70-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="a6e70-157">Wenn der Vorteil der Umstellung von Threads die Kosten des Kontext Schalters übersteigt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-157">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="a6e70-158">Im Allgemeinen sollten Sie eine Methode asynchron erstellen, wenn die synchrone Methode auf den ASP.net Request-Thread wartet, während keine Arbeit ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="a6e70-159">Durch die asynchrone Ausführung des Aufrufes wird der ASP.net-Anforderungs Thread nicht angehalten und funktioniert nicht mehr, während er auf den Abschluss des webService Request wartet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="a6e70-160">Das Testen zeigt, dass die blockierenden Vorgänge einen Engpass bei der Standort Leistung darstellen und dass IIS mehr Anforderungen mithilfe von asynchronen Methoden für diese blockierenden Aufrufe bedienen kann.</span><span class="sxs-lookup"><span data-stu-id="a6e70-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

<span data-ttu-id="a6e70-161">Das herunterladbare Beispiel zeigt, wie asynchrone Aktionsmethoden effektiv verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="a6e70-162">Das bereitgestellte Beispiel wurde entworfen, um eine einfache Demonstration der asynchronen Programmierung in ASP.NET MVC 4 mithilfe von .NET 4,5 zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="a6e70-163">Das Beispiel ist nicht als Referenzarchitektur für die asynchrone Programmierung in ASP.NET MVC gedacht.</span><span class="sxs-lookup"><span data-stu-id="a6e70-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="a6e70-164">Das Beispielprogramm ruft [ASP.net-Web-API](../../../web-api/index.md) Methoden auf, die wiederum [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) aufrufen, um lange Ausführungs-Webdienst Aufrufe zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="a6e70-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="a6e70-165">Die meisten Produktionsanwendungen zeigen diese offensichtlichen Vorteile für die Verwendung von asynchronen Aktionsmethoden nicht an.</span><span class="sxs-lookup"><span data-stu-id="a6e70-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="a6e70-166">Bei wenigen Anwendungen müssen alle Aktionsmethoden asynchron sein.</span><span class="sxs-lookup"><span data-stu-id="a6e70-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="a6e70-167">Häufig bietet die typverarbeitung einiger synchroner Aktionsmethoden in asynchrone Methoden die beste Effizienzsteigerung für die erforderliche Arbeitsmenge.</span><span class="sxs-lookup"><span data-stu-id="a6e70-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="a6e70-168">Die Beispielanwendung</span><span class="sxs-lookup"><span data-stu-id="a6e70-168">The Sample Application</span></span>

<span data-ttu-id="a6e70-169">Sie können die Beispielanwendung von [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) auf der [GitHub](https://github.com/) -Website herunterladen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="a6e70-170">Das Repository besteht aus drei Projekten:</span><span class="sxs-lookup"><span data-stu-id="a6e70-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="a6e70-171">*Mvc4Async*: das ASP.NET MVC 4-Projekt, das den in diesem Tutorial verwendeten Code enthält.</span><span class="sxs-lookup"><span data-stu-id="a6e70-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="a6e70-172">Es werden Web-API-Aufrufe an den **webapipgw** -Dienst durchführt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="a6e70-173">*Webapipgw*: das ASP.NET MVC 4-Web-API-Projekt, das die `Products, Gizmos and Widgets` Controller implementiert.</span><span class="sxs-lookup"><span data-stu-id="a6e70-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="a6e70-174">Es stellt die Daten für das *webappasync* -Projekt und das *Mvc4Async* -Projekt bereit.</span><span class="sxs-lookup"><span data-stu-id="a6e70-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="a6e70-175">*Webappasync*: das ASP.net-Web Forms Projekt, das in einem anderen Tutorial verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="a6e70-176">Die synchrone Gizmos-Aktionsmethode</span><span class="sxs-lookup"><span data-stu-id="a6e70-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="a6e70-177">Der folgende Code zeigt die `Gizmos` synchrone Aktionsmethode, die verwendet wird, um eine Liste von Gizmos anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="a6e70-178">(In diesem Artikel ist ein Gizmo ein fiktives mechanisches Gerät.)</span><span class="sxs-lookup"><span data-stu-id="a6e70-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="a6e70-179">Der folgende Code zeigt die `GetGizmos`-Methode des Gizmo-Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="a6e70-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="a6e70-180">Die `GizmoService GetGizmos`-Methode übergibt einen URI an einen ASP.net-Web-API HTTP-Dienst, der eine Liste der Gizmos-Daten zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="a6e70-181">Das *webapipgw* -Projekt enthält die Implementierung der Web-API-`gizmos, widget` und `product` Controller.</span><span class="sxs-lookup"><span data-stu-id="a6e70-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="a6e70-182">Die folgende Abbildung zeigt die Gizmos-Ansicht aus dem Beispiel Projekt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="a6e70-184">Erstellen einer asynchronen Gizmos-Aktionsmethode</span><span class="sxs-lookup"><span data-stu-id="a6e70-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="a6e70-185">Das Beispiel verwendet die [neuen Schlüsselwörter](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) und erwarnung (verfügbar in .NET 4,5 und Visual Studio 2012), damit der Compiler für die Verwaltung der komplizierten Transformationen verantwortlich ist, die für die asynchrone Programmierung erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="a6e70-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="a6e70-186">Der Compiler ermöglicht das Schreiben von Code mithilfe C#der synchronen Ablaufsteuerungskonstrukte, und der Compiler wendet automatisch die für die Verwendung von Rückrufen erforderlichen Transformationen an, um das Blockieren von Threads zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="a6e70-187">Der folgende Code zeigt die `Gizmos` synchrone-Methode und die `GizmosAsync` asynchrone-Methode.</span><span class="sxs-lookup"><span data-stu-id="a6e70-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="a6e70-188">Wenn Ihr Browser das [HTML 5-`<mark>` Element](http://www.w3.org/wiki/HTML/Elements/mark)unterstützt, werden die Änderungen in `GizmosAsync` gelb hervorgehoben angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="a6e70-189">Die folgenden Änderungen wurden angewendet, damit das `GizmosAsync` asynchron sein kann.</span><span class="sxs-lookup"><span data-stu-id="a6e70-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="a6e70-190">Die-Methode wird mit dem [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) -Schlüsselwort gekennzeichnet, das den Compiler anweist, Rückrufe für Teile des Texts zu generieren und automatisch eine `Task<ActionResult>` zu erstellen, die zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="a6e70-191">&quot;Async-&quot; wurde an den Methodennamen angehängt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="a6e70-192">Das Anfügen von "Async" ist nicht erforderlich, ist jedoch die Konvention beim Schreiben von asynchronen Methoden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="a6e70-193">Der Rückgabetyp wurde von `ActionResult` in `Task<ActionResult>`geändert.</span><span class="sxs-lookup"><span data-stu-id="a6e70-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="a6e70-194">Der Rückgabetyp von `Task<ActionResult>` stellt laufende Arbeit dar und stellt Aufrufern der Methode ein Handle zur Verfügung, über das auf den Abschluss des asynchronen Vorgangs gewartet werden soll.</span><span class="sxs-lookup"><span data-stu-id="a6e70-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="a6e70-195">In diesem Fall ist der Aufrufer der Webdienst.</span><span class="sxs-lookup"><span data-stu-id="a6e70-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="a6e70-196">`Task<ActionResult>` stellt laufende Arbeit mit dem Ergebnis `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="a6e70-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="a6e70-197">Das [Erwartungs Wort für den](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) Webdienst wurde angewendet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="a6e70-198">Die asynchrone Webdienst-API wurde (`GetGizmosAsync`) aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="a6e70-199">Innerhalb des `GetGizmosAsync` Methoden Texts eine andere asynchrone Methode, wird `GetGizmosAsync` aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="a6e70-200">`GetGizmosAsync` sofort eine `Task<List<Gizmo>>` zurück, die letztendlich beendet wird, wenn die Daten verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="a6e70-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="a6e70-201">Da Sie nichts anderes tun möchten, bis Sie über die Gizmo-Daten verfügen, erwartet der Code die Aufgabe (mit dem **Erwartungs Wort "** erwartungsgemäß").</span><span class="sxs-lookup"><span data-stu-id="a6e70-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="a6e70-202">Sie können das **warte** Zeit Schlüsselwort nur in Methoden verwenden, die mit dem **Async** -Schlüsselwort kommentiert werden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="a6e70-203">Mit dem **Erwartungs Wort wird der Thread** nicht blockiert, bis die Aufgabe beendet ist.</span><span class="sxs-lookup"><span data-stu-id="a6e70-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="a6e70-204">Er registriert den Rest der Methode als Rückruf für die Aufgabe und gibt sofort zurück.</span><span class="sxs-lookup"><span data-stu-id="a6e70-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="a6e70-205">Wenn die erwartete Aufgabe schließlich abgeschlossen ist, ruft Sie diesen Rückruf auf und setzt somit die Ausführung der Methode an der Stelle fort, an der Sie aufgehört hat.</span><span class="sxs-lookup"><span data-stu-id="a6e70-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="a6e70-206">Weitere Informationen zur Verwendung der Schlüsselwörter "References" und " [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) [" und des](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) [Aufgaben](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) Namespace finden Sie unter " [Async-Verweise](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async)".</span><span class="sxs-lookup"><span data-stu-id="a6e70-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="a6e70-207">Der folgende Code zeigt die `GetGizmos`- und `GetGizmosAsync`-Methoden:</span><span class="sxs-lookup"><span data-stu-id="a6e70-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="a6e70-208">Die asynchronen Änderungen ähneln den oben beschriebenen **gizmosasync** -Vorgängen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="a6e70-209">Die Methoden Signatur wurde mit dem [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) -Schlüsselwort versehen, der Rückgabetyp wurde in "`Task<List<Gizmo>>`" geändert, und " *Async* " wurde an den Methodennamen angehängt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="a6e70-210">Die asynchrone [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) -Klasse wird anstelle der [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) -Klasse verwendet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="a6e70-211">Das [Erwartungs Wort wurde auf die](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) asynchronen [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) -Methoden angewendet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="a6e70-212">Die folgende Abbildung zeigt die asynchrone Gizmo-Sicht.</span><span class="sxs-lookup"><span data-stu-id="a6e70-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="a6e70-214">Die Browser Darstellung der Gizmos-Daten ist mit der vom synchronen-Befehl erstellten Sicht identisch.</span><span class="sxs-lookup"><span data-stu-id="a6e70-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="a6e70-215">Der einzige Unterschied besteht darin, dass die asynchrone Version bei starker Auslastung möglicherweise leistungsfähiger ist.</span><span class="sxs-lookup"><span data-stu-id="a6e70-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a><span data-ttu-id="a6e70-216">Paralleles Ausführen mehrerer Vorgänge</span><span class="sxs-lookup"><span data-stu-id="a6e70-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="a6e70-217">Asynchrone Aktionsmethoden haben gegenüber synchronen Methoden einen erheblichen Vorteil, wenn eine Aktion mehrere unabhängige Vorgänge ausführen muss.</span><span class="sxs-lookup"><span data-stu-id="a6e70-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="a6e70-218">Im bereitgestellten Beispiel zeigt die synchrone Methode `PWG`(für Produkte, Widgets und Gizmos) die Ergebnisse von drei Webdienst aufrufen an, um eine Liste von Produkten, Widgets und Gizmos zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a6e70-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="a6e70-219">Das [ASP.net-Web-API](../../../web-api/index.md) Projekt, das diese Dienste bereitstellt, verwendet [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) zum Simulieren von Latenzzeiten oder langsamen Netzwerk aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="a6e70-220">Wenn die Verzögerung auf 500 Millisekunden festgelegt ist, dauert die Ausführung der asynchronen `PWGasync`-Methode etwas mehr als 500 Millisekunden, während die synchrone `PWG` Version mehr als 1.500 Millisekunden benötigt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="a6e70-221">Die synchrone `PWG`-Methode wird im folgenden Code dargestellt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="a6e70-222">Die asynchrone `PWGasync`-Methode wird im folgenden Code dargestellt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="a6e70-223">Die folgende Abbildung zeigt die Ansicht, die von der **pwgasync** -Methode zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="a6e70-225">Verwenden eines Abbruch Tokens</span><span class="sxs-lookup"><span data-stu-id="a6e70-225">Using a Cancellation Token</span></span>

<span data-ttu-id="a6e70-226">Asynchrone Aktionsmethoden, die `Task<ActionResult>`zurückgeben, können abgebrochen werden, d. h., Sie akzeptieren einen [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) -Parameter, wenn eine mit dem [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) -Attribut angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="a6e70-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="a6e70-227">Der folgende Code zeigt die `GizmosCancelAsync`-Methode mit einem Timeout von 150 Millisekunden.</span><span class="sxs-lookup"><span data-stu-id="a6e70-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="a6e70-228">Der folgende Code zeigt die getgizmosasync-Überladung, die einen [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) -Parameter annimmt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="a6e70-229">In der bereitgestellten Beispielanwendung wird durch Auswählen des Links zum *Abbruch Token-Demo* die `GizmosCancelAsync`-Methode aufgerufen und der Abbruch des asynchronen Aufrufs veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="a6e70-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancellation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="a6e70-230">Server Konfiguration für Webdienst Aufrufe mit hoher Parallelität/hoher Latenz</span><span class="sxs-lookup"><span data-stu-id="a6e70-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="a6e70-231">Um die Vorteile einer asynchronen Webanwendung zu nutzen, müssen Sie möglicherweise einige Änderungen an der Standard Serverkonfiguration vornehmen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="a6e70-232">Beachten Sie beim Konfigurieren von und Belastungstests für Ihre asynchrone Webanwendung Folgendes:</span><span class="sxs-lookup"><span data-stu-id="a6e70-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="a6e70-233">Windows 7, Windows Vista und alle Windows-Client Betriebssysteme haben maximal 10 gleichzeitige Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="a6e70-234">Sie benötigen ein Windows Server-Betriebssystem, um die Vorteile von asynchronen Methoden unter hoher Auslastung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="a6e70-235">Registrieren Sie .NET 4,5 bei IIS über eine Eingabeaufforderung mit erhöhten Rechten:</span><span class="sxs-lookup"><span data-stu-id="a6e70-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="a6e70-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis-i</span><span class="sxs-lookup"><span data-stu-id="a6e70-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="a6e70-237">Weitere Informationen finden Sie unter [ASP.NET IIS Registration Tool (ASPNET\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="a6e70-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="a6e70-238">Möglicherweise müssen Sie das Limit für die [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) -Warteschlange vom Standardwert 1.000 auf 5.000 erhöhen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="a6e70-239">Wenn die Einstellung zu niedrig ist, werden möglicherweise [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) -Anforderungen mit dem HTTP 503-Status abgelehnt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="a6e70-240">So ändern Sie das Warteschlangen Limit von http. sys:</span><span class="sxs-lookup"><span data-stu-id="a6e70-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="a6e70-241">Öffnen Sie den IIS-Manager, und navigieren Sie zum Bereich Anwendungs Pools.</span><span class="sxs-lookup"><span data-stu-id="a6e70-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="a6e70-242">Klicken Sie mit der rechten Maustaste auf den Ziel Anwendungs Pool, und wählen Sie **Erweiterte Einstellungen**.</span><span class="sxs-lookup"><span data-stu-id="a6e70-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="a6e70-243">Erweiterte](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png) ![</span><span class="sxs-lookup"><span data-stu-id="a6e70-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="a6e70-244">Ändern Sie im Dialogfeld **Erweiterte Einstellungen** die *Warteschlangen Länge* von 1.000 in 5.000.</span><span class="sxs-lookup"><span data-stu-id="a6e70-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="a6e70-245">![Warteschlangen Länge](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a6e70-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="a6e70-246">Beachten Sie in den obigen Abbildungen, dass .NET Framework als v 4.0 aufgeführt ist, auch wenn der Anwendungs Pool .NET 4,5 verwendet.</span><span class="sxs-lookup"><span data-stu-id="a6e70-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="a6e70-247">Informationen zu dieser Abweichung finden Sie in den folgenden Bereichen:</span><span class="sxs-lookup"><span data-stu-id="a6e70-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="a6e70-248">.Net-Versionsverwaltung und mehrere Ziel Versionen: .NET 4,5 ist ein direktes Upgrade auf .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="a6e70-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="a6e70-249">Festlegen einer IIS-Anwendung oder eines Anwendungs Pools für die Verwendung von ASP.NET 3,5 anstelle von 2,0</span><span class="sxs-lookup"><span data-stu-id="a6e70-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="a6e70-250">[.NET Framework-Versionen und -Abhängigkeiten](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="a6e70-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="a6e70-251">Wenn Ihre Anwendung Webdienste oder System.NET verwendet, um über HTTP mit einem Back-End zu kommunizieren, müssen Sie möglicherweise das [connectionManagement/maxConnection-](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) Element erhöhen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="a6e70-252">Bei ASP.NET-Anwendungen wird dies durch die Funktion "autoConfig" auf das 12-fache der Anzahl der CPUs beschränkt.</span><span class="sxs-lookup"><span data-stu-id="a6e70-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="a6e70-253">Dies bedeutet, dass Sie bei einer Quad-proc-Methode höchstens 12 \* 4 = 48 gleichzeitige Verbindungen mit einem IP-Endpunkt haben können.</span><span class="sxs-lookup"><span data-stu-id="a6e70-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="a6e70-254">Da diese an [AutoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx)gebunden ist, ist die einfachste Möglichkeit, `maxconnection` in einer ASP.NET-Anwendung zu erhöhen, [System .net. ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) in der from `Application_Start`-Methode in der Datei *Global. asax* Programm gesteuert festzulegen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="a6e70-255">Ein Beispiel finden Sie im Beispiel für das herunterladen.</span><span class="sxs-lookup"><span data-stu-id="a6e70-255">See the sample download for an example.</span></span>
- <span data-ttu-id="a6e70-256">In .NET 4,5 sollte der Standardwert 5000 für [maxconcurrentrequestspercpu](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) in Ordnung sein.</span><span class="sxs-lookup"><span data-stu-id="a6e70-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
