---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Verhindern von Angriffen mit offenerC#Umleitung () | Microsoft-Dokumentation
author: jongalloway
description: In diesem Tutorial wird erläutert, wie Sie offene Umleitungs Angriffe in Ihren ASP.NET-MVC-Anwendungen verhindern können. In diesem Tutorial werden die Änderungen erläutert, die vorgenommen wurden...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78432585"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="d1450-104">Verhindern von Angriffen durch offene Umleitungen (C#)</span><span class="sxs-lookup"><span data-stu-id="d1450-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="d1450-105">von [Jon Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="d1450-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="d1450-106">In diesem Tutorial wird erläutert, wie Sie offene Umleitungs Angriffe in Ihren ASP.NET-MVC-Anwendungen verhindern können.</span><span class="sxs-lookup"><span data-stu-id="d1450-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="d1450-107">In diesem Tutorial werden die Änderungen erläutert, die in AccountController in ASP.NET MVC 3 vorgenommen wurden, und es wird veranschaulicht, wie Sie diese Änderungen in Ihren vorhandenen ASP.NET MVC 1,0-und 2-Anwendungen anwenden können.</span><span class="sxs-lookup"><span data-stu-id="d1450-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="d1450-108">Was ist ein offener Umleitungs Angriff?</span><span class="sxs-lookup"><span data-stu-id="d1450-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="d1450-109">Jede Webanwendung, die an eine URL umgeleitet wird, die über die Anforderung angegeben wird, z. b. die QueryString-oder Formulardaten, kann möglicherweise manipuliert werden, um Benutzer an eine externe, böswillige URL umzuleiten.</span><span class="sxs-lookup"><span data-stu-id="d1450-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="d1450-110">Diese Manipulation wird als offener Umleitungs Angriff bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="d1450-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="d1450-111">Wenn Ihre Anwendungslogik eine Umleitung an eine angegebene URL durchführt, müssen Sie überprüfen, ob die Umleitungs-URL nicht manipuliert wurde.</span><span class="sxs-lookup"><span data-stu-id="d1450-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="d1450-112">Der Anmelde Name, der im standardmäßigen AccountController für ASP.NET MVC 1,0 und ASP.NET MVC 2 verwendet wird, ist anfällig für Open Redirect-Angriffe.</span><span class="sxs-lookup"><span data-stu-id="d1450-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="d1450-113">Glücklicherweise ist es einfach, vorhandene Anwendungen so zu aktualisieren, dass die Korrekturen aus ASP.NET MVC 3 Preview verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d1450-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="d1450-114">Um das Sicherheitsrisiko zu verstehen, sehen wir uns an, wie die Anmelde Umleitung in einem standardmäßigen ASP.NET MVC 2-Webanwendungs Projekt funktioniert.</span><span class="sxs-lookup"><span data-stu-id="d1450-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="d1450-115">Wenn Sie versuchen, eine Controller Aktion zu besuchen, die über das Attribut [autorisieren] verfügt, werden nicht autorisierte Benutzer in die/Account/Logon-Ansicht umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="d1450-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="d1450-116">Diese Umleitung zu/Account/Logon enthält einen "rückkehrnurl"-QueryString-Parameter, sodass der Benutzer an die ursprünglich angeforderte URL zurückgegeben werden kann, nachdem Sie sich erfolgreich angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="d1450-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="d1450-117">Im folgenden Screenshot sehen Sie, dass der Versuch, auf die/Account/ChangePassword-Ansicht zuzugreifen, wenn Sie nicht angemeldet ist, eine Umleitung an/Account/Logon führt. Rückgab =% 2fakcount% 2F ChangePassword% 2f.</span><span class="sxs-lookup"><span data-stu-id="d1450-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="d1450-118">**Abbildung 01**: Anmeldeseite mit offener Umleitung</span><span class="sxs-lookup"><span data-stu-id="d1450-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="d1450-119">Da der Parameter "QueryString" von "Rückkehrer" nicht überprüft wird, kann er von einem Angreifer geändert werden, um eine beliebige URL-Adresse in den Parameter einzufügen, um einen offenen Umleitungs Angriff auszuführen.</span><span class="sxs-lookup"><span data-stu-id="d1450-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="d1450-120">Um dies zu veranschaulichen, können wir den Parameter "der rückkehrnurl" in " [http://bing.com](http://bing.com)" ändern, sodass die resultierende Anmelde-URL "/Account/LOGON" lautet? Rückkehrnurl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="d1450-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="d1450-121">Nach erfolgreicher Anmeldung bei der Site werden wir zu [http://bing.com](http://bing.com)umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="d1450-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="d1450-122">Da diese Umleitung nicht überprüft wird, könnte Sie stattdessen auf eine böswillige Site verweisen, die versucht, den Benutzer zu täuschen.</span><span class="sxs-lookup"><span data-stu-id="d1450-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="d1450-123">Ein komplexerer offener Umleitungs Angriff</span><span class="sxs-lookup"><span data-stu-id="d1450-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="d1450-124">Angriffe mit offener Umleitung sind besonders gefährlich, weil ein Angreifer weiß, dass wir versuchen, sich bei einer bestimmten Website anzumelden, was uns anfällig [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx)für einen Phishingangriff ist.</span><span class="sxs-lookup"><span data-stu-id="d1450-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="d1450-125">Ein Angreifer könnte z. b. böswillige e-Mails an Website Benutzer senden, um die Kenn Wörter zu erfassen.</span><span class="sxs-lookup"><span data-stu-id="d1450-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="d1450-126">Sehen wir uns an, wie dies auf der Seite "nerddinner" funktioniert.</span><span class="sxs-lookup"><span data-stu-id="d1450-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="d1450-127">(Beachten Sie, dass die Live-Seite "nerddinner" aktualisiert wurde, um Schutz vor offenen Umleitungen zu bieten.)</span><span class="sxs-lookup"><span data-stu-id="d1450-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="d1450-128">Zuerst sendet ein Angreifer einen Link zur Anmeldeseite in "nerddinner", die eine Umleitung an die zugehörige gefälschte Seite enthält:</span><span class="sxs-lookup"><span data-stu-id="d1450-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="d1450-129">Beachten Sie, dass die Rückgabe-URL auf nerddiner.com zeigt, dem ein "n" aus dem Word Dinner fehlt.</span><span class="sxs-lookup"><span data-stu-id="d1450-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="d1450-130">In diesem Beispiel ist dies eine Domäne, die der Angreifer steuert.</span><span class="sxs-lookup"><span data-stu-id="d1450-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="d1450-131">Wenn wir auf den obigen Link zugreifen, werden wir zur legitimen NerdDinner.com-Anmeldeseite weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="d1450-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="d1450-132">**Abbildung 02**: Nerddinner Login-Seite mit offener Umleitung</span><span class="sxs-lookup"><span data-stu-id="d1450-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="d1450-133">Wenn wir uns ordnungsgemäß anmelden, werden wir durch die Anmelde Aktion ASP.NET MVC AccountController zur URL umgeleitet, die im Parameter "QueryString" von "wiederholnurl" angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="d1450-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="d1450-134">In diesem Fall ist dies die URL, die der Angreifer eingegeben hat, was [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn)ist.</span><span class="sxs-lookup"><span data-stu-id="d1450-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="d1450-135">Sofern wir nicht sehr wachsam sind, ist es sehr wahrscheinlich, dass dies nicht der Fall ist, insbesondere weil der Angreifer sicher ist, dass die gefälschte Seite genau wie die berechtigte Anmeldeseite aussieht.</span><span class="sxs-lookup"><span data-stu-id="d1450-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="d1450-136">Diese Anmeldeseite enthält eine Fehlermeldung, die anfordert, dass Sie sich erneut anmelden.</span><span class="sxs-lookup"><span data-stu-id="d1450-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="d1450-137">Ungeschickt, wir müssen unser Kennwort falsch formatierten.</span><span class="sxs-lookup"><span data-stu-id="d1450-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="d1450-138">**Abbildung 03**: Gefälschter nerddinner Login-Bildschirm</span><span class="sxs-lookup"><span data-stu-id="d1450-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="d1450-139">Wenn wir den Benutzernamen und das Kennwort erneut eingeben, speichert die gefälschte Anmeldeseite die Informationen und sendet Sie zurück an die berechtigte NerdDinner.com-Website.</span><span class="sxs-lookup"><span data-stu-id="d1450-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="d1450-140">An diesem Punkt hat die Website "NerdDinner.com" bereits authentifiziert, sodass die gefälschte Anmeldeseite direkt zu dieser Seite umgeleitet werden kann.</span><span class="sxs-lookup"><span data-stu-id="d1450-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="d1450-141">Das Endergebnis ist, dass der Angreifer über den Benutzernamen und das Kennwort verfügt, und wir wissen, dass wir ihn Ihnen nicht zur Verfügung gestellt haben.</span><span class="sxs-lookup"><span data-stu-id="d1450-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="d1450-142">Überprüfen des anfälligen Codes in der AccountController-Anmelde Aktion</span><span class="sxs-lookup"><span data-stu-id="d1450-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="d1450-143">Der Code für die Anmelde Aktion in einer ASP.NET MVC 2-Anwendung ist unten dargestellt.</span><span class="sxs-lookup"><span data-stu-id="d1450-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="d1450-144">Beachten Sie, dass der Controller bei erfolgreicher Anmeldung eine Umleitung an die Rücksende Liste zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="d1450-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="d1450-145">Sie können sehen, dass keine Überprüfung für den Parameter "Rückkehrer" ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="d1450-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="d1450-146">**Codebeispiel 1 – ASP.NET MVC 2-Anmelde Aktion in `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="d1450-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="d1450-147">Sehen wir uns nun die Änderungen an der Anmelde Aktion ASP.NET MVC 3 an.</span><span class="sxs-lookup"><span data-stu-id="d1450-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="d1450-148">Dieser Code wurde geändert, um den "Rückkehrer"-Parameter zu validieren, indem er eine neue Methode in der Hilfsprogrammklasse "System. Web. MVC. URL" namens "`IsLocalUrl()`" aufruft.</span><span class="sxs-lookup"><span data-stu-id="d1450-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="d1450-149">**Codebeispiel 2 – ASP.NET MVC 3-Anmelde Aktion in `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="d1450-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="d1450-150">Dies wurde geändert, um den Rückgabe-URL-Parameter zu validieren, indem eine neue Methode in der Hilfsklasse "System. Web. MVC. URL" aufgerufen wird, `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="d1450-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="d1450-151">Schützen Ihrer ASP.NET MVC 1,0-und MVC 2-Anwendungen</span><span class="sxs-lookup"><span data-stu-id="d1450-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="d1450-152">Wir können die ASP.NET MVC 3-Änderungen in unseren vorhandenen ASP.NET MVC 1,0-und 2-Anwendungen nutzen, indem Sie die Hilfsmethode "islocalurl ()" hinzufügen und die Anmelde Aktion aktualisieren, um den Parameter "Rückkehrer" zu validieren.</span><span class="sxs-lookup"><span data-stu-id="d1450-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="d1450-153">Die Urlhelper islocalurl ()-Methode ruft tatsächlich nur eine Methode in System. Web. Webseiten auf, da diese Validierung auch von ASP.net Web Pages Anwendungen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="d1450-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="d1450-154">**Codebeispiel 3 – die islocalurl ()-Methode aus dem ASP.NET MVC 3 Urlhelper-`class`**</span><span class="sxs-lookup"><span data-stu-id="d1450-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="d1450-155">Die isurllocaltohost-Methode enthält die tatsächliche Validierungs Logik, wie in der Abbildung 4 gezeigt.</span><span class="sxs-lookup"><span data-stu-id="d1450-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="d1450-156">**Codebeispiel 4 – isurllocaltohost ()-Methode aus der System. Web. Webseiten requestextensions-Klasse**</span><span class="sxs-lookup"><span data-stu-id="d1450-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="d1450-157">In unserer ASP.NET MVC 1,0-oder 2-Anwendung fügen wir dem AccountController eine islocalurl ()-Methode hinzu. es wird jedoch empfohlen, Sie nach Möglichkeit zu einer separaten Hilfsklasse hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="d1450-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="d1450-158">Wir nehmen zwei kleine Änderungen an der ASP.NET MVC 3-Version von islocalurl () vor, damit Sie in AccountController verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="d1450-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="d1450-159">Zunächst ändern wir die Methode von einer öffentlichen Methode in eine private Methode, da auf öffentliche Methoden in Controllern als Controller Aktionen zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="d1450-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="d1450-160">Zweitens ändern wir den-Befehl, mit dem der URL-Host anhand des Anwendungs Hosts überprüft wird.</span><span class="sxs-lookup"><span data-stu-id="d1450-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="d1450-161">Dieser Befehl nutzt ein lokales RequestContext-Feld in der Urlhelper-Klasse.</span><span class="sxs-lookup"><span data-stu-id="d1450-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="d1450-162">Anstatt diese zu verwenden. RequestContext. HttpContext. Request. URL. Host verwenden wir dies. Request. URL. Host.</span><span class="sxs-lookup"><span data-stu-id="d1450-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="d1450-163">Der folgende Code zeigt die geänderte islocalurl ()-Methode für die Verwendung mit einer Controller Klasse in ASP.NET MVC 1,0-und 2-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="d1450-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="d1450-164">**Listing 5 – islocalurl ()-Methode, die für die Verwendung mit einer MVC-Controller Klasse geändert wird**</span><span class="sxs-lookup"><span data-stu-id="d1450-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="d1450-165">Nun, da die islocalurl ()-Methode vorhanden ist, können wir Sie aus der Anmelde Aktion aufrufen, um den Parameter "Rückkehrer" zu validieren, wie im folgenden Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="d1450-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="d1450-166">**Codebeispiel 6 – aktualisierte Anmelde Methode, die den Parameter "kehrnurl" überprüft**</span><span class="sxs-lookup"><span data-stu-id="d1450-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="d1450-167">Nun können Sie einen offenen Umleitungs Angriff testen, indem Sie versuchen, sich mit einer externen Rückgabe-URL anzumelden.</span><span class="sxs-lookup"><span data-stu-id="d1450-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="d1450-168">Verwenden wir/Account/LOGON? Wieder kehrnurl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="d1450-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="d1450-169">**Abbildung 04**: Testen der aktualisierten Anmelde Aktion</span><span class="sxs-lookup"><span data-stu-id="d1450-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="d1450-170">Nach der erfolgreichen Anmeldung werden wir zur Aktion "Home/Index Controller" anstatt zur externen URL umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="d1450-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="d1450-171">**Abbildung 05**: Offener Umleitungs Angriff besiegt</span><span class="sxs-lookup"><span data-stu-id="d1450-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="d1450-172">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="d1450-172">Summary</span></span>

<span data-ttu-id="d1450-173">Open Redirect-Angriffe können auftreten, wenn Umleitungs-URLs als Parameter in der URL für eine Anwendung weitergegeben werden.</span><span class="sxs-lookup"><span data-stu-id="d1450-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="d1450-174">Die ASP.NET MVC 3-Vorlage enthält Code zum Schutz vor offenen Umleitungs Angriffen.</span><span class="sxs-lookup"><span data-stu-id="d1450-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="d1450-175">Sie können diesen Code mit einigen Änderungen an ASP.NET MVC 1,0 und 2-Anwendungen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="d1450-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="d1450-176">Fügen Sie zum Schutz vor offenen Umleitungs Angriffen bei der Anmeldung bei ASP.NET 1,0-und 2-Anwendungen eine islocalurl ()-Methode hinzu, und überprüfen Sie den Parameter "Rückkehrer" in der Anmelde Aktion.</span><span class="sxs-lookup"><span data-stu-id="d1450-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
