---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Tutorial: Server Übertragung mit ASP.net signalr 1. x | Microsoft-Dokumentation'
author: bradygaster
description: In diesem Tutorial wird gezeigt, wie eine Webanwendung erstellt wird, die ASP.net signalr zum Bereitstellen von Server Broadcast Funktionen verwendet. Server Broadcast bedeutet, dass Communic...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78467931"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="11830-104">Tutorial: Server Übertragung mit ASP.net signalr 1. x</span><span class="sxs-lookup"><span data-stu-id="11830-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="11830-105">von [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="11830-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="11830-106">In diesem Tutorial wird gezeigt, wie eine Webanwendung erstellt wird, die ASP.net signalr zum Bereitstellen von Server Broadcast Funktionen verwendet.</span><span class="sxs-lookup"><span data-stu-id="11830-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="11830-107">Server Broadcast bedeutet, dass die an Clients gesendeten Mitteilungen vom Server initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="11830-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="11830-108">Dieses Szenario erfordert einen anderen Programmier Ansatz als Peer-to-Peer-Szenarios, wie z. b. Chat-Anwendungen, bei denen die an Clients gesendete Kommunikation von mindestens einem Client initiiert wird.</span><span class="sxs-lookup"><span data-stu-id="11830-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="11830-109">Die Anwendung, die Sie in diesem Tutorial erstellen, simuliert einen Börsen Ticker, ein typisches Szenario für die Server Broadcast-Funktionalität.</span><span class="sxs-lookup"><span data-stu-id="11830-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="11830-110">Kommentare zu diesem Tutorial sind willkommen.</span><span class="sxs-lookup"><span data-stu-id="11830-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="11830-111">Wenn Sie Fragen haben, die nicht direkt mit dem Tutorial zusammenhängen, können Sie Sie im [ASP.net signalr-Forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) oder in [StackOverflow.com](http://stackoverflow.com)veröffentlichen.</span><span class="sxs-lookup"><span data-stu-id="11830-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="11830-112">Übersicht</span><span class="sxs-lookup"><span data-stu-id="11830-112">Overview</span></span>

<span data-ttu-id="11830-113">Das nuget-Paket [Microsoft. Aspnet. signalr. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) installiert eine simulierte Beispiel-tickeranwendung in einem Visual Studio-Projekt.</span><span class="sxs-lookup"><span data-stu-id="11830-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="11830-114">Im ersten Teil dieses Tutorials erstellen Sie eine vereinfachte Version der Anwendung von Grund auf neu.</span><span class="sxs-lookup"><span data-stu-id="11830-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="11830-115">Im weiteren Verlauf des Tutorials installieren Sie das nuget-Paket und überprüfen die zusätzlichen Features und Code, die es erstellt.</span><span class="sxs-lookup"><span data-stu-id="11830-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="11830-116">Die Stock Ticker-Anwendung ist ein Vertreter einer Art von Echtzeitanwendung, in der Sie in regelmäßigen Abständen Benachrichtigungen vom Server an alle verbundenen Clients senden oder übertragen möchten.</span><span class="sxs-lookup"><span data-stu-id="11830-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="11830-117">Die Anwendung, die Sie im ersten Teil dieses Tutorials erstellen, zeigt ein Raster mit Aktiendaten an.</span><span class="sxs-lookup"><span data-stu-id="11830-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![StockTicker-anfangs Version](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="11830-119">Der Server aktualisiert die Aktienpreise in regelmäßigen Abständen nach dem Zufallsprinzip und überträgt die Updates an alle verbundenen Clients.</span><span class="sxs-lookup"><span data-stu-id="11830-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="11830-120">Im Browser ändern sich die Zahlen und Symbole in den **Änderungs** -und **%** Spalten dynamisch in Reaktion auf Benachrichtigungen vom Server.</span><span class="sxs-lookup"><span data-stu-id="11830-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="11830-121">Wenn Sie zusätzliche Browser in derselben URL öffnen, zeigen Sie alle dieselben Daten und die gleichen Änderungen an den Daten gleichzeitig an.</span><span class="sxs-lookup"><span data-stu-id="11830-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="11830-122">Dieses Tutorial enthält die folgenden Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="11830-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="11830-123">Erforderliche Komponenten</span><span class="sxs-lookup"><span data-stu-id="11830-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="11830-124">Erstellen des Projekts</span><span class="sxs-lookup"><span data-stu-id="11830-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="11830-125">Hinzufügen der signalr-nuget-Pakete</span><span class="sxs-lookup"><span data-stu-id="11830-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="11830-126">Einrichten des Server Codes</span><span class="sxs-lookup"><span data-stu-id="11830-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="11830-127">Einrichten des Client Codes</span><span class="sxs-lookup"><span data-stu-id="11830-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="11830-128">Testen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="11830-128">Test the application</span></span>](#test)
- [<span data-ttu-id="11830-129">Aktivieren der Protokollierung</span><span class="sxs-lookup"><span data-stu-id="11830-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="11830-130">Vollständiges StockTicker-Beispiel installieren und überprüfen</span><span class="sxs-lookup"><span data-stu-id="11830-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="11830-131">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="11830-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="11830-132">Wenn Sie die Schritte zum Entwickeln der Anwendung nicht durcharbeiten möchten, können Sie das signalr. Sample-Paket in einem neuen, **leeren ASP.NET-Webanwendungs** Projekt installieren und diese Schritte lesen, um Erläuterungen zum Code zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="11830-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="11830-133">Der erste Teil des Tutorials behandelt eine Teilmenge des signalr. Sample-Codes, und der zweite Teil erläutert die wichtigsten Features der zusätzlichen Funktionalität im signalr. Sample-Paket.</span><span class="sxs-lookup"><span data-stu-id="11830-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="11830-134">Voraussetzungen</span><span class="sxs-lookup"><span data-stu-id="11830-134">Prerequisites</span></span>

<span data-ttu-id="11830-135">Bevor Sie beginnen, stellen Sie sicher, dass Visual Studio 2012 oder 2010 SP1 auf dem Computer installiert ist.</span><span class="sxs-lookup"><span data-stu-id="11830-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="11830-136">Wenn Sie nicht über Visual Studio verfügen, finden Sie weitere Informationen unter [ASP.net Downloads](https://www.asp.net/downloads) , um das kostenlose Visual Studio 2012 Express für Web zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="11830-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="11830-137">Wenn Sie über Visual Studio 2010 verfügen, stellen Sie sicher, dass [nuget](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) installiert ist.</span><span class="sxs-lookup"><span data-stu-id="11830-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="11830-138">Erstellen eines Projekts</span><span class="sxs-lookup"><span data-stu-id="11830-138">Create the project</span></span>

1. <span data-ttu-id="11830-139">Klicken Sie im Menü **Datei** auf **Neues Projekt**.</span><span class="sxs-lookup"><span data-stu-id="11830-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="11830-140">Erweitern **C#** Sie im Dialogfeld **Neues Projekt** unter **Vorlagen** , und wählen Sie **Web**aus.</span><span class="sxs-lookup"><span data-stu-id="11830-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="11830-141">Wählen Sie die Vorlage **ASP.net Empty Web Application** aus, benennen Sie das Projekt *signalr. StockTicker*, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="11830-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Dialogfeld "Neues Projekt"](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="11830-143">Hinzufügen der signalr-nuget-Pakete</span><span class="sxs-lookup"><span data-stu-id="11830-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="11830-144">Hinzufügen der signalr-und jQuery-nuget-Pakete</span><span class="sxs-lookup"><span data-stu-id="11830-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="11830-145">Sie können einem Projekt signalr-Funktionen hinzufügen, indem Sie ein nuget-Paket installieren.</span><span class="sxs-lookup"><span data-stu-id="11830-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="11830-146">Klicken Sie auf **Tools | Nuget-Paket-Manager | Paket-Manager-Konsole**.</span><span class="sxs-lookup"><span data-stu-id="11830-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="11830-147">Geben Sie den folgenden Befehl in den Paket-Manager ein.</span><span class="sxs-lookup"><span data-stu-id="11830-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="11830-148">Das signalr-Paket installiert eine Reihe von anderen nuget-Paketen als Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="11830-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="11830-149">Wenn die Installation abgeschlossen ist, verfügen Sie über alle Server-und Client Komponenten, die für die Verwendung von signalr in einer ASP.NET-Anwendung erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="11830-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="11830-150">Einrichten des Servercodes</span><span class="sxs-lookup"><span data-stu-id="11830-150">Set up the server code</span></span>

<span data-ttu-id="11830-151">In diesem Abschnitt richten Sie den Code ein, der auf dem Server ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="11830-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="11830-152">Erstellen der Aktienklasse</span><span class="sxs-lookup"><span data-stu-id="11830-152">Create the Stock class</span></span>

<span data-ttu-id="11830-153">Beginnen Sie mit dem Erstellen der kursmodell Klasse, die Sie zum Speichern und übertragen von Informationen zu einem Kurs verwenden.</span><span class="sxs-lookup"><span data-stu-id="11830-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="11830-154">Erstellen Sie eine neue Klassendatei im Projektordner, benennen Sie Sie *Stock.cs*, und ersetzen Sie den Vorlagen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="11830-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="11830-155">Die zwei Eigenschaften, die Sie beim Erstellen von Beständen festlegen, sind das Symbol (z. b. msft für Microsoft) und der Preis.</span><span class="sxs-lookup"><span data-stu-id="11830-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="11830-156">Welche anderen Eigenschaften Sie benötigen, hängt davon ab, wie und wann Sie den Preis festlegen.</span><span class="sxs-lookup"><span data-stu-id="11830-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="11830-157">Wenn Sie das erste Mal einen Preis festlegen, wird der Wert an dayopen weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="11830-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="11830-158">Nachfolgende Zeiten, in denen Sie den Preis festlegen, werden die Eigenschaftswerte für Änderung und prozentualänderung basierend auf der Differenz zwischen Preis und dayopen berechnet.</span><span class="sxs-lookup"><span data-stu-id="11830-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="11830-159">Erstellen der Stock Ticker-und stocktickerhub-Klassen</span><span class="sxs-lookup"><span data-stu-id="11830-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="11830-160">Sie verwenden die signalr Hub-API, um die Server-zu-Client-Interaktion zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="11830-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="11830-161">Eine stocktickerhub-Klasse, die von der signalr-Hub-Klasse abgeleitet wird, verarbeitet den Empfang von Verbindungen und Methoden Aufrufen von Clients.</span><span class="sxs-lookup"><span data-stu-id="11830-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="11830-162">Außerdem müssen Sie Aktiendaten aufbewahren und ein Zeit Geber Objekt ausführen, um Preis Aktualisierungen unabhängig von Clientverbindungen regelmäßig zu initiieren.</span><span class="sxs-lookup"><span data-stu-id="11830-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="11830-163">Diese Funktionen können nicht in einer Hub-Klasse abgelegt werden, da die Hub-Instanzen flüchtig sind.</span><span class="sxs-lookup"><span data-stu-id="11830-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="11830-164">Für jeden Vorgang auf dem Hub wird eine Hub-Klasseninstanz erstellt, z. b. Verbindungen und Aufrufe vom Client an den Server.</span><span class="sxs-lookup"><span data-stu-id="11830-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="11830-165">Der Mechanismus, der die Aktiendaten beibehält, die Preise aktualisiert und die Preis Aktualisierungen überträgt, muss in einer separaten Klasse ausgeführt werden, die Sie StockTicker nennen.</span><span class="sxs-lookup"><span data-stu-id="11830-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Senden aus StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="11830-167">Sie möchten nur, dass eine Instanz der Stock Ticker-Klasse auf dem Server ausgeführt wird. Daher müssen Sie einen Verweis von jeder stocktickerhub-Instanz auf die Singleton Stock Ticker-Instanz einrichten.</span><span class="sxs-lookup"><span data-stu-id="11830-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="11830-168">Die StockTicker-Klasse muss an Clients übertragen werden können, da Sie über die Aktiendaten und die triggerupdates verfügt, StockTicker jedoch keine Hub-Klasse ist.</span><span class="sxs-lookup"><span data-stu-id="11830-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="11830-169">Daher muss die StockTicker-Klasse einen Verweis auf das signalr Hub-Verbindungs Kontext Objekt erhalten.</span><span class="sxs-lookup"><span data-stu-id="11830-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="11830-170">Anschließend kann das signalr-Verbindungs Kontext Objekt für die Übertragung an Clients verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="11830-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="11830-171">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie auf **Add New Item**.</span><span class="sxs-lookup"><span data-stu-id="11830-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="11830-172">Wenn Sie Visual Studio 2012 mit dem [ASP.net and Web Tools 2012,2-Update](https://go.microsoft.com/fwlink/?LinkId=279941)haben, klicken Sie unter  **C# Visual** auf **Web** , und wählen Sie die Element Vorlage **signalr-Hub-Klasse** aus.</span><span class="sxs-lookup"><span data-stu-id="11830-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="11830-173">Wählen Sie andernfalls die **Klassen** Vorlage aus.</span><span class="sxs-lookup"><span data-stu-id="11830-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="11830-174">Nennen Sie die neue Klasse *StockTickerHub.cs*, und klicken Sie dann auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="11830-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![StockTickerHub.cs Hinzufügen](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="11830-176">Ersetzen Sie den Vorlagencode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="11830-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="11830-177">Die [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) -Klasse wird verwendet, um Methoden zu definieren, die von Clients auf dem Server aufgerufen werden können.</span><span class="sxs-lookup"><span data-stu-id="11830-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="11830-178">Sie definieren eine Methode: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="11830-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="11830-179">Wenn ein Client zum ersten Mal eine Verbindung mit dem Server herstellt, wird diese Methode aufgerufen, um eine Liste aller Aktien mit ihren aktuellen Preisen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="11830-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="11830-180">Die-Methode kann synchron ausgeführt werden und `IEnumerable<Stock>` zurückgeben, da Sie Daten aus dem Arbeitsspeicher zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="11830-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="11830-181">Wenn die Methode die Daten abrufen musste, indem Sie eine bestimmte Aktion durchführen, wie z. b. eine Datenbanksuche oder einen Webdienst-Befehl, geben Sie `Task<IEnumerable<Stock>>` als Rückgabewert an, um die asynchrone Verarbeitung zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="11830-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="11830-182">Weitere Informationen finden Sie unter [ASP.net signalr Hubs API Guide-Server-when for asynchron Execute](index.md).</span><span class="sxs-lookup"><span data-stu-id="11830-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="11830-183">Das Attribut hubname gibt an, wie auf den Hub im JavaScript-Code auf dem Client verwiesen wird.</span><span class="sxs-lookup"><span data-stu-id="11830-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="11830-184">Wenn Sie dieses Attribut nicht verwenden, ist der Standardname auf dem Client eine Version des Klassen namens, die in Kamel Buchstaben steht, was in diesem Fall stocktickerhub wäre.</span><span class="sxs-lookup"><span data-stu-id="11830-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="11830-185">Wie Sie später sehen werden, wenn Sie die Stock Ticker-Klasse erstellen, wird in der statischen Instance-Eigenschaft eine Singleton Instanz dieser Klasse erstellt.</span><span class="sxs-lookup"><span data-stu-id="11830-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="11830-186">Diese Singleton-Instanz von StockTicker verbleibt im Arbeitsspeicher, unabhängig davon, wie viele Clients eine Verbindung herstellen oder trennen, und diese Instanz verwendet die getallstocks-Methode, um aktuelle Aktieninformationen zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="11830-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="11830-187">Erstellen Sie eine neue Klassendatei im Projektordner, benennen Sie Sie *StockTicker.cs*, und ersetzen Sie den Vorlagen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="11830-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="11830-188">Da mehrere Threads dieselbe Instanz von stocktickcode ausführen, muss die StockTicker-Klasse Thread sicher sein.</span><span class="sxs-lookup"><span data-stu-id="11830-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="11830-189">Speichern der Singleton-Instanz in einem statischen Feld</span><span class="sxs-lookup"><span data-stu-id="11830-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="11830-190">Der Code initialisiert das statische \_Instanzfeld, das die Instanzeigenschaft mit einer Instanz der-Klasse unterstützt. Dies ist die einzige Instanz der-Klasse, die erstellt werden kann, da der Konstruktor als privat markiert ist.</span><span class="sxs-lookup"><span data-stu-id="11830-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="11830-191">Die verzögerte [Initialisierung](https://msdn.microsoft.com/library/dd997286.aspx) wird für das \_Instanzfeld verwendet, nicht aus Leistungsgründen, sondern um sicherzustellen, dass die Instanzerstellung Thread sicher ist.</span><span class="sxs-lookup"><span data-stu-id="11830-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="11830-192">Jedes Mal, wenn ein Client eine Verbindung mit dem Server herstellt, ruft eine neue Instanz der stocktickerhub-Klasse, die in einem separaten Thread ausgeführt wird, die stockticksingleton-Instanz aus der statischen StockTicker. Instance-Eigenschaft ab, wie Sie zuvor in der Stock tickerhub-Klasse gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="11830-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="11830-193">Speichern von Aktiendaten in einem ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="11830-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="11830-194">Der Konstruktor initialisiert die \_Bestands Auflistung mit einigen Beispiel Daten für die Aktien und getallstocks gibt die Bestände zurück.</span><span class="sxs-lookup"><span data-stu-id="11830-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="11830-195">Wie Sie bereits gesehen haben, wird diese Sammlung von Beständen wiederum von stocktickerhub. getallstocks zurückgegeben, bei der es sich um eine Server Methode in der Hub-Klasse handelt, die von Clients aufgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="11830-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="11830-196">Die Bestands Sammlung ist als [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) -Typ für Thread Sicherheit definiert.</span><span class="sxs-lookup"><span data-stu-id="11830-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="11830-197">Als Alternative können Sie ein [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) -Objekt verwenden und das Wörterbuch explizit sperren, wenn Sie Änderungen daran vornehmen.</span><span class="sxs-lookup"><span data-stu-id="11830-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="11830-198">Bei dieser Beispielanwendung ist es in Ordnung, Anwendungsdaten im Arbeitsspeicher zu speichern und die Daten zu verlieren, wenn die StockTicker-Instanz verworfen wird.</span><span class="sxs-lookup"><span data-stu-id="11830-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="11830-199">In einer realen Anwendung arbeiten Sie mit einem Back-End-Datenspeicher, z. b. einer-Datenbank.</span><span class="sxs-lookup"><span data-stu-id="11830-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="11830-200">Regelmäßiges Aktualisieren von Aktienkursen</span><span class="sxs-lookup"><span data-stu-id="11830-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="11830-201">Der-Konstruktor startet ein Timer-Objekt, das regelmäßig Methoden aufruft, die die Aktienpreise nach dem Zufallsprinzip aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="11830-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="11830-202">Updatestockprices wird vom Timer aufgerufen, der im State-Parameter NULL übergibt.</span><span class="sxs-lookup"><span data-stu-id="11830-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="11830-203">Vor dem Aktualisieren der Preise wird eine Sperre für das \_updatestockpriceslock-Objekt übernommen.</span><span class="sxs-lookup"><span data-stu-id="11830-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="11830-204">Der Code überprüft, ob die Preise bereits von einem anderen Thread aktualisiert werden, und ruft dann tryupdatestockprice für jede Aktie in der Liste auf.</span><span class="sxs-lookup"><span data-stu-id="11830-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="11830-205">Die tryupdatestockprice-Methode entscheidet, ob der Aktienkurs geändert und wie viel geändert werden muss.</span><span class="sxs-lookup"><span data-stu-id="11830-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="11830-206">Wenn der Aktienkurs geändert wird, wird broadcaststockprice aufgerufen, um die Aktienkurs Änderung an alle verbundenen Clients zu senden.</span><span class="sxs-lookup"><span data-stu-id="11830-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="11830-207">Das \_updatingstockprices-Flag ist als [flüchtig](https://msdn.microsoft.com/library/x13ttww7.aspx) gekennzeichnet, um sicherzustellen, dass der Zugriff auf das Flag Thread sicher ist.</span><span class="sxs-lookup"><span data-stu-id="11830-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="11830-208">In einer realen Anwendung würde die tryupdatestockprice-Methode einen Webdienst aufrufen, um den Preis zu suchen. in diesem Code wird ein Zufallszahlengenerator verwendet, um Änderungen nach dem Zufallsprinzip vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="11830-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="11830-209">So erhalten Sie den signalr-Kontext, sodass die StockTicker-Klasse an Clients gesendet werden kann</span><span class="sxs-lookup"><span data-stu-id="11830-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="11830-210">Da sich die Preisänderungen hier im StockTicker-Objekt befinden, ist dies das Objekt, das eine updatestockprice-Methode für alle verbundenen Clients aufrufen muss.</span><span class="sxs-lookup"><span data-stu-id="11830-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="11830-211">In einer Hub-Klasse verfügen Sie über eine API zum Aufrufen von Client Methoden, aber StockTicker ist nicht von der Hub-Klasse abgeleitet und verfügt über keinen Verweis auf ein Hub-Objekt.</span><span class="sxs-lookup"><span data-stu-id="11830-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="11830-212">Daher muss die StockTicker-Klasse die signalr-Kontext Instanz für die stocktickerhub-Klasse abrufen und diese zum Abrufen von Methoden auf Clients verwenden, damit Sie an verbundene Clients gesendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="11830-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="11830-213">Der Code Ruft beim Erstellen der Singleton-Klasseninstanz einen Verweis auf den signalr-Kontext ab, übergibt diesen Verweis an den-Konstruktor, und der-Konstruktor legt ihn in der Clients-Eigenschaft ab.</span><span class="sxs-lookup"><span data-stu-id="11830-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="11830-214">Es gibt zwei Gründe, warum Sie den Kontext nur einmal abrufen möchten: das Abrufen des Kontexts ist ein kostspieliger Vorgang, und er stellt sicher, dass die beabsichtigte Reihenfolge der Nachrichten, die an Clients gesendet werden, erhalten bleibt.</span><span class="sxs-lookup"><span data-stu-id="11830-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="11830-215">Wenn Sie die Clients-Eigenschaft des Kontexts abrufen und in der stocktickerclient-Eigenschaft platzieren, können Sie Code schreiben, um Client Methoden aufzurufen, die wie in einer Hub-Klasse aussehen.</span><span class="sxs-lookup"><span data-stu-id="11830-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="11830-216">Wenn Sie beispielsweise an alle Clients übertragen möchten, können Sie Clients schreiben. alle. updatestockprice (Stock).</span><span class="sxs-lookup"><span data-stu-id="11830-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="11830-217">Die updatestockprice-Methode, die Sie in broadcaststockprice aufrufen, ist noch nicht vorhanden. Sie fügen Sie später hinzu, wenn Sie Code schreiben, der auf dem Client ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="11830-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="11830-218">Sie können hier auf "updatestockprice" verweisen, da "Clients. all" dynamisch ist, was bedeutet, dass der Ausdruck zur Laufzeit ausgewertet wird.</span><span class="sxs-lookup"><span data-stu-id="11830-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="11830-219">Wenn dieser Methodenaufruf ausgeführt wird, sendet signalr den Methodennamen und den Parameterwert an den Client. wenn der Client über eine Methode mit dem Namen "updatestockprice" verfügt, wird diese Methode aufgerufen, und der Parameterwert wird an ihn übergeben.</span><span class="sxs-lookup"><span data-stu-id="11830-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="11830-220">Clients. All bedeutet, dass an alle Clients gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="11830-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="11830-221">Signalr bietet Ihnen andere Optionen, um anzugeben, an welche Clients oder Client Gruppen die Clients gesendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="11830-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="11830-222">Weitere Informationen finden Sie unter [hubconnectioncontext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="11830-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="11830-223">Registrieren der signalr-Route</span><span class="sxs-lookup"><span data-stu-id="11830-223">Register the SignalR route</span></span>

<span data-ttu-id="11830-224">Der Server muss wissen, welche URL abgefangen und an signalr weitergeleitet werden soll.</span><span class="sxs-lookup"><span data-stu-id="11830-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="11830-225">Zu diesem Zweck fügen Sie der Datei " *Global. asax* " Code hinzu.</span><span class="sxs-lookup"><span data-stu-id="11830-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="11830-226">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie dann auf **Neues Element hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="11830-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="11830-227">Wählen Sie die Element Vorlage **globale Anwendungsklasse** aus, und klicken Sie dann auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="11830-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    !["Global. asax" hinzufügen](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="11830-229">Fügen Sie den signalr-Routen Registrierungscode der Anwendung\_Start-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="11830-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="11830-230">Standardmäßig ist die Basis-URL für den gesamten signalr-Datenverkehr "/signalr", und "/signalr/Hubs" wird verwendet, um eine dynamisch generierte JavaScript-Datei abzurufen, die Proxys für alle in der Anwendung verwendeten Hubs definiert.</span><span class="sxs-lookup"><span data-stu-id="11830-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="11830-231">Die maphubs-Methode enthält über Ladungen, mit denen Sie eine andere Basis-URL und bestimmte signalr-Optionen in einer Instanz der [hubconfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) -Klasse angeben können.</span><span class="sxs-lookup"><span data-stu-id="11830-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="11830-232">Fügen Sie am Anfang der Datei eine using-Anweisung hinzu:</span><span class="sxs-lookup"><span data-stu-id="11830-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="11830-233">Speichern und schließen Sie die Datei *Global. asax* , und erstellen Sie das Projekt.</span><span class="sxs-lookup"><span data-stu-id="11830-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="11830-234">Sie haben nun das Einrichten des Server Codes abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="11830-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="11830-235">Im nächsten Abschnitt richten Sie den-Client ein.</span><span class="sxs-lookup"><span data-stu-id="11830-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="11830-236">Einrichten des Client Codes</span><span class="sxs-lookup"><span data-stu-id="11830-236">Set up the client code</span></span>

1. <span data-ttu-id="11830-237">Erstellen Sie eine neue HTML-Datei im Projektordner, und nennen Sie Sie *StockTicker. html*.</span><span class="sxs-lookup"><span data-stu-id="11830-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="11830-238">Ersetzen Sie den Vorlagencode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="11830-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="11830-239">Der HTML-Code erstellt eine Tabelle mit 5 Spalten, einer Kopfzeile und einer Daten Zeile mit einer einzelnen Zelle, die alle 5 Spalten umfasst.</span><span class="sxs-lookup"><span data-stu-id="11830-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="11830-240">In der Daten Zeile wird "laden..." angezeigt. und werden nur vorübergehend angezeigt, wenn die Anwendung gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="11830-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="11830-241">Der JavaScript-Code entfernt diese Zeile und fügt Ihre Platz Zeilen mit den vom Server abgerufenen Aktiendaten hinzu.</span><span class="sxs-lookup"><span data-stu-id="11830-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="11830-242">Die Skript Tags geben die jQuery-Skriptdatei, die signalr-Kern Skriptdatei, die Skriptdatei für signalr-Proxys und eine StockTicker-Skriptdatei an, die Sie später erstellen.</span><span class="sxs-lookup"><span data-stu-id="11830-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="11830-243">Die Skriptdatei für signalr-Proxys, die die URL "/signalr/Hubs" angibt, wird dynamisch generiert und definiert Proxy Methoden für die Methoden in der hubklasse, in diesem Fall für stocktickerhub. getallstocks.</span><span class="sxs-lookup"><span data-stu-id="11830-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="11830-244">Wenn Sie möchten, können Sie diese JavaScript-Datei mithilfe von [signalr](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) -Hilfsprogrammen manuell generieren und die Erstellung dynamischer Dateien im maphubs-Methodenaufrufe deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="11830-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="11830-245">Stellen Sie sicher, dass die JavaScript-Datei Verweise in *StockTicker. html* korrekt sind.</span><span class="sxs-lookup"><span data-stu-id="11830-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="11830-246">Stellen Sie also sicher, dass die jQuery-Version in Ihrem Skripttag (1.8.2 im Beispiel) mit der jQuery-Version im Skript Ordner Ihres Projekts identisch ist, und stellen Sie sicher, dass die signalr-Version in Ihrem Skripttag mit der signalr *-Version* im *Skript Ordner Ihres* Projekts identisch ist.</span><span class="sxs-lookup"><span data-stu-id="11830-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="11830-247">Ändern Sie ggf. die Dateinamen in den Skript Tags.</span><span class="sxs-lookup"><span data-stu-id="11830-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="11830-248">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf *StockTicker. html*, und klicken Sie dann auf **als Start Seite festlegen**.</span><span class="sxs-lookup"><span data-stu-id="11830-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="11830-249">Erstellen Sie eine neue JavaScript-Datei im Projektordner, und nennen Sie Sie *StockTicker. js*.</span><span class="sxs-lookup"><span data-stu-id="11830-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="11830-250">Ersetzen Sie den Vorlagencode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="11830-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="11830-251">$. Connection verweist auf die signalr-Proxys.</span><span class="sxs-lookup"><span data-stu-id="11830-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="11830-252">Der Code Ruft einen Verweis auf den Proxy für die stocktickerhub-Klasse ab und legt ihn in der tickervariablen ab.</span><span class="sxs-lookup"><span data-stu-id="11830-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="11830-253">Der Proxy Name ist der Name, der vom Attribut [hubname] festgelegt wurde:</span><span class="sxs-lookup"><span data-stu-id="11830-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="11830-254">Nachdem alle Variablen und Funktionen definiert wurden, initialisiert die letzte Codezeile in der Datei die signalr-Verbindung, indem die signalr-Start Funktion aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="11830-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="11830-255">Die Start-Funktion führt asynchron aus und gibt ein [Verzögertes jQuery-Objekt](http://api.jquery.com/category/deferred-object/)zurück. Dies bedeutet, dass Sie die done-Funktion zum Angeben der Funktion aufruft, die aufgerufen wird, wenn der asynchrone Vorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="11830-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="11830-256">Die Init-Funktion Ruft die getallstocks-Funktion auf dem Server auf und verwendet die vom Server zurückgegebenen Informationen, um die Aktien Tabelle zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="11830-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="11830-257">Beachten Sie, dass Sie die Kamel-Schreibweise auf dem Client standardmäßig verwenden müssen, obwohl der Methodenname auf dem Server Pascal-Schreibweise ist.</span><span class="sxs-lookup"><span data-stu-id="11830-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="11830-258">Die Regel für die Kamel Schreibweise gilt nur für Methoden, nicht für Objekte.</span><span class="sxs-lookup"><span data-stu-id="11830-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="11830-259">Beispielsweise verweisen Sie auf Aktien. Symbol und Lager. Price, nicht Stock. Symbol oder Stock. Price.</span><span class="sxs-lookup"><span data-stu-id="11830-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="11830-260">Wenn Sie die Pascal-Schreibweise auf dem Client verwenden oder einen vollständig anderen Methodennamen verwenden möchten, können Sie die hubmethode mit dem Attribut "hubmethodname" auf die gleiche Weise wie die Hub-Klasse mit dem Attribut "hubname" ergänzen.</span><span class="sxs-lookup"><span data-stu-id="11830-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="11830-261">In der Init-Methode wird HTML für eine Tabellenzeile für jedes vom Server empfangene Lager Objekt erstellt, indem formatstock aufgerufen wird, um die Eigenschaften des Aktien Objekts zu formatieren, und dann durch Aufrufen von verdrängen (das oben in *StockTicker. js*definiert ist), dass Platzhalter in der RowTemplate-Variablen durch die Eigenschaften Werte der Aktien Objekte ersetzt werden.</span><span class="sxs-lookup"><span data-stu-id="11830-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="11830-262">Der resultierende HTML-Code wird dann an die Aktien Tabelle angehängt.</span><span class="sxs-lookup"><span data-stu-id="11830-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="11830-263">Sie rufen init auf, indem Sie Sie als Rückruffunktion übergeben, die ausgeführt wird, nachdem die asynchrone Start Funktion abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="11830-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="11830-264">Wenn Sie "init" nach dem Aufruf von "Start" als separate JavaScript-Anweisung aufrufen, schlägt die Funktion fehl, da Sie sofort ausgeführt werden würde, ohne zu warten, bis die Start Funktion die Verbindung hergestellt hat.</span><span class="sxs-lookup"><span data-stu-id="11830-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="11830-265">In diesem Fall versucht die Init-Funktion, die getallstocks-Funktion aufzurufen, bevor die Server Verbindung hergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="11830-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="11830-266">Wenn der Server den Preis einer Aktien Person ändert, wird updatestockprice auf verbundenen Clients aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="11830-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="11830-267">Die-Funktion wird der Client-Eigenschaft des StockTicker-Proxys hinzugefügt, um Sie für Aufrufe vom Server verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="11830-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="11830-268">Die Funktion updatestockprice formatiert ein vom Server empfangenes Aktien Objekt auf die gleiche Weise wie in der Init-Funktion in eine Tabellenzeile.</span><span class="sxs-lookup"><span data-stu-id="11830-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="11830-269">Anstatt die Zeile an die Tabelle zu anhängen, wird die aktuelle Zeile der Aktien Tabelle in der Tabelle gefunden und durch die neue Zeile ersetzt.</span><span class="sxs-lookup"><span data-stu-id="11830-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="11830-270">Testen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="11830-270">Test the application</span></span>

1. <span data-ttu-id="11830-271">Drücken Sie F5, um die Anwendung im Debugmodus auszuführen.</span><span class="sxs-lookup"><span data-stu-id="11830-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="11830-272">Die Aktien Tabelle zeigt anfänglich das "laden..." und nach einer kurzen Verzögerung werden die anfänglichen Aktiendaten angezeigt, und die Aktienpreise werden geändert.</span><span class="sxs-lookup"><span data-stu-id="11830-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Laden](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Anfängliche Aktien Tabelle](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Aktien Tabelle empfängt Änderungen vom Server](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="11830-276">Kopieren Sie die URL aus der Adressleiste des Browsers, und fügen Sie Sie in ein oder mehrere neue Browserfenster ein.</span><span class="sxs-lookup"><span data-stu-id="11830-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="11830-277">Die anfängliche Aktien Anzeige ist identisch mit dem ersten Browser, und die Änderungen werden gleichzeitig durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="11830-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="11830-278">Schließen Sie alle Browser, und öffnen Sie einen neuen Browser, und gehen Sie dann zur gleichen URL.</span><span class="sxs-lookup"><span data-stu-id="11830-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="11830-279">Das StockTicker-Singleton-Objekt wird weiterhin auf dem Server ausgeführt, sodass die Aktien Tabelle anzeigt, dass sich die Bestände unverändert geändert haben.</span><span class="sxs-lookup"><span data-stu-id="11830-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="11830-280">(Die anfängliche Tabelle mit 0 (null) Änderungs Zahlen wird nicht angezeigt.)</span><span class="sxs-lookup"><span data-stu-id="11830-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="11830-281">Schließen Sie den Browser.</span><span class="sxs-lookup"><span data-stu-id="11830-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="11830-282">Aktivieren der Protokollierung</span><span class="sxs-lookup"><span data-stu-id="11830-282">Enable logging</span></span>

<span data-ttu-id="11830-283">Signalr verfügt über eine integrierte Protokollierungsfunktion, die Sie auf dem Client aktivieren können, um die Problembehandlung zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="11830-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="11830-284">In diesem Abschnitt aktivieren Sie die Protokollierung und sehen anhand von Beispielen, wie Protokolle anzeigen, welche der folgenden Transportmethoden von signalr verwendet wird:</span><span class="sxs-lookup"><span data-stu-id="11830-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="11830-285">[Websockets](http://en.wikipedia.org/wiki/WebSocket), die von IIS 8 und aktuellen Browsern unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="11830-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="11830-286">Vom [Server gesendete Ereignisse](http://en.wikipedia.org/wiki/Server-sent_events), die von anderen Browsern als Internet Explorer unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="11830-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="11830-287">" [Forever Frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe)", unterstützt von Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="11830-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="11830-288">[AJAX Long](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling)-Abruf, von allen Browsern unterstützt.</span><span class="sxs-lookup"><span data-stu-id="11830-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="11830-289">Für eine beliebige Verbindung wählt signalr die beste Transportmethode aus, die sowohl vom Server als auch vom Client unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="11830-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="11830-290">Öffnen Sie *StockTicker. js* , und fügen Sie eine Codezeile hinzu, um die Protokollierung direkt vor dem Code zu aktivieren, der die Verbindung am Ende der Datei initialisiert:</span><span class="sxs-lookup"><span data-stu-id="11830-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="11830-291">Drücken Sie F5, um das Projekt auszuführen.</span><span class="sxs-lookup"><span data-stu-id="11830-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="11830-292">Öffnen Sie das Fenster "Entwicklertools" des Browsers, und wählen Sie die Konsole aus, um die Protokolle anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="11830-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="11830-293">Möglicherweise müssen Sie die Seite aktualisieren, um die Protokolle von signalr zum Aushandeln der Transportmethode für eine neue Verbindung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="11830-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="11830-294">Wenn Sie Internet Explorer 10 unter Windows 8 (IIS 8) ausführen, ist die Transportmethode websockets.</span><span class="sxs-lookup"><span data-stu-id="11830-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Internet Explorer 10 IIS 8-Konsole](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="11830-296">Wenn Sie Internet Explorer 10 unter Windows 7 (IIS 7,5) ausführen, ist die Transportmethode iframe.</span><span class="sxs-lookup"><span data-stu-id="11830-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10-Konsole, IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="11830-298">Installieren Sie in Firefox das Firebug-Add-in, um ein Konsolenfenster zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="11830-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="11830-299">Wenn Sie Firefox 19 auf Windows 8 (IIS 8) ausführen, ist die Transportmethode websockets.</span><span class="sxs-lookup"><span data-stu-id="11830-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8-websockets](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="11830-301">Wenn Sie Firefox 19 unter Windows 7 (IIS 7,5) ausführen, handelt es sich bei der Transportmethode um vom Server gesendete Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="11830-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 IIS 7,5-Konsole](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="11830-303">Vollständiges StockTicker-Beispiel installieren und überprüfen</span><span class="sxs-lookup"><span data-stu-id="11830-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="11830-304">Die StockTicker-Anwendung, die vom nuget-Paket [Microsoft. Aspnet. signalr. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) installiert wird, umfasst mehr Features als die vereinfachte Version, die Sie soeben erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="11830-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="11830-305">In diesem Abschnitt des Tutorials installieren Sie das nuget-Paket und überprüfen die neuen Features und den Code, der diese implementiert.</span><span class="sxs-lookup"><span data-stu-id="11830-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="11830-306">Installieren des "signalr. Sample"-nuget-Pakets</span><span class="sxs-lookup"><span data-stu-id="11830-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="11830-307">Klicken Sie in **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie auf **nuget-Pakete verwalten**.</span><span class="sxs-lookup"><span data-stu-id="11830-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="11830-308">Klicken Sie im Dialogfeld **nuget-Pakete verwalten** auf **Online**, geben Sie im Feld **Online suchen** den Wert *signalr. Sample* ein, und klicken Sie dann im Paket **signalr. Sample** auf **Installieren** .</span><span class="sxs-lookup"><span data-stu-id="11830-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Installieren des signalr. Sample-Pakets](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="11830-310">Kommentieren Sie in der Datei " *Global. asax* " RouteTable. routes. maphubs (); aus. Zeile, die Sie zuvor in der Anwendung\_Start-Methode hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="11830-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="11830-311">Der Code in " *Global. asax* " ist nicht mehr erforderlich, da das signalr. Sample-Paket die signalr-Route in der *App\_"Start/registerhubs. cs"-* Datei registriert:</span><span class="sxs-lookup"><span data-stu-id="11830-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="11830-312">Die webactivator-Klasse, auf die durch das Assembly-Attribut verwiesen wird, ist im webactivatorex-nuget-Paket enthalten, das als Abhängigkeit des signalr. Sample-Pakets installiert wird.</span><span class="sxs-lookup"><span data-stu-id="11830-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="11830-313">Erweitern Sie in **Projektmappen-Explorer**den Ordner *signalr. Sample* , der durch die Installation des Pakets signalr. Sample erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="11830-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="11830-314">Klicken Sie im Ordner *signalr. Sample* mit der rechten Maustaste auf *StockTicker. html*, und klicken Sie dann auf **als Start Seite festlegen**.</span><span class="sxs-lookup"><span data-stu-id="11830-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="11830-315">Durch die Installation des nuget-Pakets "signalr. Sample" kann die Version von jQuery geändert werden, die Sie im Ordner " *Scripts* " haben.</span><span class="sxs-lookup"><span data-stu-id="11830-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="11830-316">Die neue Datei " *StockTicker. html* ", die das Paket im Ordner " *signalr. Sample* " installiert, ist synchron mit der jQuery-Version, die vom Paket installiert wird. Wenn Sie jedoch die ursprüngliche Datei " *StockTicker. html* " erneut ausführen möchten, müssen Sie möglicherweise zuerst den jQuery-Verweis im Skript-Tag aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="11830-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="11830-317">Ausführen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="11830-317">Run the application</span></span>

1. <span data-ttu-id="11830-318">Drücken Sie F5, um die Anwendung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="11830-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="11830-319">Zusätzlich zu dem Raster, das Sie zuvor gesehen haben, zeigt die vollständige Börsen Ticker-Anwendung ein Fenster mit horizontaler Bildlauf an, in dem dieselben Aktiendaten angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="11830-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="11830-320">Wenn Sie die Anwendung zum ersten Mal ausführen, wird der "Markt" als "geschlossen" angezeigt, und Sie sehen ein statisches Raster und ein Tickerfenster, das keinen Bildlauf durchführt.</span><span class="sxs-lookup"><span data-stu-id="11830-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker-Bildschirm Start](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="11830-322">Wenn Sie auf " **Markt öffnen**" klicken, wird für das **Live Stock-Ticker** -Feld ein horizontaler Bildlauf durchlaufen, und der Server beginnt, in regelmäßigen Abständen Aktienkurs Änderungen zu übertragen</span><span class="sxs-lookup"><span data-stu-id="11830-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="11830-323">Jedes Mal, wenn sich ein Aktienkurs ändert, werden sowohl das **Live Stock Table** -Raster als auch das **Live Stock-tickfeld** aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="11830-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="11830-324">Wenn die Preisänderung eines Bestands positiv ist, wird der Kurs mit einem grünen Hintergrund angezeigt, und wenn die Änderung negativ ist, wird die Aktie mit einem roten Hintergrund angezeigt.</span><span class="sxs-lookup"><span data-stu-id="11830-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![StockTicker-APP, Markt offen](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="11830-326">Die Schaltfläche " **Markt schließen** " hält die Änderungen an und beendet den Bildlauf, und die Schaltfläche " **Zurücksetzen** " setzt alle Aktiendaten auf den ursprünglichen Zustand zurück, bevor die Preisänderungen begonnen wurden</span><span class="sxs-lookup"><span data-stu-id="11830-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="11830-327">Wenn Sie mehr Browserfenster öffnen und zur gleichen URL wechseln, sehen Sie, dass die gleichen Daten in jedem Browser dynamisch gleichzeitig aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="11830-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="11830-328">Wenn Sie auf eine der Schaltflächen klicken, reagieren alle Browser gleichzeitig auf dieselbe Weise.</span><span class="sxs-lookup"><span data-stu-id="11830-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="11830-329">Live Stock Ticker-Anzeige</span><span class="sxs-lookup"><span data-stu-id="11830-329">Live Stock Ticker display</span></span>

<span data-ttu-id="11830-330">Die **Live Stock Ticker** -Anzeige ist eine unsortierter Liste in einem div-Element, das von CSS-Stilen in eine einzelne Zeile formatiert wird.</span><span class="sxs-lookup"><span data-stu-id="11830-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="11830-331">Der Ticker wird auf die gleiche Weise wie die Tabelle initialisiert und aktualisiert: durch Ersetzen von Platzhaltern in einer &lt;Li&gt; Vorlagen Zeichenfolge und dynamisches Hinzufügen der &lt;Li&gt; Elemente zum &lt;Element&gt; UL.</span><span class="sxs-lookup"><span data-stu-id="11830-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="11830-332">Der Bildlauf wird mithilfe der jQuery-Funktion "animieren" durchgeführt, um den Rand Links von der ungeordneten Liste innerhalb des div-Vorgangs zu verändern.</span><span class="sxs-lookup"><span data-stu-id="11830-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="11830-333">Der Stock Ticker-HTML:</span><span class="sxs-lookup"><span data-stu-id="11830-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="11830-334">Das Aktien-Ticker-CSS:</span><span class="sxs-lookup"><span data-stu-id="11830-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="11830-335">Der jQuery-Code, der den Bildlauf durchführt:</span><span class="sxs-lookup"><span data-stu-id="11830-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="11830-336">Zusätzliche Methoden auf dem Server, die vom Client aufgerufen werden können</span><span class="sxs-lookup"><span data-stu-id="11830-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="11830-337">Die stocktickerhub-Klasse definiert vier zusätzliche Methoden, die vom Client aufgerufen werden können:</span><span class="sxs-lookup"><span data-stu-id="11830-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="11830-338">Openmarket, closemarket und Reset werden als Antwort auf die Schaltflächen oben auf der Seite aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="11830-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="11830-339">Sie veranschaulichen das Muster eines Clients, der eine Zustandsänderung auslöst, die sofort an alle Clients weitergegeben wird.</span><span class="sxs-lookup"><span data-stu-id="11830-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="11830-340">Jede dieser Methoden Ruft eine Methode in der StockTicker-Klasse auf, die sich auf die Markt Zustandsänderung auswirkt und dann den neuen Status überträgt.</span><span class="sxs-lookup"><span data-stu-id="11830-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="11830-341">In der Stock Ticker-Klasse wird der Marktstatus durch eine marketstate-Eigenschaft verwaltet, die einen marketstate-Enumerationswert zurückgibt:</span><span class="sxs-lookup"><span data-stu-id="11830-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="11830-342">Jede Methode, die den Marktstatus ändert, wird in einem Sperrblock angezeigt, da die StockTicker-Klasse threadsafe sein muss:</span><span class="sxs-lookup"><span data-stu-id="11830-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="11830-343">Um sicherzustellen, dass dieser Code Thread sicher ist, wird das Feld \_marketstate, das die Eigenschaft "marketstate" sichert, als flüchtig markiert.</span><span class="sxs-lookup"><span data-stu-id="11830-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="11830-344">Die Methoden "broadcastmarketstatechange" und "broadcastmarketreset" ähneln der von Ihnen bereits erkannten Methode "broadcaststockprice", mit dem Unterschied, dass Sie verschiedene Methoden aufruft, die auf dem Client definiert sind:</span><span class="sxs-lookup"><span data-stu-id="11830-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="11830-345">Zusätzliche Funktionen auf dem Client, die vom Server aufgerufen werden können</span><span class="sxs-lookup"><span data-stu-id="11830-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="11830-346">Die Funktion "updatestockprice" verarbeitet nun sowohl das Raster als auch das tickerdisplay und verwendet "jQuery. Color", um rote und grüne Farben zu blinken.</span><span class="sxs-lookup"><span data-stu-id="11830-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="11830-347">Neue Funktionen in *signalr. StockTicker. js* aktivieren und deaktivieren die Schaltflächen auf der Grundlage des Markt Zustands, und Sie können den horizontalen Bildlauf des tickfensters abbrechen oder starten.</span><span class="sxs-lookup"><span data-stu-id="11830-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="11830-348">Da dem Ticker. Client mehrere Funktionen hinzugefügt werden, werden diese mithilfe der Erweiterungs [Funktion "jQuery](http://api.jquery.com/jQuery.extend/) " hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="11830-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="11830-349">Zusätzliche Client Einrichtung nach dem Herstellen der Verbindung</span><span class="sxs-lookup"><span data-stu-id="11830-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="11830-350">Nachdem der Client die Verbindung hergestellt hat, gibt es einige zusätzliche Aufgaben: ermitteln Sie, ob der Markt geöffnet oder geschlossen ist, um die entsprechende marketopup-oder marketclosed-Funktion aufzurufen, und fügen Sie die Server Methodenaufrufe an die Schaltflächen an.</span><span class="sxs-lookup"><span data-stu-id="11830-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="11830-351">Die Server Methoden werden erst nach dem Herstellen der Verbindung mit den Schaltflächen verknüpft, sodass der Code nicht versuchen kann, die Server Methoden aufzurufen, bevor diese verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="11830-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="11830-352">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="11830-352">Next steps</span></span>

<span data-ttu-id="11830-353">In diesem Tutorial haben Sie gelernt, wie Sie eine signalr-Anwendung programmieren, die Nachrichten von dem Server sowohl regelmäßig als auch als Reaktion auf Benachrichtigungen von einem beliebigen Client an alle verbundenen Clients überträgt.</span><span class="sxs-lookup"><span data-stu-id="11830-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="11830-354">Das Muster der Verwendung einer Multithread-Singleton-Instanz zur Wartung des Server Zustands kann auch in Online-Spielszenarien mit mehreren Spielen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="11830-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="11830-355">Ein Beispiel finden Sie [unter dem shootr-Spiel, das auf signalr basiert](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="11830-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="11830-356">Lernprogramme, in denen Peer-zu-Peer-Kommunikations Szenarios angezeigt werden, finden Sie unter [Getting Started with signalr](index.md) und [Echt Zeit Aktualisierung mit signalr](index.md).</span><span class="sxs-lookup"><span data-stu-id="11830-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="11830-357">Weitere Informationen zu den erweiterten signalr-Entwicklungskonzepten finden Sie auf den folgenden Websites für signalr-Quellcode und-Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="11830-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="11830-358">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="11830-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="11830-359">Signalr-Projekt</span><span class="sxs-lookup"><span data-stu-id="11830-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="11830-360">Signalr GitHub und Beispiele</span><span class="sxs-lookup"><span data-stu-id="11830-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="11830-361">Signalr-wiki</span><span class="sxs-lookup"><span data-stu-id="11830-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
