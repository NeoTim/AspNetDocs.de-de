---
uid: web-api/overview/error-handling/web-api-global-error-handling
title: Globale Fehlerbehandlung in ASP.NET Web-API 2 - ASP.NET 4.x
author: davidmatson
description: Eine Übersicht über die globale Fehlerbehandlung in ASP.NET Web API 2 für ASP.NET 4.x.
ms.author: riande
ms.date: 02/03/2014
ms.custom: seoapril2019
ms.assetid: bffd7863-f63b-4b23-a13c-372b5492e9fb
msc.legacyurl: /web-api/overview/error-handling/web-api-global-error-handling
msc.type: authoredcontent
ms.openlocfilehash: 5ff54d2e4ed881ce927d0a401fb79d9b8bc5b8a1
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675430"
---
# <a name="global-error-handling-in-aspnet-web-api-2"></a><span data-ttu-id="28bec-103">Globale Fehlerbehandlung in ASP.NET Web-API 2</span><span class="sxs-lookup"><span data-stu-id="28bec-103">Global Error Handling in ASP.NET Web API 2</span></span>

<span data-ttu-id="28bec-104">von [David Matson](https://github.com/davidmatson), [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="28bec-104">by [David Matson](https://github.com/davidmatson), [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="28bec-105">Dieses Thema bietet einen Überblick über die globale Fehlerbehandlung in ASP.NET Web-API 2 für ASP.NET 4.x.</span><span class="sxs-lookup"><span data-stu-id="28bec-105">This topic provides an overview of global error handling in ASP.NET Web API 2 for ASP.NET 4.x.</span></span> <span data-ttu-id="28bec-106">Heute gibt es in der Web-API keine einfache Möglichkeit, Fehler global zu protokollieren oder zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="28bec-106">Today there's no easy way in Web API to log or handle errors globally.</span></span> <span data-ttu-id="28bec-107">Einige nicht behandelte Ausnahmen können über [Ausnahmefilter](exception-handling.md)verarbeitet werden, es gibt jedoch eine Reihe von Fällen, die Ausnahmefilter nicht verarbeiten können.</span><span class="sxs-lookup"><span data-stu-id="28bec-107">Some unhandled exceptions can be processed via [exception filters](exception-handling.md), but there are a number of cases that exception filters can't handle.</span></span> <span data-ttu-id="28bec-108">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="28bec-108">For example:</span></span>

1. <span data-ttu-id="28bec-109">Von Controllerkonstruktoren ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="28bec-109">Exceptions thrown from controller constructors.</span></span>
2. <span data-ttu-id="28bec-110">Von Meldungshandlern ausgelöste Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="28bec-110">Exceptions thrown from message handlers.</span></span>
3. <span data-ttu-id="28bec-111">Während des Routings ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="28bec-111">Exceptions thrown during routing.</span></span>
4. <span data-ttu-id="28bec-112">Während der Serialisierung von Antwortinhalten ausgelöste Ausnahmen.</span><span class="sxs-lookup"><span data-stu-id="28bec-112">Exceptions thrown during response content serialization.</span></span>

<span data-ttu-id="28bec-113">Wir möchten eine einfache, konsistente Möglichkeit bieten, diese Ausnahmen zu protokollieren und (wo möglich) zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="28bec-113">We want to provide a simple, consistent way to log and handle (where possible) these exceptions.</span></span> 

<span data-ttu-id="28bec-114">Es gibt zwei Hauptfälle für die Behandlung von Ausnahmen, den Fall, in dem wir in der Lage sind, eine Fehlerantwort zu senden, und den Fall, in dem wir nur die Ausnahme protokollieren können.</span><span class="sxs-lookup"><span data-stu-id="28bec-114">There are two major cases for handling exceptions, the case where we are able to send an error response and the case where all we can do is log the exception.</span></span> <span data-ttu-id="28bec-115">Ein Beispiel für den letzteren Fall ist, wenn eine Ausnahme in der Mitte von Streaming-Antwortinhalten ausgelöst wird. in diesem Fall ist es zu spät, eine neue Antwortnachricht zu senden, da der Statuscode, die Header und der Teilinhalt bereits über den Draht gegangen sind, sodass wir die Verbindung einfach abbrechen.</span><span class="sxs-lookup"><span data-stu-id="28bec-115">An example for the latter case is when an exception is thrown in the middle of streaming response content; in that case it is too late to send a new response message since the status code, headers, and partial content have already gone across the wire, so we simply abort the connection.</span></span> <span data-ttu-id="28bec-116">Auch wenn die Ausnahme nicht behandelt werden kann, um eine neue Antwortnachricht zu erzeugen, unterstützen wir weiterhin die Protokollierung der Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="28bec-116">Even though the exception can't be handled to produce a new response message, we still support logging the exception.</span></span> <span data-ttu-id="28bec-117">In Fällen, in denen wir einen Fehler erkennen können, können wir eine entsprechende Fehlerantwort zurückgeben, wie im Folgenden gezeigt:</span><span class="sxs-lookup"><span data-stu-id="28bec-117">In cases where we can detect an error, we can return an appropriate error response as shown in the following:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample1.cs?highlight=6)]

### <a name="existing-options"></a><span data-ttu-id="28bec-118">Vorhandene Optionen</span><span class="sxs-lookup"><span data-stu-id="28bec-118">Existing Options</span></span>

<span data-ttu-id="28bec-119">Zusätzlich zu [Ausnahmefiltern](exception-handling.md)können [Nachrichtenhandler](../advanced/http-message-handlers.md) heute verwendet werden, um alle Antworten auf 500 Ebenen zu beobachten, aber das Handeln auf diese Antworten ist schwierig, da ihnen der Kontext über den ursprünglichen Fehler fehlt.</span><span class="sxs-lookup"><span data-stu-id="28bec-119">In addition to [exception filters](exception-handling.md), [message handlers](../advanced/http-message-handlers.md) can be used today to observe all 500-level responses, but acting on those responses is difficult, as they lack context about the original error.</span></span> <span data-ttu-id="28bec-120">Nachrichtenhandler haben auch einige der gleichen Einschränkungen wie Ausnahmefilter in Bezug auf die Fälle, die sie behandeln können.</span><span class="sxs-lookup"><span data-stu-id="28bec-120">Message handlers also have some of the same limitations as exception filters regarding the cases they can handle.</span></span> <span data-ttu-id="28bec-121">Während die Web-API über eine Ablaufverfolgungsinfrastruktur verfügt, die Fehlerbedingungen erfasst, dient die Ablaufverfolgungsinfrastruktur zu Diagnosezwecken und ist nicht für die Ausführung in Produktionsumgebungen konzipiert oder geeignet.</span><span class="sxs-lookup"><span data-stu-id="28bec-121">While Web API does have tracing infrastructure that captures error conditions the tracing infrastructure is for diagnostics purposes and is not designed or suited for running in production environments.</span></span> <span data-ttu-id="28bec-122">Globale Ausnahmebehandlung und Protokollierung sollten Dienste sein, die während der Produktion ausgeführt und in vorhandene Überwachungslösungen (z. B. [ELMAH )](https://code.google.com/p/elmah/)eingebunden werden können.</span><span class="sxs-lookup"><span data-stu-id="28bec-122">Global exception handling and logging should be services that can run during production and be plugged into existing monitoring solutions (for example, [ELMAH](https://code.google.com/p/elmah/)).</span></span>

### <a name="solution-overview"></a><span data-ttu-id="28bec-123">Übersicht über die Lösungen</span><span class="sxs-lookup"><span data-stu-id="28bec-123">Solution Overview</span></span>

 <span data-ttu-id="28bec-124">Wir bieten zwei neue benutzeraustauschbare Dienste, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) und IExceptionHandler, um nicht behandelte Ausnahmen zu protokollieren und zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="28bec-124">We provide two new user-replaceable services, [IExceptionLogger](../releases/whats-new-in-aspnet-web-api-21.md) and IExceptionHandler, to log and handle unhandled exceptions.</span></span> <span data-ttu-id="28bec-125">Die Dienstleistungen sind sehr ähnlich, mit zwei Hauptunterschieden:</span><span class="sxs-lookup"><span data-stu-id="28bec-125">The services are very similar, with two main differences:</span></span>

1. <span data-ttu-id="28bec-126">Wir unterstützen die Registrierung mehrerer Ausnahmeprotokollierungen, aber nur einen einzelnen Ausnahmehandler.</span><span class="sxs-lookup"><span data-stu-id="28bec-126">We support registering multiple exception loggers but only a single exception handler.</span></span>
2. <span data-ttu-id="28bec-127">Ausnahmeprotokoller werden immer aufgerufen, auch wenn wir im Begriff sind, die Verbindung abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="28bec-127">Exception loggers always get called, even if we're about to abort the connection.</span></span> <span data-ttu-id="28bec-128">Ausnahmehandler werden nur aufgerufen, wenn wir noch auswählen können, welche Antwortnachricht gesendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="28bec-128">Exception handlers only get called when we're still able to choose which response message to send.</span></span>

<span data-ttu-id="28bec-129">Beide Dienste bieten Zugriff auf einen Ausnahmekontext, der relevante Informationen ab dem Punkt enthält, an dem die Ausnahme erkannt wurde, insbesondere [die HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), die [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), die ausgelöste Ausnahme und die Ausnahmequelle (Details unten).</span><span class="sxs-lookup"><span data-stu-id="28bec-129">Both services provide access to an exception context containing relevant information from the point where the exception was detected, particularly the [HttpRequestMessage](https://msdn.microsoft.com/library/system.net.http.httprequestmessage(v=vs.110).aspx), the [HttpRequestContext](https://msdn.microsoft.com/library/system.web.http.controllers.httprequestcontext(v=vs.118).aspx), the thrown exception and the exception source (details below).</span></span>

### <a name="design-principles"></a><span data-ttu-id="28bec-130">Entwurfsprinzipien</span><span class="sxs-lookup"><span data-stu-id="28bec-130">Design Principles</span></span>

1. <span data-ttu-id="28bec-131">**Keine brechenden Änderungen** Da diese Funktionalität in einer kleineren Version hinzugefügt wird, besteht eine wichtige Einschränkung, die sich auf die Lösung auswirkt, darin, dass es keine Änderungen gibt, weder zum Typkontrakten noch zum Verhalten.</span><span class="sxs-lookup"><span data-stu-id="28bec-131">**No breaking changes** Because this functionality is being added in a minor release, one important constraint impacting the solution is that there be no breaking changes, either to type contracts or to behavior.</span></span> <span data-ttu-id="28bec-132">Diese Einschränkung schloss einige Bereinigungen aus, die wir gerne in Bezug auf bestehende Fangblöcke durchgeführt hätten, die Ausnahmen in 500 Antworten verwandelten.</span><span class="sxs-lookup"><span data-stu-id="28bec-132">This constraint ruled out some cleanup we would like to have done in terms of existing catch blocks turning exceptions into 500 responses.</span></span> <span data-ttu-id="28bec-133">Diese zusätzliche Bereinigung ist etwas, das wir für eine nachfolgende Hauptversion in Betracht ziehen könnten.</span><span class="sxs-lookup"><span data-stu-id="28bec-133">This additional cleanup is something we might consider for a subsequent major release.</span></span> <span data-ttu-id="28bec-134">Wenn dies für Sie wichtig ist, stimmen Sie bitte darüber unter [ASP.NET Web-API-Benutzerstimme](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception)ab.</span><span class="sxs-lookup"><span data-stu-id="28bec-134">If this is important to you please vote on it at [ASP.NET Web API user voice](http://aspnet.uservoice.com/forums/147201-asp-net-web-api/suggestions/5451321-add-flag-to-enable-iexceptionlogger-and-iexception).</span></span>
2. <span data-ttu-id="28bec-135">**Aufrechterhaltung der Konsistenz mit Web-API-Konstrukten** Die Filterpipeline der Web-API ist eine hervorragende Möglichkeit, querschnittsübergreifende Bedenken mit der Flexibilität zu behandeln, die Logik auf einen aktionsspezifischen, Controller-spezifischen oder globalen Bereich anzuwenden.</span><span class="sxs-lookup"><span data-stu-id="28bec-135">**Maintaining consistency with Web API constructs** Web API's filter pipeline is a great way to handle cross-cutting concerns with the flexibility of applying the logic at an action-specific, controller-specific or global scope.</span></span> <span data-ttu-id="28bec-136">Filter, einschließlich Ausnahmefilter, haben immer Aktions- und Controllerkontexte, auch wenn sie im globalen Bereich registriert sind.</span><span class="sxs-lookup"><span data-stu-id="28bec-136">Filters, including exception filters, always have action and controller contexts, even when registered at the global scope.</span></span> <span data-ttu-id="28bec-137">Dieser Vertrag ist für Filter sinnvoll, bedeutet jedoch, dass Ausnahmefilter, auch global ausgerichtete, für einige Ausnahmebehandlungsfälle nicht geeignet sind, z. B. Ausnahmen von Nachrichtenhandlern, bei denen kein Aktions- oder Controllerkontext vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-137">That contract makes sense for filters, but it means that exception filters, even globally scoped ones, aren't a good fit for some exception handling cases, such as exceptions from message handlers, where no action or controller context exists.</span></span> <span data-ttu-id="28bec-138">Wenn wir das flexible Scoping von Filtern für die Ausnahmebehandlung nutzen wollen, benötigen wir immer noch Ausnahmefilter.</span><span class="sxs-lookup"><span data-stu-id="28bec-138">If we want to use the flexible scoping afforded by filters for exception handling, we still need exception filters.</span></span> <span data-ttu-id="28bec-139">Wenn wir jedoch Ausnahmen außerhalb eines Controllerkontexts behandeln müssen, benötigen wir auch ein separates Konstrukt für die vollständige globale Fehlerbehandlung (etwas ohne den Controllerkontext und die Einschränkungen des Aktionskontexts).</span><span class="sxs-lookup"><span data-stu-id="28bec-139">But if we need to handle exception outside of a controller context, we also need a separate construct for full global error handling (something without the controller context and action context constraints).</span></span>

### <a name="when-to-use"></a><span data-ttu-id="28bec-140">Wann zu verwenden</span><span class="sxs-lookup"><span data-stu-id="28bec-140">When to Use</span></span>

- <span data-ttu-id="28bec-141">Ausnahmeprotokollierungen sind die Lösung, um alle nicht behandelten Ausnahmen zu sehen, die von der Web-API abgefangen werden.</span><span class="sxs-lookup"><span data-stu-id="28bec-141">Exception loggers are the solution to seeing all unhandled exception caught by Web API.</span></span>
- <span data-ttu-id="28bec-142">Ausnahmehandler sind die Lösung zum Anpassen aller möglichen Antworten an nicht behandelte Ausnahmen, die von der Web-API abgefangen werden.</span><span class="sxs-lookup"><span data-stu-id="28bec-142">Exception handlers are the solution for customizing all possible responses to unhandled exceptions caught by Web API.</span></span>
- <span data-ttu-id="28bec-143">Ausnahmefilter sind die einfachste Lösung für die Verarbeitung der nicht behandelten Ausnahmen der Teilmenge, die sich auf eine bestimmte Aktion oder einen bestimmten Controller beziehen.</span><span class="sxs-lookup"><span data-stu-id="28bec-143">Exception filters are the easiest solution for processing the subset unhandled exceptions related to a specific action or controller.</span></span>

### <a name="service-details"></a><span data-ttu-id="28bec-144">Dienstdetails</span><span class="sxs-lookup"><span data-stu-id="28bec-144">Service Details</span></span>

 <span data-ttu-id="28bec-145">Die Ausnahmeprotokollierungs- und Handlerdienstschnittstellen sind einfache asynchrone Methoden, die die entsprechenden Kontexte verwenden:</span><span class="sxs-lookup"><span data-stu-id="28bec-145">The exception logger and handler service interfaces are simple async methods taking the respective contexts:</span></span> 

[!code-csharp[Main](web-api-global-error-handling/samples/sample2.cs)]

 <span data-ttu-id="28bec-146">Wir bieten auch Basisklassen für beide Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="28bec-146">We also provide base classes for both of these interfaces.</span></span> <span data-ttu-id="28bec-147">Das Überschreiben der Core-Methoden (Sync oder async) ist alles, was zum Protokollieren oder Behandeln zu den empfohlenen Zeiten erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-147">Overriding the core (sync or async) methods is all that is required to log or handle at the recommended times.</span></span> <span data-ttu-id="28bec-148">Bei der `ExceptionLogger` Protokollierung stellt die Basisklasse sicher, dass die Core-Protokollierungsmethode nur einmal für jede Ausnahme aufgerufen wird (auch wenn sie später weiter oben in der Aufrufliste weiter verbreitet wird und erneut abgefangen wird).</span><span class="sxs-lookup"><span data-stu-id="28bec-148">For logging, the `ExceptionLogger` base class will ensure that the core logging method is only called once for each exception (even if it later propagates further up the call stack and is caught again).</span></span> <span data-ttu-id="28bec-149">Die `ExceptionHandler` Basisklasse ruft die Kernbehandlungsmethode nur für Ausnahmen am oberen Rand der Aufrufliste auf und ignoriert ältere verschachtelte Catch-Blöcke.</span><span class="sxs-lookup"><span data-stu-id="28bec-149">The `ExceptionHandler` base class will call the core handling method only for exceptions at the top of the call stack, ignoring legacy nested catch blocks.</span></span> <span data-ttu-id="28bec-150">(Vereinfachte Versionen dieser Basisklassen finden Sie im Anhang unten.) Beide `IExceptionLogger` `IExceptionHandler` und erhalten Informationen über `ExceptionContext`die Ausnahme über eine .</span><span class="sxs-lookup"><span data-stu-id="28bec-150">(Simplified versions of these base classes are in the appendix below.) Both `IExceptionLogger` and `IExceptionHandler` receive information about the exception via an `ExceptionContext`.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample3.cs)]

<span data-ttu-id="28bec-151">Wenn das Framework eine Ausnahmeprotokollierung oder einen Ausnahmehandler aufruft, stellt es immer eine `Exception` und eine `Request`bereit.</span><span class="sxs-lookup"><span data-stu-id="28bec-151">When the framework calls an exception logger or an exception handler, it will always provide an `Exception` and a `Request`.</span></span> <span data-ttu-id="28bec-152">Mit Ausnahme von Komponententests wird `RequestContext`es auch immer eine .</span><span class="sxs-lookup"><span data-stu-id="28bec-152">Except for unit testing, it will also always provide a `RequestContext`.</span></span> <span data-ttu-id="28bec-153">Es wird selten `ControllerContext` `ActionContext` eine und (nur beim Aufrufen von der catch-Block für Ausnahmefilter).</span><span class="sxs-lookup"><span data-stu-id="28bec-153">It will rarely provide a `ControllerContext` and `ActionContext` (only when calling from the catch block for exception filters).</span></span> <span data-ttu-id="28bec-154">Es wird sehr `Response`selten eine liefern (nur in bestimmten IIS-Fällen, wenn in der Mitte des Versuchs, die Antwort zu schreiben).</span><span class="sxs-lookup"><span data-stu-id="28bec-154">It will very rarely provide a `Response`(only in certain IIS cases when in the middle of trying to write the response).</span></span> <span data-ttu-id="28bec-155">Beachten Sie, dass es, `null` da einige dieser Eigenschaften `null` möglicherweise darin bestehen, dass der Consumer vor dem Zugriff auf Member der Ausnahmeklasse nachprüfe.`CatchBlock`</span><span class="sxs-lookup"><span data-stu-id="28bec-155">Note that because some of these properties may be `null` it is up to the consumer to check for `null` before accessing members of the exception class.`CatchBlock`</span></span> <span data-ttu-id="28bec-156">ist eine Zeichenfolge, die angibt, welcher catch-Block die Ausnahme gesehen hat.</span><span class="sxs-lookup"><span data-stu-id="28bec-156">is a string indicating which catch block saw the exception.</span></span> <span data-ttu-id="28bec-157">Die catch-Blockzeichenfolgen lauten wie folgt:</span><span class="sxs-lookup"><span data-stu-id="28bec-157">The catch block strings are as follows:</span></span>

- <span data-ttu-id="28bec-158">HttpServer (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="28bec-158">HttpServer (SendAsync method)</span></span>
- <span data-ttu-id="28bec-159">HttpControllerDispatcher (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="28bec-159">HttpControllerDispatcher (SendAsync method)</span></span>
- <span data-ttu-id="28bec-160">HttpBatchHandler (SendAsync-Methode)</span><span class="sxs-lookup"><span data-stu-id="28bec-160">HttpBatchHandler (SendAsync method)</span></span>
- <span data-ttu-id="28bec-161">IExceptionFilter (ApiControllers Verarbeitung der Ausnahmefilterpipeline in ExecuteAsync)</span><span class="sxs-lookup"><span data-stu-id="28bec-161">IExceptionFilter (ApiController's processing of the exception filter pipeline in ExecuteAsync)</span></span>
- <span data-ttu-id="28bec-162">OWIN-Host:</span><span class="sxs-lookup"><span data-stu-id="28bec-162">OWIN host:</span></span>

    - <span data-ttu-id="28bec-163">HttpMessageHandlerAdapter.BufferResponseContentAsync (für Pufferausgabe)</span><span class="sxs-lookup"><span data-stu-id="28bec-163">HttpMessageHandlerAdapter.BufferResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="28bec-164">HttpMessageHandlerAdapter.CopyResponseContentAsync (für Streaming-Ausgabe)</span><span class="sxs-lookup"><span data-stu-id="28bec-164">HttpMessageHandlerAdapter.CopyResponseContentAsync (for streaming output)</span></span>
- <span data-ttu-id="28bec-165">Webhost:</span><span class="sxs-lookup"><span data-stu-id="28bec-165">Web host:</span></span>

    - <span data-ttu-id="28bec-166">HttpControllerHandler.WriteBufferedResponseContentAsync (für Pufferausgabe)</span><span class="sxs-lookup"><span data-stu-id="28bec-166">HttpControllerHandler.WriteBufferedResponseContentAsync (for buffering output)</span></span>
    - <span data-ttu-id="28bec-167">HttpControllerHandler.WriteStreamedResponseContentAsync (für Streaming-Ausgabe)</span><span class="sxs-lookup"><span data-stu-id="28bec-167">HttpControllerHandler.WriteStreamedResponseContentAsync (for streaming output)</span></span>
    - <span data-ttu-id="28bec-168">HttpControllerHandler.WriteErrorResponseContentAsync (bei Fehlern bei der Fehlerwiederherstellung im gepufferten Ausgabemodus)</span><span class="sxs-lookup"><span data-stu-id="28bec-168">HttpControllerHandler.WriteErrorResponseContentAsync (for failures in error recovery under buffered output mode)</span></span>

<span data-ttu-id="28bec-169">Die Liste der catch-Blockzeichenfolgen ist auch über statische schreibgeschützte Eigenschaften verfügbar.</span><span class="sxs-lookup"><span data-stu-id="28bec-169">The list of catch block strings is also available via static readonly properties.</span></span> <span data-ttu-id="28bec-170">(Die Kern-Catch-Blockzeichenfolge befindet sich auf den statischen ExceptionCatchBlocks; der Rest wird jeweils in einer statischen Klasse für OWIN und Webhost angezeigt).`IsTopLevelCatchBlock`</span><span class="sxs-lookup"><span data-stu-id="28bec-170">(The core catch block string are on the static ExceptionCatchBlocks; the remainder appear on one static class each for OWIN and web host).`IsTopLevelCatchBlock`</span></span> <span data-ttu-id="28bec-171">ist hilfreich, um das empfohlene Muster der Behandlung von Ausnahmen nur am oberen Rand der Aufrufliste zu befolgen.</span><span class="sxs-lookup"><span data-stu-id="28bec-171">is helpful for following the recommended pattern of handling exceptions only at the top of the call stack.</span></span> <span data-ttu-id="28bec-172">Anstatt Ausnahmen in 500 Antworten zu verwandeln, an der überall ein geschachtelter Catch-Block auftritt, kann ein Ausnahmehandler Ausnahmen propagieren lassen, bis sie vom Host angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="28bec-172">Rather than turning exceptions into 500 responses anywhere a nested catch block occurs, an exception handler can let exceptions propagate until they are about to be seen by the host.</span></span>

<span data-ttu-id="28bec-173">Zusätzlich zu `ExceptionContext`der erhält ein Logger eine weitere `ExceptionLoggerContext`Information über die volle :</span><span class="sxs-lookup"><span data-stu-id="28bec-173">In addition to the `ExceptionContext`, a logger gets one more piece of information via the full `ExceptionLoggerContext`:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample4.cs)]

<span data-ttu-id="28bec-174">Die zweite `CanBeHandled`Eigenschaft , ermöglicht es einer Protokollierung, eine Ausnahme zu identifizieren, die nicht behandelt werden kann.</span><span class="sxs-lookup"><span data-stu-id="28bec-174">The second property, `CanBeHandled`, allows a logger to identify an exception that cannot be handled.</span></span> <span data-ttu-id="28bec-175">Wenn die Verbindung abgebrochen werden soll und keine neue Antwortnachricht gesendet werden kann, werden die Logger aufgerufen, aber der Handler wird ***nicht*** aufgerufen, und die Logger können dieses Szenario anhand dieser Eigenschaft identifizieren.</span><span class="sxs-lookup"><span data-stu-id="28bec-175">When the connection is about to be aborted and no new response message can be sent, the loggers will be called but the handler will ***not*** be called, and the loggers can identify this scenario from this property.</span></span>

<span data-ttu-id="28bec-176">Zusätzlich zu `ExceptionContext`der erhält ein Handler eine weitere Eigenschaft, die er vollständig `ExceptionHandlerContext` festlegen kann, um die Ausnahme zu behandeln:</span><span class="sxs-lookup"><span data-stu-id="28bec-176">In additional to the `ExceptionContext`, a handler gets one more property it can set on the full `ExceptionHandlerContext` to handle the exception:</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample5.cs)]

<span data-ttu-id="28bec-177">Ein Ausnahmehandler gibt an, dass er `Result` eine Ausnahme behandelt hat, indem er die Eigenschaft auf ein Aktionsergebnis festlegt (z. B. [exceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx)oder ein benutzerdefiniertes Ergebnis).</span><span class="sxs-lookup"><span data-stu-id="28bec-177">An exception handler indicates that it has handled an exception by setting the `Result` property to an action result (for example, an [ExceptionResult](https://msdn.microsoft.com/library/system.web.http.results.exceptionresult(v=vs.118).aspx), [InternalServerErrorResult](https://msdn.microsoft.com/library/system.web.http.results.internalservererrorresult(v=vs.118).aspx), [StatusCodeResult](https://msdn.microsoft.com/library/system.web.http.results.statuscoderesult(v=vs.118).aspx), or a custom result).</span></span> <span data-ttu-id="28bec-178">Wenn `Result` die Eigenschaft null ist, wird die Ausnahme nicht behandelt, und die ursprüngliche Ausnahme wird erneut ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="28bec-178">If the `Result` property is null, the exception is unhandled and the original exception will be re-thrown.</span></span>

<span data-ttu-id="28bec-179">Für Ausnahmen am oberen Rand der Aufrufliste haben wir einen zusätzlichen Schritt unternommen, um sicherzustellen, dass die Antwort für API-Aufrufer geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-179">For exceptions at the top of the call stack, we took an extra step to ensure the response is appropriate for API callers.</span></span> <span data-ttu-id="28bec-180">Wenn die Ausnahme an den Host weitergegeben wird, wird dem Aufrufer der gelbe Bildschirm des Todes oder eine andere vom Host bereitgestellte Antwort angezeigt, die in der Regel HTML und normalerweise keine geeignete API-Fehlerantwort ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-180">If the exception propagates up to the host, the caller would see the yellow screen of death or some other host provided response which is typically HTML and not usually an appropriate API error response.</span></span> <span data-ttu-id="28bec-181">In diesen Fällen startet das Ergebnis ungleich NULL, und nur wenn `null` ein benutzerdefinierter Ausnahmehandler es explizit auf (unbehandelt) zurücksetzt, wird die Ausnahme an den Host weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="28bec-181">In these cases, the Result starts out non-null, and only if a custom exception handler explicitly sets it back to `null` (unhandled) will the exception propagate to the host.</span></span> <span data-ttu-id="28bec-182">Die `Result` `null` Einstellung auf in solchen Fällen kann für zwei Szenarien nützlich sein:</span><span class="sxs-lookup"><span data-stu-id="28bec-182">Setting `Result` to `null` in such cases can be useful for two scenarios:</span></span>

1. <span data-ttu-id="28bec-183">OWIN gehostete Web-API mit benutzerdefinierter Ausnahmebehandlung von Middleware, die vor/außerhalb der Web-API registriert ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-183">OWIN hosted Web API with custom exception handling middleware registered before/outside Web API.</span></span>
2. <span data-ttu-id="28bec-184">Lokales Debuggen über einen Browser, bei dem der gelbe Bildschirm des Todes tatsächlich eine hilfreiche Antwort für eine nicht behandelte Ausnahme ist.</span><span class="sxs-lookup"><span data-stu-id="28bec-184">Local debugging via a browser, where the yellow screen of death is actually a helpful response for an unhandled exception.</span></span>

<span data-ttu-id="28bec-185">Sowohl für Ausnahmeprotokollierungen als auch für Ausnahmehandler tun wir nichts, um wiederherzustellen, wenn der Logger oder Handler selbst eine Ausnahme auslöst.</span><span class="sxs-lookup"><span data-stu-id="28bec-185">For both exception loggers and exception handlers, we don't do anything to recover if the logger or handler itself throws an exception.</span></span> <span data-ttu-id="28bec-186">(Anstatt die Ausnahme propagieren zu lassen, lassen Sie Feedback am Ende dieser Seite, wenn Sie einen besseren Ansatz haben.) Der Vertrag für Ausnahmelogger und Handler besteht darin, dass sie ausnahmen nicht an ihre Aufrufer weitergeben lassen sollten. Andernfalls wird die Ausnahme nur an den Host weitergegeben, was zu einem HTML-Fehler führt (z. B. ASP). NET-Gelbbildschirm), der an den Client zurückgesendet wird (was normalerweise nicht die bevorzugte Option für API-Aufrufer ist, die JSON oder XML erwarten).</span><span class="sxs-lookup"><span data-stu-id="28bec-186">(Other than letting the exception propagate, leave feedback at the bottom of this page if you have a better approach.) The contract for exception loggers and handlers is that they should not let exceptions propagate up to their callers; otherwise, the exception will just propagate, often all the way to the host resulting in an HTML error (like ASP.NET's yellow screen) being sent back to the client (which usually isn't the preferred option for API callers that expect JSON or XML).</span></span>

## <a name="examples"></a><span data-ttu-id="28bec-187">Beispiele</span><span class="sxs-lookup"><span data-stu-id="28bec-187">Examples</span></span>

### <a name="tracing-exception-logger"></a><span data-ttu-id="28bec-188">Ablaufverfolgung stabellenerohnen</span><span class="sxs-lookup"><span data-stu-id="28bec-188">Tracing Exception Logger</span></span>

<span data-ttu-id="28bec-189">Die Ausnahmeprotokollierung unten sendet Ausnahmedaten an konfigurierte Ablaufverfolgungsquellen (einschließlich des Debugausgabefensters in Visual Studio).</span><span class="sxs-lookup"><span data-stu-id="28bec-189">The exception logger below sends exception data to configured Trace sources (including the Debug output window in Visual Studio).</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample6.cs)]

### <a name="custom-error-message-exception-handler"></a><span data-ttu-id="28bec-190">Benutzerdefinierte Fehlermeldung Exception Handler</span><span class="sxs-lookup"><span data-stu-id="28bec-190">Custom Error Message Exception Handler</span></span>

<span data-ttu-id="28bec-191">Der unten stehende Ausnahmehandler erzeugt eine benutzerdefinierte Fehlerantwort an Clients, einschließlich einer E-Mail-Adresse für die Kontaktaufnahme mit dem Support.</span><span class="sxs-lookup"><span data-stu-id="28bec-191">The exception handler below produces a custom error response to clients, including an email address for contacting support.</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample7.cs)]

## <a name="registering-exception-filters"></a><span data-ttu-id="28bec-192">Registrieren von Ausnahmefiltern</span><span class="sxs-lookup"><span data-stu-id="28bec-192">Registering Exception Filters</span></span>

<span data-ttu-id="28bec-193">Wenn Sie die Projektvorlage "ASP.NET MVC 4 Web Application" zum Erstellen ihres `WebApiConfig` Projekts verwenden, legen Sie Ihren Web-API-Konfigurationscode in der Klasse im *Ordner App_Start:*</span><span class="sxs-lookup"><span data-stu-id="28bec-193">If you use the "ASP.NET MVC 4 Web Application" project template to create your project, put your Web API configuration code inside the `WebApiConfig` class, in the *App_Start* folder:</span></span>

[!code-csharp[Main](exception-handling/samples/sample7.cs?highlight=5)]

## <a name="appendix-base-class-details"></a><span data-ttu-id="28bec-194">Anhang: Basisklassendetails</span><span class="sxs-lookup"><span data-stu-id="28bec-194">Appendix: Base Class Details</span></span>

[!code-csharp[Main](web-api-global-error-handling/samples/sample8.cs)]
