---
uid: web-api/overview/security/individual-accounts-in-web-api
title: Sichern einer Web-API mit einzelnen Konten und lokalen Anmelde Informationen in ASP.net-Web-API 2,2 | Microsoft-Dokumentation
author: MikeWasson
description: In diesem Thema wird gezeigt, wie Sie eine Web-API mit OAuth2 für die Authentifizierung bei einer Mitgliedschafts Datenbank sichern. Im Tutorial Visual Studio 201 verwendete Software Versionen...
ms.author: riande
ms.date: 10/15/2014
ms.assetid: 92c84846-f0ea-4b5e-94b6-5004874eb060
msc.legacyurl: /web-api/overview/security/individual-accounts-in-web-api
msc.type: authoredcontent
ms.openlocfilehash: 7492c4aa4c2a0a8aeed64c3462bda8fc51f35a6b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78447177"
---
# <a name="secure-a-web-api-with-individual-accounts-and-local-login-in-aspnet-web-api-22"></a><span data-ttu-id="16075-104">Sichern einer Web-API mit einzelnen Konten und lokalen Anmelde Informationen in ASP.net-Web-API 2,2</span><span class="sxs-lookup"><span data-stu-id="16075-104">Secure a Web API with Individual Accounts and Local Login in ASP.NET Web API 2.2</span></span>

<span data-ttu-id="16075-105">von [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="16075-105">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

[<span data-ttu-id="16075-106">Beispiel-app herunterladen</span><span class="sxs-lookup"><span data-stu-id="16075-106">Download Sample App</span></span>](https://github.com/MikeWasson/LocalAccountsApp)

> <span data-ttu-id="16075-107">In diesem Thema wird gezeigt, wie Sie eine Web-API mit OAuth2 für die Authentifizierung bei einer Mitgliedschafts Datenbank sichern.</span><span class="sxs-lookup"><span data-stu-id="16075-107">This topic shows how to secure a web API using OAuth2 to authenticate against a membership database.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="16075-108">Im Tutorial verwendete Software Versionen</span><span class="sxs-lookup"><span data-stu-id="16075-108">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="16075-109">Visual Studio 2013 Update 3</span><span class="sxs-lookup"><span data-stu-id="16075-109">Visual Studio 2013 Update 3</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - [<span data-ttu-id="16075-110">Web-API 2,2</span><span class="sxs-lookup"><span data-stu-id="16075-110">Web API 2.2</span></span>](../releases/whats-new-in-aspnet-web-api-22.md)
> - [<span data-ttu-id="16075-111">ASP.net Identity 2,1</span><span class="sxs-lookup"><span data-stu-id="16075-111">ASP.NET Identity 2.1</span></span>](../../../identity/index.md)

<span data-ttu-id="16075-112">In Visual Studio 2013 bietet die Web-API-Projektvorlage drei Authentifizierungs Optionen:</span><span class="sxs-lookup"><span data-stu-id="16075-112">In Visual Studio 2013, the Web API project template gives you three options for authentication:</span></span>

- <span data-ttu-id="16075-113">**Einzelne Konten.**</span><span class="sxs-lookup"><span data-stu-id="16075-113">**Individual accounts.**</span></span> <span data-ttu-id="16075-114">Die APP verwendet eine Mitgliedschafts Datenbank.</span><span class="sxs-lookup"><span data-stu-id="16075-114">The app uses a membership database.</span></span>
- <span data-ttu-id="16075-115">**Organisations Konten.**</span><span class="sxs-lookup"><span data-stu-id="16075-115">**Organizational accounts.**</span></span> <span data-ttu-id="16075-116">Benutzer melden sich mit ihren Azure Active Directory, Office 365 oder lokalen Active Directory Anmelde Informationen an.</span><span class="sxs-lookup"><span data-stu-id="16075-116">Users sign in with their Azure Active Directory, Office 365, or on-premise Active Directory credentials.</span></span>
- <span data-ttu-id="16075-117">**Windows-Authentifizierung.**</span><span class="sxs-lookup"><span data-stu-id="16075-117">**Windows authentication.**</span></span> <span data-ttu-id="16075-118">Diese Option ist für Intranetanwendungen vorgesehen und verwendet das IIS-Modul für die Windows-Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="16075-118">This option is intended for Intranet applications, and uses the Windows Authentication IIS module.</span></span>

<span data-ttu-id="16075-119">Weitere Informationen zu diesen Optionen finden Sie unter [Erstellen von ASP.NET-Webprojekten in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span><span class="sxs-lookup"><span data-stu-id="16075-119">For more details about these options, see [Creating ASP.NET Web Projects in Visual Studio 2013](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth).</span></span>

<span data-ttu-id="16075-120">Einzelne Konten bieten zwei Möglichkeiten für einen Benutzer, sich anzumelden:</span><span class="sxs-lookup"><span data-stu-id="16075-120">Individual accounts provide two ways for a user to log in:</span></span>

- <span data-ttu-id="16075-121">**Lokale Anmeldung**.</span><span class="sxs-lookup"><span data-stu-id="16075-121">**Local login**.</span></span> <span data-ttu-id="16075-122">Der Benutzer registriert sich am Standort und gibt einen Benutzernamen und ein Kennwort ein.</span><span class="sxs-lookup"><span data-stu-id="16075-122">The user registers at the site, entering a username and password.</span></span> <span data-ttu-id="16075-123">Die APP speichert den Kenn Wort Hash in der Mitgliedschafts Datenbank.</span><span class="sxs-lookup"><span data-stu-id="16075-123">The app stores the password hash in the membership database.</span></span> <span data-ttu-id="16075-124">Wenn sich der Benutzer anmeldet, überprüft das ASP.net Identity System das Kennwort.</span><span class="sxs-lookup"><span data-stu-id="16075-124">When the user logs in, the ASP.NET Identity system verifies the password.</span></span>
- <span data-ttu-id="16075-125">**Anmeldung für soziale**Netzwerke.</span><span class="sxs-lookup"><span data-stu-id="16075-125">**Social login**.</span></span> <span data-ttu-id="16075-126">Der Benutzer meldet sich mit einem externen Dienst an, z. b. Facebook, Microsoft oder Google.</span><span class="sxs-lookup"><span data-stu-id="16075-126">The user signs in with an external service, such as Facebook, Microsoft, or Google.</span></span> <span data-ttu-id="16075-127">Die App erstellt weiterhin einen Eintrag für den Benutzer in der Mitgliedschafts Datenbank, speichert aber keine Anmelde Informationen.</span><span class="sxs-lookup"><span data-stu-id="16075-127">The app still creates an entry for the user in the membership database, but does not store any credentials.</span></span> <span data-ttu-id="16075-128">Der Benutzer authentifiziert sich, indem er sich beim externen Dienst anmeldet.</span><span class="sxs-lookup"><span data-stu-id="16075-128">The user authenticates by signing into the external service.</span></span>

<span data-ttu-id="16075-129">Dieser Artikel befasst sich mit dem lokalen Anmelde Szenario.</span><span class="sxs-lookup"><span data-stu-id="16075-129">This article looks at the local login scenario.</span></span> <span data-ttu-id="16075-130">Sowohl für die lokale als auch für die soziale Anmeldung verwendet die Web-API OAuth2, um Anforderungen zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="16075-130">For both local and social login, Web API uses OAuth2 to authenticate requests.</span></span> <span data-ttu-id="16075-131">Allerdings unterscheiden sich die Anmelde Informationen für die lokale Anmeldung und die Anmeldung für soziale Netzwerke.</span><span class="sxs-lookup"><span data-stu-id="16075-131">However, the credential flows are different for local and social login.</span></span>

<span data-ttu-id="16075-132">In diesem Artikel zeige ich eine einfache APP, die es dem Benutzer ermöglicht, authentifizierte AJAX-Aufrufe an eine Web-API zu senden.</span><span class="sxs-lookup"><span data-stu-id="16075-132">In this article, I'll demonstrate a simple app that lets the user log in and send authenticated AJAX calls to a web API.</span></span> <span data-ttu-id="16075-133">Sie können den Beispielcode [hier](https://github.com/MikeWasson/LocalAccountsApp)herunterladen.</span><span class="sxs-lookup"><span data-stu-id="16075-133">You can download the sample code [here](https://github.com/MikeWasson/LocalAccountsApp).</span></span> <span data-ttu-id="16075-134">In der Info Datei wird beschrieben, wie das Beispiel in Visual Studio von Grund auf neu erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="16075-134">The readme describes how to create the sample from scratch in Visual Studio.</span></span>

[![](individual-accounts-in-web-api/_static/image2.png)](individual-accounts-in-web-api/_static/image1.png)

<span data-ttu-id="16075-135">Die Beispiel-App verwendet Knockout. js für die Datenbindung und jQuery zum Senden von AJAX-Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="16075-135">The sample app uses Knockout.js for data-binding and jQuery for sending AJAX requests.</span></span> <span data-ttu-id="16075-136">Ich konzentriere mich auf die AJAX-Aufrufe, damit Sie "Knockout. js" für diesen Artikel nicht kennen müssen.</span><span class="sxs-lookup"><span data-stu-id="16075-136">I'll be focusing on the AJAX calls, so you don't need to know Knockout.js for this article.</span></span>

<span data-ttu-id="16075-137">Dabei beschreibe ich Folgendes:</span><span class="sxs-lookup"><span data-stu-id="16075-137">Along the way, I'll describe:</span></span>

- <span data-ttu-id="16075-138">Was die APP auf der Clientseite tut.</span><span class="sxs-lookup"><span data-stu-id="16075-138">What the app is doing on the client side.</span></span>
- <span data-ttu-id="16075-139">Was geschieht auf dem Server?</span><span class="sxs-lookup"><span data-stu-id="16075-139">What's happening on the server.</span></span>
- <span data-ttu-id="16075-140">Der HTTP-Datenverkehr in der Mitte.</span><span class="sxs-lookup"><span data-stu-id="16075-140">The HTTP traffic in the middle.</span></span>

<span data-ttu-id="16075-141">Zuerst müssen wir eine OAuth2-Terminologie definieren.</span><span class="sxs-lookup"><span data-stu-id="16075-141">First, we need to define some OAuth2 terminology.</span></span>

- <span data-ttu-id="16075-142">*Ressource*.</span><span class="sxs-lookup"><span data-stu-id="16075-142">*Resource*.</span></span> <span data-ttu-id="16075-143">Einige Daten, die geschützt werden können.</span><span class="sxs-lookup"><span data-stu-id="16075-143">Some piece of data that can be protected.</span></span>
- <span data-ttu-id="16075-144">*Ressourcen Server*.</span><span class="sxs-lookup"><span data-stu-id="16075-144">*Resource server*.</span></span> <span data-ttu-id="16075-145">Der Server, der die Ressource hostet.</span><span class="sxs-lookup"><span data-stu-id="16075-145">The server that hosts the resource.</span></span>
- <span data-ttu-id="16075-146">*Ressourcen Besitzer*.</span><span class="sxs-lookup"><span data-stu-id="16075-146">*Resource owner*.</span></span> <span data-ttu-id="16075-147">Die Entität, die die Berechtigung für den Zugriff auf eine Ressource erteilen kann.</span><span class="sxs-lookup"><span data-stu-id="16075-147">The entity that can grant permission to access a resource.</span></span> <span data-ttu-id="16075-148">(Normalerweise der Benutzer.)</span><span class="sxs-lookup"><span data-stu-id="16075-148">(Typically the user.)</span></span>
- <span data-ttu-id="16075-149">*Client*: die APP, die auf die Ressource zugreifen möchte.</span><span class="sxs-lookup"><span data-stu-id="16075-149">*Client*: The app that wants access to the resource.</span></span> <span data-ttu-id="16075-150">In diesem Artikel ist der Client ein Webbrowser.</span><span class="sxs-lookup"><span data-stu-id="16075-150">In this article, the client is a web browser.</span></span>
- <span data-ttu-id="16075-151">*Zugriffs Token*.</span><span class="sxs-lookup"><span data-stu-id="16075-151">*Access token*.</span></span> <span data-ttu-id="16075-152">Ein Token, das den Zugriff auf eine Ressource gewährt.</span><span class="sxs-lookup"><span data-stu-id="16075-152">A token that grants access to a resource.</span></span>
- <span data-ttu-id="16075-153">*Bearertoken*.</span><span class="sxs-lookup"><span data-stu-id="16075-153">*Bearer token*.</span></span> <span data-ttu-id="16075-154">Ein bestimmter Typ von Zugriffs Token mit der-Eigenschaft, die von jedem verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="16075-154">A particular type of access token, with the property that anyone can use the token.</span></span> <span data-ttu-id="16075-155">Anders ausgedrückt: ein Client benötigt keinen kryptografischen Schlüssel oder anderen geheimen Schlüssel, um ein bearertoken zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="16075-155">In other words, a client doesn't need a cryptographic key or other secret to use a bearer token.</span></span> <span data-ttu-id="16075-156">Aus diesem Grund sollten bearertoken nur über HTTPS verwendet werden, und es sollten relativ kurze Ablaufzeiten vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="16075-156">For that reason, bearer tokens should only be used over a HTTPS, and should have relatively short expiration times.</span></span>
- <span data-ttu-id="16075-157">*Autorisierungsserver*.</span><span class="sxs-lookup"><span data-stu-id="16075-157">*Authorization server*.</span></span> <span data-ttu-id="16075-158">Ein Server, der Zugriffs Token zuweist.</span><span class="sxs-lookup"><span data-stu-id="16075-158">A server that gives out access tokens.</span></span>

<span data-ttu-id="16075-159">Eine Anwendung kann sowohl als autorisierungsserver als auch als Ressourcen Server fungieren.</span><span class="sxs-lookup"><span data-stu-id="16075-159">An application can act as both authorization server and resource server.</span></span> <span data-ttu-id="16075-160">Die Web-API-Projektvorlage folgt diesem Muster.</span><span class="sxs-lookup"><span data-stu-id="16075-160">The Web API project template follows this pattern.</span></span>

## <a name="local-login-credential-flow"></a><span data-ttu-id="16075-161">Anmelde Informationsfluss für lokale Anmeldung</span><span class="sxs-lookup"><span data-stu-id="16075-161">Local Login Credential Flow</span></span>

<span data-ttu-id="16075-162">Bei der lokalen Anmeldung verwendet die Web-API den in OAuth2 definierten Kenn [Wort Fluss des Ressourcen Besitzers](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) .</span><span class="sxs-lookup"><span data-stu-id="16075-162">For local login, Web API uses the [resource owner password flow](http://oauthlib.readthedocs.org/en/latest/oauth2/grants/password.html) defined in OAuth2.</span></span>

1. <span data-ttu-id="16075-163">Der Benutzer gibt einen Namen und ein Kennwort in den Client ein.</span><span class="sxs-lookup"><span data-stu-id="16075-163">The user enters a name and password into the client.</span></span>
2. <span data-ttu-id="16075-164">Der Client sendet diese Anmelde Informationen an den autorisierungsserver.</span><span class="sxs-lookup"><span data-stu-id="16075-164">The client sends these credentials to the authorization server.</span></span>
3. <span data-ttu-id="16075-165">Der autorisierungsserver authentifiziert die Anmelde Informationen und gibt ein Zugriffs Token zurück.</span><span class="sxs-lookup"><span data-stu-id="16075-165">The authorization server authenticates the credentials and returns an access token.</span></span>
4. <span data-ttu-id="16075-166">Für den Zugriff auf eine geschützte Ressource schließt der Client das Zugriffs Token im Autorisierungs Header der HTTP-Anforderung ein.</span><span class="sxs-lookup"><span data-stu-id="16075-166">To access a protected resource, the client includes the access token in the Authorization header of the HTTP request.</span></span>

![](individual-accounts-in-web-api/_static/image3.png)

<span data-ttu-id="16075-167">Wenn Sie **einzelne Konten** in der Web-API-Projektvorlage auswählen, enthält das Projekt einen autorisierungsserver, der die Benutzer Anmelde Informationen überprüft und Token ausgibt.</span><span class="sxs-lookup"><span data-stu-id="16075-167">When you select **Individual accounts** in the Web API project template, the project includes an authorization server that validates user credentials and issues tokens.</span></span> <span data-ttu-id="16075-168">Das folgende Diagramm zeigt den gleichen Anmelde Informationsfluss in Bezug auf Web-API-Komponenten.</span><span class="sxs-lookup"><span data-stu-id="16075-168">The following diagram shows the same credential flow in terms of Web API components.</span></span>

![](individual-accounts-in-web-api/_static/image4.png)

<span data-ttu-id="16075-169">In diesem Szenario fungieren Web-API-Controller als Ressourcen Server.</span><span class="sxs-lookup"><span data-stu-id="16075-169">In this scenario, Web API controllers act as resource servers.</span></span> <span data-ttu-id="16075-170">Ein Authentifizierungs Filter überprüft Zugriffs Token, und das **[autorisieren]** -Attribut wird verwendet, um eine Ressource zu schützen.</span><span class="sxs-lookup"><span data-stu-id="16075-170">An authentication filter validates access tokens, and the **[Authorize]** attribute is used to protect a resource.</span></span> <span data-ttu-id="16075-171">Wenn ein Controller oder eine Aktion über das Attribut **[autorisieren]** verfügt, müssen alle Anforderungen an diesen Controller oder diese Aktion authentifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="16075-171">When a controller or action has the **[Authorize]** attribute, all requests to that controller or action must be authenticated.</span></span> <span data-ttu-id="16075-172">Andernfalls wird die Autorisierung verweigert, und die Web-API gibt einen Fehler 401 (nicht autorisiert) zurück.</span><span class="sxs-lookup"><span data-stu-id="16075-172">Otherwise, authorization is denied, and Web API returns a 401 (Unauthorized) error.</span></span>

<span data-ttu-id="16075-173">Der autorisierungsserver und der Authentifizierungs Filter filtern beide eine [owin-Middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) -Komponente, die die Details von OAuth2 behandelt.</span><span class="sxs-lookup"><span data-stu-id="16075-173">The authorization server and the authentication filter both call into an [OWIN middleware](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md) component that handles the details of OAuth2.</span></span> <span data-ttu-id="16075-174">Der Entwurf wird später in diesem Tutorial ausführlicher beschrieben.</span><span class="sxs-lookup"><span data-stu-id="16075-174">I'll describe the design in more detail later in this tutorial.</span></span>

## <a name="sending-an-unauthorized-request"></a><span data-ttu-id="16075-175">Senden einer nicht autorisierten Anforderung</span><span class="sxs-lookup"><span data-stu-id="16075-175">Sending an Unauthorized Request</span></span>

<span data-ttu-id="16075-176">Führen Sie die APP aus, und klicken Sie auf die Schaltfläche **API Anrufen** , um loszulegen.</span><span class="sxs-lookup"><span data-stu-id="16075-176">To get started, run the app and click the **Call API** button.</span></span> <span data-ttu-id="16075-177">Wenn die Anforderung abgeschlossen ist, sollte im **Ergebnis** Feld eine Fehlermeldung angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="16075-177">When the request completes, you should see an error message in the **Result** box.</span></span> <span data-ttu-id="16075-178">Der Grund hierfür ist, dass die Anforderung kein Zugriffs Token enthält, sodass die Anforderung nicht autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="16075-178">That's because the request does not contain an access token, so the request is unauthorized.</span></span>

[![](individual-accounts-in-web-api/_static/image6.png)](individual-accounts-in-web-api/_static/image5.png)

<span data-ttu-id="16075-179">Die Schaltfläche **API aufrufen** sendet eine AJAX-Anforderung an ~/API/Values, die eine Web-API-Controller Aktion aufruft.</span><span class="sxs-lookup"><span data-stu-id="16075-179">The **Call API** button sends an AJAX request to ~/api/values, which invokes a Web API controller action.</span></span> <span data-ttu-id="16075-180">Dies ist der Abschnitt von JavaScript-Code, der die AJAX-Anforderung sendet.</span><span class="sxs-lookup"><span data-stu-id="16075-180">Here is the section of JavaScript code that sends the AJAX request.</span></span> <span data-ttu-id="16075-181">In der Beispiel-App befindet sich der gesamte JavaScript-app-Code in der Datei scripung\app.js.</span><span class="sxs-lookup"><span data-stu-id="16075-181">In the sample app, all of the JavaScript app code is located in the Scripts\app.js file.</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample1.js)]

<span data-ttu-id="16075-182">Bis der Benutzer sich anmeldet, gibt es kein bearertoken und daher keinen Autorisierungs Header in der Anforderung.</span><span class="sxs-lookup"><span data-stu-id="16075-182">Until the user logs in, there is no bearer token, and therefore no Authorization header in the request.</span></span> <span data-ttu-id="16075-183">Dies bewirkt, dass die Anforderung einen 401-Fehler zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="16075-183">This causes the request to return a 401 error.</span></span>

<span data-ttu-id="16075-184">Hier ist die HTTP-Anforderung.</span><span class="sxs-lookup"><span data-stu-id="16075-184">Here is the HTTP request.</span></span> <span data-ttu-id="16075-185">(Ich habe " [fddler](http://www.telerik.com/fiddler) " zum Erfassen des HTTP-Datenverkehrs verwendet.)</span><span class="sxs-lookup"><span data-stu-id="16075-185">(I used [Fiddler](http://www.telerik.com/fiddler) to capture the HTTP traffic.)</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample2.cmd)]

<span data-ttu-id="16075-186">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="16075-186">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample3.cmd?highlight=1,4)]

<span data-ttu-id="16075-187">Beachten Sie, dass die Antwort einen WWW-Authenticate-Header enthält, bei dem die Challenge auf bearfest gelegt ist.</span><span class="sxs-lookup"><span data-stu-id="16075-187">Notice that the response includes a Www-Authenticate header with the challenge set to Bearer.</span></span> <span data-ttu-id="16075-188">Dies gibt an, dass der Server ein bearertoken erwartet.</span><span class="sxs-lookup"><span data-stu-id="16075-188">That indicates the server expects a bearer token.</span></span>

## <a name="register-a-user"></a><span data-ttu-id="16075-189">Registrieren eines Benutzers</span><span class="sxs-lookup"><span data-stu-id="16075-189">Register a User</span></span>

<span data-ttu-id="16075-190">Geben Sie im Abschnitt **registrieren** der App eine e-Mail und ein Kennwort ein, und klicken Sie auf die Schaltfläche **registrieren** .</span><span class="sxs-lookup"><span data-stu-id="16075-190">In the **Register** section of the app, enter an email and password, and click the **Register** button.</span></span>

<span data-ttu-id="16075-191">Sie müssen für dieses Beispiel keine gültige e-Mail-Adresse verwenden, aber eine echte App bestätigt die Adresse.</span><span class="sxs-lookup"><span data-stu-id="16075-191">You don't need to use a valid email address for this sample, but a real app would confirm the address.</span></span> <span data-ttu-id="16075-192">(Siehe [Erstellen einer Secure ASP.NET MVC 5-Web-App mit Anmeldung, e-Mail-Bestätigung und Kenn Wort](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)Zurücksetzung.) Verwenden Sie für das Kennwort etwa "Password1!" mit einem Großbuchstaben, Kleinbuchstaben, Zahlen und nicht alphanumerischen Zeichen.</span><span class="sxs-lookup"><span data-stu-id="16075-192">(See [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).) For the password, use something like "Password1!", with an upper case letter, lower case letter, number, and non-alpha-numeric character.</span></span> <span data-ttu-id="16075-193">Um die APP auf dem neuesten Stand zu halten, habe ich die Client seitige Validierung ausgelassen. Wenn also ein Problem mit dem Kenn Wort Format vorliegt, erhalten Sie den Fehler 400 (ungültige Anforderung).</span><span class="sxs-lookup"><span data-stu-id="16075-193">To keep the app simple, I left out client-side validation, so if there is a problem with the password format, you'll get a 400 (Bad Request) error.</span></span>

[![](individual-accounts-in-web-api/_static/image8.png)](individual-accounts-in-web-api/_static/image7.png)

<span data-ttu-id="16075-194">Die **Register** Schaltfläche sendet eine Post-Anforderung an ~/API/Account/Register/.</span><span class="sxs-lookup"><span data-stu-id="16075-194">The **Register** button sends a POST request to ~/api/Account/Register/.</span></span> <span data-ttu-id="16075-195">Der Anforderungs Text ist ein JSON-Objekt, das den Namen und das Kennwort enthält.</span><span class="sxs-lookup"><span data-stu-id="16075-195">The request body is a JSON object that holds the name and password.</span></span> <span data-ttu-id="16075-196">Dies ist der JavaScript-Code, der die Anforderung sendet:</span><span class="sxs-lookup"><span data-stu-id="16075-196">Here is the JavaScript code that sends the request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample4.js)]

<span data-ttu-id="16075-197">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="16075-197">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample5.cmd?highlight=5,10)]

<span data-ttu-id="16075-198">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="16075-198">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample6.cmd)]

<span data-ttu-id="16075-199">Diese Anforderung wird von der `AccountController`-Klasse verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="16075-199">This request is handled by the `AccountController` class.</span></span> <span data-ttu-id="16075-200">Intern verwendet `AccountController` ASP.net Identity zum Verwalten der Mitgliedschafts Datenbank.</span><span class="sxs-lookup"><span data-stu-id="16075-200">Internally, `AccountController` uses ASP.NET Identity to manage the membership database.</span></span>

<span data-ttu-id="16075-201">Wenn Sie die APP lokal aus Visual Studio ausführen, werden Benutzerkonten in der Tabelle "aspnettusers" in "localdb" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="16075-201">If you run the app locally from Visual Studio, user accounts are stored in LocalDB, in the AspNetUsers table.</span></span> <span data-ttu-id="16075-202">Um die Tabellen in Visual Studio anzuzeigen, klicken Sie auf das Menü **Ansicht** , wählen Sie **Server-Explorer**und dann **Datenverbindungen**aus.</span><span class="sxs-lookup"><span data-stu-id="16075-202">To view the tables in Visual Studio, click the **View** menu, select **Server Explorer**, then expand **Data Connections**.</span></span>

![](individual-accounts-in-web-api/_static/image9.png)

## <a name="get-an-access-token"></a><span data-ttu-id="16075-203">Abrufen eines Zugriffs Tokens</span><span class="sxs-lookup"><span data-stu-id="16075-203">Get an Access Token</span></span>

<span data-ttu-id="16075-204">Bisher haben wir keine OAuth abgeschlossen, aber jetzt wird der OAuth-autorisierungsserver in Aktion angezeigt, wenn wir ein Zugriffs Token anfordern.</span><span class="sxs-lookup"><span data-stu-id="16075-204">So far we have not done any OAuth, but now we'll see the OAuth authorization server in action, when we request an access token.</span></span> <span data-ttu-id="16075-205">Geben Sie im Bereich **Log in** der Beispiel-APP die e-Mail und das Kennwort ein, und klicken Sie auf **Anmelden**.</span><span class="sxs-lookup"><span data-stu-id="16075-205">In the **Log In** area of the sample app, enter the email and password and click **Log In**.</span></span>

[![](individual-accounts-in-web-api/_static/image11.png)](individual-accounts-in-web-api/_static/image10.png)

<span data-ttu-id="16075-206">Die Schaltfläche **Anmelden** sendet eine Anforderung an den tokenendpunkt.</span><span class="sxs-lookup"><span data-stu-id="16075-206">The **Log In** button sends a request to the token endpoint.</span></span> <span data-ttu-id="16075-207">Der Anforderungs Text enthält die folgenden Formular-URL-codierten Daten:</span><span class="sxs-lookup"><span data-stu-id="16075-207">The body of the request contains the following form-url-encoded data:</span></span>

- <span data-ttu-id="16075-208">Grant\_Type: "Password"</span><span class="sxs-lookup"><span data-stu-id="16075-208">grant\_type: "password"</span></span>
- <span data-ttu-id="16075-209">Benutzername: &lt;die e-Mail des Benutzers an&gt;</span><span class="sxs-lookup"><span data-stu-id="16075-209">username: &lt;the user's email&gt;</span></span>
- <span data-ttu-id="16075-210">Kennwort: &lt;Kennwort&gt;</span><span class="sxs-lookup"><span data-stu-id="16075-210">password: &lt;password&gt;</span></span>

<span data-ttu-id="16075-211">Hier sehen Sie den JavaScript-Code, der die AJAX-Anforderung sendet:</span><span class="sxs-lookup"><span data-stu-id="16075-211">Here is the JavaScript code that sends the AJAX request:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample7.js?highlight=14)]

<span data-ttu-id="16075-212">Wenn die Anforderung erfolgreich ist, gibt der autorisierungsserver ein Zugriffs Token im Antworttext zurück.</span><span class="sxs-lookup"><span data-stu-id="16075-212">If the request succeeds, the authorization server returns an access token in the response body.</span></span> <span data-ttu-id="16075-213">Beachten Sie, dass das Token im Sitzungs Speicher gespeichert wird, um es später beim Senden von Anforderungen an die API zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="16075-213">Notice that we store the token in session storage, to use later when sending requests to the API.</span></span> <span data-ttu-id="16075-214">Im Gegensatz zu einigen Authentifizierungs Formen (z. b. cookiebasierte Authentifizierung) fügt der Browser das Zugriffs Token nicht automatisch in nachfolgende Anforderungen ein.</span><span class="sxs-lookup"><span data-stu-id="16075-214">Unlike some forms of authentication (such as cookie-based authentication), the browser will not automatically include the access token in subsequent requests.</span></span> <span data-ttu-id="16075-215">Die Anwendung muss dies explizit tun.</span><span class="sxs-lookup"><span data-stu-id="16075-215">The application must do so explicitly.</span></span> <span data-ttu-id="16075-216">Das ist eine gute Sache, da Sie [CSRF-Sicherheits](preventing-cross-site-request-forgery-csrf-attacks.md)Risiken einschränkt.</span><span class="sxs-lookup"><span data-stu-id="16075-216">That's a good thing, because it limits [CSRF vulnerabilities](preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

<span data-ttu-id="16075-217">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="16075-217">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample8.cmd?highlight=5,10)]

<span data-ttu-id="16075-218">Sie können sehen, dass die Anforderung die Anmelde Informationen des Benutzers enthält.</span><span class="sxs-lookup"><span data-stu-id="16075-218">You can see that the request contains the user's credentials.</span></span> <span data-ttu-id="16075-219">Sie *müssen* HTTPS verwenden, um die Transportschicht Sicherheit bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="16075-219">You *must* use HTTPS to provide transport layer security.</span></span>

<span data-ttu-id="16075-220">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="16075-220">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample9.cmd?highlight=8)]

<span data-ttu-id="16075-221">Zur besseren Lesbarkeit habe ich den JSON-Code eingerückt und das Zugriffs Token gekürzt, was recht lang ist.</span><span class="sxs-lookup"><span data-stu-id="16075-221">For readability, I indented the JSON and truncated the access token, which is a quite long.</span></span>

<span data-ttu-id="16075-222">Die Eigenschaften `access_token`, `token_type`und `expires_in` werden von der OAuth2-Spezifikation definiert. Die anderen Eigenschaften (`userName`, `.issued`und `.expires`) dienen nur zu Informationszwecken.</span><span class="sxs-lookup"><span data-stu-id="16075-222">The `access_token`, `token_type`, and `expires_in` properties are defined by the OAuth2 spec. The other properties (`userName`, `.issued`, and `.expires`) are just for informational purposes.</span></span> <span data-ttu-id="16075-223">Sie finden den Code, mit dem diese zusätzlichen Eigenschaften in der `TokenEndpoint`-Methode in der/Providers/ApplicationOAuthProvider.cs-Datei hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="16075-223">You can find the code that adds those additional properties in the `TokenEndpoint` method, in the /Providers/ApplicationOAuthProvider.cs file.</span></span>

## <a name="send-an-authenticated-request"></a><span data-ttu-id="16075-224">Authentifizierte Anforderung senden</span><span class="sxs-lookup"><span data-stu-id="16075-224">Send an Authenticated Request</span></span>

<span data-ttu-id="16075-225">Nachdem wir nun über ein bearertoken verfügen, können wir eine authentifizierte Anforderung an die API senden.</span><span class="sxs-lookup"><span data-stu-id="16075-225">Now that we have a bearer token, we can make an authenticated request to the API.</span></span> <span data-ttu-id="16075-226">Dies geschieht, indem der Autorisierungs Header in der Anforderung festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="16075-226">This is done by setting the Authorization header in the request.</span></span> <span data-ttu-id="16075-227">Klicken Sie erneut auf die Schaltfläche **API abrufen** , um dies anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="16075-227">Click the **Call API** button again to see this.</span></span>

[![](individual-accounts-in-web-api/_static/image13.png)](individual-accounts-in-web-api/_static/image12.png)

<span data-ttu-id="16075-228">HTTP-Anforderung:</span><span class="sxs-lookup"><span data-stu-id="16075-228">HTTP request:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample10.cmd?highlight=5)]

<span data-ttu-id="16075-229">HTTP-Antwort:</span><span class="sxs-lookup"><span data-stu-id="16075-229">HTTP response:</span></span>

[!code-console[Main](individual-accounts-in-web-api/samples/sample11.cmd)]

## <a name="log-out"></a><span data-ttu-id="16075-230">Abmelden</span><span class="sxs-lookup"><span data-stu-id="16075-230">Log Out</span></span>

<span data-ttu-id="16075-231">Da der Browser die Anmelde Informationen oder das Zugriffs Token nicht zwischenspeichert, ist es einfach, das Token zu "vergessen", indem es aus dem Sitzungs Speicher entfernt wird:</span><span class="sxs-lookup"><span data-stu-id="16075-231">Because the browser does not cache the credentials or the access token, logging out is simply a matter of "forgetting" the token, by removing it from session storage:</span></span>

[!code-javascript[Main](individual-accounts-in-web-api/samples/sample12.js)]

## <a name="understanding-the-individual-accounts-project-template"></a><span data-ttu-id="16075-232">Grundlegendes zur Projektvorlage für einzelne Konten</span><span class="sxs-lookup"><span data-stu-id="16075-232">Understanding the Individual Accounts Project Template</span></span>

<span data-ttu-id="16075-233">Wenn Sie **einzelne Konten** in der Projektvorlage ASP.NET-Webanwendung auswählen, enthält das Projekt Folgendes:</span><span class="sxs-lookup"><span data-stu-id="16075-233">When you select **Individual Accounts** in the ASP.NET Web Application project template, the project includes:</span></span>

- <span data-ttu-id="16075-234">Ein OAuth2-autorisierungsserver.</span><span class="sxs-lookup"><span data-stu-id="16075-234">An OAuth2 authorization server.</span></span>
- <span data-ttu-id="16075-235">Ein Web-API-Endpunkt zum Verwalten von Benutzerkonten</span><span class="sxs-lookup"><span data-stu-id="16075-235">A Web API endpoint for managing user accounts</span></span>
- <span data-ttu-id="16075-236">Ein EF-Modell zum Speichern von Benutzerkonten.</span><span class="sxs-lookup"><span data-stu-id="16075-236">An EF model for storing user accounts.</span></span>

<span data-ttu-id="16075-237">Im folgenden finden Sie die wichtigsten Anwendungs Klassen, die diese Features implementieren:</span><span class="sxs-lookup"><span data-stu-id="16075-237">Here are the main application classes that implement these features:</span></span>

- <span data-ttu-id="16075-238">[https://login.microsoftonline.com/consumers/](`AccountController`).</span><span class="sxs-lookup"><span data-stu-id="16075-238">`AccountController`.</span></span> <span data-ttu-id="16075-239">Stellt einen Web-API-Endpunkt zum Verwalten von Benutzerkonten bereit.</span><span class="sxs-lookup"><span data-stu-id="16075-239">Provides a Web API endpoint for managing user accounts.</span></span> <span data-ttu-id="16075-240">Die `Register` Aktion ist die einzige Aktion, die wir in diesem Tutorial verwendet haben.</span><span class="sxs-lookup"><span data-stu-id="16075-240">The `Register` action is the only one that we used in this tutorial.</span></span> <span data-ttu-id="16075-241">Andere Methoden der-Klasse unterstützen die Kenn Wort Zurücksetzung, soziale Anmeldungen und andere Funktionen.</span><span class="sxs-lookup"><span data-stu-id="16075-241">Other methods on the class support password reset, social logins, and other functionality.</span></span>
- <span data-ttu-id="16075-242">in/Models/IdentityModels.cs. definierte `ApplicationUser`</span><span class="sxs-lookup"><span data-stu-id="16075-242">`ApplicationUser`, defined in /Models/IdentityModels.cs.</span></span> <span data-ttu-id="16075-243">Diese Klasse ist das EF-Modell für Benutzerkonten in der Mitgliedschafts Datenbank.</span><span class="sxs-lookup"><span data-stu-id="16075-243">This class is the EF model for user accounts in the membership database.</span></span>
- <span data-ttu-id="16075-244">`ApplicationUserManager`, die in/App\_Start/identityconfig. cs definiert ist, wird diese Klasse von [usermanager](https://msdn.microsoft.com/library/dn613290.aspx) abgeleitet und führt Vorgänge für Benutzerkonten aus, z. b. das Erstellen eines neuen Benutzers, das Überprüfen von Kenn Wörtern usw. und speichert automatisch Änderungen an der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="16075-244">`ApplicationUserManager`, defined in /App\_Start/IdentityConfig.cs This class derives from [UserManager](https://msdn.microsoft.com/library/dn613290.aspx) and performs operations on user accounts, such as creating a new user, verifying passwords, and so forth, and automatically persists changes to the database.</span></span>
- <span data-ttu-id="16075-245">[https://login.microsoftonline.com/consumers/](`ApplicationOAuthProvider`).</span><span class="sxs-lookup"><span data-stu-id="16075-245">`ApplicationOAuthProvider`.</span></span> <span data-ttu-id="16075-246">Dieses Objekt wird in die owin-Middleware eingebunden und verarbeitet Ereignisse, die von der Middleware ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="16075-246">This object plugs into the OWIN middleware, and processes events raised by the middleware.</span></span> <span data-ttu-id="16075-247">Sie wird von [oauthauthorizationserverprovider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx)abgeleitet.</span><span class="sxs-lookup"><span data-stu-id="16075-247">It derives from [OAuthAuthorizationServerProvider](https://msdn.microsoft.com/library/microsoft.owin.security.oauth.oauthauthorizationserverprovider.aspx).</span></span>

![](individual-accounts-in-web-api/_static/image14.png)

### <a name="configuring-the-authorization-server"></a><span data-ttu-id="16075-248">Konfigurieren des Autorisierungs Servers</span><span class="sxs-lookup"><span data-stu-id="16075-248">Configuring the Authorization Server</span></span>

<span data-ttu-id="16075-249">Der folgende Code konfiguriert in StartupAuth.cs den OAuth2-autorisierungsserver.</span><span class="sxs-lookup"><span data-stu-id="16075-249">In StartupAuth.cs, the following code configures the OAuth2 authorization server.</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample13.cs)]

<span data-ttu-id="16075-250">Die `TokenEndpointPath`-Eigenschaft ist der URL-Pfad zum autorisierungsserver Endpunkt.</span><span class="sxs-lookup"><span data-stu-id="16075-250">The `TokenEndpointPath` property is the URL path to the authorization server endpoint.</span></span> <span data-ttu-id="16075-251">Das ist die URL, die die APP verwendet, um die bearertoken zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="16075-251">That's the URL that app uses to get the bearer tokens.</span></span>

<span data-ttu-id="16075-252">Die `Provider`-Eigenschaft gibt einen Anbieter an, der in die owin-Middleware einfügt und Ereignisse verarbeitet, die von der Middleware ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="16075-252">The `Provider` property specifies a provider that plugs into the OWIN middleware, and processes events raised by the middleware.</span></span>

<span data-ttu-id="16075-253">Hier ist der grundlegende Ablauf, wenn die APP ein Token erhalten soll:</span><span class="sxs-lookup"><span data-stu-id="16075-253">Here is the basic flow when the app wants to get a token:</span></span>

1. <span data-ttu-id="16075-254">Um ein Zugriffs Token zu erhalten, sendet die APP eine Anforderung an ~/Token.</span><span class="sxs-lookup"><span data-stu-id="16075-254">To get an access token, the app sends a request to ~/Token.</span></span>
2. <span data-ttu-id="16075-255">Die OAuth-Middleware ruft `GrantResourceOwnerCredentials` für den Anbieter auf.</span><span class="sxs-lookup"><span data-stu-id="16075-255">The OAuth middleware calls `GrantResourceOwnerCredentials` on the provider.</span></span>
3. <span data-ttu-id="16075-256">Der Anbieter Ruft die `ApplicationUserManager` auf, um die Anmelde Informationen zu überprüfen und eine Anspruchs Identität zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="16075-256">The provider calls the `ApplicationUserManager` to validate the credentials and create a claims identity.</span></span>
4. <span data-ttu-id="16075-257">Wenn dies erfolgreich ist, erstellt der Anbieter ein Authentifizierungs Ticket, das verwendet wird, um das Token zu generieren.</span><span class="sxs-lookup"><span data-stu-id="16075-257">If that succeeds, the provider creates an authentication ticket, which is used to generate the token.</span></span>

[![](individual-accounts-in-web-api/_static/image16.png)](individual-accounts-in-web-api/_static/image15.png)

<span data-ttu-id="16075-258">Die OAuth-Middleware weiß nichts über die Benutzerkonten.</span><span class="sxs-lookup"><span data-stu-id="16075-258">The OAuth middleware doesn't know anything about the user accounts.</span></span> <span data-ttu-id="16075-259">Der Anbieter kommuniziert zwischen der Middleware und ASP.net Identity.</span><span class="sxs-lookup"><span data-stu-id="16075-259">The provider communicates between the middleware and ASP.NET Identity.</span></span> <span data-ttu-id="16075-260">Weitere Informationen zum Implementieren des Autorisierungs Servers finden Sie unter [owin OAuth 2,0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span><span class="sxs-lookup"><span data-stu-id="16075-260">For more information about implementing the authorization server, see [OWIN OAuth 2.0 Authorization Server](../../../aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server.md).</span></span>

### <a name="configuring-web-api-to-use-bearer-tokens"></a><span data-ttu-id="16075-261">Konfigurieren der Web-API für die Verwendung von bearertoken</span><span class="sxs-lookup"><span data-stu-id="16075-261">Configuring Web API to use Bearer Tokens</span></span>

<span data-ttu-id="16075-262">In der `WebApiConfig.Register`-Methode richtet der folgende Code die Authentifizierung für die Web-API-Pipeline ein:</span><span class="sxs-lookup"><span data-stu-id="16075-262">In the `WebApiConfig.Register` method, the following code sets up authentication for the Web API pipeline:</span></span>

[!code-csharp[Main](individual-accounts-in-web-api/samples/sample14.cs)]

<span data-ttu-id="16075-263">Die **hostauthenticationfilter** -Klasse aktiviert die Authentifizierung mithilfe von bearertoken.</span><span class="sxs-lookup"><span data-stu-id="16075-263">The **HostAuthenticationFilter** class enables authentication using bearer tokens.</span></span>

<span data-ttu-id="16075-264">Die **suppressdefaulthostauthentication** -Methode weist die Web-API an, jegliche Authentifizierung zu ignorieren, bevor die Anforderung die Web-API-Pipeline erreicht, entweder von IIS oder von owin-Middleware.</span><span class="sxs-lookup"><span data-stu-id="16075-264">The **SuppressDefaultHostAuthentication** method tells Web API to ignore any authentication that happens before the request reaches the Web API pipeline, either by IIS or by OWIN middleware.</span></span> <span data-ttu-id="16075-265">Auf diese Weise können Sie die Authentifizierung der Web-API ausschließlich auf Bearertoken einschränken.</span><span class="sxs-lookup"><span data-stu-id="16075-265">That way, we can restrict Web API to authenticate only using bearer tokens.</span></span>

> [!NOTE]
> <span data-ttu-id="16075-266">Der MVC-Teil Ihrer APP kann insbesondere eine Formular Authentifizierung verwenden, die Anmelde Informationen in einem Cookie speichert.</span><span class="sxs-lookup"><span data-stu-id="16075-266">In particular, the MVC portion of your app might use forms authentication, which stores credentials in a cookie.</span></span> <span data-ttu-id="16075-267">Die cookiebasierte Authentifizierung erfordert die Verwendung von Fälschungs Token, um CSRF-Angriffe zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="16075-267">Cookie-based authentication requires the use of anti-forgery tokens, to prevent CSRF attacks.</span></span> <span data-ttu-id="16075-268">Das ist ein Problem für Web-APIs, da die Web-API keine bequeme Möglichkeit hat, das antifälschungstoken an den Client zu senden.</span><span class="sxs-lookup"><span data-stu-id="16075-268">That's a problem for web APIs, because there is no convenient way for the web API to send the anti-forgery token to the client.</span></span> <span data-ttu-id="16075-269">(Weitere Hintergrundinformationen zu diesem Problem finden Sie unter [verhindern von CSRF-Angriffen in der Web-API](preventing-cross-site-request-forgery-csrf-attacks.md).) Der Aufruf von **suppressdefaulthostauthentication** stellt sicher, dass die Web-API nicht anfällig für CSRF-Angriffe von Anmelde Informationen ist, die in Cookies gespeichert</span><span class="sxs-lookup"><span data-stu-id="16075-269">(For more background on this issue, see [Preventing CSRF Attacks in Web API](preventing-cross-site-request-forgery-csrf-attacks.md).) Calling **SuppressDefaultHostAuthentication** ensures that Web API is not vulnerable to CSRF attacks from credentials stored in cookies.</span></span>

<span data-ttu-id="16075-270">Wenn der Client eine geschützte Ressource anfordert, geschieht Folgendes in der Web-API-Pipeline:</span><span class="sxs-lookup"><span data-stu-id="16075-270">When the client requests a protected resource, here is what happens in the Web API pipeline:</span></span>

1. <span data-ttu-id="16075-271">Der **hostauthentication** -Filter Ruft die OAuth-Middleware auf, um das Token zu validieren.</span><span class="sxs-lookup"><span data-stu-id="16075-271">The **HostAuthentication** filter calls the OAuth middleware to validate the token.</span></span>
2. <span data-ttu-id="16075-272">Die Middleware konvertiert das Token in eine Anspruchs Identität.</span><span class="sxs-lookup"><span data-stu-id="16075-272">The middleware converts the token into a claims identity.</span></span>
3. <span data-ttu-id="16075-273">An diesem Punkt wird die Anforderung *authentifiziert* , aber nicht *autorisiert*.</span><span class="sxs-lookup"><span data-stu-id="16075-273">At this point, the request is *authenticated* but not *authorized*.</span></span>
4. <span data-ttu-id="16075-274">Der Autorisierungs Filter untersucht die Anspruchs Identität.</span><span class="sxs-lookup"><span data-stu-id="16075-274">The authorization filter examines the claims identity.</span></span> <span data-ttu-id="16075-275">Wenn die Ansprüche den Benutzer für diese Ressource autorisieren, wird die Anforderung autorisiert.</span><span class="sxs-lookup"><span data-stu-id="16075-275">If the claims authorize the user for that resource, the request is authorized.</span></span> <span data-ttu-id="16075-276">Standardmäßig werden alle authentifizierten authentifizierten Anforderungen vom Attribut **[autorisieren]** autorisiert.</span><span class="sxs-lookup"><span data-stu-id="16075-276">By default, the **[Authorize]** attribute will authorize any request that is authenticated.</span></span> <span data-ttu-id="16075-277">Allerdings können Sie Sie nach Rolle oder anderen Ansprüchen autorisieren.</span><span class="sxs-lookup"><span data-stu-id="16075-277">However, you can authorize by role or by other claims.</span></span> <span data-ttu-id="16075-278">Weitere Informationen finden Sie unter [Authentifizierung und Autorisierung in der Web-API](authentication-and-authorization-in-aspnet-web-api.md).</span><span class="sxs-lookup"><span data-stu-id="16075-278">For more information, see [Authentication and Authorization in Web API](authentication-and-authorization-in-aspnet-web-api.md).</span></span>
5. <span data-ttu-id="16075-279">Wenn die vorherigen Schritte erfolgreich ausgeführt wurden, gibt der Controller die geschützte Ressource zurück.</span><span class="sxs-lookup"><span data-stu-id="16075-279">If the previous steps are successful, the controller returns the protected resource.</span></span> <span data-ttu-id="16075-280">Andernfalls empfängt der Client den Fehler 401 (nicht autorisiert).</span><span class="sxs-lookup"><span data-stu-id="16075-280">Otherwise, the client receives a 401 (Unauthorized) error.</span></span>

[![](individual-accounts-in-web-api/_static/image18.png)](individual-accounts-in-web-api/_static/image17.png)

## <a name="additional-resources"></a><span data-ttu-id="16075-281">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="16075-281">Additional Resources</span></span>

- [<span data-ttu-id="16075-282">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="16075-282">ASP.NET Identity</span></span>](../../../identity/index.md)
- <span data-ttu-id="16075-283">Grundlegendes [zu Sicherheits Features in der Spa-Vorlage für VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span><span class="sxs-lookup"><span data-stu-id="16075-283">[Understanding Security Features in the SPA Template for VS2013 RC](https://blogs.msdn.com/b/webdev/archive/2013/09/20/understanding-security-features-in-spa-template.aspx).</span></span> <span data-ttu-id="16075-284">MSDN-Blogbeitrag von hongye sun.</span><span class="sxs-lookup"><span data-stu-id="16075-284">MSDN blog post by Hongye Sun.</span></span>
- <span data-ttu-id="16075-285">[Dissecting the Web API Individual Accounts Template – Part 2: local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span><span class="sxs-lookup"><span data-stu-id="16075-285">[Dissecting the Web API Individual Accounts Template–Part 2: Local Accounts](http://leastprivilege.com/2013/11/26/dissecting-the-web-api-individual-accounts-templatepart-2-local-accounts/).</span></span> <span data-ttu-id="16075-286">Blog Beitrag von Dominick Baier.</span><span class="sxs-lookup"><span data-stu-id="16075-286">Blog post by Dominick Baier.</span></span>
- <span data-ttu-id="16075-287">[Host Authentifizierung und Web-API mit owin](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span><span class="sxs-lookup"><span data-stu-id="16075-287">[Host authentication and Web API with OWIN](http://brockallen.com/2013/10/27/host-authentication-and-web-api-with-owin-and-active-vs-passive-authentication-middleware/).</span></span> <span data-ttu-id="16075-288">Eine gute Erläuterung der `SuppressDefaultHostAuthentication` und `HostAuthenticationFilter` von Brock allen.</span><span class="sxs-lookup"><span data-stu-id="16075-288">A good explanation of `SuppressDefaultHostAuthentication` and `HostAuthenticationFilter` by Brock Allen.</span></span>
- <span data-ttu-id="16075-289">[Anpassen von Profilinformationen in ASP.net Identity in vs 2013-Vorlagen](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span><span class="sxs-lookup"><span data-stu-id="16075-289">[Customizing profile information in ASP.NET Identity in VS 2013 templates](https://blogs.msdn.com/b/webdev/archive/2013/10/16/customizing-profile-information-in-asp-net-identity-in-vs-2013-templates.aspx).</span></span> <span data-ttu-id="16075-290">MSDN-Blogbeitrag von Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="16075-290">MSDN blog post by Pranav Rastogi.</span></span>
- <span data-ttu-id="16075-291">[Pro Anforderungs Lebensdauer-Verwaltung für die usermanager-Klasse in ASP.net Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="16075-291">[Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span> <span data-ttu-id="16075-292">MSDN-Blogbeitrag von Suhas Joshi, mit einer guten Erläuterung der `UserManager`-Klasse.</span><span class="sxs-lookup"><span data-stu-id="16075-292">MSDN blog post by Suhas Joshi, with a good explanation of the `UserManager` class.</span></span>
