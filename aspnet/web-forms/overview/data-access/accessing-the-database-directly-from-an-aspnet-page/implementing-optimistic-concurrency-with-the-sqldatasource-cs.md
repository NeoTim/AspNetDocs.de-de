---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
title: Implementieren von Optimistischer Parallelität mit dem SqlDataSource-Steuerelement (c#) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial haben wir überprüfen Sie die Grundlagen der Steuerung durch vollständige Parallelität und untersuchen Sie anschließend, wie Sie mit dem SqlDataSource-Steuerelement zu implementieren.
ms.author: riande
ms.date: 02/20/2007
ms.assetid: df999966-ac48-460e-b82b-4877a57d6ab9
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-cs
msc.type: authoredcontent
ms.openlocfilehash: e8ed68e10d2924a2174494943b654e1f46284be4
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/09/2019
ms.locfileid: "59420704"
---
# <a name="implementing-optimistic-concurrency-with-the-sqldatasource-c"></a><span data-ttu-id="880be-103">Implementieren von optimistischer Parallelität mit dem SqlDataSource-Steuerelement (C#)</span><span class="sxs-lookup"><span data-stu-id="880be-103">Implementing Optimistic Concurrency with the SqlDataSource (C#)</span></span>

<span data-ttu-id="880be-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="880be-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="880be-105">[Beispiel-App herunter](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) oder [PDF-Datei herunterladen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="880be-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_CS.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/datatutorial50cs1.pdf)</span></span>

> <span data-ttu-id="880be-106">In diesem Tutorial haben wir überprüfen Sie die Grundlagen der Steuerung durch vollständige Parallelität und untersuchen Sie anschließend, wie Sie mit dem SqlDataSource-Steuerelement zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="880be-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>


## <a name="introduction"></a><span data-ttu-id="880be-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="880be-107">Introduction</span></span>

<span data-ttu-id="880be-108">Im vorherigen Tutorial untersucht wir hinzufügen, einfügen, aktualisieren und Löschen von Funktionen, um dem SqlDataSource-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="880be-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="880be-109">Kurz gesagt, diese Features bieten wir zum erforderlich sind. Geben Sie den entsprechenden `INSERT`, `UPDATE`, oder `DELETE` SQL-Anweisung in das Steuerelement s `InsertCommand`, `UpdateCommand`, oder `DeleteCommand` Eigenschaften werden zusammen mit den entsprechenden Parameter in der `InsertParameters`, `UpdateParameters`, und `DeleteParameters` Sammlungen.</span><span class="sxs-lookup"><span data-stu-id="880be-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="880be-110">Während diese Eigenschaften und Auflistungen manuell angegeben werden können, bietet das Konfigurieren von Datenquellen-Assistenten s Schaltfläche "Erweitert" einer generieren `INSERT`, `UPDATE`, und `DELETE` Anweisungen-Kontrollkästchen, das automatisch diese Anweisungen erstellen wird basierend auf der `SELECT` Anweisung.</span><span class="sxs-lookup"><span data-stu-id="880be-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="880be-111">Zusammen mit der Generierung `INSERT`, `UPDATE`, und `DELETE` Anweisungen deaktivieren, aktivieren Sie das Dialogfeld Erweiterte SQL-Generierungsoptionen enthält eine Option für die Verwendung optimistischer Parallelität (siehe Abbildung 1).</span><span class="sxs-lookup"><span data-stu-id="880be-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="880be-112">Wenn dieses Kontrollkästchen aktiviert, die `WHERE` Klauseln in den automatisch generierten `UPDATE` und `DELETE` -Anweisungen werden geändert, um nur die aktualisieren oder löschen, wenn die zugrunde liegenden Datenbankdaten nicht geändert wurde, da der Benutzer letzten der Daten in das Raster laden.</span><span class="sxs-lookup"><span data-stu-id="880be-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn't been modified since the user last loaded the data into the grid.</span></span>


![Sie können die vollständige Parallelität-Unterstützung hinzufügen, von den erweiterten SQL-Generierung Dialogfeld "Optionen"](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.gif)

<span data-ttu-id="880be-114">**Abbildung 1**: Sie können die vollständige Parallelität-Unterstützung hinzufügen, von den erweiterten SQL-Generierung Dialogfeld "Optionen"</span><span class="sxs-lookup"><span data-stu-id="880be-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>


<span data-ttu-id="880be-115">In der [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) Tutorial untersuchten wir die Grundlagen der Steuerung durch vollständige Parallelität und wie Sie es dem ObjectDataSource-Steuerelement hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="880be-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="880be-116">In diesem Tutorial wir auf die Grundlagen der Steuerung durch vollständige Parallelität Retuschieren und untersuchen Sie anschließend, wie Sie mit dem SqlDataSource-Steuerelement zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="880be-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="880be-117">Eine Zusammenfassung der vollständigen Parallelität</span><span class="sxs-lookup"><span data-stu-id="880be-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="880be-118">Für Webanwendungen, die ermöglichen, mehrere Benutzer gleichzeitig zum Bearbeiten oder löschen die gleichen Daten, besteht eine Möglichkeit, dass ein Benutzer kann einem anderen s ändert versehentlich überschreiben.</span><span class="sxs-lookup"><span data-stu-id="880be-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="880be-119">In der [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) Tutorial, die ich im folgenden Beispiel wird bereitgestellt:</span><span class="sxs-lookup"><span data-stu-id="880be-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="880be-120">Stellen Sie sich, dass zwei Benutzer, Jisun und Sam, sowohl eine Seite in einer Anwendung, für die Besucher besuchen wurden, aktualisieren und Löschen von Produkten über ein GridView-Steuerelement zulässig.</span><span class="sxs-lookup"><span data-stu-id="880be-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="880be-121">Beide klicken Sie auf die Schaltfläche "Bearbeiten" für Chai entspricht ungefähr zur selben Zeit.</span><span class="sxs-lookup"><span data-stu-id="880be-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="880be-122">Jisun ändert sich der Name des Produkts in Chai Tee und klickt auf die Schaltfläche "Aktualisieren".</span><span class="sxs-lookup"><span data-stu-id="880be-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="880be-123">Das Ergebnis ist ein `UPDATE` -Anweisung, die für die Datenbank gesendet wird, die festlegt *alle* Produkt s aktualisierbaren Felder (obwohl Jisun nur für ein Feld aktualisiert `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="880be-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="880be-124">Zu diesem Zeitpunkt besitzt die Datenbank die Werte der Lieferant außergewöhnlichen fluessiger Form, und so weiter für dieses bestimmte Produkt Chai Tee, der Kategorie "Getränke,".</span><span class="sxs-lookup"><span data-stu-id="880be-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="880be-125">Allerdings zeigt GridView Sam-s-Bildschirm als Chai immer noch den Namen des Produkts in der bearbeitbaren GridView-Zeile.</span><span class="sxs-lookup"><span data-stu-id="880be-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="880be-126">Wenige Sekunden nach dem Jisun s Änderungen übernommen wurden Sam-die Kategorie "Gewürze" updates und Update klickt.</span><span class="sxs-lookup"><span data-stu-id="880be-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="880be-127">Dies führt zu einer `UPDATE` Anweisung gesendet, um die Datenbank, die den Namen des Produkts, das Chai entspricht, legt diese fest der `CategoryID` zu den entsprechenden "Gewürze" Kategorie-ID, und So weiter.</span><span class="sxs-lookup"><span data-stu-id="880be-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="880be-128">Jisun-s-Änderungen an den Namen des Produkts wurde überschrieben.</span><span class="sxs-lookup"><span data-stu-id="880be-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="880be-129">Abbildung 2 zeigt dies.</span><span class="sxs-lookup"><span data-stu-id="880be-129">Figure 2 illustrates this interaction.</span></span>


[![W<span data-ttu-id="880be-130">"hen" zwei Benutzer gleichzeitig Update ändert ein Datensatz gibt es s Potenzial für einen Benutzer s überschreiben die anderen s]</span><span class="sxs-lookup"><span data-stu-id="880be-130">hen Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image1.png)

<span data-ttu-id="880be-131">**Abbildung 2**: Wenn zwei Benutzer gleichzeitig aktualisieren einen Datensatz vorhanden s Potenzial für einen Benutzer s an überschreiben die anderen s ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="880be-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image2.png))</span></span>


<span data-ttu-id="880be-132">Um zu verhindern, dass dieses Szenario Herausklappen, eine Form der [parallelitätssteuerung](http://en.wikipedia.org/wiki/Concurrency_control) implementiert werden muss.</span><span class="sxs-lookup"><span data-stu-id="880be-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="880be-133">[Vollständige Parallelität](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) der Schwerpunkt in diesem Tutorial, der auf der Annahme, die beim dort Parallelitätskonflikte hin und wieder, möglicherweise den Großteil der Zeit, die solche Konflikte auftreten, wird nicht funktioniert.</span><span class="sxs-lookup"><span data-stu-id="880be-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise.</span></span> <span data-ttu-id="880be-134">Aus diesem Grund, wenn ein Konflikt auftreten,, informiert Steuerung für optimistische Parallelität einfach den Benutzer, dass ihre Änderungen kann nicht gespeichert werden, da ein anderer Benutzer die gleichen Daten geändert hat.</span><span class="sxs-lookup"><span data-stu-id="880be-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="880be-135">Für Anwendungen, in denen davon ausgegangen wird, ist, dass es viele Parallelitätskonflikte oder solche Konflikte nicht tolerierbar sind, kann dann Steuerung durch eingeschränkte Parallelität stattdessen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="880be-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="880be-136">Siehe die [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) Tutorial für eine ausführlichere Erläuterung der Steuerung durch eingeschränkte Parallelität.</span><span class="sxs-lookup"><span data-stu-id="880be-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>


<span data-ttu-id="880be-137">Steuerung für optimistische Parallelität funktioniert, indem Sie sicherstellen, dass der Datensatz aktualisieren oder löschen die gleichen Werte verfügt, wie zuvor beim Aktualisieren oder Löschen von Prozess starten.</span><span class="sxs-lookup"><span data-stu-id="880be-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="880be-138">Z. B. beim Klicken auf die Schaltfläche "Bearbeiten" in einem bearbeitbaren GridView-Ansicht, die-s-Datensatzwerte aus der Datenbank gelesen und in die Textfelder und anderen Websteuerelementen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="880be-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="880be-139">Diese ursprünglichen Werte werden durch die GridView gespeichert.</span><span class="sxs-lookup"><span data-stu-id="880be-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="880be-140">Später, nachdem der Benutzer nimmt ihre Änderungen vor, und klickt auf die Schaltfläche "Aktualisieren", die `UPDATE` -Anweisung verwendet muss berücksichtigen Sie die ursprünglichen Werte sowie die neuen Werte und den zugrunde liegenden Datenbankdatensatz nur aktualisieren, wenn die ursprünglichen Werte, dass der Benutzer bearbeiten sind identisch mit den Werten noch in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="880be-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="880be-141">Abbildung 3 zeigt diese Abfolge von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="880be-141">Figure 3 depicts this sequence of events.</span></span>


[![F<span data-ttu-id="880be-142">oder die Update- oder Delete erfolgreich ausgeführt werden soll, müssen die ursprünglichen Werte gleich den Datenbankwerten der aktuellen werden]</span><span class="sxs-lookup"><span data-stu-id="880be-142">or the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image3.png)

<span data-ttu-id="880be-143">**Abbildung 3**: Für die Update- oder Delete, hergestellt wird, die ursprünglichen Werte müssen werden gleich die aktuellen Datenbankwerte ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="880be-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.png))</span></span>


<span data-ttu-id="880be-144">Es gibt verschiedene Ansätze zum Implementieren von optimistischer Parallelität (finden Sie unter [Peter A. Bromberg](http://www.eggheadcafe.com/articles/pbrombergresume.asp)des [optimistische Parallelität aktualisieren Logik](http://www.eggheadcafe.com/articles/20050719.asp) für einen kurzen Blick auf eine Reihe von Optionen).</span><span class="sxs-lookup"><span data-stu-id="880be-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://www.eggheadcafe.com/articles/pbrombergresume.asp)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="880be-145">Die Technik, die verwendet werden, von dem SqlDataSource-Steuerelement (oder per ADO.NET typisierten DataSets, die in unserer Data Access Layer verwendet) ergänzt das `WHERE` -Klausel, um einen Vergleich aller die ursprünglichen Werte enthalten.</span><span class="sxs-lookup"><span data-stu-id="880be-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="880be-146">Die folgenden `UPDATE` -Anweisung aktualisiert z. B. den Namen und den Preis eines Produkts nur dann, wenn die aktuellen Datenbankwerte die Werte gleich sind, die ursprünglich, beim Aktualisieren des Datensatzes in den GridView-Ansicht abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="880be-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="880be-147">Die `@ProductName` und `@UnitPrice` Parameter enthalten die neuen Werten, die vom Benutzer eingegeben haben, während `@original_ProductName` und `@original_UnitPrice` enthalten die Werte, die ursprünglich in der GridView geladen wurden, als auf die Schaltfläche "Bearbeiten" geklickt wurde:</span><span class="sxs-lookup"><span data-stu-id="880be-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample1.sql)]

<span data-ttu-id="880be-148">In diesem Tutorial sehen, ist das Aktivieren der Steuerung durch vollständige Parallelität mit dem SqlDataSource-Steuerelement so einfach wie das Aktivieren eines Kontrollkästchens.</span><span class="sxs-lookup"><span data-stu-id="880be-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="880be-149">Schritt 1: Erstellen ein SqlDataSource-Steuerelement, unterstützt die optimistische Parallelität</span><span class="sxs-lookup"><span data-stu-id="880be-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="880be-150">Öffnen Sie zunächst die `OptimisticConcurrency.aspx` Seite die `SqlDataSource` Ordner.</span><span class="sxs-lookup"><span data-stu-id="880be-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="880be-151">Ziehen Sie ein SqlDataSource-Steuerelement aus der Toolbox auf den Designer, Einstellungen der `ID` Eigenschaft `ProductsDataSourceWithOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="880be-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="880be-152">Klicken Sie anschließend auf den Link "Datenquelle konfigurieren" aus dem Steuerelement-s-Smarttag.</span><span class="sxs-lookup"><span data-stu-id="880be-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="880be-153">Wählen Sie aus dem ersten Bildschirm des Assistenten, arbeiten Sie mit der `NORTHWINDConnectionString` , und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="880be-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>


[![C<span data-ttu-id="880be-154">Wählen Sie aus, für die Arbeit mit der NORTHWINDConnectionString]</span><span class="sxs-lookup"><span data-stu-id="880be-154">hoose to Work with the NORTHWINDConnectionString]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.png)

<span data-ttu-id="880be-155">**Abbildung 4**: Wählen Sie für die Arbeit mit der `NORTHWINDConnectionString` ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="880be-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.png))</span></span>


<span data-ttu-id="880be-156">In diesem Beispiel, das wir Hinzufügen einer GridView-Ansicht, die es ermöglicht Benutzern das Bearbeiten der `Products` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="880be-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="880be-157">Wählen Sie daher aus dem Bildschirm für die Select-Anweisung konfigurieren, die `Products` Tabelle aus der Dropdown-Liste, und wählen Sie die `ProductID`, `ProductName`, `UnitPrice`, und `Discontinued` Spalten, wie in Abbildung 5 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="880be-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>


[![F<span data-ttu-id="880be-158">ROM Produkttabelle zurück, die ProductID, ProductName, UnitPrice und nicht mehr unterstützte Spalten]</span><span class="sxs-lookup"><span data-stu-id="880be-158">rom the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.png)

<span data-ttu-id="880be-159">**Abbildung 5**: Aus der `Products` Tabelle, zum Zurückgeben der `ProductID`, `ProductName`, `UnitPrice`, und `Discontinued` Spalten ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="880be-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.png))</span></span>


<span data-ttu-id="880be-160">Wählen Sie die Spalten, klicken Sie auf die Schaltfläche "Erweitert", um das Dialogfeld "Erweiterte SQL-Generierungsoptionen" zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="880be-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="880be-161">Überprüfen Sie die generieren `INSERT`, `UPDATE`, und `DELETE` Anweisungen und verwenden Sie optimistische Parallelität Kontrollkästchen, und klicken Sie auf OK (siehe Abbildung 1 für einen Screenshot).</span><span class="sxs-lookup"><span data-stu-id="880be-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="880be-162">Schließen Sie den Assistenten, indem Sie auf Weiter, und schließen.</span><span class="sxs-lookup"><span data-stu-id="880be-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="880be-163">Nach Abschluss der Konfigurieren von Datenquellen-Assistenten können Sie überprüfen die resultierende `DeleteCommand` und `UpdateCommand` Eigenschaften und die `DeleteParameters` und `UpdateParameters` Sammlungen.</span><span class="sxs-lookup"><span data-stu-id="880be-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="880be-164">Die einfachste Möglichkeit hierzu ist, klicken auf der Registerkarte "Datenquelle" in der unteren linken Ecke auf der Seite s deklarativen Syntax finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="880be-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="880be-165">Dort sehen Sie ein `UpdateCommand` Wert:</span><span class="sxs-lookup"><span data-stu-id="880be-165">There you will find an `UpdateCommand` value of:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample2.sql)]

<span data-ttu-id="880be-166">Mit sieben Parameter in der `UpdateParameters` Auflistung:</span><span class="sxs-lookup"><span data-stu-id="880be-166">With seven parameters in the `UpdateParameters` collection:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample3.aspx)]

<span data-ttu-id="880be-167">Auf ähnliche Weise die `DeleteCommand` Eigenschaft und `DeleteParameters` Auflistung sollte wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="880be-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample4.sql)]


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample5.aspx)]

<span data-ttu-id="880be-168">Zusätzlich zum Erweitern der `WHERE` Klauseln der `UpdateCommand` und `DeleteCommand` Eigenschaften (und die zusätzlichen Parameter für die jeweiligen Parameter Sammlungen hinzufügen), wählen die Verwendung von optimistischer Parallelitätsoption passt an zwei andere Eigenschaften:</span><span class="sxs-lookup"><span data-stu-id="880be-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="880be-169">Änderungen der [ `ConflictDetection` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) aus `OverwriteChanges` (Standard),</span><span class="sxs-lookup"><span data-stu-id="880be-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to</span></span> `CompareAllValues`
- <span data-ttu-id="880be-170">Änderungen der [ `OldValuesParameterFormatString` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) aus {0} (Standard) zum Originalbild\_ {0} .</span><span class="sxs-lookup"><span data-stu-id="880be-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="880be-171">Wenn die Daten-Websteuerelement s SqlDataSource-Steuerelement aufruft `Update()` oder `Delete()` -Methode, die ursprünglichen Werte übergibt.</span><span class="sxs-lookup"><span data-stu-id="880be-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="880be-172">Wenn die SqlDataSource s `ConflictDetection` -Eigenschaftensatz auf `CompareAllValues`, diese ursprünglichen Werte werden an den Befehl hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="880be-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="880be-173">Die `OldValuesParameterFormatString` Eigenschaft stellt das Muster für diese Wertparameter der ursprüngliche verwendet.</span><span class="sxs-lookup"><span data-stu-id="880be-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="880be-174">Der Konfigurieren von Datenquellen-Assistent verwendet die ursprüngliche\_ {0} und nennt alle ursprünglichen Parameter in der `UpdateCommand` und `DeleteCommand` Eigenschaften und `UpdateParameters` und `DeleteParameters` Sammlungen entsprechend.</span><span class="sxs-lookup"><span data-stu-id="880be-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="880be-175">Da wir erneut die nicht mit dem SqlDataSource-Steuerelement STRG + s, Einfügen von Funktionen, können Sie entfernen die `InsertCommand` Eigenschaft und die zugehörige `InsertParameters` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="880be-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>


## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="880be-176">Ordnungsgemäße Handhabung`NULL`Werte</span><span class="sxs-lookup"><span data-stu-id="880be-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="880be-177">Leider ist das ergänzte `UPDATE` und `DELETE` Anweisungen automatisch generierte vom Konfigurieren von Datenquellen-Assistenten bei Verwendung der vollständigen Parallelität werden *nicht* arbeiten mit Datensätzen, die enthalten `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="880be-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="880be-178">Berücksichtigen Sie deshalb erhalten unsere SqlDataSource s `UpdateCommand`:</span><span class="sxs-lookup"><span data-stu-id="880be-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample6.sql)]

<span data-ttu-id="880be-179">Die `UnitPrice` -Spalte in der `Products` Tabelle haben `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="880be-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="880be-180">Wenn ein bestimmter Datensatz enthält eine `NULL` Wert für `UnitPrice`, `WHERE` Klausel Teil `[UnitPrice] = @original_UnitPrice` wird *immer* auf "false" ausgewertet werden, da `NULL = NULL` gibt immer "false" zurück.</span><span class="sxs-lookup"><span data-stu-id="880be-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="880be-181">Aus diesem Grund, die Datensätze enthalten `NULL` Werte können nicht bearbeitet oder gelöscht wird, als die `UPDATE` und `DELETE` Anweisungen `WHERE` Klauseln nicht zum Aktualisieren oder Löschen von Zeilen zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="880be-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won't return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="880be-182">Dieser Fehler wurde zuerst im Juni von 2004 in an Microsoft gemeldet [SqlDataSource-Steuerelement generiert falsche SQL-Anweisungen](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) und in der nächsten Version von ASP.NET korrigiert werden demnach geplant ist.</span><span class="sxs-lookup"><span data-stu-id="880be-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>


<span data-ttu-id="880be-183">Um dieses Problem zu beheben, müssen wir manuell aktualisieren die `WHERE` Klauseln in sowohl die `UpdateCommand` und `DeleteCommand` Eigenschaften für **alle** Spalten können mit `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="880be-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="880be-184">Im Allgemeinen ändern `[ColumnName] = @original_ColumnName` auf:</span><span class="sxs-lookup"><span data-stu-id="880be-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample7.sql)]

<span data-ttu-id="880be-185">Diese Änderung können direkt über die deklaratives Markup, über die Optionen UpdateQuery oder DeleteQuery im Eigenschaftenfenster oder über das UPDATE vorgenommen werden, und Löschen von Registerkarten in der Specify, benutzerdefinierte SQL-Anweisung oder gespeicherte Prozedur-Option in den Daten konfigurieren Datenquellen-Assistenten.</span><span class="sxs-lookup"><span data-stu-id="880be-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="880be-186">In diesem Fall muss diese Änderung vorgenommen werden, für die *jeder* -Spalte in der `UpdateCommand` und `DeleteCommand` s `WHERE` -Klausel, die enthalten, kann `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="880be-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="880be-187">Anwenden dieses zu unserem Beispiel führt die folgende geänderte `UpdateCommand` und `DeleteCommand` Werte:</span><span class="sxs-lookup"><span data-stu-id="880be-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="880be-188">Schritt 2: Hinzufügen einer GridView-Ansicht mit bearbeiten und Löschoptionen</span><span class="sxs-lookup"><span data-stu-id="880be-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="880be-189">Mit dem SqlDataSource-Steuerelement so konfiguriert, dass das unterstützen der optimistischen Parallelität übrig bleibt ein Daten-Websteuerelement zur Seite hinzufügen, der diese parallelitätssteuerung verwendet.</span><span class="sxs-lookup"><span data-stu-id="880be-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="880be-190">In diesem Tutorial können Sie s Hinzufügen einer GridView-Ansicht, die beide bearbeiten bereitstellt und die Löschfunktionen.</span><span class="sxs-lookup"><span data-stu-id="880be-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="880be-191">Um dies zu erreichen, ziehen Sie in einer GridView-Ansicht aus der Toolbox in den Designer und den Satz der `ID` zu `Products`.</span><span class="sxs-lookup"><span data-stu-id="880be-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="880be-192">Von GridView s Smarttags, binden Sie es an der `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource-Steuerelement, die in Schritt 1 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="880be-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="880be-193">Überprüfen Sie abschließend die Optionen für die Bearbeitung aktivieren und löschen aktivieren aus dem Smarttag.</span><span class="sxs-lookup"><span data-stu-id="880be-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>


[![B<span data-ttu-id="880be-194">Suchen der GridView mit dem SqlDataSource-Steuerelement und aktivieren, bearbeiten und Löschen von]</span><span class="sxs-lookup"><span data-stu-id="880be-194">ind the GridView to the SqlDataSource and Enable Editing and Deleting]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.png)

<span data-ttu-id="880be-195">**Abbildung 6**: GridView zu binden, SqlDataSource-Steuerelement und Bearbeitung aktivieren und löschen ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="880be-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image10.png))</span></span>


<span data-ttu-id="880be-196">Konfigurieren Sie nach dem Hinzufügen der GridView, seine Darstellung durch das Entfernen der `ProductID` BoundField, Ändern der `ProductName` BoundField-s `HeaderText` Eigenschaft Produkt, und Aktualisieren der `UnitPrice` BoundField, damit die `HeaderText` -Eigenschaft ist einfach Preis.</span><span class="sxs-lookup"><span data-stu-id="880be-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="880be-197">Im Idealfall d optimiert, dass die Bearbeitungsschnittstelle einen RequiredFieldValidator für die Einbeziehung der `ProductName` Wert und einem CompareValidator für die `UnitPrice` Wert (um es sicherzustellen, dass s ein ordnungsgemäß formatierter numerischer Wert).</span><span class="sxs-lookup"><span data-stu-id="880be-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="880be-198">Finden Sie in der [Anpassen der Benutzeroberfläche für die Änderung der Daten](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) Tutorial für eine eingehendere Betrachtung die GridView-s bearbeiten-Schnittstelle anpassen.</span><span class="sxs-lookup"><span data-stu-id="880be-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="880be-199">Das GridView, die Ansichtszustand s aktiviert werden muss, da die ursprünglichen Werte, die von der GridView an dem SqlDataSource-Steuerelement übergeben werden im Ansichtszustand gespeichert.</span><span class="sxs-lookup"><span data-stu-id="880be-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>


<span data-ttu-id="880be-200">Nach dem vornehmen dieser Änderungen an die GridView, sollte GridView und SqlDataSource deklarative Markup etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="880be-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample9.aspx)]

<span data-ttu-id="880be-201">Um die Steuerung für optimistische Parallelität in Aktion zu sehen, öffnen Sie zwei Browserfenster, und laden die `OptimisticConcurrency.aspx` Seite in beiden.</span><span class="sxs-lookup"><span data-stu-id="880be-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="880be-202">Klicken Sie auf die Schaltflächen Bearbeiten, für das erste Produkt in beiden Browsern.</span><span class="sxs-lookup"><span data-stu-id="880be-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="880be-203">In einem Browser aus ändern Sie den Namen des Produkts, und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="880be-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="880be-204">Der Browser wird postback und GridView wird zurück zu den vorab Bearbeitungsmodus mit dem neuen Produktnamen für den Datensatz, der gerade bearbeitet.</span><span class="sxs-lookup"><span data-stu-id="880be-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="880be-205">Im zweiten Browserfenster ändern Sie den Preis (aber lassen Sie den Produktnamen als den ursprünglichen Wert), und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="880be-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="880be-206">Beim Postback im Raster auf den vorab Bearbeitungsmodus gibt, aber die Änderung der Preis wird nicht aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="880be-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="880be-207">Der zweite Browser zeigt dem gleichen Wert wie die erste Bedingung der neue Produktname mit dem alten Preis.</span><span class="sxs-lookup"><span data-stu-id="880be-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="880be-208">Die Änderungen in der zweiten Browserfenster sind verloren gegangen.</span><span class="sxs-lookup"><span data-stu-id="880be-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="880be-209">Darüber hinaus sind die Änderungen verloren gegangen stattdessen automatisch, wie es war keine Ausnahme oder eine Meldung, dass eine parallelitätsverletzung soeben aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="880be-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>


[![T<span data-ttu-id="880be-210">Er ändert sich in der zweiten Browser-Fenster im Hintergrund gingen]</span><span class="sxs-lookup"><span data-stu-id="880be-210">he Changes in the Second Browser Window Were Silently Lost]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image11.png)

<span data-ttu-id="880be-211">**Abbildung 7**: Die Änderungen in der zweiten Browser-Fenster im Hintergrund gingen ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="880be-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image12.png))</span></span>


<span data-ttu-id="880be-212">Der Grund, warum die zweite browseränderungen s nicht ein Commit ausgeführt waren, wurde, da die `UPDATE` Anweisung s `WHERE` -Klausel gefiltert, um alle Datensätze und daher keine Auswirkungen auf Zeilen.</span><span class="sxs-lookup"><span data-stu-id="880be-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="880be-213">S betrachten können die `UPDATE` Anweisung erneut aus:</span><span class="sxs-lookup"><span data-stu-id="880be-213">Let s look at the `UPDATE` statement again:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample10.sql)]

<span data-ttu-id="880be-214">Wenn das zweite Browserfenster den Datensatz aktualisiert wird, wird der ursprüngliche Produktname angegeben, der `WHERE` Klausel t Übereinstimmung sich mit vorhandenen Namen des Produkts (da es vom ersten Browser geändert wurde).</span><span class="sxs-lookup"><span data-stu-id="880be-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="880be-215">Aus diesem Grund die Anweisung `[ProductName] = @original_ProductName` gibt False zurück, und die `UPDATE` wirkt sich nicht auf alle Einträge.</span><span class="sxs-lookup"><span data-stu-id="880be-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="880be-216">Löschen Sie auf die gleiche Weise funktioniert.</span><span class="sxs-lookup"><span data-stu-id="880be-216">Delete works in the same manner.</span></span> <span data-ttu-id="880be-217">Mit zwei Browserfenster öffnen zu beginnen, indem Sie ein bestimmtes Produkt mit einem bearbeiten und dann die Änderungen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="880be-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="880be-218">Klicken Sie nach dem Speichern der Änderungen in einem Browser an, auf die Schaltfläche "löschen" für das gleiche Produkt in der anderen.</span><span class="sxs-lookup"><span data-stu-id="880be-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="880be-219">Da die ursprünglichen Werte ich möchte faktenpartition der `DELETE` Anweisung s `WHERE` -Klausel, der Löschvorgang im Hintergrund ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="880be-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>


<span data-ttu-id="880be-220">Aus Sicht der Endbenutzer-s in der zweiten Browserfenster nach dem Klicken auf die Schaltfläche "Aktualisieren" im Raster gibt zurück, in den Bearbeitungsmodus vor, aber die Änderungen sind verloren gegangen.</span><span class="sxs-lookup"><span data-stu-id="880be-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="880be-221">Jedoch dort s keine visuelle Feedback, das ihre Änderungen bleiben nicht.</span><span class="sxs-lookup"><span data-stu-id="880be-221">However, there s no visual feedback that their changes didn't stick.</span></span> <span data-ttu-id="880be-222">Im Idealfall eine benutzeränderungen s auf eine parallelitätsverletzung verloren gehen, wir d informiert und vielleicht das Raster im Bearbeitungsmodus belassen.</span><span class="sxs-lookup"><span data-stu-id="880be-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="880be-223">Lassen Sie s, betrachten dazu zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="880be-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="880be-224">Schritt 3: Bestimmen, wenn eine Parallelitätsverletzung aufgetreten ist</span><span class="sxs-lookup"><span data-stu-id="880be-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="880be-225">Da eine parallelitätsverletzung die Änderungen zurückgewiesen wird, die eine vorgenommen hat, wäre es schön, die den Benutzer zu warnen, wenn eine parallelitätsverletzung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="880be-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="880be-226">Um den Benutzer darauf aufmerksam, Let s, fügen Sie ein Label-Steuerelement an den Anfang der Seite mit dem Namen `ConcurrencyViolationMessage` , deren `Text` Eigenschaft wird die folgende Meldung angezeigt: Sie haben versucht, zu aktualisieren oder Löschen eines Datensatzes, das gleichzeitig von einem anderen Benutzer aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="880be-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="880be-227">Bitte überprüfen Sie die Änderungen des anderen Benutzers, und klicken Sie dann wiederholen Sie das Update oder löschen.</span><span class="sxs-lookup"><span data-stu-id="880be-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="880be-228">Legen Sie das Label-Steuerelement s `CssClass` -Eigenschaft in "Warnung", ist eine CSS-Klasse definiert, `Styles.css` , Text in Rot, kursiv, fett und große Schriftart anzeigt.</span><span class="sxs-lookup"><span data-stu-id="880be-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="880be-229">Legen Sie schließlich die Bezeichnung s `Visible` und `EnableViewState` Eigenschaften `false`.</span><span class="sxs-lookup"><span data-stu-id="880be-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="880be-230">Dadurch wird ausgeblendet, die Bezeichnung mit Ausnahme von nur diese Postbacks, in dem wir explizit festlegen, seiner `Visible` Eigenschaft `true`.</span><span class="sxs-lookup"><span data-stu-id="880be-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `true`.</span></span>


[![A<span data-ttu-id="880be-231">TT ein Bezeichnungssteuerelement zum Anzeigen der Warnung auf der Seite]</span><span class="sxs-lookup"><span data-stu-id="880be-231">dd a Label Control to the Page to Display the Warning]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image13.png)

<span data-ttu-id="880be-232">**Abbildung 8**: Fügen Sie ein Label-Steuerelement auf der Seite zum Anzeigen der Warnung ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="880be-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image14.png))</span></span>


<span data-ttu-id="880be-233">Beim Durchführen eines Updates "oder" Delete "," das GridView-s `RowUpdated` und `RowDeleted` Ereignishandler ausgelöst werden, nachdem die Datenquellen-Steuerelement die angeforderte Update- oder Delete ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="880be-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="880be-234">Wir können ermitteln, wie viele Zeilen durch den Vorgang von diesen Ereignishandlern betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="880be-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="880be-235">Wenn keine Zeilen betroffen sind, angezeigt werden sollten die `ConcurrencyViolationMessage` Bezeichnung.</span><span class="sxs-lookup"><span data-stu-id="880be-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="880be-236">Erstellen Sie einen Ereignishandler für beide die `RowUpdated` und `RowDeleted` Ereignisse, und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="880be-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>


[!code-csharp[Main](implementing-optimistic-concurrency-with-the-sqldatasource-cs/samples/sample11.cs)]

<span data-ttu-id="880be-237">In beiden Ereignishandler überprüfen wir die `e.AffectedRows` Eigenschaft und, wenn er das gleich 0 ist, legen Sie die `ConcurrencyViolationMessage` Bezeichnung s `Visible` Eigenschaft `true`.</span><span class="sxs-lookup"><span data-stu-id="880be-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `true`.</span></span> <span data-ttu-id="880be-238">In der `RowUpdated` -Ereignishandler wir auch anweisen, den die GridView, in den Bearbeitungsmodus zu bleiben, durch Festlegen der `KeepInEditMode` Eigenschaft auf "true".</span><span class="sxs-lookup"><span data-stu-id="880be-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="880be-239">In diesem Fall müssen wir die Daten in das Raster binden, damit die anderen s Benutzerdaten in die Bearbeitungsschnittstelle geladen werden.</span><span class="sxs-lookup"><span data-stu-id="880be-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="880be-240">Dies erfolgt durch Aufrufen der GridView-s `DataBind()` Methode.</span><span class="sxs-lookup"><span data-stu-id="880be-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="880be-241">Wie in Abbildung 9 gezeigt, bei diesen zwei Ereignishandlern, wird eine äußerst bemerkenswerten Meldung angezeigt, wenn eine parallelitätsverletzung liegt vor.</span><span class="sxs-lookup"><span data-stu-id="880be-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>


[![A <span data-ttu-id="880be-242">Meldung bei eine Parallelitätsverletzung]</span><span class="sxs-lookup"><span data-stu-id="880be-242">Message is Displayed in the Face of a Concurrency Violation]</span></span>(implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image15.png)

<span data-ttu-id="880be-243">**Abbildung 9**: Wird eine Meldung angezeigt, bei dem eine Parallelitätsverletzung ([klicken Sie, um das Bild in voller Größe anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="880be-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-cs/_static/image16.png))</span></span>


## <a name="summary"></a><span data-ttu-id="880be-244">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="880be-244">Summary</span></span>

<span data-ttu-id="880be-245">Beim Erstellen einer Webanwendung, in denen mehrere, gleichzeitige Benutzer möglicherweise die gleichen Daten bearbeiten es ist wichtig, die Verwaltungsoptionen für die Parallelität zu berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="880be-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="880be-246">Standardmäßig ist die ASP.NET-Daten, die steuert, Web und die Datenquellen-Steuerelemente keine parallelitätssteuerung nutzen.</span><span class="sxs-lookup"><span data-stu-id="880be-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="880be-247">Wie wir in diesem Tutorial gesehen haben, ist die Implementierung der Steuerung durch vollständige Parallelität mit dem SqlDataSource-Steuerelement relativ schnell und einfach.</span><span class="sxs-lookup"><span data-stu-id="880be-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="880be-248">Dem SqlDataSource-Steuerelement behandelt den größten Teil der Arbeit aus, für Ihre hinzufügen Erweitert `WHERE` -Klauseln verwenden, um den automatisch generierten `UPDATE` und `DELETE` Anweisungen, es gibt jedoch sind einige Besonderheiten bei der Verwendung von `NULL` Wert der Spalten, wie unter der Ordnungsgemäße Handhabung `NULL` Abschnitt Werte.</span><span class="sxs-lookup"><span data-stu-id="880be-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="880be-249">Dieses Lernprogramm schließt unserer Untersuchung von dem SqlDataSource-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="880be-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="880be-250">Die verbleibenden Lernprogramme werden zurückgegeben, für die Arbeit mit Daten, die mit dem ObjectDataSource-Steuerelement und eine geschichtete Architektur.</span><span class="sxs-lookup"><span data-stu-id="880be-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="880be-251">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="880be-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="880be-252">Der Autor</span><span class="sxs-lookup"><span data-stu-id="880be-252">About the Author</span></span>

<span data-ttu-id="880be-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben Büchern zu ASP/ASP.NET und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), arbeitet mit Microsoft-Web-Technologien seit 1998.</span><span class="sxs-lookup"><span data-stu-id="880be-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="880be-254">Er ist als ein unabhängiger Berater, Schulungsleiter und Autor.</span><span class="sxs-lookup"><span data-stu-id="880be-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="880be-255">Sein neueste Buch wird [*Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="880be-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="880be-256">Er ist unter [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="880be-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="880be-257">oder über seinen Blog finden Sie unter [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="880be-257">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="880be-258">[Zurück](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
> [Weiter](querying-data-with-the-sqldatasource-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="880be-258">[Previous](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)
[Next](querying-data-with-the-sqldatasource-control-vb.md)</span></span>
