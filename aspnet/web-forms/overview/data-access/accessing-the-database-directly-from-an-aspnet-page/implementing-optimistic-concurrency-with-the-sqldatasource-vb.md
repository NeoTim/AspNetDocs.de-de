---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
title: Implementieren von optimistischer Parallelität mit SqlDataSource (VB) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial überprüfen wir die Grundlagen der Steuerung der vollständigen Parallelität und untersuchen dann, wie Sie mit dem SqlDataSource-Steuerelement implementiert werden.
ms.author: riande
ms.date: 02/20/2007
ms.assetid: a8fa72ee-8328-4854-a419-c1b271772303
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 431734b5245c20ac840147cf0827fa7f8d1e4d17
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78445311"
---
# <a name="implementing-optimistic-concurrency-with-the-sqldatasource-vb"></a><span data-ttu-id="66256-103">Implementieren von optimistischer Parallelität mit dem SqlDataSource-Steuerelement (VB)</span><span class="sxs-lookup"><span data-stu-id="66256-103">Implementing Optimistic Concurrency with the SqlDataSource (VB)</span></span>

<span data-ttu-id="66256-104">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="66256-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="66256-105">[Beispiel-app herunterladen](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) oder [PDF herunterladen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="66256-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span></span>

> <span data-ttu-id="66256-106">In diesem Tutorial überprüfen wir die Grundlagen der Steuerung der vollständigen Parallelität und untersuchen dann, wie Sie mit dem SqlDataSource-Steuerelement implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="66256-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>

## <a name="introduction"></a><span data-ttu-id="66256-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="66256-107">Introduction</span></span>

<span data-ttu-id="66256-108">Im vorherigen Tutorial wurde erläutert, wie Sie dem SqlDataSource-Steuerelement Einfüge-, Aktualisierungs-und Löschfunktionen hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="66256-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="66256-109">Kurz gesagt, um diese Features bereitzustellen, mussten wir die entsprechende `INSERT`-, `UPDATE`-oder `DELETE` SQL-Anweisung in den Eigenschaften der `InsertCommand`-, `UpdateCommand`-oder `DeleteCommand`-Eigenschaft des Steuer Elements angeben, zusammen mit den entsprechenden Parametern in den `InsertParameters`-, `UpdateParameters`-und `DeleteParameters`-Auflistungen.</span><span class="sxs-lookup"><span data-stu-id="66256-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="66256-110">Diese Eigenschaften und Auflistungen können manuell angegeben werden. die Schaltfläche "Erweiterte Datenquellen-Assistent" enthält jedoch das Kontrollkästchen "`INSERT`generieren", "`UPDATE`" und "`DELETE`", mit dem diese Anweisungen automatisch auf der Grundlage der `SELECT` Anweisung erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="66256-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="66256-111">Zusammen mit dem Kontrollkästchen `INSERT`generieren, `UPDATE`und `DELETE`-Anweisung enthält das Dialogfeld Erweiterte SQL-Generierungs Optionen eine Option zum Verwenden von optimistischer Parallelität (siehe Abbildung 1).</span><span class="sxs-lookup"><span data-stu-id="66256-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="66256-112">Wenn dieses Kontrollkästchen aktiviert ist, werden die `WHERE`-Klauseln in den automatisch generierten `UPDATE` und `DELETE`-Anweisungen so geändert, dass Sie nur das Update oder den Löschvorgang ausführen, wenn die zugrunde liegenden Datenbankdaten seit dem letzten Laden der Daten im Raster nicht geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="66256-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn't been modified since the user last loaded the data into the grid.</span></span>

![Im Dialog Feld Erweiterte SQL-Generierungs Optionen können Sie die Unterstützung für optimistische Parallelität hinzufügen.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.gif)

<span data-ttu-id="66256-114">**Abbildung 1**: Sie können im Dialog Feld "Erweiterte SQL-Generierungs Optionen" Unterstützung für vollständige Parallelität hinzufügen</span><span class="sxs-lookup"><span data-stu-id="66256-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>

<span data-ttu-id="66256-115">Im Tutorial zum [Implementieren von optimistischer](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Parallelität haben wir die Grundlagen der Steuerung der vollständigen Parallelität und die Vorgehensweise zum Hinzufügen zu ObjectDataSource untersucht.</span><span class="sxs-lookup"><span data-stu-id="66256-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="66256-116">In diesem Tutorial werden die Grundlagen der Steuerung der vollständigen Parallelität behandelt und dann erläutert, wie Sie mithilfe von SqlDataSource implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="66256-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="66256-117">Eine Zusammenfassung der optimistischen Parallelität</span><span class="sxs-lookup"><span data-stu-id="66256-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="66256-118">Für Webanwendungen, die mehreren, gleichzeitigen Benutzern erlauben, dieselben Daten zu bearbeiten oder zu löschen, besteht die Möglichkeit, dass ein Benutzer möglicherweise versehentlich andere Änderungen überschreibt.</span><span class="sxs-lookup"><span data-stu-id="66256-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="66256-119">Im Tutorial zum [Implementieren von optimistischer](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Parallelität habe ich Folgendes Beispiel angegeben:</span><span class="sxs-lookup"><span data-stu-id="66256-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="66256-120">Stellen Sie sich vor, dass zwei Benutzer, jisun und Sam, eine Seite in einer Anwendung besuchen, die es Besuchern gestattet hat, Produkte über ein GridView-Steuerelement zu aktualisieren und zu löschen.</span><span class="sxs-lookup"><span data-stu-id="66256-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="66256-121">Beide klicken auf die Bearbeitungs Schaltfläche für Chai ungefähr zur gleichen Zeit.</span><span class="sxs-lookup"><span data-stu-id="66256-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="66256-122">Jisun ändert den Produktnamen in Chai Tea und klickt auf die Schaltfläche Aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="66256-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="66256-123">Das Ergebnis ist eine `UPDATE`-Anweisung, die an die Datenbank gesendet wird, die *alle* aktualisierbaren Felder für das Produkt festlegt (obwohl jisun nur ein Feld aktualisiert hat, `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="66256-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="66256-124">Zu diesem Zeitpunkt hat die Datenbank die Werte "Chai Tea", "Kategorie Getränke", "Lieferant Exotic Liquids" usw. für dieses Produkt.</span><span class="sxs-lookup"><span data-stu-id="66256-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="66256-125">Allerdings zeigt der Bildschirm GridView auf Sam s den Produktnamen in der bearbeitbaren GridView-Zeile weiterhin als Chai an.</span><span class="sxs-lookup"><span data-stu-id="66256-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="66256-126">Einige Sekunden nach dem Commit der jisun s-Änderungen aktualisiert Sam die Kategorie in Bedingungen und klickt auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="66256-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="66256-127">Dies führt dazu, dass eine `UPDATE`-Anweisung an die Datenbank gesendet wird, die den Produktnamen auf Chai festlegt, die `CategoryID` auf die zugehörige Kategorie-ID der Bedingungen usw.</span><span class="sxs-lookup"><span data-stu-id="66256-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="66256-128">Änderungen an der jisun s-Änderung am Produktnamen wurden überschrieben.</span><span class="sxs-lookup"><span data-stu-id="66256-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="66256-129">In Abbildung 2 wird diese Interaktion veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="66256-129">Figure 2 illustrates this interaction.</span></span>

<span data-ttu-id="66256-130">[![wenn zwei Benutzer gleichzeitig einen Datensatz aktualisieren, besteht die Möglichkeit, dass ein Benutzer Änderungen an den anderen en überschreibt.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="66256-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="66256-131">**Abbildung 2**: Wenn zwei Benutzer gleichzeitig einen Datensatz aktualisieren, gibt es möglicherweise eine Änderung an einem Benutzer, um die anderen en zu überschreiben ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png)).</span><span class="sxs-lookup"><span data-stu-id="66256-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span></span>

<span data-ttu-id="66256-132">Um dieses Szenario zu verhindern, muss eine Form der Parallelitäts [Steuerung](http://en.wikipedia.org/wiki/Concurrency_control) implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="66256-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="66256-133">Vollständige Parallelität der Schwerpunkt dieses Lernprogramms liegt auf der Annahme, dass es [in der zwischen](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) Zeit zu Parallelitäts Konflikten kommt und der Großteil der Zeit solche Konflikte nicht verursacht.</span><span class="sxs-lookup"><span data-stu-id="66256-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won't arise.</span></span> <span data-ttu-id="66256-134">Wenn z. b. ein Konflikt auftritt, wird dem Benutzer durch die Steuerung der vollständigen Parallelität lediglich mitgeteilt, dass die Änderungen gespeichert werden können, weil ein anderer Benutzer die gleichen Daten geändert hat.</span><span class="sxs-lookup"><span data-stu-id="66256-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="66256-135">Bei Anwendungen, in denen davon ausgegangen wird, dass es zu vielen Parallelitäts Konflikten kommt oder solche Konflikte nicht toleriert werden, kann stattdessen die pessimistische Parallelitäts Steuerung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="66256-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="66256-136">Eine ausführlichere Erläuterung zur Steuerung der pessimistischen Parallelität finden Sie im Tutorial zum [Implementieren von optimistischer](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Parallelität.</span><span class="sxs-lookup"><span data-stu-id="66256-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>

<span data-ttu-id="66256-137">Durch die Steuerung der vollständigen Parallelität wird sichergestellt, dass der zu Aktualisier Ende oder zu löschende Datensatz dieselben Werte hat wie beim Start des Aktualisierungs-oder Löschvorgangs.</span><span class="sxs-lookup"><span data-stu-id="66256-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="66256-138">Wenn Sie z. b. in einem bearbeitbaren GridView-Steuerelement auf die Schaltfläche Bearbeiten klicken, werden die Werte des Datensatz s aus der Datenbank gelesen und in Textfeldern und anderen websteuer Elementen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="66256-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="66256-139">Diese ursprünglichen Werte werden von der GridView gespeichert.</span><span class="sxs-lookup"><span data-stu-id="66256-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="66256-140">Nachdem der Benutzer die Änderungen vorgenommen und auf die Schaltfläche Aktualisieren geklickt hat, muss in der `UPDATE`-Anweisung die ursprünglichen Werte zuzüglich der neuen Werte berücksichtigt werden, und der zugrunde liegende Datenbankdaten Satz muss nur aktualisiert werden, wenn die ursprünglichen Werte, die der Benutzer mit der Bearbeitung begonnen hat, mit den Werten in der Datenbank identisch sind.</span><span class="sxs-lookup"><span data-stu-id="66256-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="66256-141">In Abbildung 3 wird diese Abfolge von Ereignissen dargestellt.</span><span class="sxs-lookup"><span data-stu-id="66256-141">Figure 3 depicts this sequence of events.</span></span>

<span data-ttu-id="66256-142">[![, dass das Update oder der Löschvorgang erfolgreich ist, müssen die ursprünglichen Werte den aktuellen Daten bankwerten entsprechen.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="66256-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="66256-143">**Abbildung 3**: damit das Update oder der Löschvorgang erfolgreich ausgeführt werden kann, müssen die ursprünglichen Werte den aktuellen Daten bankwerten entsprechen ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png)).</span><span class="sxs-lookup"><span data-stu-id="66256-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span></span>

<span data-ttu-id="66256-144">Es gibt verschiedene Ansätze für die Implementierung von optimistischer Parallelität (siehe die [Aktualisierungs Logik für optimistische](http://www.eggheadcafe.com/articles/20050719.asp) Parallelität von [Peter A. Bromberg](http://peterbromberg.net/)für einen kurzen Blick auf eine Reihe von Optionen).</span><span class="sxs-lookup"><span data-stu-id="66256-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://peterbromberg.net/)'s [Optimistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="66256-145">Die von SqlDataSource verwendete Technik (sowie die in unserer Datenzugriffs Schicht verwendeten ADO.net typisierten Datasets) erweitert die `WHERE`-Klausel so, dass Sie einen Vergleich aller ursprünglichen Werte einschließt.</span><span class="sxs-lookup"><span data-stu-id="66256-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="66256-146">Mit der folgenden `UPDATE` Anweisung werden z. b. der Name und der Preis eines Produkts nur aktualisiert, wenn die aktuellen Daten Bank Werte den Werten entsprechen, die ursprünglich beim Aktualisieren des Datensatzes in der GridView abgerufen wurden.</span><span class="sxs-lookup"><span data-stu-id="66256-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="66256-147">Die Parameter `@ProductName` und `@UnitPrice` enthalten die neuen Werte, die vom Benutzer eingegeben wurden, während `@original_ProductName` und `@original_UnitPrice` die Werte enthalten, die beim Klicken auf die Schaltfläche Bearbeiten ursprünglich in die GridView geladen wurden:</span><span class="sxs-lookup"><span data-stu-id="66256-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="66256-148">Wie wir in diesem Tutorial sehen werden, ist das Aktivieren der Steuerung der optimistischen Parallelität mit SqlDataSource so einfach wie das Aktivieren eines Kontrollkästchens.</span><span class="sxs-lookup"><span data-stu-id="66256-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="66256-149">Schritt 1: Erstellen einer SqlDataSource, die optimistische Parallelität unterstützt</span><span class="sxs-lookup"><span data-stu-id="66256-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="66256-150">Öffnen Sie zunächst die Seite `OptimisticConcurrency.aspx` aus dem Ordner `SqlDataSource`.</span><span class="sxs-lookup"><span data-stu-id="66256-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="66256-151">Ziehen Sie ein SqlDataSource-Steuerelement aus der Toolbox auf den Designer, und legen Sie dessen `ID`-Eigenschaft auf `ProductsDataSourceWithOptimisticConcurrency`fest.</span><span class="sxs-lookup"><span data-stu-id="66256-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="66256-152">Klicken Sie anschließend auf den Link Datenquelle konfigurieren des Smarttags für die Steuerelemente.</span><span class="sxs-lookup"><span data-stu-id="66256-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="66256-153">Wählen Sie auf dem ersten Bildschirm des Assistenten die Option zum Arbeiten mit dem `NORTHWINDConnectionString` aus, und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="66256-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>

<span data-ttu-id="66256-154">[![Sie die Verwendung von NorthwindConnectionString.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="66256-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="66256-155">**Abbildung 4**: Wählen Sie die Arbeit mit dem `NORTHWINDConnectionString` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="66256-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span></span>

<span data-ttu-id="66256-156">In diesem Beispiel fügen wir eine GridView hinzu, mit der Benutzer die `Products` Tabelle bearbeiten können.</span><span class="sxs-lookup"><span data-stu-id="66256-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="66256-157">Wählen Sie daher im Bildschirm "SELECT-Anweisung konfigurieren" in der Dropdown Liste die `Products` Tabelle aus, und wählen Sie die Spalten "`ProductID`", "`ProductName`", "`UnitPrice`" und "`Discontinued`" aus, wie in Abbildung 5 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="66256-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>

<span data-ttu-id="66256-158">[Geben Sie ![aus der Tabelle Products die Spalten ProductID, ProductName, UnitPrice und nicht mehr unterstützt zurück.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="66256-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="66256-159">**Abbildung 5**`Products`: Zurückgeben der Spalten "`ProductID`", "`ProductName`", "`UnitPrice`" und "`Discontinued`" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="66256-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span></span>

<span data-ttu-id="66256-160">Nachdem Sie die Spalten auswählen, klicken Sie auf die Schaltfläche Erweitert, um das Dialogfeld Erweiterte SQL-Generierungs Optionen zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="66256-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="66256-161">Überprüfen Sie die Anweisungen `INSERT`generieren, `UPDATE`und `DELETE`, und verwenden Sie die Kontrollkästchen für die vollständige Parallelität, und klicken Sie auf OK (Weitere Informationen finden Sie in Abbildung 1).</span><span class="sxs-lookup"><span data-stu-id="66256-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="66256-162">Beenden Sie den Assistenten, indem Sie auf weiter und dann auf Fertigstellen klicken</span><span class="sxs-lookup"><span data-stu-id="66256-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="66256-163">Nachdem Sie den Assistenten zum Konfigurieren von Datenquellen abgeschlossen haben, nehmen Sie sich einen Moment Zeit, um die resultierenden `DeleteCommand` und `UpdateCommand` Eigenschaften sowie die `DeleteParameters`-und `UpdateParameters` Auflistungen</span><span class="sxs-lookup"><span data-stu-id="66256-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="66256-164">Die einfachste Möglichkeit hierzu besteht darin, in der unteren linken Ecke auf die Registerkarte "Quelle" zu klicken, um die deklarative Syntax der Seite anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="66256-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="66256-165">Dort finden Sie einen `UpdateCommand` Wert von:</span><span class="sxs-lookup"><span data-stu-id="66256-165">There you will find an `UpdateCommand` value of:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="66256-166">Mit sieben Parametern in der `UpdateParameters`-Sammlung:</span><span class="sxs-lookup"><span data-stu-id="66256-166">With seven parameters in the `UpdateParameters` collection:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="66256-167">Ebenso sollten die `DeleteCommand`-Eigenschaft und die `DeleteParameters` Auflistung wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="66256-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample4.sql)]

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample5.aspx)]

<span data-ttu-id="66256-168">Zusätzlich zur Erweiterung der `WHERE` Klauseln der Eigenschaften `UpdateCommand` und `DeleteCommand` (und zum Hinzufügen der zusätzlichen Parameter zu den jeweiligen Parameter Auflistungen), werden bei Auswahl der Option optimistische Parallelität verwenden zwei weitere Eigenschaften angepasst:</span><span class="sxs-lookup"><span data-stu-id="66256-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="66256-169">Ändert die [`ConflictDetection`-Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) von `OverwriteChanges` (Standard) in `CompareAllValues`</span><span class="sxs-lookup"><span data-stu-id="66256-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="66256-170">Ändert die [`OldValuesParameterFormatString`-Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) von {0} (Standardeinstellung) in den ursprünglichen\_{0}.</span><span class="sxs-lookup"><span data-stu-id="66256-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="66256-171">Wenn das datenweb-Steuerelement die SqlDataSource s-`Update()` oder `Delete()`-Methode aufruft, übergibt es die ursprünglichen Werte.</span><span class="sxs-lookup"><span data-stu-id="66256-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="66256-172">Wenn die Eigenschaft SqlDataSource s `ConflictDetection` auf `CompareAllValues`festgelegt ist, werden diese ursprünglichen Werte dem Befehl hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="66256-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="66256-173">Die `OldValuesParameterFormatString`-Eigenschaft stellt das Benennungs Muster bereit, das für diese ursprünglichen Wert Parameter verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="66256-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="66256-174">Der Assistent zum Konfigurieren von Datenquellen verwendet die ursprüngliche\_{0} und benennt jeden ursprünglichen Parameter in den Eigenschaften `UpdateCommand` und `DeleteCommand` sowie `UpdateParameters` und `DeleteParameters` Sammlungen entsprechend.</span><span class="sxs-lookup"><span data-stu-id="66256-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="66256-175">Da die Einfügefunktionen des SqlDataSource-Steuer Elements nicht verwendet werden, können Sie die `InsertCommand`-Eigenschaft und deren `InsertParameters` Auflistung entfernen.</span><span class="sxs-lookup"><span data-stu-id="66256-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>

## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="66256-176">Ordnungsgemäße Behandlung von`NULL`Werten</span><span class="sxs-lookup"><span data-stu-id="66256-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="66256-177">Leider funktionieren die vom Assistenten zum Konfigurieren von Datenquellen beim Verwenden von optimistischer Parallelität automatisch generierten erweiterten `UPDATE` und `DELETE` Anweisungen *nicht* mit Datensätzen, die `NULL` Werte enthalten.</span><span class="sxs-lookup"><span data-stu-id="66256-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="66256-178">Sehen Sie sich die folgenden `UpdateCommand`an, um zu sehen, warum die SqlDataSource s</span><span class="sxs-lookup"><span data-stu-id="66256-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample6.sql)]

<span data-ttu-id="66256-179">Die `UnitPrice` Spalte in der `Products` Tabelle kann `NULL` Werte aufweisen.</span><span class="sxs-lookup"><span data-stu-id="66256-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="66256-180">Wenn ein bestimmter Datensatz über einen `NULL` Wert für `UnitPrice`verfügt, wird der `WHERE`-klauselteil `[UnitPrice] = @original_UnitPrice` *immer* auf false ausgewertet, da `NULL = NULL` immer false zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="66256-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="66256-181">Daher können Datensätze, die `NULL` Werte enthalten, nicht bearbeitet oder gelöscht werden, da die `WHERE` Klauseln `UPDATE` und `DELETE` keine zu aktualisierenden oder zu löschenden Zeilen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="66256-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won't return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="66256-182">Dieser Fehler wurde zuerst an Microsoft im Juni 2004 in [SqlDataSource](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) ausgegeben, es werden falsche SQL-Anweisungen generiert, und es wird geplant, dass er in der nächsten Version von ASP.net korrigiert wird.</span><span class="sxs-lookup"><span data-stu-id="66256-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>

<span data-ttu-id="66256-183">Um dieses Problem zu beheben, müssen Sie die `WHERE`-Klauseln in den Eigenschaften `UpdateCommand` und `DeleteCommand` für **alle** Spalten, die `NULL` Werte aufweisen können, manuell aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="66256-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="66256-184">Ändern Sie im allgemeinen `[ColumnName] = @original_ColumnName` in:</span><span class="sxs-lookup"><span data-stu-id="66256-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="66256-185">Diese Änderung kann direkt über das deklarative Markup, über die Optionen UpdateQuery oder DeleteQuery aus dem Eigenschaftenfenster oder über die Registerkarten aktualisieren und löschen in der Option benutzerdefinierte SQL-Anweisung oder gespeicherte Prozedur angeben in den Optionen Configure Data (benutzerdefinierte SQL-Anweisung oder gespeicherte Prozedur angeben) vorgenommen werden. Quellen-Assistent.</span><span class="sxs-lookup"><span data-stu-id="66256-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="66256-186">Diese Änderung muss für *jede* Spalte in der `UpdateCommand`-und `DeleteCommand` s `WHERE`-Klausel vorgenommen werden, die `NULL` Werte enthalten kann.</span><span class="sxs-lookup"><span data-stu-id="66256-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="66256-187">Wenn Sie dies auf unser Beispiel anwenden, führt dies zu den folgenden geänderten `UpdateCommand` und `DeleteCommand` Werten:</span><span class="sxs-lookup"><span data-stu-id="66256-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="66256-188">Schritt 2: Hinzufügen einer GridView-Option mit Optionen zum Bearbeiten und löschen</span><span class="sxs-lookup"><span data-stu-id="66256-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="66256-189">Wenn SqlDataSource für die Unterstützung optimistischer Parallelität konfiguriert ist, besteht nur noch das Hinzufügen eines datenweb-Steuer Elements zu der Seite, die diese Parallelitäts Steuerung verwendet.</span><span class="sxs-lookup"><span data-stu-id="66256-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="66256-190">Fügen Sie für dieses Tutorial eine GridView hinzu, die sowohl die Funktion "Bearbeiten" als auch "Löschen" bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="66256-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="66256-191">Ziehen Sie hierzu eine GridView aus der Toolbox auf den Designer, und legen Sie den `ID` auf `Products`fest.</span><span class="sxs-lookup"><span data-stu-id="66256-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="66256-192">Binden Sie das GridView s-Smarttag an das `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource-Steuerelement, das Sie in Schritt 1 hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="66256-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="66256-193">Überprüfen Sie abschließend die Optionen Aktivieren der Bearbeitung und Löschen des Smarttags.</span><span class="sxs-lookup"><span data-stu-id="66256-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>

<span data-ttu-id="66256-194">[![die GridView an SqlDataSource binden und das Bearbeiten und löschen aktivieren.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="66256-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="66256-195">**Abbildung 6**: Binden der GridView an die SqlDataSource und Aktivieren der Bearbeitung und Löschung ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="66256-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span></span>

<span data-ttu-id="66256-196">Nachdem Sie die GridView hinzugefügt haben, konfigurieren Sie die Darstellung, indem Sie die `ProductID` BoundField entfernen, die `ProductName` BoundField s `HeaderText`-Eigenschaft in Product ändern und das `UnitPrice` BoundField aktualisieren, sodass die `HeaderText`-Eigenschaft einfach Price ist.</span><span class="sxs-lookup"><span data-stu-id="66256-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="66256-197">Im Idealfall verbessern wir die Bearbeitungs Schnittstelle so, dass Sie ein "Requirements dfieldvalidator" für den `ProductName` Wert und einen CompareValidator für den `UnitPrice` Wert enthält (um sicherzustellen, dass es sich um einen ordnungsgemäß formatierten numerischen Wert handelt).</span><span class="sxs-lookup"><span data-stu-id="66256-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="66256-198">Ausführliche Informationen zur Anpassung der GridView s-Bearbeitungs Schnittstelle finden Sie im Tutorial [Anpassen der Daten Änderungs Schnittstelle](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="66256-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="66256-199">Der GridView s-Ansichts Zustand muss aktiviert sein, da die ursprünglichen Werte, die von der GridView an die SqlDataSource übergeben werden, im Ansichts Zustand gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="66256-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>

<span data-ttu-id="66256-200">Nachdem Sie diese Änderungen an der GridView vorgenommen haben, sollten das deklarative GridView-und SqlDataSource-Markup in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="66256-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="66256-201">Um die Steuerung der vollständigen Parallelität in Aktion zu sehen, öffnen Sie zwei Browserfenster, und laden Sie die `OptimisticConcurrency.aspx` Seite in beiden.</span><span class="sxs-lookup"><span data-stu-id="66256-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="66256-202">Klicken Sie auf die Bearbeitungs Schaltflächen für das erste Produkt in beiden Browsern.</span><span class="sxs-lookup"><span data-stu-id="66256-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="66256-203">Ändern Sie in einem Browser den Produktnamen, und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="66256-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="66256-204">Der Browser wird Postback durchführt, und die GridView kehrt in den Vorbearbeitungs Modus zurück und zeigt den neuen Produktnamen für den soeben bearbeiteten Datensatz an.</span><span class="sxs-lookup"><span data-stu-id="66256-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="66256-205">Ändern Sie im zweiten Browserfenster den Preis (aber belassen Sie den Produktnamen als ursprünglichen Wert), und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="66256-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="66256-206">Beim Postback kehrt das Raster in seinen vorab Bearbeitungsmodus zurück, aber die Änderung am Preis wird nicht aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="66256-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="66256-207">Der zweite Browser zeigt den gleichen Wert wie der erste, den neuen Produktnamen mit dem alten Preis.</span><span class="sxs-lookup"><span data-stu-id="66256-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="66256-208">Die im zweiten Browserfenster vorgenommenen Änderungen sind verloren gegangen.</span><span class="sxs-lookup"><span data-stu-id="66256-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="66256-209">Außerdem gingen die Änderungen nicht in Ruhe, da es keine Ausnahme oder Meldung gab, die darauf hinweist, dass gerade eine Parallelitäts Verletzung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="66256-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>

<span data-ttu-id="66256-210">[![die Änderungen im zweiten Browser Fenster im Hintergrund verloren.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="66256-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="66256-211">**Abbildung 7**: die Änderungen im zweiten Browser Fenster gingen im Hintergrund verloren ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="66256-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span></span>

<span data-ttu-id="66256-212">Der Grund, warum für die zweiten Browser Änderungen kein Commit ausgeführt wurde, war, weil die `UPDATE` Anweisung s `WHERE`-Klausel alle Datensätze herausgefiltert hat und daher keine Auswirkung auf Zeilen hatte.</span><span class="sxs-lookup"><span data-stu-id="66256-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="66256-213">Sehen Sie sich die `UPDATE`-Anweisung erneut an:</span><span class="sxs-lookup"><span data-stu-id="66256-213">Let s look at the `UPDATE` statement again:</span></span>

[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="66256-214">Wenn das zweite Browserfenster den Datensatz aktualisiert, stimmt der in der `WHERE`-Klausel angegebene ursprüngliche Produktname nicht mit dem vorhandenen Produktnamen (da er vom ersten Browser geändert wurde) ab.</span><span class="sxs-lookup"><span data-stu-id="66256-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="66256-215">Daher gibt die-Anweisung `[ProductName] = @original_ProductName` false zurück, und die `UPDATE` wirkt sich nicht auf Datensätze aus.</span><span class="sxs-lookup"><span data-stu-id="66256-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="66256-216">DELETE funktioniert auf die gleiche Weise.</span><span class="sxs-lookup"><span data-stu-id="66256-216">Delete works in the same manner.</span></span> <span data-ttu-id="66256-217">Wenn zwei Browserfenster geöffnet sind, beginnen Sie, indem Sie ein bestimmtes Produkt mit einem bestimmten Produkt bearbeiten und die Änderungen dann speichern.</span><span class="sxs-lookup"><span data-stu-id="66256-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="66256-218">Nachdem Sie die Änderungen in einem Browser gespeichert haben, klicken Sie auf die Schaltfläche Löschen für das gleiche Produkt in der anderen.</span><span class="sxs-lookup"><span data-stu-id="66256-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="66256-219">Da die ursprünglichen Werte in der `WHERE`-Klausel der `DELETE`-Anweisung nicht mit der Anweisung identisch sind, schlägt der Löschvorgang fehl.</span><span class="sxs-lookup"><span data-stu-id="66256-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>

<span data-ttu-id="66256-220">Aus Sicht des Endbenutzers im zweiten Browserfenster kehrt das Raster nach dem Klicken auf die Schaltfläche "Aktualisieren" in den Vorbearbeitungs Modus zurück, die Änderungen sind jedoch verloren gegangen.</span><span class="sxs-lookup"><span data-stu-id="66256-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="66256-221">Es gibt jedoch kein visuelles Feedback, dass Ihre Änderungen nicht geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="66256-221">However, there s no visual feedback that their changes didn't stick.</span></span> <span data-ttu-id="66256-222">Wenn eine Änderung des Benutzers an einer Parallelitäts Verletzung verloren geht, benachrichtigen wir Sie im Idealfall und behalten das Raster ggf. im Bearbeitungsmodus.</span><span class="sxs-lookup"><span data-stu-id="66256-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="66256-223">Sehen Sie sich an, wie Sie dies erreichen können.</span><span class="sxs-lookup"><span data-stu-id="66256-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="66256-224">Schritt 3: bestimmen, wann eine Parallelitäts Verletzung aufgetreten ist</span><span class="sxs-lookup"><span data-stu-id="66256-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="66256-225">Da die von Ihnen vorgenommenen Änderungen durch eine Parallelitäts Verletzung abgelehnt werden, wäre es sinnvoll, den Benutzer zu benachrichtigen, wenn eine Parallelitäts Verletzung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="66256-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="66256-226">Um den Benutzer zu warnen, fügen Sie ein Label-websteuer Element oben auf der Seite mit dem Namen `ConcurrencyViolationMessage` hinzu, dessen `Text`-Eigenschaft die folgende Meldung anzeigt: Sie haben versucht, einen Datensatz zu aktualisieren oder zu löschen, der von einem anderen Benutzer gleichzeitig aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="66256-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="66256-227">Überprüfen Sie die Änderungen des anderen Benutzers, und wiederholen Sie dann das Update oder den Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="66256-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="66256-228">Legen Sie für die Bezeichnung Control s `CssClass`-Eigenschaft den Wert Warning fest. dabei handelt es sich um eine in `Styles.css` definierte CSS-Klasse, die Text in einer roten, kursiv, Fett und großen Schriftart anzeigt.</span><span class="sxs-lookup"><span data-stu-id="66256-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="66256-229">Legen Sie abschließend die Eigenschaften der Bezeichnung s `Visible` und `EnableViewState` auf `False`fest.</span><span class="sxs-lookup"><span data-stu-id="66256-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="66256-230">Dadurch wird die Bezeichnung ausgeblendet, außer nur bei den Postbacks, bei denen die `Visible`-Eigenschaft explizit auf `True`festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="66256-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `True`.</span></span>

<span data-ttu-id="66256-231">[![der Seite ein Label-Steuerelement hinzufügen, um die Warnung anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="66256-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="66256-232">**Abbildung 8**: Hinzufügen eines Label-Steuer Elements zur Seite, um die Warnung anzuzeigen ([Klicken Sie, um das Bild in voller Größe](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png)anzuzeigen)</span><span class="sxs-lookup"><span data-stu-id="66256-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span></span>

<span data-ttu-id="66256-233">Wenn Sie ein Update oder eine Löschung ausführen, werden die GridView s `RowUpdated` und `RowDeleted` Ereignishandler ausgelöst, nachdem das Datenquellen-Steuerelement das angeforderte Update oder den angeforderten Löschvorgang durchgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="66256-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="66256-234">Wir können bestimmen, wie viele Zeilen vom Vorgang von diesen Ereignis Handlern betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="66256-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="66256-235">Wenn keine Zeilen betroffen sind, möchten wir die `ConcurrencyViolationMessage` Bezeichnung anzeigen.</span><span class="sxs-lookup"><span data-stu-id="66256-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="66256-236">Erstellen Sie einen Ereignishandler für die Ereignisse `RowUpdated` und `RowDeleted`, und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="66256-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>

[!code-vb[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="66256-237">In beiden Ereignis Handlern wird die `e.AffectedRows`-Eigenschaft überprüft. Wenn Sie gleich 0 ist, legen Sie die Eigenschaft `ConcurrencyViolationMessage` Bezeichnung s `Visible` auf `True`fest.</span><span class="sxs-lookup"><span data-stu-id="66256-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `True`.</span></span> <span data-ttu-id="66256-238">Im `RowUpdated`-Ereignishandler wird auch das GridView-Objekt angewiesen, im Bearbeitungsmodus zu bleiben, indem die `KeepInEditMode`-Eigenschaft auf true festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="66256-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="66256-239">Dabei müssen wir die Daten erneut an das Raster binden, damit die anderen Benutzerdaten in die Bearbeitungs Schnittstelle geladen werden.</span><span class="sxs-lookup"><span data-stu-id="66256-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="66256-240">Dies wird durch Aufrufen der GridView s-`DataBind()`-Methode erreicht.</span><span class="sxs-lookup"><span data-stu-id="66256-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="66256-241">Wie Abbildung 9 zeigt, wird bei diesen beiden Ereignis Handlern eine sehr merkliche Meldung angezeigt, wenn eine Parallelitäts Verletzung auftritt.</span><span class="sxs-lookup"><span data-stu-id="66256-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>

<span data-ttu-id="66256-242">[![eine Meldung in Bezug auf eine Parallelitäts Verletzung angezeigt wird.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="66256-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="66256-243">**Abbildung 9**: eine Meldung wird angezeigt, wenn eine Parallelitäts Verletzung vorliegt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="66256-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span></span>

## <a name="summary"></a><span data-ttu-id="66256-244">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="66256-244">Summary</span></span>

<span data-ttu-id="66256-245">Beim Erstellen einer Webanwendung, bei der mehrere gleichzeitige Benutzer möglicherweise dieselben Daten bearbeiten, ist es wichtig, die Optionen für die Parallelitäts Steuerung zu beachten.</span><span class="sxs-lookup"><span data-stu-id="66256-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="66256-246">Standardmäßig verwenden die ASP.net-datenweb Steuerelemente und Datenquellen-Steuerelemente keine Parallelitäts Steuerung.</span><span class="sxs-lookup"><span data-stu-id="66256-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="66256-247">Wie in diesem Tutorial gezeigt, ist die Implementierung der Steuerung der vollständigen Parallelität mit SqlDataSource relativ schnell und einfach.</span><span class="sxs-lookup"><span data-stu-id="66256-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="66256-248">SqlDataSource verarbeitet den größten Teil der Arbeit-Anweisung für die hinzugefügten erweiterten `WHERE` Klauseln zu den automatisch generierten `UPDATE` und `DELETE` Anweisungen, aber es gibt einige Feinheiten bei der Behandlung von `NULL` Wert Spalten, wie im Abschnitt ordnungsgemäße Behandlung `NULL` Werte erläutert.</span><span class="sxs-lookup"><span data-stu-id="66256-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="66256-249">In diesem Tutorial wird die Untersuchung von SqlDataSource abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="66256-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="66256-250">Unsere verbleibenden Lernprogramme werden mithilfe von ObjectDataSource und mehrstufigen Architektur wieder mit Daten arbeiten.</span><span class="sxs-lookup"><span data-stu-id="66256-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="66256-251">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="66256-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="66256-252">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="66256-252">About the Author</span></span>

<span data-ttu-id="66256-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="66256-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="66256-254">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="66256-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="66256-255">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="66256-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="66256-256">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="66256-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="66256-257">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="66256-257">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="66256-258">Previous</span><span class="sxs-lookup"><span data-stu-id="66256-258">Previous</span></span>](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)
