---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: Zwischenspeichern von Daten in derC#Architektur () | Microsoft-Dokumentation
author: rick-anderson
description: Im vorherigen Tutorial haben Sie erfahren, wie Sie die Zwischenspeicherung auf der Präsentationsebene anwenden. In diesem Tutorial erfahren Sie, wie Sie unsere geschichtete Architektur nutzen...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 192cadb8e2f862ac2a97a36b375e247b281ece93
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78443727"
---
# <a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="5b4a2-104">Zwischenspeichern von Daten in der Architektur (C#)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-104">Caching Data in the Architecture (C#)</span></span>

<span data-ttu-id="5b4a2-105">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5b4a2-106">[Beispiel-app herunterladen](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) oder [PDF herunterladen](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="5b4a2-107">Im vorherigen Tutorial haben Sie erfahren, wie Sie die Zwischenspeicherung auf der Präsentationsebene anwenden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="5b4a2-108">In diesem Tutorial erfahren Sie, wie Sie unsere geschichtete Architektur nutzen können, um Daten auf der Geschäftslogik Schicht zwischenzuspeichern.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="5b4a2-109">Dies erreichen Sie, indem Sie die Architektur so erweitern, dass Sie eine cachingschicht einschließt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-109">We do this by extending the architecture to include a Caching Layer.</span></span>

## <a name="introduction"></a><span data-ttu-id="5b4a2-110">Einführung</span><span class="sxs-lookup"><span data-stu-id="5b4a2-110">Introduction</span></span>

<span data-ttu-id="5b4a2-111">Wie bereits im vorherigen Tutorial gezeigt, ist das Zwischenspeichern der ObjectDataSource s-Daten so einfach wie das Festlegen einiger Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="5b4a2-112">Leider wendet ObjectDataSource das Caching auf der Präsentationsschicht an, die die zwischen Speicherungs Richtlinien eng mit der ASP.NET-Seite verbindet.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="5b4a2-113">Einer der Gründe für das Erstellen einer mehrschichtigen Architektur besteht darin, dass solche Verknüpfungen beschädigt werden können.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="5b4a2-114">Die Geschäftslogik Schicht entkoppelt beispielsweise die Geschäftslogik von den ASP.NET Seiten, während die Datenzugriffs Ebene die Datenzugriffs Details entkoppelt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="5b4a2-115">Diese Entkopplung von Geschäftslogik-und Datenzugriffs Details wird teilweise bevorzugt, da das System besser lesbar, besser verwaltbar und flexibler zu ändern ist.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="5b4a2-116">Außerdem ist die Verwendung von Domänen Kenntnissen und Arbeitsabteilung möglich, da ein Entwickler, der auf der Präsentationsschicht arbeitet, nicht mit den Details der Datenbank vertraut sein muss, um Ihre Arbeit zu erledigen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="5b4a2-117">Das Entkoppeln der Cachingrichtlinie von der Präsentationsebene bietet ähnliche Vorteile.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="5b4a2-118">In diesem Tutorial erweitern wir unsere Architektur um eine zwischen Speicherungs *Schicht* (oder kurz cl), die unsere Cachingrichtlinie einsetzt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="5b4a2-119">Die zwischen Speicherungs Ebene enthält eine `ProductsCL` Klasse, die den Zugriff auf Produktinformationen mit Methoden wie `GetProducts()`, `GetProductsByCategoryID(categoryID)`usw. ermöglicht, die beim Aufrufen zuerst versucht, die Daten aus dem Cache abzurufen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="5b4a2-120">Wenn der Cache leer ist, rufen diese Methoden die entsprechende `ProductsBLL` Methode in der BLL auf, die wiederum die Daten aus der dal abruft.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="5b4a2-121">Die `ProductsCL`-Methoden Zwischenspeichern die aus der BLL abgerufenen Daten, bevor Sie zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="5b4a2-122">Wie in Abbildung 1 gezeigt, befindet sich die CL zwischen der Präsentations-und der Geschäftslogik Schicht.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>

![Die Cache Schicht (CL) ist eine andere Ebene in unserer Architektur.](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="5b4a2-124">**Abbildung 1**: die Cache Schicht (CL) ist eine andere Ebene in unserer Architektur.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>

## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="5b4a2-125">Schritt 1: Erstellen der cachingebenenklassen</span><span class="sxs-lookup"><span data-stu-id="5b4a2-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="5b4a2-126">In diesem Tutorial erstellen wir eine sehr einfache cl mit einer einzigen Klasse `ProductsCL`, die nur eine Handvoll Methoden aufweist.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="5b4a2-127">Das Erstellen einer vollständigen zwischen Speicherungs Schicht für die gesamte Anwendung erfordert das Erstellen von `CategoriesCL`-, `EmployeesCL`-und `SuppliersCL` Klassen und das Bereitstellen einer Methode in diesen cachingebenenklassen für jede Datenzugriffs-oder Änderungs Methode in der BLL.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="5b4a2-128">Wie bei BLL und Dal sollte die cachingschicht idealerweise als separates Klassen Bibliotheksprojekt implementiert werden. Wir implementieren es jedoch als Klasse im Ordner "`App_Code`".</span><span class="sxs-lookup"><span data-stu-id="5b4a2-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="5b4a2-129">Wenn Sie die CL-Klassen von den Klassen dal und BLL bereinigen möchten, erstellen Sie einen neuen Unterordner im Ordner `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="5b4a2-130">Klicken Sie mit der rechten Maustaste auf den Ordner `App_Code` im Projektmappen-Explorer, wählen Sie neuer Ordner aus, und benennen Sie den neuen Ordner `CL`.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="5b4a2-131">Nachdem Sie diesen Ordner erstellt haben, fügen Sie ihm eine neue Klasse mit dem Namen `ProductsCL.cs`hinzu.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>

![Fügen Sie einen neuen Ordner namens cl und eine Klasse mit dem Namen ProductsCL.cs hinzu.](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="5b4a2-133">**Abbildung 2**: Hinzufügen eines neuen Ordners mit dem Namen `CL` und einer Klasse mit dem Namen `ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="5b4a2-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>

<span data-ttu-id="5b4a2-134">Die `ProductsCL`-Klasse sollte denselben Satz von Datenzugriffs-und Änderungs Methoden enthalten, die in der entsprechenden Business Logic Layer-Klasse (`ProductsBLL`) gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="5b4a2-135">Anstatt alle diese Methoden zu erstellen, können Sie hier nur ein paar erstellen, um ein Gefühl für die von der CL verwendeten Muster zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="5b4a2-136">Insbesondere fügen wir die Methoden "`GetProducts()`" und "`GetProductsByCategoryID(categoryID)`" in Schritt 3 und eine `UpdateProduct` Überladung in Schritt 4 hinzu.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="5b4a2-137">Sie können die verbleibenden `ProductsCL` Methoden und `CategoriesCL`-, `EmployeesCL`-und `SuppliersCL`-Klassen in ihrer Freizeit hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="5b4a2-138">Schritt 2: Lesen und Schreiben in den Daten Cache</span><span class="sxs-lookup"><span data-stu-id="5b4a2-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="5b4a2-139">Die im vorherigen Tutorial untersuchte ObjectDataSource-Caching-Funktion verwendet intern den ASP.NET-Daten Cache, um die aus der BLL abgerufenen Daten zu speichern.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="5b4a2-140">Auf den Daten Cache kann auch Programm gesteuert über ASP.net Pages Code-Behind-Klassen oder über die Klassen in der Architektur der Webanwendung zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="5b4a2-141">Verwenden Sie das folgende Muster, um den Daten Cache aus einer Code Behind-Klasse der ASP.net page s zu lesen und in den Daten Cache zu schreiben:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="5b4a2-142">Die [`Cache` Class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert`-Methode](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) verfügt über eine Reihe von über Ladungen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="5b4a2-143">`Cache["key"] = value` und `Cache.Insert(key, value)` sind Synonym, und beide fügen dem Cache ein Element mit dem angegebenen Schlüssel ohne einen definierten Ablauf hinzu.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="5b4a2-144">In der Regel soll ein Ablaufdatum angegeben werden, wenn ein Element zum Cache hinzugefügt wird, entweder als Abhängigkeit, als zeitbasierter Ablauf oder beides.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="5b4a2-145">Verwenden Sie eine der anderen `Insert`-Methoden Überladungen, um Abhängigkeits-oder zeitbasierte Ablauf Informationen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="5b4a2-146">Die Methoden der Caching-Methode müssen zunächst überprüfen, ob die angeforderten Daten im Cache vorhanden sind. wenn dies der Fall ist, können Sie Sie von dort aus zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="5b4a2-147">Wenn sich die angeforderten Daten nicht im Cache befinden, muss die entsprechende BLL-Methode aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="5b4a2-148">Der Rückgabewert sollte zwischengespeichert und dann zurückgegeben werden, wie im folgenden Sequenzdiagramm veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>

![Die s-Methoden der cachingschicht geben Daten aus dem Cache zurück, wenn Sie verfügbar sind.](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="5b4a2-150">**Abbildung 3**: die Methoden zum Zwischenspeichern von Layer-Methoden geben Daten aus dem Cache zurück, wenn Sie verfügbar sind</span><span class="sxs-lookup"><span data-stu-id="5b4a2-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>

<span data-ttu-id="5b4a2-151">Die in Abbildung 3 dargestellte Sequenz wird in den cl-Klassen mithilfe des folgenden Musters erreicht:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="5b4a2-152">Hier ist *Type* der Typ der Daten, die im Cache `Northwind.ProductsDataTable`gespeichert werden, z. b., während *Key* der Schlüssel ist, der das Cache Element eindeutig identifiziert.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="5b4a2-153">Wenn sich das Element mit dem angegebenen *Schlüssel* nicht im Cache befindet, wird die *Instanz* `null`, und die Daten werden aus der entsprechenden BLL-Methode abgerufen und dem Cache hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="5b4a2-154">Wenn `return instance` erreicht ist, enthält die *Instanz* einen Verweis auf die Daten, entweder aus dem Cache oder aus der BLL.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="5b4a2-155">Stellen Sie sicher, dass Sie das obige Muster verwenden, wenn Sie auf Daten aus dem Cache zugreifen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="5b4a2-156">Das folgende Muster, das auf den ersten Blick gleichwertig aussieht, enthält einen geringfügigen Unterschied, der eine Racebedingung einführt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="5b4a2-157">Racebedingungen sind schwer zu debuggen, da Sie sich sporadisch offenlegen und schwer zu reproduzieren sind.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="5b4a2-158">Der Unterschied in diesem zweiten, falschen Code Ausschnitt besteht darin, dass statt eines Verweises auf das zwischengespeicherte Element in einer lokalen Variablen direkt in der Bedingungs Anweisung *und* in der `return`auf den Daten Cache zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="5b4a2-159">Stellen Sie sich vor, dass `Cache["key"]`, wenn dieser Code erreicht wird, nicht`null`ist, aber bevor die `return`-Anweisung erreicht wird, entfernt das System den *Schlüssel* aus dem Cache.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="5b4a2-160">In diesem seltenen Fall gibt der Code einen `null` Wert anstelle eines Objekts vom erwarteten Typ zurück.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="5b4a2-161">Der Daten Cache ist Thread sicher, sodass Sie den Thread Zugriff für einfache Lese-oder Schreibvorgänge nicht synchronisieren müssen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="5b4a2-162">Wenn Sie jedoch mehrere Vorgänge für Daten im Cache durchführen müssen, die atomar sein müssen, sind Sie dafür verantwortlich, eine Sperre oder einen anderen Mechanismus zu implementieren, um die Thread Sicherheit sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="5b4a2-163">Weitere Informationen finden [Sie unter Synchronisierung des Zugriffs auf den ASP.NET-Cache](http://www.ddj.com/184406369) .</span><span class="sxs-lookup"><span data-stu-id="5b4a2-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>

<span data-ttu-id="5b4a2-164">Ein Element kann Programm gesteuert aus dem Daten Cache entfernt werden, indem die [`Remove`-Methode](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) wie folgt verwendet wird:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="5b4a2-165">Schritt 3: Zurückgeben von Produktinformationen aus der`ProductsCL`-Klasse</span><span class="sxs-lookup"><span data-stu-id="5b4a2-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="5b4a2-166">In diesem Tutorial implementieren Sie zwei Methoden zum Zurückgeben von Produktinformationen aus der `ProductsCL`-Klasse: `GetProducts()` und `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="5b4a2-167">Wie bei der `ProductsBL`-Klasse in der Geschäftslogik Schicht gibt die `GetProducts()`-Methode in der CL Informationen über alle Produkte als `Northwind.ProductsDataTable` Objekt zurück, während `GetProductsByCategoryID(categoryID)` alle Produkte aus einer angegebenen Kategorie zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="5b4a2-168">Der folgende Code zeigt einen Teil der Methoden in der `ProductsCL`-Klasse:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="5b4a2-169">Beachten Sie zunächst die `DataObject`-und `DataObjectMethodAttribute` Attribute, die auf die-Klasse und die-Methode angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="5b4a2-170">Diese Attribute stellen Informationen für den ObjectDataSource-Assistenten bereit, der angibt, welche Klassen und Methoden in den Schritten des Assistenten angezeigt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="5b4a2-171">Da auf die CL-Klassen und-Methoden von einer ObjectDataSource in der Präsentationsebene zugegriffen wird, habe ich diese Attribute hinzugefügt, um die Entwurfszeit Funktion zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="5b4a2-172">Eine ausführlichere Beschreibung dieser Attribute und ihrer Auswirkungen finden Sie im Tutorial zum [Erstellen einer Geschäftslogik Ebene](../introduction/creating-a-business-logic-layer-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="5b4a2-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="5b4a2-173">In den Methoden `GetProducts()` und `GetProductsByCategoryID(categoryID)` werden die von der `GetCacheItem(key)`-Methode zurückgegebenen Daten einer lokalen Variablen zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="5b4a2-174">Die `GetCacheItem(key)`-Methode, die wir kurz untersuchen, gibt basierend auf dem angegebenen *Schlüssel*ein bestimmtes Element aus dem Cache zurück.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="5b4a2-175">Wenn keine solchen Daten im Cache gefunden werden, werden Sie aus der entsprechenden `ProductsBLL` Class-Methode abgerufen und dann mithilfe der `AddCacheItem(key, value)`-Methode dem Cache hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="5b4a2-176">Die `GetCacheItem(key)`-und `AddCacheItem(key, value)` Methoden-Schnittstelle mit dem Daten Cache, dem Lesen und Schreiben von Werten.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="5b4a2-177">Die `GetCacheItem(key)`-Methode ist die einfachere der beiden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="5b4a2-178">Sie gibt einfach den Wert aus der Cache-Klasse zurück, indem Sie den folgenden *Schlüssel*verwendet:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="5b4a2-179">`GetCacheItem(key)` verwendet keinen *Schlüssel* Wert wie angegeben, sondern ruft stattdessen die `GetCacheKey(key)`-Methode auf, die den *Schlüssel* zurückgibt, der mit productscache vorangestellt ist.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="5b4a2-180">Der `MasterCacheKeyArray`, der die Zeichenfolge productscache enthält, wird auch von der `AddCacheItem(key, value)`-Methode verwendet, wie wir es vorübergehend sehen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="5b4a2-181">Aus einer Code Behind-Klasse der ASP.net page s kann auf den Daten Cache mithilfe der `Page`-Klasse [`Cache`-Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)zugegriffen werden, und es wird eine Syntax wie `Cache["key"] = value`ermöglicht, wie in Schritt 2 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="5b4a2-182">Aus einer Klasse innerhalb der Architektur kann auf den Daten Cache mithilfe von `HttpRuntime.Cache` oder `HttpContext.Current.Cache`zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="5b4a2-183">Der Blogeintrag von [Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx) [HttpRuntime. Cache im Vergleich zu HttpContext. Current. Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notiert den geringfügigen Leistungsvorteil bei der Verwendung von `HttpRuntime` anstelle `HttpContext.Current`. Folglich verwendet `ProductsCL` `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="5b4a2-184">Wenn Ihre Architektur mithilfe von Klassen Bibliotheks Projekten implementiert wird, müssen Sie einen Verweis auf die `System.Web` Assembly hinzufügen, um die [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) -und [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) -Klassen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>

<span data-ttu-id="5b4a2-185">Wenn das Element nicht im Cache gefunden wird, werden die Daten der `ProductsCL`-Klasse mithilfe der `AddCacheItem(key, value)`-Methode dem Cache hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="5b4a2-186">Um dem Cache einen *Wert* hinzuzufügen, können wir den folgenden Code verwenden, der einen 60 Sekunden Ablauf verwendet:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="5b4a2-187">`DateTime.Now.AddSeconds(CacheDuration)` gibt den zeitbasierten Ablauf 60 Sekunden in der Zukunft an, während [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) angibt, dass es keinen gleitenden Ablauf gibt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="5b4a2-188">Wenngleich diese `Insert`-Methoden Überladung Eingabeparameter für einen absoluten und gleitenden Ablauf hat, können Sie nur eine der beiden bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="5b4a2-189">Wenn Sie versuchen, sowohl eine absolute Zeit als auch eine Zeitspanne anzugeben, löst die `Insert` Methode eine `ArgumentException`-Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="5b4a2-190">Diese Implementierung der `AddCacheItem(key, value)`-Methode hat derzeit einige Mängel.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="5b4a2-191">Diese Probleme werden in Schritt 4 behandelt und gelöst.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-191">We'll address and overcome these issues in Step 4.</span></span>

## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="5b4a2-192">Schritt 4: invalidieren des Caches, wenn die Daten durch die Architektur geändert werden</span><span class="sxs-lookup"><span data-stu-id="5b4a2-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="5b4a2-193">Zusammen mit den Methoden zum Abrufen von Daten muss die zwischen Speicherungs Schicht die gleichen Methoden wie das BLL zum Einfügen, aktualisieren und Löschen von Daten bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="5b4a2-194">Die Daten Änderungs Methoden der CL-Daten ändern die zwischengespeicherten Daten nicht, sondern führen stattdessen die entsprechende Daten Änderungs Methode für BLL aus und erklären den Cache dann für ungültig.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="5b4a2-195">Wie bereits im vorherigen Tutorial gezeigt, ist dies das gleiche Verhalten, das ObjectDataSource anwendet, wenn die zwischen Speicherungs Funktionen aktiviert sind und die `Insert`-, `Update`-oder `Delete` Methoden aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="5b4a2-196">Die folgende `UpdateProduct` Überladung veranschaulicht, wie die Daten Änderungs Methoden in der CL implementiert werden:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="5b4a2-197">Die entsprechende Daten Änderungs Methode für die Geschäftslogik Schicht wird aufgerufen, aber bevor die Antwort zurückgegeben wird, müssen wir den Cache für ungültig erklären.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="5b4a2-198">Leider ist das invalidieren des Caches nicht unkompliziert, da die `ProductsCL`-Klasse `GetProducts()` und `GetProductsByCategoryID(categoryID)`-Methoden jeweils dem Cache Elemente mit unterschiedlichen Schlüsseln hinzufügen, und die `GetProductsByCategoryID(categoryID)`-Methode fügt ein anderes Cache Element für jede eindeutige *CategoryID*hinzu.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="5b4a2-199">Wenn Sie den Cache für ungültig erklären, müssen wir *alle* Elemente entfernen, die möglicherweise von der `ProductsCL`-Klasse hinzugefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="5b4a2-200">Dies kann erreicht werden, indem eine *Cache Abhängigkeit* mit jedem Element verknüpft wird, das dem Cache in der `AddCacheItem(key, value)`-Methode hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="5b4a2-201">Im Allgemeinen kann eine Cache Abhängigkeit ein anderes Element im Cache, eine Datei im Dateisystem oder Daten aus einer Microsoft SQL Server Datenbank sein.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="5b4a2-202">Wenn sich die Abhängigkeit ändert oder aus dem Cache entfernt wird, werden die zugeordneten Cache Elemente automatisch aus dem Cache entfernt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="5b4a2-203">Für dieses Tutorial möchten wir ein zusätzliches Element im Cache erstellen, das als Cache Abhängigkeit für alle Elemente dient, die über die `ProductsCL`-Klasse hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="5b4a2-204">Auf diese Weise können alle diese Elemente aus dem Cache entfernt werden, indem einfach die Cache Abhängigkeit entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="5b4a2-205">Aktualisieren Sie die `AddCacheItem(key, value)`-Methode so, dass jedes Element, das über diese Methode dem Cache hinzugefügt wird, einer einzelnen Cache Abhängigkeit zugeordnet ist:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="5b4a2-206">`MasterCacheKeyArray` ist ein Zeichen folgen Array, das einen einzelnen Wert (productscache) enthält.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="5b4a2-207">Zuerst wird dem Cache ein Cache Element hinzugefügt und das aktuelle Datum und die Uhrzeit zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="5b4a2-208">Wenn das Cache Element bereits vorhanden ist, wird es aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="5b4a2-209">Als nächstes wird eine Cache Abhängigkeit erstellt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="5b4a2-210">Der [`CacheDependency` Klasse](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s-Konstruktor verfügt über eine Reihe von über Ladungen, aber der in diesem verwendete Wert erwartet zwei `string` Array Eingaben.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="5b4a2-211">Der erste gibt den Satz von Dateien an, die als Abhängigkeiten verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="5b4a2-212">Da wir keine dateibasierten Abhängigkeiten verwenden möchten, wird der Wert `null` für den ersten Eingabeparameter verwendet.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="5b4a2-213">Der zweite Eingabeparameter gibt den Satz von Cache Schlüsseln an, die als Abhängigkeiten verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="5b4a2-214">Hier geben wir unsere einzige Abhängigkeit an, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="5b4a2-215">Der `CacheDependency` wird dann an die `Insert`-Methode weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="5b4a2-216">Mit dieser Änderung an `AddCacheItem(key, value)`ist das invalidieren des Caches so einfach wie das Entfernen der Abhängigkeit.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>

[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="5b4a2-217">Schritt 5: Aufrufen der zwischen Speicherungs Ebene von der Präsentationsebene</span><span class="sxs-lookup"><span data-stu-id="5b4a2-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="5b4a2-218">Die Klassen und Methoden der Cache Schicht können verwendet werden, um mithilfe der Techniken, die wir in diesen Tutorials untersucht haben, mit Daten zu arbeiten.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="5b4a2-219">Um die Arbeit mit zwischengespeicherten Daten zu veranschaulichen, speichern Sie die Änderungen in der `ProductsCL`-Klasse, und öffnen Sie dann die `FromTheArchitecture.aspx` Seite im Ordner `Caching`, und fügen Sie eine GridView hinzu.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="5b4a2-220">Erstellen Sie aus dem GridView s-Smarttag eine neue ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="5b4a2-221">Im ersten Schritt des Assistenten sollten Sie die `ProductsCL`-Klasse als eine der Optionen in der Dropdown Liste sehen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>

<span data-ttu-id="5b4a2-222">[![die productscl-Klasse in der Dropdown Liste für das Geschäftsobjekt enthalten ist.](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="5b4a2-223">**Abbildung 4**: die `ProductsCL` Klasse ist in der Dropdown Liste für das Geschäftsobjekt enthalten ([Klicken Sie, um das Bild in voller Größe anzuzeigen](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5b4a2-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>

<span data-ttu-id="5b4a2-224">Nachdem Sie `ProductsCL`ausgewählt haben, klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="5b4a2-225">Die Dropdown Liste auf der Registerkarte auswählen enthält zwei Elemente: `GetProducts()` und `GetProductsByCategoryID(categoryID)` und die Registerkarte Update die einzige `UpdateProduct` Überladung.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="5b4a2-226">Wählen Sie die `GetProducts()`-Methode auf der Registerkarte auswählen und `UpdateProducts` auf der Registerkarte Aktualisieren aus, und klicken Sie dann auf Fertigstellen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>

<span data-ttu-id="5b4a2-227">[![die Methoden der productscl Class s in den Dropdown Listen aufgeführt.](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="5b4a2-228">**Abbildung 5**: die Methoden der `ProductsCL`-Klasse werden in den Dropdown Listen aufgelistet ([Klicken Sie, um das Bild in voller Größe anzuzeigen](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5b4a2-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>

<span data-ttu-id="5b4a2-229">Nachdem Sie den Assistenten abgeschlossen haben, wird die Eigenschaft ObjectDataSource s `OldValuesParameterFormatString` von Visual Studio auf `original_{0}` festgelegt, und der GridView werden die entsprechenden Felder hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="5b4a2-230">Ändern Sie die `OldValuesParameterFormatString`-Eigenschaft auf ihren Standardwert zurück, `{0}`, und konfigurieren Sie die GridView, um das Paging, Sortieren und bearbeiten zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="5b4a2-231">Da die von der CL verwendete `UploadProducts` Überladung nur den Namen und den Preis der bearbeiteten Produkte akzeptiert, schränken Sie die GridView ein, sodass nur diese Felder bearbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="5b4a2-232">Im vorherigen Tutorial haben wir eine GridView definiert, um Felder für die Felder `ProductName`, `CategoryName`und `UnitPrice` einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="5b4a2-233">Sie können diese Formatierung und Struktur auch replizieren. in diesem Fall sollten das deklarative Markup der GridView-und ObjectDataSource s in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="5b4a2-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="5b4a2-234">An dieser Stelle haben wir eine Seite, die die zwischen Speicherungs Ebene verwendet.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="5b4a2-235">Um den Cache in Aktion zu sehen, legen Sie Breakpoints in der `ProductsCL`-Klasse `GetProducts()` und `UpdateProduct`-Methoden fest.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="5b4a2-236">Besuchen Sie die Seite in einem Browser, und durchlaufen Sie den Code beim Sortieren und Paging, um die aus dem Cache gezogenen Daten anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="5b4a2-237">Aktualisieren Sie anschließend einen Datensatz, und beachten Sie, dass der Cache ungültig wird und daher aus der BLL abgerufen wird, wenn die Daten an die GridView zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="5b4a2-238">Die im Download bereitgestellte Cache Ebene, die diesen Artikel begleitet, ist nicht fertig.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="5b4a2-239">Sie enthält nur eine Klasse, `ProductsCL`, die nur eine Handvoll Methoden Sport hat.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="5b4a2-240">Darüber hinaus verwendet nur eine einzelne ASP.NET-Seite die CL (`~/Caching/FromTheArchitecture.aspx`) alle anderen Benutzer verweisen weiterhin direkt auf die BLL.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="5b4a2-241">Wenn Sie beabsichtigen, eine cl in Ihrer Anwendung zu verwenden, sollten alle Aufrufe von der Präsentationsschicht an die CL weitergeleitet werden. Dies erfordert, dass die cl s-Klassen und-Methoden diese Klassen und Methoden in der von der Präsentationsebene verwendeten BLL behandelt haben.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>

## <a name="summary"></a><span data-ttu-id="5b4a2-242">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="5b4a2-242">Summary</span></span>

<span data-ttu-id="5b4a2-243">Während das Zwischenspeichern auf der Präsentationsebene mit ASP.NET 2,0 s SqlDataSource-und ObjectDataSource-Steuerelementen angewendet werden kann, werden idealerweise zwischen Speicherungs Zuständigkeiten an eine separate Ebene in der Architektur delegiert.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="5b4a2-244">In diesem Tutorial haben wir eine zwischen Speicherungs Schicht und die Geschäftslogik Schicht zwischen der Darstellungs Schicht und der Geschäftslogik Ebene erstellt.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="5b4a2-245">Die zwischen Speicherungs Schicht muss denselben Satz von Klassen und Methoden bereitstellen, die in der BLL vorhanden sind und von der Präsentationsebene aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="5b4a2-246">Die Beispiele für die zwischen Speicherungs Schicht, die wir in diesemund in den vorherigen Tutorials untersucht haben, haben</span><span class="sxs-lookup"><span data-stu-id="5b4a2-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="5b4a2-247">Mit reaktivem laden werden die Daten nur dann in den Cache geladen, wenn eine Anforderung für die Daten erfolgt und die Daten im Cache fehlen.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="5b4a2-248">Daten können auch proaktiv in den Cache *geladen* werden, ein Verfahren, das die Daten in den Cache lädt, bevor Sie tatsächlich benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="5b4a2-249">Im nächsten Tutorial wird ein Beispiel für das proaktive laden angezeigt, wenn wir uns ansehen, wie statische Werte beim Anwendungsstart im Cache gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="5b4a2-250">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="5b4a2-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5b4a2-251">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="5b4a2-251">About the Author</span></span>

<span data-ttu-id="5b4a2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5b4a2-253">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5b4a2-254">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5b4a2-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5b4a2-255">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5b4a2-256">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5b4a2-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5b4a2-257">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="5b4a2-257">Special Thanks To</span></span>

<span data-ttu-id="5b4a2-258">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5b4a2-259">Lead Reviewer für dieses Tutorial war Teresa Murph.</span><span class="sxs-lookup"><span data-stu-id="5b4a2-259">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="5b4a2-260">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="5b4a2-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5b4a2-261">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5b4a2-262">[Zurück](caching-data-with-the-objectdatasource-cs.md)
> [Weiter](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="5b4a2-262">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
