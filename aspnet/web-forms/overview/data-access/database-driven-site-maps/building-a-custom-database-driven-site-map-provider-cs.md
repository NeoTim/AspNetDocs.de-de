---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Aufbauen eines benutzerdefinierten datenbankgesteuerten Site Übersichts AnbietersC#() | Microsoft-Dokumentation
author: rick-anderson
description: Der Standard-Site Übersichts Anbieter in ASP.NET 2,0 ruft seine Daten aus einer statischen XML-Datei ab. Der XML-basierte Anbieter eignet sich für viele kleine und mittlere siz...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e27b37703b12c9796e8516f0d805aef1fdf8d8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/28/2019
ms.locfileid: "74637261"
---
# <a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="26545-104">Erstellen eines benutzerdefinierten Anbieters für datenbankgesteuerte Siteübersichten (C#)</span><span class="sxs-lookup"><span data-stu-id="26545-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>

<span data-ttu-id="26545-105">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="26545-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="26545-106">[Code herunterladen](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) oder [PDF herunterladen](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="26545-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="26545-107">Der Standard-Site Übersichts Anbieter in ASP.NET 2,0 ruft seine Daten aus einer statischen XML-Datei ab.</span><span class="sxs-lookup"><span data-stu-id="26545-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="26545-108">Obwohl der XML-basierte Anbieter für viele kleine und mittelgroße Websites geeignet ist, benötigen größere Webanwendungen eine dynamischere Site Übersicht.</span><span class="sxs-lookup"><span data-stu-id="26545-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="26545-109">In diesem Tutorial erstellen wir einen benutzerdefinierten Site Übersichts Anbieter, der seine Daten aus der Geschäftslogik Schicht abruft, die wiederum Daten aus der Datenbank abruft.</span><span class="sxs-lookup"><span data-stu-id="26545-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="26545-110">Einführung</span><span class="sxs-lookup"><span data-stu-id="26545-110">Introduction</span></span>

<span data-ttu-id="26545-111">Das ASP.NET 2,0 s Site Map-Feature ermöglicht es einem Seiten Entwickler, eine Website Zuordnung für Webanwendungen in einem persistenten Medium (z. b. in einer XML-Datei) zu definieren.</span><span class="sxs-lookup"><span data-stu-id="26545-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="26545-112">Nachdem die Site Übersichts Daten definiert wurden, können Sie Programm gesteuert über die [`SiteMap`-Klasse](https://msdn.microsoft.com/library/system.web.sitemap.aspx) im [`System.Web`-Namespace](https://msdn.microsoft.com/library/system.web.aspx) oder über eine Vielzahl von navigationweb Steuerelementen wie SiteMapPath-, Menü-und TreeView-Steuerelemente zugreifen.</span><span class="sxs-lookup"><span data-stu-id="26545-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="26545-113">Das Site Übersichts System verwendet das [Anbieter Modell](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) , sodass verschiedene Implementierungen der Site Map-Serialisierung erstellt und an eine Webanwendung angeschlossen werden können.</span><span class="sxs-lookup"><span data-stu-id="26545-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="26545-114">Der standardmäßige Site Übersichts Anbieter, der mit ASP.NET 2,0 ausgeliefert wird, speichert die Site Übersichts Struktur in einer XML-Datei.</span><span class="sxs-lookup"><span data-stu-id="26545-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="26545-115">Im Tutorial zu [Master Seiten und zur Website Navigation](../introduction/master-pages-and-site-navigation-cs.md) haben wir eine Datei namens `Web.sitemap` erstellt, die diese Struktur enthielt und deren XML-Code mit jedem neuen Tutorial-Abschnitt aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="26545-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="26545-116">Der standardmäßige XML-basierte Site Übersichts Anbieter funktioniert gut, wenn die Struktur der Site Map-Struktur Recht statisch ist, z. b. für diese Tutorials.</span><span class="sxs-lookup"><span data-stu-id="26545-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="26545-117">In vielen Szenarien ist jedoch eine dynamischere Site Map erforderlich.</span><span class="sxs-lookup"><span data-stu-id="26545-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="26545-118">Sehen Sie sich die in Abbildung 1 gezeigte Site Übersicht an, wobei jede Kategorie und jedes Produkt als Abschnitte in der Struktur der Website angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="26545-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="26545-119">Wenn diese Site Übersicht angezeigt wird, können Sie durch das Aufrufen der Webseite, die dem Stamm Knoten entspricht, alle Kategorien auflisten, während beim Besuch einer bestimmten Kategorie auf der Webseite die Kategorie s Produkte aufgeführt werden und eine bestimmte Produkt-e-Seite angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="26545-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="26545-120">[![Sie die Kategorien und Produkte in der Struktur der Site Map-Struktur](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="26545-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="26545-121">**Abbildung 1**: die in der Struktur der Site Map-Struktur eingebundenen Kategorien und Produkte ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="26545-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>

<span data-ttu-id="26545-122">Diese Kategorie-und produktbasierte Struktur kann in der `Web.sitemap`-Datei hart codiert werden, die Datei muss jedoch jedes Mal aktualisiert werden, wenn eine Kategorie oder ein Produkt hinzugefügt, entfernt oder umbenannt wurde.</span><span class="sxs-lookup"><span data-stu-id="26545-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="26545-123">Folglich wird die Wartung der Site Übersicht erheblich vereinfacht, wenn die Struktur aus der Datenbank oder im Idealfall aus der Geschäftslogik Schicht der Anwendungsarchitektur abgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="26545-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="26545-124">Auf diese Weise wird die Site Übersicht beim Hinzufügen, umbenennen oder Löschen von Produkten und Kategorien automatisch aktualisiert, um diese Änderungen widerzuspiegeln.</span><span class="sxs-lookup"><span data-stu-id="26545-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="26545-125">Da die ASP.NET 2,0 s-Site Map-Serialisierung über das Anbieter Modell erstellt wurde, können wir unseren eigenen benutzerdefinierten Site Übersichts Anbieter erstellen, der seine Daten aus einem alternativen Datenspeicher, z. b. der Datenbank oder der Architektur, abgreift.</span><span class="sxs-lookup"><span data-stu-id="26545-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="26545-126">In diesem Tutorial erstellen wir einen benutzerdefinierten Anbieter, der seine Daten aus der BLL abruft.</span><span class="sxs-lookup"><span data-stu-id="26545-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="26545-127">Legen Sie Los!</span><span class="sxs-lookup"><span data-stu-id="26545-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="26545-128">Der in diesem Tutorial erstellte benutzerdefinierte Site Übersichts Anbieter ist eng mit der Architektur und dem Datenmodell der Anwendung verknüpft.</span><span class="sxs-lookup"><span data-stu-id="26545-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="26545-129">Jeff Prosise s [speichert Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) und [der SQL Site Map Provider, den Sie](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) auf Artikel gewartet haben, untersuchen einen generalisierten Ansatz zum Speichern von Site Übersichts Daten in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="26545-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="26545-130">Schritt 1: Erstellen der benutzerdefinierten Website Übersichts Anbieter-Webseiten</span><span class="sxs-lookup"><span data-stu-id="26545-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="26545-131">Bevor wir mit dem Erstellen eines benutzerdefinierten Site Übersichts Anbieters beginnen, können Sie zunächst die ASP.NET Seiten hinzufügen, die für dieses Tutorial erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="26545-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="26545-132">Fügen Sie zunächst einen neuen Ordner mit dem Namen `SiteMapProvider`hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="26545-133">Fügen Sie dann die folgenden ASP.NET-Seiten zu diesem Ordner hinzu, und stellen Sie sicher, dass Sie die einzelnen Seiten der `Site.master` Master Seite zuordnen:</span><span class="sxs-lookup"><span data-stu-id="26545-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="26545-134">Fügen Sie dem Ordner `App_Code` auch einen `CustomProviders` Unterordner hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Fügen Sie die ASP.NET-Seiten für die Website Übersichts Lernprogramme hinzu.](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="26545-136">**Abbildung 2**: Hinzufügen der ASP.NET-Seiten für die Site Map-Anbieter bezogenen Tutorials</span><span class="sxs-lookup"><span data-stu-id="26545-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="26545-137">Da nur ein Lernprogramm für diesen Abschnitt vorhanden ist, müssen wir nicht `Default.aspx`, die Lernprogramme des Abschnitts aufzulisten.</span><span class="sxs-lookup"><span data-stu-id="26545-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="26545-138">Stattdessen werden `Default.aspx` die Kategorien in einem GridView-Steuerelement anzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="26545-139">Dies wird in Schritt 2 behandelt.</span><span class="sxs-lookup"><span data-stu-id="26545-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="26545-140">Aktualisieren Sie dann `Web.sitemap`, um einen Verweis auf die `Default.aspx` Seite einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="26545-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="26545-141">Fügen Sie insbesondere nach dem Caching-`<siteMapNode>`folgendes Markup hinzu:</span><span class="sxs-lookup"><span data-stu-id="26545-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="26545-142">Nehmen Sie sich nach dem Aktualisieren `Web.sitemap`einen Moment Zeit, um die Tutorials-Website über einen Browser anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="26545-143">Das Menü auf der linken Seite enthält jetzt ein Element für das einzige Tutorial für Site Übersichts Anbieter.</span><span class="sxs-lookup"><span data-stu-id="26545-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Die Site Übersicht enthält jetzt einen Eintrag für das Tutorial Site Übersichts Anbieter.](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="26545-145">**Abbildung 3**: die Site Übersicht enthält jetzt einen Eintrag für das Tutorial zum Site Map-Anbieter.</span><span class="sxs-lookup"><span data-stu-id="26545-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="26545-146">Dieses Tutorial konzentriert sich hauptsächlich auf das Erstellen eines benutzerdefinierten Site Übersichts Anbieters und das Konfigurieren einer Webanwendung für die Verwendung dieses Anbieters.</span><span class="sxs-lookup"><span data-stu-id="26545-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="26545-147">Insbesondere erstellen wir einen Anbieter, der eine Site Übersicht zurückgibt, die einen Stamm Knoten zusammen mit einem Knoten für jede Kategorie und jedes Produkt enthält, wie in Abbildung 1 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="26545-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="26545-148">Im Allgemeinen kann jeder Knoten in der Site Übersicht eine URL angeben.</span><span class="sxs-lookup"><span data-stu-id="26545-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="26545-149">Für unsere Site Map wird die URL des Stamm Knotens `~/SiteMapProvider/Default.aspx`, in der alle Kategorien in der Datenbank aufgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="26545-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="26545-150">Jeder Kategorieknoten in der Site Übersicht verfügt über eine URL, die auf `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`verweist, in der alle Produkte in der angegebenen *CategoryID*aufgelistet werden.</span><span class="sxs-lookup"><span data-stu-id="26545-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="26545-151">Schließlich verweist jeder Product Site Map-Knoten auf `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, in dem die Details des jeweiligen Produkts angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="26545-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="26545-152">Zunächst müssen die Seiten `Default.aspx`, `ProductsByCategory.aspx`und `ProductDetails.aspx` erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="26545-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="26545-153">Diese Seiten werden in den Schritten 2, 3 bzw. 4 abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="26545-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="26545-154">Da es sich bei diesem Tutorial um Site Übersichts Anbieter handelt und in den letzten Tutorials das Erstellen dieser Arten von mehrseitigen Master-/Detailberichten erläutert wurde, werden die Schritte 2 bis 4 beschrieben.</span><span class="sxs-lookup"><span data-stu-id="26545-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="26545-155">Wenn Sie ein Aktualisierungs Programm zum Erstellen von Master-/Detailberichten benötigen, das sich über mehrere Seiten erstreckt, lesen Sie das Tutorial zum [Filtern von Master/Details über zwei Seiten](../masterdetail/master-detail-filtering-across-two-pages-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="26545-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="26545-156">Schritt 2: Anzeigen einer Liste von Kategorien</span><span class="sxs-lookup"><span data-stu-id="26545-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="26545-157">Öffnen Sie die Seite `Default.aspx` im Ordner `SiteMapProvider`, und ziehen Sie eine GridView aus der Toolbox auf den Designer, und legen Sie deren `ID` auf `Categories`fest.</span><span class="sxs-lookup"><span data-stu-id="26545-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="26545-158">Binden Sie das GridView s-Smarttag an eine neue ObjectDataSource mit dem Namen `CategoriesDataSource`, und konfigurieren Sie Sie so, dass Sie Ihre Daten mithilfe der `CategoriesBLL` Class s `GetCategories`-Methode abruft.</span><span class="sxs-lookup"><span data-stu-id="26545-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="26545-159">Da in dieser GridView nur die Kategorien angezeigt werden und keine Daten Änderungs Funktionen bereitgestellt werden, legen Sie die Dropdown Listen auf den Registerkarten aktualisieren, einfügen und löschen auf (keine) fest.</span><span class="sxs-lookup"><span data-stu-id="26545-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="26545-160">[![die ObjectDataSource so konfigurieren, dass Kategorien mithilfe der GetCategories-Methode zurückgegeben werden.](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="26545-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="26545-161">**Abbildung 4**: Konfigurieren von ObjectDataSource zum Zurückgeben von Kategorien mit der `GetCategories`-Methode ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="26545-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>

<span data-ttu-id="26545-162">[![die Dropdown Listen auf den Registerkarten aktualisieren, einfügen und löschen auf (keine) festgelegt.](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="26545-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="26545-163">**Abbildung 5**: Festlegen der Dropdown Listen auf den Registerkarten "Aktualisieren", "Einfügen" und "Löschen" auf "(keine)" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="26545-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>

<span data-ttu-id="26545-164">Nach dem Abschließen des Assistenten zum Konfigurieren von Datenquellen wird von Visual Studio ein BoundField-Element für `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`und `BrochurePath`hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="26545-165">Bearbeiten Sie die GridView so, dass Sie nur die `CategoryName` und `Description` boundfields enthält, und aktualisieren Sie die Eigenschaft `CategoryName` BoundField s `HeaderText` auf Category.</span><span class="sxs-lookup"><span data-stu-id="26545-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="26545-166">Fügen Sie als nächstes ein HyperLinkField hinzu, und positionieren Sie es so, dass es das Feld ganz links ist.</span><span class="sxs-lookup"><span data-stu-id="26545-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="26545-167">Legen Sie die `DataNavigateUrlFields`-Eigenschaft auf `CategoryID` und die `DataNavigateUrlFormatString`-Eigenschaft auf `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`fest.</span><span class="sxs-lookup"><span data-stu-id="26545-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="26545-168">Legen Sie die `Text`-Eigenschaft auf Produkte anzeigen fest.</span><span class="sxs-lookup"><span data-stu-id="26545-168">Set the `Text` property to View Products .</span></span>

![Hinzufügen eines HyperLinkField zu den Kategorien GridView](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="26545-170">**Abbildung 6**: Hinzufügen eines HyperLinkField zum `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="26545-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="26545-171">Nachdem Sie die ObjectDataSource erstellt und die GridView s-Felder angepasst haben, werden die beiden Steuerelemente deklaratives Markup wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="26545-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="26545-172">Abbildung 7 zeigt `Default.aspx`, wenn Sie in einem Browser angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="26545-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="26545-173">Wenn Sie auf den Link Produkte anzeigen klicken, gelangen Sie zu `ProductsByCategory.aspx?CategoryID=categoryID`, den wir in Schritt 3 erstellen werden.</span><span class="sxs-lookup"><span data-stu-id="26545-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="26545-174">[![jede Kategorie zusammen mit dem Link "Produkte anzeigen" aufgeführt ist.](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="26545-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="26545-175">**Abbildung 7**: jede Kategorie wird zusammen mit dem Link "Produkte anzeigen" aufgelistet ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="26545-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="26545-176">Schritt 3: Auflisten der Produkte der ausgewählten Kategorie</span><span class="sxs-lookup"><span data-stu-id="26545-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="26545-177">Öffnen Sie die Seite "`ProductsByCategory.aspx`", und fügen Sie eine GridView-`ProductsByCategory`hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="26545-178">Binden Sie das GridView-Objekt aus dem Smarttag an eine neue ObjectDataSource mit dem Namen `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="26545-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="26545-179">Konfigurieren Sie die ObjectDataSource so, dass Sie die `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)`-Methode verwendet, und legen Sie in den Registerkarten Update, INSERT und DELETE die Dropdown Liste auf (None) fest.</span><span class="sxs-lookup"><span data-stu-id="26545-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="26545-180">[![die Methode "getproductbycategoryid" (CategoryID) der productbll-Klasse verwenden](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="26545-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="26545-181">**Abbildung 8**: Verwenden der `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)`-Methode ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="26545-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>

<span data-ttu-id="26545-182">Im letzten Schritt des Assistenten zum Konfigurieren von Datenquellen werden Sie aufgefordert, eine Parameter Quelle für *CategoryID*einzugeben.</span><span class="sxs-lookup"><span data-stu-id="26545-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="26545-183">Da diese Informationen über das QueryString-Feld `CategoryID`übergeben werden, wählen Sie in der Dropdown Liste die Option QueryString aus, und geben Sie im Textfeld QueryStringField den Wert CategoryID ein, wie in Abbildung 9 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="26545-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="26545-184">Klicken Sie auf Fertig stellen, um den Assistenten abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="26545-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="26545-185">[![das Feld CategoryID QueryString für den CategoryID-Parameter verwenden.](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="26545-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="26545-186">**Abbildung 9**: Verwenden des `CategoryID` QueryString-Felds für den *CategoryID* -Parameter ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="26545-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>

<span data-ttu-id="26545-187">Nachdem Sie den Assistenten abgeschlossen haben, fügt Visual Studio die entsprechenden boundfields und ein CheckBoxField der GridView für die Product Data-Felder hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="26545-188">Entfernen Sie alle außer die `ProductName`, `UnitPrice`und `SupplierName` boundfields.</span><span class="sxs-lookup"><span data-stu-id="26545-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="26545-189">Passen Sie diese drei boundfields-`HeaderText` Eigenschaften an, um Product, Price und Supplier zu lesen.</span><span class="sxs-lookup"><span data-stu-id="26545-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="26545-190">Formatieren Sie das `UnitPrice` BoundField als Währung.</span><span class="sxs-lookup"><span data-stu-id="26545-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="26545-191">Fügen Sie als nächstes ein HyperLinkField hinzu, und verschieben Sie es an die linke Position.</span><span class="sxs-lookup"><span data-stu-id="26545-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="26545-192">Legen Sie die `Text`-Eigenschaft auf Details anzeigen, die `DataNavigateUrlFields`-Eigenschaft auf `ProductID`und deren `DataNavigateUrlFormatString`-Eigenschaft auf `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="26545-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Fügen Sie ein HyperLinkField für Sicht Details hinzu, das auf ProductDetails. aspx zeigt.](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="26545-194">**Abbildung 10**: Hinzufügen eines HyperLinkField für Sicht Details, das auf `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="26545-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="26545-195">Nachdem Sie diese Anpassungen vorgenommen haben, sollten das deklarative Markup der GridView-und ObjectDataSource-Tabelle den folgenden ähneln:</span><span class="sxs-lookup"><span data-stu-id="26545-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="26545-196">Wechseln Sie zurück zum Anzeigen `Default.aspx` über einen Browser, und klicken Sie auf den Link Produkte anzeigen für Getränke.</span><span class="sxs-lookup"><span data-stu-id="26545-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="26545-197">Auf diese Weise können Sie `ProductsByCategory.aspx?CategoryID=1`, die Namen, Preise und Lieferanten der Produkte in der Northwind-Datenbank anzeigen, die zur Kategorie Getränke gehören (siehe Abbildung 11).</span><span class="sxs-lookup"><span data-stu-id="26545-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="26545-198">Sie können diese Seite weiter verbessern, um einen Link zum Zurückgeben der Benutzer zur kategorieauflistungs Seite (`Default.aspx`) und zum DetailsView-oder FormView-Steuerelement hinzufügen, das den Namen und die Beschreibung der ausgewählten Kategorie anzeigt.</span><span class="sxs-lookup"><span data-stu-id="26545-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="26545-199">[![werden die Namen, Preise und Lieferanten der Getränke angezeigt.](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="26545-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="26545-200">**Abbildung 11**: die Namen, Preise und Lieferanten der Getränke werden angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="26545-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="26545-201">Schritt 4: Anzeigen der Details eines Produkts</span><span class="sxs-lookup"><span data-stu-id="26545-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="26545-202">Auf der letzten Seite, `ProductDetails.aspx`, werden die Details der ausgewählten Produkte angezeigt.</span><span class="sxs-lookup"><span data-stu-id="26545-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="26545-203">Öffnen Sie `ProductDetails.aspx`, und ziehen Sie eine DetailsView aus der Toolbox auf den Designer.</span><span class="sxs-lookup"><span data-stu-id="26545-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="26545-204">Legen Sie die Eigenschaft DetailsView s `ID` auf `ProductInfo` fest, und löschen Sie deren `Height` und `Width` Eigenschaftswerte.</span><span class="sxs-lookup"><span data-stu-id="26545-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="26545-205">Binden Sie im smarttagtag die DetailsView an eine neue ObjectDataSource mit dem Namen `ProductDataSource`, und konfigurieren Sie die ObjectDataSource, um Ihre Daten aus der `ProductsBLL` Class s `GetProductByProductID(productID)`-Methode abzurufen.</span><span class="sxs-lookup"><span data-stu-id="26545-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="26545-206">Legen Sie wie bei den vorherigen Webseiten, die in den Schritten 2 und 3 erstellt wurden, die Dropdown Listen auf den Registerkarten aktualisieren, einfügen und löschen auf (keine) fest.</span><span class="sxs-lookup"><span data-stu-id="26545-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="26545-207">[![Konfigurieren von ObjectDataSource für die Verwendung der getproductbyproductid (ProductID)-Methode](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="26545-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="26545-208">**Abbildung 12**: Konfigurieren von ObjectDataSource für die Verwendung der `GetProductByProductID(productID)`-Methode ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="26545-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>

<span data-ttu-id="26545-209">Im letzten Schritt des Assistenten zum Konfigurieren von Datenquellen werden Sie aufgefordert, die Quelle des *ProductID-* Parameters einzugeben.</span><span class="sxs-lookup"><span data-stu-id="26545-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="26545-210">Da diese Daten das QueryString-Feld `ProductID`durchlaufen, legen Sie die Dropdown Liste auf QueryString und das Textfeld QueryStringField auf ProductID fest.</span><span class="sxs-lookup"><span data-stu-id="26545-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="26545-211">Klicken Sie abschließend auf die Schaltfläche Fertigstellen, um den Assistenten abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="26545-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="26545-212">[![den ProductID-Parameter so konfigurieren, dass der Wert aus dem Feld "ProductID QueryString" abgerufen wird.](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="26545-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="26545-213">**Abbildung 13**: Konfigurieren des *ProductID-* Parameters zum Abrufen seines Werts aus dem Feld "`ProductID` QueryString" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="26545-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>

<span data-ttu-id="26545-214">Nach dem Abschließen des Assistenten zum Konfigurieren von Datenquellen erstellt Visual Studio entsprechende boundfields und ein CheckBoxField in der DetailsView für die Product Data-Felder.</span><span class="sxs-lookup"><span data-stu-id="26545-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="26545-215">Entfernen Sie die `ProductID`, `SupplierID`und `CategoryID` boundfields, und konfigurieren Sie die restlichen Felder wie angezeigt.</span><span class="sxs-lookup"><span data-stu-id="26545-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="26545-216">Nach einigen ästhetischen Konfigurationen hat mein deklaratives Markup "DetailsView" und "ObjectDataSource s" wie folgt ausgesehen:</span><span class="sxs-lookup"><span data-stu-id="26545-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="26545-217">Kehren Sie zum Testen dieser Seite zu `Default.aspx` zurück, und klicken Sie auf Produkte für die Kategorie Getränke anzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="26545-218">Klicken Sie in der Liste der Getränkeprodukte auf den Link Details anzeigen für Chai-Tea.</span><span class="sxs-lookup"><span data-stu-id="26545-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="26545-219">Dadurch gelangen Sie zu `ProductDetails.aspx?ProductID=1`, in der die Details von Chai Tea angezeigt werden (siehe Abbildung 14).</span><span class="sxs-lookup"><span data-stu-id="26545-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="26545-220">[![der Hersteller, die Kategorie, den Preis und weitere Informationen Chai-Tea werden angezeigt.](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="26545-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="26545-221">**Abbildung 14**: der Hersteller, die Kategorie, der Preis und weitere Informationen von Chai Tea s werden angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="26545-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="26545-222">Schritt 5: Grundlegendes zur inneren Funktionsweise eines Site Übersichts Anbieters</span><span class="sxs-lookup"><span data-stu-id="26545-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="26545-223">Die Site Map wird im Arbeitsspeicher des Webservers als Auflistung von `SiteMapNode` Instanzen dargestellt, die eine Hierarchie bilden.</span><span class="sxs-lookup"><span data-stu-id="26545-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="26545-224">Es muss genau ein Stamm vorhanden sein, alle nicht Stamm Knoten müssen über einen übergeordneten Knoten verfügen, und alle Knoten verfügen möglicherweise über eine beliebige Anzahl von untergeordneten Knoten.</span><span class="sxs-lookup"><span data-stu-id="26545-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="26545-225">Jedes `SiteMapNode` Objekt stellt einen Abschnitt in der Struktur der Website dar. in diesen Abschnitten wird häufig eine entsprechende Webseite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="26545-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="26545-226">Folglich hat die [`SiteMapNode`-Klasse](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) Eigenschaften wie `Title`, `Url`und `Description`, die Informationen für den Abschnitt bereitstellen, der von der `SiteMapNode` repräsentiert wird.</span><span class="sxs-lookup"><span data-stu-id="26545-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="26545-227">Außerdem gibt es eine `Key` Eigenschaft, die jede `SiteMapNode` in der Hierarchie eindeutig identifiziert, sowie Eigenschaften, mit denen diese Hierarchie `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`usw. festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="26545-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="26545-228">Abbildung 15 zeigt die allgemeine Site Übersichts Struktur aus Abbildung 1, aber mit den Implementierungsdetails, die detaillierter dargestellt werden.</span><span class="sxs-lookup"><span data-stu-id="26545-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="26545-229">[![jeder SiteMapNode Eigenschaften wie "Title", "URL", "Key" usw.](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="26545-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="26545-230">**Abbildung 15**: jede `SiteMapNode` hat Eigenschaften wie `Title`, `Url`, `Key`usw. ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="26545-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>

<span data-ttu-id="26545-231">Der Zugriff auf die Site Map ist über die [`SiteMap`-Klasse](https://msdn.microsoft.com/library/system.web.sitemap.aspx) im [`System.Web`-Namespace](https://msdn.microsoft.com/library/system.web.aspx)möglich.</span><span class="sxs-lookup"><span data-stu-id="26545-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="26545-232">Diese Class s `RootNode`-Eigenschaft gibt die Stamm `SiteMapNode` Instanz der Site Map s zurück. `CurrentNode` gibt das `SiteMapNode` zurück, dessen `Url`-Eigenschaft mit der URL der aktuell angeforderten Seite übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="26545-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="26545-233">Diese Klasse wird intern von ASP.NET 2,0 s-Navigations-websteuer Elementen verwendet.</span><span class="sxs-lookup"><span data-stu-id="26545-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="26545-234">Wenn auf die Eigenschaften der `SiteMap`-Klasse zugegriffen wird, muss die Site Map-Struktur von einem persistenten Medium in den Arbeitsspeicher serialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="26545-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="26545-235">Die Serialisierungslogik der Site Map ist jedoch nicht in der `SiteMap`-Klasse hart codiert.</span><span class="sxs-lookup"><span data-stu-id="26545-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="26545-236">Stattdessen bestimmt die `SiteMap`-Klasse zur Laufzeit, welcher Site Übersichts *Anbieter* für die Serialisierung verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="26545-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="26545-237">Standardmäßig wird die [`XmlSiteMapProvider`-Klasse](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) verwendet, die die Struktur der Site Map-Struktur aus einer ordnungsgemäß formatierten XML-Datei liest.</span><span class="sxs-lookup"><span data-stu-id="26545-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="26545-238">Allerdings können wir mit etwas Arbeit einen eigenen benutzerdefinierten Site Übersichts Anbieter erstellen.</span><span class="sxs-lookup"><span data-stu-id="26545-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="26545-239">Alle Site Übersichts Anbieter müssen von der`SiteMapProvider`- [Klasse](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx)abgeleitet werden, die die grundlegenden Methoden und Eigenschaften enthält, die für Site Übersichts Anbieter erforderlich sind, aber viele der Implementierungsdetails ausgelassen werden.</span><span class="sxs-lookup"><span data-stu-id="26545-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="26545-240">Eine zweite Klasse, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), erweitert die `SiteMapProvider`-Klasse und enthält eine robustere Implementierung der erforderlichen Funktionalität.</span><span class="sxs-lookup"><span data-stu-id="26545-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="26545-241">Intern speichert der `StaticSiteMapProvider` die `SiteMapNode` Instanzen der Site Zuordnung in einem `Hashtable` und stellt Methoden wie `AddNode(child, parent)`, `RemoveNode(siteMapNode),` und `Clear()` bereit, die `SiteMapNode` s dem internen `Hashtable`hinzufügen bzw. daraus entfernen.</span><span class="sxs-lookup"><span data-stu-id="26545-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="26545-242">`XmlSiteMapProvider` wird von `StaticSiteMapProvider` abgeleitet.</span><span class="sxs-lookup"><span data-stu-id="26545-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="26545-243">Beim Erstellen eines benutzerdefinierten Site Übersichts Anbieters, der `StaticSiteMapProvider`erweitert, gibt es zwei abstrakte Methoden, die überschrieben werden müssen: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) und [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="26545-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="26545-244">`BuildSiteMap`, wie der Name schon sagt, ist dafür verantwortlich, die Site Übersichts Struktur aus dem permanenten Speicher zu laden und im Arbeitsspeicher zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="26545-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="26545-245">`GetRootNodeCore` gibt den Stamm Knoten in der Site Übersicht zurück.</span><span class="sxs-lookup"><span data-stu-id="26545-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="26545-246">Bevor eine Webanwendung einen Site Übersichts Anbieter verwenden kann, muss Sie in der Konfiguration der Anwendung registriert werden.</span><span class="sxs-lookup"><span data-stu-id="26545-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="26545-247">Standardmäßig wird die `XmlSiteMapProvider`-Klasse mit dem Namen `AspNetXmlSiteMapProvider`registriert.</span><span class="sxs-lookup"><span data-stu-id="26545-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="26545-248">Fügen Sie zum Registrieren zusätzlicher Site Übersichts Anbieter `Web.config`das folgende Markup hinzu:</span><span class="sxs-lookup"><span data-stu-id="26545-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="26545-249">Der *Name* -Wert weist dem Anbieter einen lesbaren Namen zu, während *Type* den voll qualifizierten Typnamen des Site Übersichts Anbieters angibt.</span><span class="sxs-lookup"><span data-stu-id="26545-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="26545-250">Wir untersuchen konkrete Werte für den *Namen* und die *Typwerte* in Schritt 7, nachdem wir unseren benutzerdefinierten Site Übersichts Anbieter erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="26545-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="26545-251">Die Site Map-Anbieter Klasse wird beim ersten Zugriff von der `SiteMap`-Klasse instanziiert und bleibt für die Lebensdauer der Webanwendung im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="26545-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="26545-252">Da nur eine Instanz des Site Übersichts Anbieters vorhanden ist, die von mehreren parallelen Besucher der Website aufgerufen werden kann, ist es zwingend erforderlich, dass die Methoden des Anbieters *Thread sicher*sind.</span><span class="sxs-lookup"><span data-stu-id="26545-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="26545-253">Aus Gründen der Leistung und Skalierbarkeit ist es wichtig, dass wir die in-Memory-Site Übersichts Struktur Zwischenspeichern und diese zwischengespeicherte Struktur zurückgeben, anstatt Sie jedes Mal neu zu erstellen, wenn die `BuildSiteMap`-Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="26545-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="26545-254">`BuildSiteMap` kann je nach den auf der Seite verwendeten Navigations Steuerelementen und der Tiefe der Site Übersichts Struktur mehrmals pro Seiten Anforderung pro Benutzer aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="26545-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="26545-255">Wenn wir die Site Map-`BuildSiteMap` Struktur in jedem Fall nicht zwischenspeichern, müssen wir jedes Mal, wenn Sie aufgerufen wird, die Produkt-und Kategorieinformationen aus der Architektur erneut abrufen (was zu einer Abfrage der Datenbank führen würde).</span><span class="sxs-lookup"><span data-stu-id="26545-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="26545-256">Wie in den vorherigen Tutorials zum Zwischenspeichern erläutert, können zwischengespeicherte Daten veraltet werden.</span><span class="sxs-lookup"><span data-stu-id="26545-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="26545-257">Um dies zu bekämpfen, können wir entweder Zeit-oder SQL-Cache-Abhängigkeits basierte Abläufe verwenden.</span><span class="sxs-lookup"><span data-stu-id="26545-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="26545-258">Ein Site Übersichts Anbieter kann optional die [`Initialize` Methode](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx)überschreiben.</span><span class="sxs-lookup"><span data-stu-id="26545-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="26545-259">`Initialize` wird aufgerufen, wenn der Site Übersichts Anbieter zum ersten Mal instanziiert wird und alle benutzerdefinierten Attribute, die dem Anbieter zugewiesen sind, in `Web.config` im `<add>`-Element wie `<add name="name" type="type" customAttribute="value" />`zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="26545-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="26545-260">Es ist hilfreich, wenn Sie es einem Seiten Entwickler gestatten möchten, verschiedene Einstellungen für das Site Map-Anbieter anzugeben, ohne den Anbieter-e-Code ändern zu müssen.</span><span class="sxs-lookup"><span data-stu-id="26545-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="26545-261">Wenn wir z. b. die Kategorie-und Produktdaten direkt aus der Datenbank lesen und nicht über die Architektur, möchten wir wahrscheinlich, dass der Seiten Entwickler die Daten bankverbindungs Zeichenfolge über `Web.config` anstatt mithilfe eines hart codierten Werts im e-Code des Anbieters angeben soll.</span><span class="sxs-lookup"><span data-stu-id="26545-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="26545-262">Der benutzerdefinierte Site Übersichts Anbieter, den wir in Schritt 6 erstellen, setzt diese `Initialize` Methode nicht außer Kraft.</span><span class="sxs-lookup"><span data-stu-id="26545-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="26545-263">Ein Beispiel für die Verwendung der `Initialize`-Methode finden Sie unter [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Speichern von Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) Artikel.</span><span class="sxs-lookup"><span data-stu-id="26545-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="26545-264">Schritt 6: Erstellen des benutzerdefinierten Site Übersichts Anbieters</span><span class="sxs-lookup"><span data-stu-id="26545-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="26545-265">Zum Erstellen eines benutzerdefinierten Site Übersichts Anbieters, der die Site Übersicht aus den Kategorien und Produkten in der Northwind-Datenbank erstellt, muss eine Klasse erstellt werden, die `StaticSiteMapProvider`erweitert.</span><span class="sxs-lookup"><span data-stu-id="26545-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="26545-266">In Schritt 1 haben Sie aufgefordert, im Ordner "`App_Code`" einen `CustomProviders` Ordner hinzuzufügen. Fügen Sie diesem Ordner `NorthwindSiteMapProvider`eine neue Klasse hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="26545-267">Fügen Sie der `NorthwindSiteMapProvider`-Klasse folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="26545-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="26545-268">Beginnen Sie mit der Untersuchung dieser Class s `BuildSiteMap`-Methode, die mit einer [`lock`-Anweisung](https://msdn.microsoft.com/library/c5kehkcz.aspx)beginnt.</span><span class="sxs-lookup"><span data-stu-id="26545-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="26545-269">Mit der `lock`-Anweisung können jeweils nur jeweils ein Thread eingegeben werden. auf diese Weise wird der Zugriff auf den Code serialisiert, und es wird verhindert, dass zwei gleichzeitige Threads aufeinander umtraten.</span><span class="sxs-lookup"><span data-stu-id="26545-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="26545-270">Die `SiteMapNode` Variable auf Klassenebene wird zum Zwischenspeichern der Site Übersichts Struktur verwendet `root`.</span><span class="sxs-lookup"><span data-stu-id="26545-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="26545-271">Wenn die Site Übersicht zum ersten Mal erstellt wird, oder zum ersten Mal, nachdem die zugrunde liegenden Daten geändert wurden, werden `root` `null`, und die Struktur der Site Struktur wird erstellt.</span><span class="sxs-lookup"><span data-stu-id="26545-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="26545-272">Der Stamm Knoten der Site Übersicht wird `root` während des Erstellungs Prozesses zugewiesen, sodass `root` nicht `null`werden, wenn diese Methode das nächste Mal aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="26545-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="26545-273">Folglich wird `root` nicht `null` die Struktur der Site Map an den Aufrufer zurückgegeben, ohne Sie neu erstellen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="26545-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="26545-274">Wenn root `null`ist, wird die Site Übersichts Struktur aus den Produkt-und Kategorieinformationen erstellt.</span><span class="sxs-lookup"><span data-stu-id="26545-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="26545-275">Die Site Map wird erstellt, indem die `SiteMapNode` Instanzen erstellt und dann die Hierarchie durch Aufrufe der `AddNode`-Methode der `StaticSiteMapProvider`-Klasse gebildet wird.</span><span class="sxs-lookup"><span data-stu-id="26545-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="26545-276">`AddNode` führt die interne Buchführung durch, wobei die verschiedenen `SiteMapNode` Instanzen in einem `Hashtable`gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="26545-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="26545-277">Bevor wir mit dem Erstellen der Hierarchie beginnen, rufen wir zunächst die `Clear`-Methode auf, die die Elemente aus dem internen `Hashtable`löscht.</span><span class="sxs-lookup"><span data-stu-id="26545-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="26545-278">Als nächstes werden die `ProductsBLL`-Klasse `GetProducts`-Methode und die resultierenden `ProductsDataTable` in lokalen Variablen gespeichert.</span><span class="sxs-lookup"><span data-stu-id="26545-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="26545-279">Die Erstellung der Site Map-s beginnt mit dem Erstellen des Stamm Knotens und dem zuweisen zu `root`.</span><span class="sxs-lookup"><span data-stu-id="26545-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="26545-280">Der Überladung des [`SiteMapNode` s-Konstruktors](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) , der hier und in dieser `BuildSiteMap` verwendet wird, werden die folgenden Informationen übergeben:</span><span class="sxs-lookup"><span data-stu-id="26545-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="26545-281">Ein Verweis auf den Site Übersichts Anbieter (`this`).</span><span class="sxs-lookup"><span data-stu-id="26545-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="26545-282">Der `SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="26545-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="26545-283">Dieser erforderliche Wert muss für jede `SiteMapNode`eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="26545-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="26545-284">Der `SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="26545-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="26545-285">`Url` ist optional, aber wenn bereitgestellt, muss jeder `SiteMapNode` s `Url` Wert eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="26545-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="26545-286">Der `SiteMapNode` s `Title`, der erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="26545-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="26545-287">Der `AddNode(root)`-Methodenaufrufe fügt der Site Map die `SiteMapNode` `root` als Stamm hinzu.</span><span class="sxs-lookup"><span data-stu-id="26545-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="26545-288">Im nächsten Schritt wird jede `ProductRow` in der `ProductsDataTable` aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="26545-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="26545-289">Wenn bereits eine `SiteMapNode` für die aktuelle Product s-Kategorie vorhanden ist, wird darauf verwiesen.</span><span class="sxs-lookup"><span data-stu-id="26545-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="26545-290">Andernfalls wird eine neue `SiteMapNode` für die Kategorie erstellt und mithilfe des `AddNode(categoryNode, root)` Methoden Aufrufes als untergeordnetes Element der `SiteMapNode``root` hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="26545-291">Nachdem die passende Kategorie `SiteMapNode` Knoten gefunden oder erstellt wurde, wird ein `SiteMapNode` für das aktuelle Produkt erstellt und über `AddNode(productNode, categoryNode)`als untergeordnetes Element der Kategorie `SiteMapNode` hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="26545-292">Beachten Sie, dass die Kategorie `SiteMapNode` s `Url`-Eigenschafts Wert `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` ist, während die Product `SiteMapNode` s `Url`-Eigenschaft `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`zugewiesen wird.</span><span class="sxs-lookup"><span data-stu-id="26545-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="26545-293">Produkte, die über einen Daten Bank `NULL` Wert für Ihre `CategoryID` verfügen, werden unter einer Kategorie gruppiert `SiteMapNode` deren `Title`-Eigenschaft auf None festgelegt ist und deren `Url`-Eigenschaft auf eine leere Zeichenfolge festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="26545-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="26545-294">Ich habe mich entschieden, `Url` auf eine leere Zeichenfolge festzulegen, da die `ProductBLL` Class s `GetProductsByCategory(categoryID)`-Methode derzeit nicht die Möglichkeit hat, nur diese Produkte mit einem `NULL` `CategoryID` Wert zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="26545-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="26545-295">Außerdem wollte ich veranschaulichen, wie die Navigations Steuerelemente einen `SiteMapNode` Rendering, der einen Wert für die `Url`-Eigenschaft nicht enthält.</span><span class="sxs-lookup"><span data-stu-id="26545-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="26545-296">Ich empfehle Ihnen, dieses Tutorial so zu erweitern, dass die Eigenschaft keine `SiteMapNode` s `Url` auf `ProductsByCategory.aspx`verweist, aber nur die Produkte mit `NULL` `CategoryID` Werte anzeigt.</span><span class="sxs-lookup"><span data-stu-id="26545-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="26545-297">Nach dem Erstellen der Site Übersicht wird dem Daten Cache ein beliebiges Objekt mit einer SQL-Cache Abhängigkeit vom `Categories` und `Products` Tabellen über ein `AggregateCacheDependency` Objekt hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="26545-298">Wir haben die Verwendung von SQL-Cache Abhängigkeiten im vorherigen Tutorial unter *Verwendung von SQL-Cache Abhängigkeiten*untersucht.</span><span class="sxs-lookup"><span data-stu-id="26545-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="26545-299">Der benutzerdefinierte Site Übersichts Anbieter verwendet jedoch eine Überladung der Data Cache s-`Insert` Methode, die wir noch untersuchen können.</span><span class="sxs-lookup"><span data-stu-id="26545-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="26545-300">Diese Überladung akzeptiert als letzten Eingabeparameter einen Delegaten, der aufgerufen wird, wenn das Objekt aus dem Cache entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="26545-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="26545-301">Insbesondere übergeben wir einen neuen [`CacheItemRemovedCallback`](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) Delegaten, der auf die `OnSiteMapChanged` Methode verweist, die weiter unten in der `NorthwindSiteMapProvider`-Klasse definiert ist.</span><span class="sxs-lookup"><span data-stu-id="26545-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="26545-302">Die Speicher interne Darstellung der Site Map wird durch die Variable auf Klassenebene `root`zwischengespeichert.</span><span class="sxs-lookup"><span data-stu-id="26545-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="26545-303">Da es nur eine Instanz der benutzerdefinierten Site Übersichts Anbieter-Klasse gibt und diese Instanz von allen Threads in der Webanwendung gemeinsam genutzt wird, dient diese Klassen Variable als Cache.</span><span class="sxs-lookup"><span data-stu-id="26545-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="26545-304">Die `BuildSiteMap`-Methode verwendet auch den Daten Cache, aber nur als Mittel zum Empfangen von Benachrichtigungen, wenn sich die zugrunde liegenden Datenbankdaten in der `Categories`-oder `Products` Tabellen ändern.</span><span class="sxs-lookup"><span data-stu-id="26545-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="26545-305">Beachten Sie, dass der Wert, der im Daten Cache abgelegt wird, nur das aktuelle Datum und die aktuelle Uhrzeit ist.</span><span class="sxs-lookup"><span data-stu-id="26545-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="26545-306">Die tatsächlichen Site Übersichts Daten werden *nicht* in den Daten Cache eingefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="26545-307">Die `BuildSiteMap`-Methode wird durch Zurückgeben des Stamm Knotens der Site Übersicht abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="26545-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="26545-308">Die übrigen Methoden sind recht unkompliziert.</span><span class="sxs-lookup"><span data-stu-id="26545-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="26545-309">`GetRootNodeCore` ist für die Rückgabe des Stamm Knotens verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="26545-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="26545-310">Da `BuildSiteMap` den Stamm zurückgibt, gibt `GetRootNodeCore` einfach `BuildSiteMap` s-Rückgabewert zurück.</span><span class="sxs-lookup"><span data-stu-id="26545-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="26545-311">Die `OnSiteMapChanged`-Methode legt `root` auf `null` zurück, wenn das Cache Element entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="26545-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="26545-312">Wenn "root" auf "`null`" zurückgesetzt wird, wird die Site Map-Struktur beim nächsten Aufrufen von `BuildSiteMap` neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="26545-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="26545-313">Schließlich gibt die `CachedDate`-Eigenschaft den im Daten Cache gespeicherten Datums-und Uhrzeitwert zurück, wenn ein solcher Wert vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="26545-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="26545-314">Diese Eigenschaft kann von einem Seiten Entwickler verwendet werden, um zu bestimmen, wann die Site Übersichts Daten zuletzt zwischengespeichert wurden.</span><span class="sxs-lookup"><span data-stu-id="26545-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="26545-315">Schritt 7: Registrieren des`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="26545-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="26545-316">Damit die Webanwendung den in Schritt 6 erstellten `NorthwindSiteMapProvider` Site Übersichts Anbieter verwenden kann, müssen wir Sie im `<siteMap>` Abschnitt von `Web.config`registrieren.</span><span class="sxs-lookup"><span data-stu-id="26545-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="26545-317">Fügen Sie in `Web.config`insbesondere das folgende Markup innerhalb des `<system.web>`-Elements hinzu:</span><span class="sxs-lookup"><span data-stu-id="26545-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="26545-318">Dieses Markup bewirkt zwei Dinge: Erstens gibt es an, dass die integrierte `AspNetXmlSiteMapProvider` der Standard-Site Übersichts Anbieter ist. Zweitens registriert Sie den benutzerdefinierten Site Übersichts Anbieter, der in Schritt 6 erstellt wurde, mit dem menschenfreundlichen Namen "Northwind".</span><span class="sxs-lookup"><span data-stu-id="26545-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="26545-319">Bei Site Übersichts Anbietern, die sich im Ordner "Application s `App_Code`" befinden, ist der Wert des `type` Attributs einfach der Klassenname.</span><span class="sxs-lookup"><span data-stu-id="26545-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="26545-320">Alternativ kann der benutzerdefinierte Site Übersichts Anbieter in einem separaten Klassen Bibliotheksprojekt erstellt worden sein, in dem die kompilierte Assembly in das `/Bin` Verzeichnis der Webanwendung eingefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="26545-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="26545-321">In diesem Fall wäre der Wert des `type`-Attributs " *Namespace*". *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="26545-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="26545-322">Nehmen Sie sich nach dem Aktualisieren `Web.config`einen Moment Zeit, um eine beliebige Seite aus den Tutorials in einem Browser anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="26545-323">Beachten Sie, dass die Navigationsschnittstelle auf der linken Seite weiterhin die Abschnitte und Tutorials anzeigt, die in `Web.sitemap`definiert sind.</span><span class="sxs-lookup"><span data-stu-id="26545-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="26545-324">Dies liegt daran, dass wir `AspNetXmlSiteMapProvider` als Standardanbieter belassen haben.</span><span class="sxs-lookup"><span data-stu-id="26545-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="26545-325">Um ein Navigations Benutzeroberflächen Element zu erstellen, das die `NorthwindSiteMapProvider`verwendet, müssen wir explizit angeben, dass der Northwind Site Map-Anbieter verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="26545-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="26545-326">Dies wird in Schritt 8 erläutert.</span><span class="sxs-lookup"><span data-stu-id="26545-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="26545-327">Schritt 8: Anzeigen von Site Übersichts Informationen mithilfe des benutzerdefinierten Site Übersichts Anbieters</span><span class="sxs-lookup"><span data-stu-id="26545-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="26545-328">Nachdem Sie den benutzerdefinierten Site Übersichts Anbieter erstellt und in `Web.config`registriert haben, können Sie die Navigations Steuerelemente zu den `Default.aspx`-, `ProductsByCategory.aspx`-und `ProductDetails.aspx` Seiten im `SiteMapProvider`-Ordner hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="26545-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="26545-329">Öffnen Sie zunächst die Seite `Default.aspx`, und ziehen Sie eine `SiteMapPath` aus der Toolbox auf den Designer.</span><span class="sxs-lookup"><span data-stu-id="26545-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="26545-330">Das SiteMapPath-Steuerelement befindet sich im Navigationsbereich der Toolbox.</span><span class="sxs-lookup"><span data-stu-id="26545-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="26545-331">[!["default. aspx" SiteMapPath hinzufügen](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="26545-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="26545-332">**Abbildung 16**: Hinzufügen eines SiteMapPath zu `Default.aspx` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="26545-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>

<span data-ttu-id="26545-333">Das SiteMapPath-Steuerelement zeigt einen Breadcrumb-Wert an, der die Position der aktuellen Seite innerhalb der Site Übersicht angibt.</span><span class="sxs-lookup"><span data-stu-id="26545-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="26545-334">Wir haben im Lernprogramm zu *Masterseiten und zur Website Navigation* am Anfang der Master Seite einen SiteMapPath hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="26545-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="26545-335">Nehmen Sie sich einen Moment Zeit, um diese Seite über einen Browser anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="26545-336">Der in Abbildung 16 hinzugefügte SiteMapPath verwendet den standardmäßigen Site Übersichts Anbieter und zieht seine Daten aus `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="26545-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="26545-337">Der Breadcrumb-Code zeigt daher Start &gt; Anpassung der Site Map an, genau wie die Breadcrumb in der oberen rechten Ecke.</span><span class="sxs-lookup"><span data-stu-id="26545-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="26545-338">[![Breadcrumb den standardmäßigen Site Übersichts Anbieter verwendet.](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="26545-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="26545-339">**Abbildung 17**: Breadcrumb verwendet den Standard-Site Übersichts Anbieter ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="26545-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>

<span data-ttu-id="26545-340">Um SiteMapPath in Abbildung 16 hinzuzufügen, verwenden Sie den benutzerdefinierten Site Übersichts Anbieter, den Sie in Schritt 6 erstellt haben, legen Sie die [`SiteMapProvider`-Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) auf Northwind fest, den Namen, den Sie der `NorthwindSiteMapProvider` in `Web.config`zugewiesen haben.</span><span class="sxs-lookup"><span data-stu-id="26545-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="26545-341">Leider verwendet der Designer weiterhin den standardmäßigen Site Übersichts Anbieter, aber wenn Sie die Seite über einen Browser besuchen, nachdem Sie diese Eigenschaft geändert haben, sehen Sie, dass der Breadcrumb jetzt den benutzerdefinierten Site Übersichts Anbieter verwendet.</span><span class="sxs-lookup"><span data-stu-id="26545-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="26545-342">[![Breadcrumb verwendet jetzt den benutzerdefinierten Site Übersichts Anbieter "northwindsitemapprovider".](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="26545-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="26545-343">**Abbildung 18**: Breadcrumb verwendet jetzt den benutzerdefinierten Site Übersichts Anbieter `NorthwindSiteMapProvider` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="26545-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>

<span data-ttu-id="26545-344">Das SiteMapPath-Steuerelement zeigt eine Funktions lichere Benutzeroberfläche auf den `ProductsByCategory.aspx`-und `ProductDetails.aspx` Seiten an.</span><span class="sxs-lookup"><span data-stu-id="26545-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="26545-345">Fügen Sie diesen Seiten eine SiteMapPath-Eigenschaft hinzu, indem Sie die `SiteMapProvider`-Eigenschaft in Northwind festlegen.</span><span class="sxs-lookup"><span data-stu-id="26545-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="26545-346">Klicken Sie in `Default.aspx` auf den Link Produkte anzeigen, und klicken Sie dann auf den Link Details anzeigen für Chai-Tea.</span><span class="sxs-lookup"><span data-stu-id="26545-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="26545-347">Wie in Abbildung 19 gezeigt, enthält der Breadcrumb den aktuellen Site Übersichts Abschnitt (Chai Tea) und seine Vorgänger: Getränke und alle Kategorien.</span><span class="sxs-lookup"><span data-stu-id="26545-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="26545-348">[![Breadcrumb verwendet jetzt den benutzerdefinierten Site Übersichts Anbieter "northwindsitemapprovider".](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="26545-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="26545-349">**Abbildung 19**: Breadcrumb verwendet jetzt den benutzerdefinierten Site Übersichts Anbieter `NorthwindSiteMapProvider` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="26545-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>

<span data-ttu-id="26545-350">Neben SiteMapPath können auch andere Elemente der Navigations Benutzeroberfläche verwendet werden, z. b. das Menü und die TreeView-Steuerelemente.</span><span class="sxs-lookup"><span data-stu-id="26545-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="26545-351">Die Seiten `Default.aspx`, `ProductsByCategory.aspx`und `ProductDetails.aspx` im Download für dieses Lernprogramm, z. b. alle Menü Steuerelemente enthalten (siehe Abbildung 20).</span><span class="sxs-lookup"><span data-stu-id="26545-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="26545-352">Eine ausführlichere Betrachtung der Navigations Steuerelemente und des Site Übersichts Systems in ASP.NET 2,0 finden Sie unter unter [Suchen von ASP.NET 2,0 s-Website Navigations Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) und im Abschnitt [using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) des [ASP.NET 2,0-Schnellstarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) .</span><span class="sxs-lookup"><span data-stu-id="26545-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="26545-353">[![das Menü Steuerelement listet die einzelnen Kategorien und Produkte auf.](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="26545-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="26545-354">**Abbildung 20**: das Menü Steuerelement listet die einzelnen Kategorien und Produkte auf ([Klicken Sie, um das Bild in voller Größe anzuzeigen](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="26545-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>

<span data-ttu-id="26545-355">Wie bereits weiter oben in diesem Tutorial erwähnt, kann auf die Site Map-Strukturprogramm gesteuert über die `SiteMap`-Klasse zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="26545-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="26545-356">Der folgende Code gibt die Stamm `SiteMapNode` des Standard Anbieters zurück:</span><span class="sxs-lookup"><span data-stu-id="26545-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="26545-357">Da die `AspNetXmlSiteMapProvider` der Standardanbieter für die Anwendung ist, würde der obige Code den in `Web.sitemap`definierten Stamm Knoten zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="26545-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="26545-358">Wenn Sie auf einen anderen Site Map-Anbieter als den Standard Verweis verweisen möchten, verwenden Sie die `SiteMap`-Klasse [`Providers`-Eigenschaft](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) wie folgt:</span><span class="sxs-lookup"><span data-stu-id="26545-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="26545-359">Dabei ist *Name* der Name des benutzerdefinierten Site Übersichts Anbieters (Northwind für die Webanwendung).</span><span class="sxs-lookup"><span data-stu-id="26545-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="26545-360">Um auf einen für einen Site Übersichts anbieterspezifischen Member zuzugreifen, verwenden Sie `SiteMap.Providers["name"]`, um die Anbieter Instanz abzurufen, und wandeln Sie Sie dann in den entsprechenden Typ um.</span><span class="sxs-lookup"><span data-stu-id="26545-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="26545-361">Verwenden Sie z. b. den folgenden Code, um die `NorthwindSiteMapProvider` s `CachedDate`-Eigenschaft auf einer ASP.NET-Seite anzuzeigen:</span><span class="sxs-lookup"><span data-stu-id="26545-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="26545-362">Stellen Sie sicher, dass Sie das SQL-Cache-Abhängigkeits Feature testen.</span><span class="sxs-lookup"><span data-stu-id="26545-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="26545-363">Nachdem Sie die Seiten `Default.aspx`, `ProductsByCategory.aspx`und `ProductDetails.aspx` besucht haben, navigieren Sie zu einem der Tutorials im Abschnitt bearbeiten, einfügen und löschen, und bearbeiten Sie den Namen einer Kategorie oder eines Produkts.</span><span class="sxs-lookup"><span data-stu-id="26545-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="26545-364">Kehren Sie dann zu einer der Seiten im `SiteMapProvider`-Ordner zurück.</span><span class="sxs-lookup"><span data-stu-id="26545-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="26545-365">Wenn Sie davon ausgehen, dass genügend Zeit für den Abruf Mechanismus vergangen ist, um die Änderung an der zugrunde liegenden Datenbank zu notieren, sollte die Site Zuordnung aktualisiert werden, um den neuen Produkt-oder Kategorienamen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="26545-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="26545-366">Summary</span><span class="sxs-lookup"><span data-stu-id="26545-366">Summary</span></span>

<span data-ttu-id="26545-367">ASP.NET 2,0 s Site Map-Features beinhalten eine `SiteMap` Klasse, eine Reihe integrierter websteuer Elemente für die Navigation und einen Standard-Site Übersichts Anbieter, der erwartet, dass die Site Übersichts Informationen in einer XML-Datei gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="26545-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="26545-368">Um Site Übersichts Informationen aus einer anderen Quelle (z. b. aus einer Datenbank, der Anwendungsarchitektur oder einem Remoteweb Dienst) zu verwenden, müssen wir einen benutzerdefinierten Site Übersichts Anbieter erstellen.</span><span class="sxs-lookup"><span data-stu-id="26545-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="26545-369">Dies umfasst das Erstellen einer Klasse, die direkt oder indirekt von der `SiteMapProvider` Klasse abgeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="26545-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="26545-370">In diesem Tutorial wurde erläutert, wie Sie einen benutzerdefinierten Site Übersichts Anbieter erstellen, der die Site Übersicht auf der Grundlage der Produkt-und Kategorieinformationen auf Grundlage der Anwendungsarchitektur erstellt hat.</span><span class="sxs-lookup"><span data-stu-id="26545-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="26545-371">Der Anbieter hat die `StaticSiteMapProvider` Klasse erweitert und eine `BuildSiteMap` Methode erstellt, mit der die Daten abgerufen, die Site Übersichts Hierarchie erstellt und die resultierende Struktur in einer Variablen auf Klassenebene zwischengespeichert wurden.</span><span class="sxs-lookup"><span data-stu-id="26545-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="26545-372">Wir haben eine SQL-Cache Abhängigkeit mit einer Rückruffunktion verwendet, um die zwischengespeicherte Struktur ungültig zu machen, wenn die zugrunde liegenden `Categories` oder `Products` Daten geändert werden.</span><span class="sxs-lookup"><span data-stu-id="26545-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="26545-373">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="26545-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="26545-374">Weiterführende Themen</span><span class="sxs-lookup"><span data-stu-id="26545-374">Further Reading</span></span>

<span data-ttu-id="26545-375">Weitere Informationen zu den in diesem Tutorial behandelten Themen finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="26545-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="26545-376">[Speichern von Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) und [dem SQL Site Map-Anbieter, auf den Sie gewartet](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) haben</span><span class="sxs-lookup"><span data-stu-id="26545-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="26545-377">Ein Blick auf das ASP.NET 2,0 s-Anbieter Modell</span><span class="sxs-lookup"><span data-stu-id="26545-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="26545-378">Anbietertoolkit</span><span class="sxs-lookup"><span data-stu-id="26545-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="26545-379">Untersuchen von ASP.NET 2,0 s-Website Navigations Features</span><span class="sxs-lookup"><span data-stu-id="26545-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="26545-380">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="26545-380">About the Author</span></span>

<span data-ttu-id="26545-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="26545-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="26545-382">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="26545-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="26545-383">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="26545-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="26545-384">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="26545-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="26545-385">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="26545-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="26545-386">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="26545-386">Special Thanks To</span></span>

<span data-ttu-id="26545-387">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="26545-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="26545-388">Die führenden Reviewer für dieses Tutorial waren Dave Gardner, Zack Jones, Teresa Murphy und Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="26545-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="26545-389">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="26545-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="26545-390">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="26545-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="26545-391">Nächste</span><span class="sxs-lookup"><span data-stu-id="26545-391">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
