---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Behandeln von Ausnahmen auf BLL-und Dal-C#Ebene () | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial wird erläutert, wie Ausnahmen, die während des Aktualisierungs Workflows eines bearbeitbaren DataList-Workflows ausgelöst wurden, schrittweise behandelt werden.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 35ff60be6ed67ea8d1bf226ae70f590100597757
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78494967"
---
# <a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="33033-103">Verarbeiten von Ausnahmen auf BLL- und DAL-Ebene (C#)</span><span class="sxs-lookup"><span data-stu-id="33033-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>

<span data-ttu-id="33033-104">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="33033-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="33033-105">[Beispiel-app herunterladen](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) oder [PDF herunterladen](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="33033-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="33033-106">In diesem Tutorial wird erläutert, wie Ausnahmen, die während des Aktualisierungs Workflows eines bearbeitbaren DataList-Workflows ausgelöst wurden, schrittweise behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="33033-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="33033-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="33033-107">Introduction</span></span>

<span data-ttu-id="33033-108">In der [Übersicht über das Bearbeiten und Löschen von Daten im DataList-](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) Tutorial haben wir einen DataList erstellt, der einfache Funktionen zum Bearbeiten und löschen bot.</span><span class="sxs-lookup"><span data-stu-id="33033-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="33033-109">Obwohl es voll funktionsfähig ist, war es kaum benutzerfreundlich, da jeder Fehler, der während des Bearbeitungs-oder Löschvorgangs aufgetreten ist, zu einer nicht behandelten Ausnahme geführt hat.</span><span class="sxs-lookup"><span data-stu-id="33033-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="33033-110">Wenn Sie z. b. den Produktnamen weglassen oder bei der Bearbeitung eines Produkts einen Preis Wert von sehr kostengünstiger! eingeben, löst eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="33033-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="33033-111">Da diese Ausnahme im Code nicht abgefangen wird, wird Sie auf die ASP.NET-Laufzeit hochskalieren, in der dann die Details der Ausnahme s auf der Webseite angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="33033-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="33033-112">Wie in der Behandlung von [Ausnahmen auf BLL-und Dal-Ebene in einer ASP.NET-Seite](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) gezeigt, werden die Ausnahme Details an die ObjectDataSource und dann an die GridView zurückgegeben, wenn eine Ausnahme aus den Tiefen der Geschäftslogik oder der Datenzugriffsebenen ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="33033-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="33033-113">Wir haben gesehen, wie Sie diese Ausnahmen ordnungsgemäß behandeln können, indem wir `Updated` oder `RowUpdated` Ereignishandler für ObjectDataSource oder GridView erstellen, eine Ausnahme überprüfen und dann angeben, dass die Ausnahme behandelt wurde.</span><span class="sxs-lookup"><span data-stu-id="33033-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="33033-114">Unsere DataList-Tutorials verwenden jedoch nicht die ObjectDataSource zum Aktualisieren und Löschen von Daten.</span><span class="sxs-lookup"><span data-stu-id="33033-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="33033-115">Stattdessen arbeiten wir direkt mit der BLL.</span><span class="sxs-lookup"><span data-stu-id="33033-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="33033-116">Um Ausnahmen zu erkennen, die von der BLL oder dal stammen, müssen wir den Code für die Ausnahmebehandlung im Code Behind unserer ASP.NET-Seite implementieren.</span><span class="sxs-lookup"><span data-stu-id="33033-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="33033-117">In diesem Tutorial erfahren Sie, wie Sie Ausnahmen, die bei einem bearbeitbaren DataList s-Aktualisierungs Workflow ausgelöst wurden, schrittweise behandeln.</span><span class="sxs-lookup"><span data-stu-id="33033-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="33033-118">In der *Übersicht über das Bearbeiten und Löschen von Daten im DataList-* Tutorial haben wir verschiedene Techniken zum Bearbeiten und Löschen von Daten aus dem DataList erläutert, einige Techniken, die zum Aktualisieren und Löschen von ObjectDataSource verwendet wurden.</span><span class="sxs-lookup"><span data-stu-id="33033-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="33033-119">Wenn Sie diese Techniken anwenden, können Sie Ausnahmen von der BLL oder dal über die ObjectDataSource s-`Updated` oder `Deleted`-Ereignishandler behandeln.</span><span class="sxs-lookup"><span data-stu-id="33033-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="33033-120">Schritt 1: Erstellen eines bearbeitbaren DataList</span><span class="sxs-lookup"><span data-stu-id="33033-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="33033-121">Bevor wir uns mit der Behandlung von Ausnahmen beschäftigen, die während des Aktualisierungs Workflows auftreten, erstellen Sie zunächst einen bearbeitbaren DataList.</span><span class="sxs-lookup"><span data-stu-id="33033-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="33033-122">Öffnen Sie die Seite `ErrorHandling.aspx` im Ordner `EditDeleteDataList`, fügen Sie dem Designer einen DataList hinzu, legen Sie dessen Eigenschaft `ID` auf `Products`fest, und fügen Sie eine neue ObjectDataSource mit dem Namen `ProductsDataSource`hinzu.</span><span class="sxs-lookup"><span data-stu-id="33033-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="33033-123">Konfigurieren Sie ObjectDataSource so, dass die `ProductsBLL` Klasse s `GetProducts()` Methode zum Auswählen von Datensätzen verwendet wird. Legen Sie die Dropdown Listen auf den Registerkarten einfügen, aktualisieren und löschen auf (keine) fest.</span><span class="sxs-lookup"><span data-stu-id="33033-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="33033-124">[![die Produktinformationen mithilfe der GetProducts ()-Methode zurückgeben](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="33033-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="33033-125">**Abbildung 1**: Zurückgeben der Produktinformationen mithilfe der `GetProducts()`-Methode ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="33033-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="33033-126">Nachdem Sie den ObjectDataSource-Assistenten abgeschlossen haben, erstellt Visual Studio automatisch eine `ItemTemplate` für den DataList.</span><span class="sxs-lookup"><span data-stu-id="33033-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="33033-127">Ersetzen Sie dies durch eine `ItemTemplate`, die den Namen und den Preis der einzelnen Produkte anzeigt und eine Bearbeitungs Schaltfläche enthält.</span><span class="sxs-lookup"><span data-stu-id="33033-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="33033-128">Erstellen Sie als nächstes eine `EditItemTemplate` mit einem TextBox-websteuer Element für die Schaltflächen Name und Price und Update und Abbrechen.</span><span class="sxs-lookup"><span data-stu-id="33033-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="33033-129">Legen Sie abschließend die DataList s-`RepeatColumns`-Eigenschaft auf 2 fest.</span><span class="sxs-lookup"><span data-stu-id="33033-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="33033-130">Nachdem Sie diese Änderungen vorgenommen haben, sollte Ihr deklaratives Markup der Seite in etwa wie folgt aussehen.</span><span class="sxs-lookup"><span data-stu-id="33033-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="33033-131">Vergewissern Sie sich, dass die `CommandName` Eigenschaften für die Schaltflächen Bearbeiten, Abbrechen und Aktualisieren auf Bearbeiten, Abbrechen bzw. aktualisieren festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="33033-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="33033-132">Für dieses Tutorial muss der Ansichts Zustand "DataList s" aktiviert sein.</span><span class="sxs-lookup"><span data-stu-id="33033-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="33033-133">Nehmen Sie sich einen Moment Zeit, um den Fortschritt über einen Browser anzuzeigen (siehe Abbildung 2).</span><span class="sxs-lookup"><span data-stu-id="33033-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="33033-134">[![jedes Produkt enthält eine Bearbeitungs Schaltfläche.](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="33033-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="33033-135">**Abbildung 2**: jedes Produkt enthält eine Schaltfläche "Bearbeiten" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="33033-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>

<span data-ttu-id="33033-136">Zurzeit verursacht die Schaltfläche "Bearbeiten" nur ein Postback, das das Produkt noch nicht bearbeitbar macht.</span><span class="sxs-lookup"><span data-stu-id="33033-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="33033-137">Um die Bearbeitung zu aktivieren, müssen wir Ereignishandler für die `EditCommand`-, `CancelCommand`-und `UpdateCommand`-Ereignisse des DataList s erstellen.</span><span class="sxs-lookup"><span data-stu-id="33033-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="33033-138">Die `EditCommand`-und `CancelCommand` Ereignisse aktualisieren einfach die DataList-`EditItemIndex`-Eigenschaft und binden die Daten erneut an den DataList-DataList:</span><span class="sxs-lookup"><span data-stu-id="33033-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="33033-139">Der `UpdateCommand` Ereignishandler ist etwas mehr beteiligt.</span><span class="sxs-lookup"><span data-stu-id="33033-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="33033-140">Es muss die `ProductID` der bearbeiteten Produkte aus der `DataKeys` Auflistung zusammen mit dem Namen und dem Preis des Produkts aus den Textfeldern in der `EditItemTemplate`lesen und dann die `ProductsBLL` Class s `UpdateProduct`-Methode aufzurufen, bevor der DataList in den Zustand der vorabbearbeitung zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="33033-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="33033-141">Verwenden Sie vorerst einfach genau denselben Code aus dem `UpdateCommand`-Ereignishandler in der *Übersicht über das Bearbeiten und Löschen von Daten im DataList-* Tutorial.</span><span class="sxs-lookup"><span data-stu-id="33033-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="33033-142">Wir fügen den Code hinzu, um Ausnahmen in Schritt 2 ordnungsgemäß zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="33033-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="33033-143">Im Falle einer ungültigen Eingabe, die in Form eines nicht ordnungsgemäß formatierten Einheits Preises vorliegen kann, wird ein unzulässiger Preis Wert von Einheiten wie z. b.-$5,00 oder das Weglassen des Product s Name ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="33033-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="33033-144">Da der `UpdateCommand` Ereignishandler an dieser Stelle keinen Code für die Ausnahmebehandlung enthält, wird die Ausnahme in die ASP.NET-Laufzeit hochskalieren, wo Sie dem Endbenutzer angezeigt wird (siehe Abbildung 3).</span><span class="sxs-lookup"><span data-stu-id="33033-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![Wenn eine nicht behandelte Ausnahme auftritt, wird dem Endbenutzer eine Fehlerseite angezeigt.](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="33033-146">**Abbildung 3**: Wenn eine nicht behandelte Ausnahme auftritt, wird dem Endbenutzer eine Fehlerseite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="33033-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="33033-147">Schritt 2: ordnungsgemäße Behandlung von Ausnahmen im UpdateCommand-Ereignis Handler</span><span class="sxs-lookup"><span data-stu-id="33033-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="33033-148">Während des Aktualisierungs Workflows können Ausnahmen im `UpdateCommand` Ereignishandler, der BLL oder der dal auftreten.</span><span class="sxs-lookup"><span data-stu-id="33033-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="33033-149">Wenn ein Benutzer beispielsweise einen Preis zu teuer eingibt, löst die `Decimal.Parse`-Anweisung im `UpdateCommand`-Ereignishandler eine `FormatException`-Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="33033-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="33033-150">Wenn der Benutzer den Namen des Produkts auslässt oder der Preis einen negativen Wert aufweist, wird von der dal eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="33033-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="33033-151">Wenn eine Ausnahme auftritt, möchten wir eine informative Meldung auf der Seite Selbstanzeigen.</span><span class="sxs-lookup"><span data-stu-id="33033-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="33033-152">Fügen Sie der Seite ein Label-websteuer Element hinzu, dessen `ID` auf `ExceptionDetails`festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="33033-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="33033-153">Konfigurieren Sie den Text der Bezeichnung, sodass er in einer roten, extra großen, Fetten und kursiv Schrift angezeigt wird, indem Sie die `CssClass`-Eigenschaft der `Warning` CSS-Klasse zuweisen, die in der `Styles.css`-Datei definiert ist.</span><span class="sxs-lookup"><span data-stu-id="33033-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="33033-154">Wenn ein Fehler auftritt, soll die Bezeichnung nur einmal angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="33033-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="33033-155">Das heißt, bei nachfolgenden Postbacks sollte die Warnmeldung der Bezeichnung s verschwinden.</span><span class="sxs-lookup"><span data-stu-id="33033-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="33033-156">Dies kann erreicht werden, indem die Bezeichnung s `Text`-Eigenschaft gelöscht wird oder die `Visible`-Eigenschaft der-Eigenschaft für den `Page_Load`-Ereignishandler `False` wird (wie in der [Behandlung von Ausnahmen auf BLL-und Dal-Ebene in einer ASP.NET-Seite](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) ) oder durch Deaktivieren der Unterstützung für den Ansichts Zustand der Bezeichnung.</span><span class="sxs-lookup"><span data-stu-id="33033-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="33033-157">Verwenden Sie die zweite Option.</span><span class="sxs-lookup"><span data-stu-id="33033-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="33033-158">Wenn eine Ausnahme ausgelöst wird, weisen wir die Details der Ausnahme der `ExceptionDetails` Label-Steuerelement-`Text` Eigenschaft zu.</span><span class="sxs-lookup"><span data-stu-id="33033-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="33033-159">Da der Ansichts Zustand deaktiviert ist, gehen bei nachfolgenden Postbacks die programmgesteuerten Änderungen der `Text`-Eigenschaft verloren und kehren zum Standardtext (eine leere Zeichenfolge) zurück. Dadurch wird die Warnmeldung ausgeblendet.</span><span class="sxs-lookup"><span data-stu-id="33033-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="33033-160">Um zu ermitteln, wann ein Fehler ausgelöst wurde, um eine hilfreiche Meldung auf der Seite anzuzeigen, müssen wir dem `UpdateCommand`-Ereignishandler einen `Try ... Catch`-Block hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="33033-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="33033-161">Der `Try` Teil enthält Code, der möglicherweise zu einer Ausnahme führt, während der `Catch` Block Code enthält, der in der Gegenseite einer Ausnahme ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="33033-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="33033-162">Weitere Informationen zum `Try ... Catch`-Block finden Sie im Abschnitt [Grundlagen zur Ausnahmebehandlung](https://msdn.microsoft.com/library/2w8f0bss.aspx) in der .NET Framework-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="33033-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="33033-163">Wenn eine Ausnahme eines beliebigen Typs durch Code im `Try`-Block ausgelöst wird, wird die Ausführung des `Catch` Block s-Codes gestartet.</span><span class="sxs-lookup"><span data-stu-id="33033-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="33033-164">Der Typ der Ausnahme, die `DbException`, `NoNullAllowedException`, `ArgumentException`usw. ausgelöst wird, hängt davon ab, was genau den Fehler ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="33033-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="33033-165">Wenn auf Datenbankebene ein Problem vorliegt, wird eine `DbException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="33033-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="33033-166">Wenn für die Felder `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`oder `ReorderLevel` ein unzulässiger Wert eingegeben wird, wird eine `ArgumentException` ausgelöst, da wir Code zum Validieren dieser Feldwerte in der `ProductsDataTable`-Klasse hinzugefügt haben (siehe das Tutorial [Erstellen einer Geschäftslogik Schicht](../introduction/creating-a-business-logic-layer-cs.md) ).</span><span class="sxs-lookup"><span data-stu-id="33033-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="33033-167">Wir können für den Endbenutzer eine ausführlichere Erläuterung bereitstellen, indem Sie den Nachrichtentext auf den Typ der aufgefangenen Ausnahme stützen.</span><span class="sxs-lookup"><span data-stu-id="33033-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="33033-168">Der folgende Code, der in einer nahezu identischen Form in der Behandlung von [Ausnahmen auf der BLL-und Dal-Ebene in einem ASP.net page-](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) Tutorial verwendet wurde, bietet diese Detailstufe:</span><span class="sxs-lookup"><span data-stu-id="33033-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="33033-169">Um dieses Lernprogramm abzuschließen, müssen Sie einfach die `DisplayExceptionDetails`-Methode vom `Catch`-Block aus, der die abgefangene `Exception` Instanz (`ex`) übergibt.</span><span class="sxs-lookup"><span data-stu-id="33033-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="33033-170">Wenn der `Try ... Catch`-Block vorhanden ist, wird den Benutzern eine informative Fehlermeldung angezeigt, wie in Abbildung 4 und 5 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="33033-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="33033-171">Beachten Sie, dass sich der DataList im Falle einer Ausnahme im Bearbeitungsmodus befindet.</span><span class="sxs-lookup"><span data-stu-id="33033-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="33033-172">Dies liegt daran, dass die Ablauf Steuerung nach dem Auftreten der Ausnahme sofort an den `Catch`-Block umgeleitet wird, wobei der Code umgangen wird, der den DataList in den Zustand der vorabbearbeitung zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="33033-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="33033-173">[![eine Fehlermeldung angezeigt wird, wenn ein Benutzer ein Pflichtfeld auslässt](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="33033-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="33033-174">**Abbildung 4**: eine Fehlermeldung wird angezeigt, wenn ein Benutzer ein Pflichtfeld auslässt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="33033-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>

<span data-ttu-id="33033-175">[![eine Fehlermeldung angezeigt wird, wenn ein negativer Preis eingegeben wird](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="33033-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="33033-176">**Abbildung 5**: eine Fehlermeldung wird angezeigt, wenn ein negativer Preis eingegeben wird ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="33033-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="33033-177">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="33033-177">Summary</span></span>

<span data-ttu-id="33033-178">GridView und ObjectDataSource stellen Ereignishandler auf der Post-Ebene bereit, die Informationen zu allen Ausnahmen enthalten, die während des Aktualisierungs-und Lösch Workflows ausgelöst wurden, sowie Eigenschaften, die festgelegt werden können, um anzugeben, ob die Ausnahme aufgetreten ist. Umgangs.</span><span class="sxs-lookup"><span data-stu-id="33033-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="33033-179">Diese Funktionen sind jedoch nicht verfügbar, wenn Sie mit dem DataList arbeiten und die BLL direkt verwenden.</span><span class="sxs-lookup"><span data-stu-id="33033-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="33033-180">Stattdessen sind wir für die Implementierung der Ausnahmebehandlung verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="33033-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="33033-181">In diesem Tutorial wurde erläutert, wie Sie eine Ausnahmebehandlung zu einem bearbeitbaren DataList s-Aktualisierungs Workflow hinzufügen, indem Sie dem `UpdateCommand`-Ereignishandler einen `Try ... Catch`-Block hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="33033-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="33033-182">Wenn während des Aktualisierungs Workflows eine Ausnahme ausgelöst wird, wird der `Catch`-Block s-Code ausgeführt, der hilfreiche Informationen in der `ExceptionDetails` Bezeichnung anzeigt.</span><span class="sxs-lookup"><span data-stu-id="33033-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="33033-183">An diesem Punkt unternimmt der DataList keinen Aufwand, um zu verhindern, dass Ausnahmen an erster Stelle auftreten.</span><span class="sxs-lookup"><span data-stu-id="33033-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="33033-184">Obwohl wir wissen, dass ein negativer Preis zu einer Ausnahme führt, haben wir noch keine Funktionen hinzugefügt, um proaktiv zu verhindern, dass ein Benutzer solche ungültige Eingaben eingibt.</span><span class="sxs-lookup"><span data-stu-id="33033-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="33033-185">Im nächsten Tutorial erfahren Sie, wie Sie die Ausnahmen, die durch ungültige Benutzereingaben verursacht werden, durch Hinzufügen von Validierungs Steuerelementen in der `EditItemTemplate`reduzieren können.</span><span class="sxs-lookup"><span data-stu-id="33033-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="33033-186">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="33033-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="33033-187">Weitere nützliche Informationen</span><span class="sxs-lookup"><span data-stu-id="33033-187">Further Reading</span></span>

<span data-ttu-id="33033-188">Weitere Informationen zu den in diesem Tutorial behandelten Themen finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="33033-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="33033-189">Entwurfsrichtlinien für Ausnahmen</span><span class="sxs-lookup"><span data-stu-id="33033-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="33033-190">[Fehler Protokollierung von Modulen und Handlern (ELMAH)](http://workspaces.gotdotnet.com/elmah) (eine Open Source-Bibliothek zum Protokollieren von Fehlern)</span><span class="sxs-lookup"><span data-stu-id="33033-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="33033-191">[Enterprise Library für .NET Framework 2,0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (schließt den Anwendungs Block für die Ausnahme Verwaltung ein)</span><span class="sxs-lookup"><span data-stu-id="33033-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="33033-192">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="33033-192">About the Author</span></span>

<span data-ttu-id="33033-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="33033-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="33033-194">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="33033-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="33033-195">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="33033-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="33033-196">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="33033-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="33033-197">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="33033-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="33033-198">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="33033-198">Special Thanks To</span></span>

<span data-ttu-id="33033-199">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="33033-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="33033-200">Lead Reviewer für dieses Tutorial war Ken pespisa.</span><span class="sxs-lookup"><span data-stu-id="33033-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="33033-201">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="33033-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="33033-202">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="33033-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="33033-203">[Zurück](performing-batch-updates-cs.md)
> [Weiter](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="33033-203">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
