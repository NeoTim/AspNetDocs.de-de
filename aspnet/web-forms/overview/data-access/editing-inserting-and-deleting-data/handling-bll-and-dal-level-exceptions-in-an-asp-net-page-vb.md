---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
title: Behandeln von Ausnahmen auf BLL-und Dal-Ebene auf einer ASP.NET-Seite (VB) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial wird erläutert, wie eine benutzerfreundliche, informative Fehlermeldung angezeigt wird, wenn eine Ausnahme während eines Einfügungs-, Update-oder Löschvorgangs von...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 129d4338-1315-4f40-89b5-2b84b807707d
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
msc.type: authoredcontent
ms.openlocfilehash: ee277596ade18d2603892d134b47c2c8697836bb
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/28/2019
ms.locfileid: "74621050"
---
# <a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-vb"></a><span data-ttu-id="2424f-103">Verarbeiten von Ausnahmen auf BLL- und DAL-Ebene in einer ASP.NET-Seite (VB)</span><span class="sxs-lookup"><span data-stu-id="2424f-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (VB)</span></span>

<span data-ttu-id="2424f-104">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2424f-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2424f-105">[Beispiel-app herunterladen](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) oder [PDF herunterladen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2424f-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span></span>

> <span data-ttu-id="2424f-106">In diesem Tutorial wird erläutert, wie eine benutzerfreundliche, informative Fehlermeldung angezeigt wird, wenn eine Ausnahme während eines Einfügungs-, Aktualisierungs-oder Löschvorgangs eines ASP.NET Data Web-Steuer Elements auftritt.</span><span class="sxs-lookup"><span data-stu-id="2424f-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>

## <a name="introduction"></a><span data-ttu-id="2424f-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="2424f-107">Introduction</span></span>

<span data-ttu-id="2424f-108">Das Arbeiten mit Daten aus einer ASP.NET-Webanwendung mithilfe einer mehrstufigen Anwendungsarchitektur umfasst die folgenden drei allgemeinen Schritte:</span><span class="sxs-lookup"><span data-stu-id="2424f-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="2424f-109">Bestimmen Sie, welche Methode der Geschäftslogik Schicht aufgerufen werden muss und welche Parameterwerte Sie übergeben müssen.</span><span class="sxs-lookup"><span data-stu-id="2424f-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="2424f-110">Die Parameterwerte können hart codiert, Programm gesteuert zugewiesen oder Eingaben sein, die vom Benutzer eingegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="2424f-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="2424f-111">Rufen Sie die Methode auf.</span><span class="sxs-lookup"><span data-stu-id="2424f-111">Invoke the method.</span></span>
3. <span data-ttu-id="2424f-112">Verarbeiten Sie die Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="2424f-112">Process the results.</span></span> <span data-ttu-id="2424f-113">Wenn eine BLL-Methode aufgerufen wird, die Daten zurückgibt, kann dies das Binden der Daten an ein datenweb Steuerelement beinhalten.</span><span class="sxs-lookup"><span data-stu-id="2424f-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="2424f-114">Bei BLL-Methoden, mit denen Daten geändert werden, kann dies das Ausführen von Aktionen auf der Grundlage eines Rückgabewerts oder die ordnungsgemäße Behandlung von Ausnahmen, die in Schritt 2 aufgetreten sind, umfassen.</span><span class="sxs-lookup"><span data-stu-id="2424f-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="2424f-115">Wie bereits im [vorherigen Tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)gezeigt, stellen sowohl die ObjectDataSource-als auch die Data Web-Steuerelemente Erweiterbarkeits Punkte für die Schritte 1 und 3 bereit.</span><span class="sxs-lookup"><span data-stu-id="2424f-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="2424f-116">Die GridView löst z. b. das `RowUpdating`-Ereignis aus, bevor die Feldwerte der `UpdateParameters` Collection von ObjectDataSource zugewiesen werden. Das `RowUpdated` Ereignis wird ausgelöst, nachdem der Vorgang von ObjectDataSource abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="2424f-117">Wir haben bereits die Ereignisse untersucht, die in Schritt 1 ausgelöst werden, und haben gesehen, wie Sie verwendet werden können, um die Eingabeparameter anzupassen oder den Vorgang abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="2424f-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="2424f-118">In diesem Tutorial werden wir uns auf die Ereignisse konzentrieren, die nach Abschluss des Vorgangs ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="2424f-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="2424f-119">Mit diesen Ereignis Handlern auf der Post-Ebene können Sie unter anderem ermitteln, ob eine Ausnahme während des Vorgangs aufgetreten ist, und diese ordnungsgemäß behandeln. dabei wird eine benutzerfreundliche, informative Fehlermeldung auf dem Bildschirm angezeigt, anstelle der standardmäßigen ASP.net Ausnahme Seite.</span><span class="sxs-lookup"><span data-stu-id="2424f-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="2424f-120">Um die Arbeit mit diesen Ereignissen auf postebene zu veranschaulichen, erstellen wir eine Seite, auf der die Produkte in einer bearbeitbaren GridView aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="2424f-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="2424f-121">Wenn beim Aktualisieren eines Produkts eine Ausnahme ausgelöst wird, wird auf der ASP.NET-Seite eine kurze Meldung oberhalb der GridView angezeigt, in der das Problem aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="2424f-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="2424f-122">Fangen wir an!</span><span class="sxs-lookup"><span data-stu-id="2424f-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="2424f-123">Schritt 1: Erstellen einer bearbeitbaren GridView für Produkte</span><span class="sxs-lookup"><span data-stu-id="2424f-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="2424f-124">Im vorherigen Tutorial haben wir eine bearbeitbare GridView mit nur zwei Feldern erstellt, `ProductName` und `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="2424f-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="2424f-125">Dies erforderte das Erstellen einer zusätzlichen Überladung für die `UpdateProduct`-Methode der `ProductsBLL` Klasse, von der nur drei Eingabeparameter (der Name, der Einheitspreis und die ID) des Produkts im Gegensatz zu einem Parameter für jedes Produktfeld akzeptiert wurden.</span><span class="sxs-lookup"><span data-stu-id="2424f-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="2424f-126">In diesem Tutorial wird dieses Verfahren wiederholt, indem eine bearbeitbare GridView erstellt wird, in der der Name, die Menge pro Einheit, der Einheitspreis und die Einheiten im Lager angezeigt werden, aber nur der Name, der Einheitspreis und die Einheiten in Aktien bearbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="2424f-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="2424f-127">Um dieses Szenario zu ermöglichen, benötigen wir eine weitere Überladung der `UpdateProduct`-Methode, die vier Parameter akzeptiert: den Namen des Produkts, den Einzelpreis, die Einheiten in Aktien und die ID.</span><span class="sxs-lookup"><span data-stu-id="2424f-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="2424f-128">Fügen Sie der `ProductsBLL`-Klasse die folgende Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="2424f-128">Add the following method to the `ProductsBLL` class:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample1.vb)]

<span data-ttu-id="2424f-129">Nachdem diese Methode abgeschlossen ist, können Sie die ASP.NET-Seite erstellen, die die Bearbeitung dieser vier speziellen Produktfelder ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="2424f-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="2424f-130">Öffnen Sie die Seite `ErrorHandling.aspx` im Ordner `EditInsertDelete`, und fügen Sie der Seite über den Designer eine GridView hinzu.</span><span class="sxs-lookup"><span data-stu-id="2424f-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="2424f-131">Binden Sie das GridView-Objekt an eine neue ObjectDataSource, und ordnen Sie die `Select()`-Methode der `GetProducts()`-Methode der `ProductsBLL`-Klasse und der `Update()`-Methode der soeben erstellten `UpdateProduct` Überladung zu.</span><span class="sxs-lookup"><span data-stu-id="2424f-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>

<span data-ttu-id="2424f-132">[![die UpdateProduct-Methoden Überladung verwenden, die vier Eingabeparameter akzeptiert.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="2424f-133">**Abbildung 1**: Verwenden der `UpdateProduct`-Methoden Überladung, die vier Eingabeparameter akzeptiert ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span></span>

<span data-ttu-id="2424f-134">Dadurch wird eine ObjectDataSource mit einer `UpdateParameters` Auflistung mit vier Parametern und einer GridView mit einem Feld für jedes der Produktfelder erstellt.</span><span class="sxs-lookup"><span data-stu-id="2424f-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="2424f-135">Das deklarative Markup von ObjectDataSource weist die `OldValuesParameterFormatString`-Eigenschaft dem Wert `original_{0}`zu. Dies führt zu einer Ausnahme, da die BLL-Klasse nicht erwartet, dass ein Eingabeparameter mit dem Namen `original_productID` übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="2424f-136">Vergessen Sie nicht, diese Einstellung vollständig aus der deklarativen Syntax zu entfernen (oder legen Sie Sie auf den Standardwert fest, `{0}`).</span><span class="sxs-lookup"><span data-stu-id="2424f-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="2424f-137">Im nächsten Schritt wird die GridView-Ansicht heruntergefahren, um nur die `ProductName`, `QuantityPerUnit`, `UnitPrice`und `UnitsInStock` boundfields einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="2424f-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="2424f-138">Sie können auch beliebige Formatierungen auf Feldebene anwenden, die Sie als notwendig betrachten (z. b. das Ändern der `HeaderText` Eigenschaften).</span><span class="sxs-lookup"><span data-stu-id="2424f-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="2424f-139">Im vorherigen Tutorial haben wir uns mit dem Formatieren des `UnitPrice` BoundField als Währung im schreibgeschützten Modus und im Bearbeitungsmodus beschäftigt.</span><span class="sxs-lookup"><span data-stu-id="2424f-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="2424f-140">Gehen wir hier wie folgt vor.</span><span class="sxs-lookup"><span data-stu-id="2424f-140">Let's do the same here.</span></span> <span data-ttu-id="2424f-141">Beachten Sie, dass dies erforderlich war, um die `DataFormatString`-Eigenschaft von BoundField auf `{0:c}`, dessen `HtmlEncode`-Eigenschaft auf `false`und die `ApplyFormatInEditMode` `true`, wie in Abbildung 2 dargestellt, festzulegen.</span><span class="sxs-lookup"><span data-stu-id="2424f-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>

<span data-ttu-id="2424f-142">[!["UnitPrice BoundField" so konfigurieren, dass es als Währung angezeigt wird.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="2424f-143">**Abbildung 2**: Konfigurieren des `UnitPrice` BoundField für die Anzeige als Währung ([Klicken Sie, um das Bild in voller Größe](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png)anzuzeigen)</span><span class="sxs-lookup"><span data-stu-id="2424f-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span></span>

<span data-ttu-id="2424f-144">Wenn Sie die `UnitPrice` als Währung in der Bearbeitungs Schnittstelle formatieren, müssen Sie einen Ereignishandler für das `RowUpdating` Ereignis der GridView erstellen, das die Währungs formatierte Zeichenfolge in einen `decimal` Wert analysiert.</span><span class="sxs-lookup"><span data-stu-id="2424f-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="2424f-145">Beachten Sie, dass der `RowUpdating` Ereignishandler aus dem letzten Tutorial ebenfalls geprüft hat, um sicherzustellen, dass der Benutzer einen `UnitPrice` Wert bereitgestellt hat.</span><span class="sxs-lookup"><span data-stu-id="2424f-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="2424f-146">In diesem Tutorial ermöglicht es dem Benutzer jedoch, den Preis zu weglassen.</span><span class="sxs-lookup"><span data-stu-id="2424f-146">However, for this tutorial let's allow the user to omit the price.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample2.vb)]

<span data-ttu-id="2424f-147">Unsere GridView enthält eine `QuantityPerUnit` BoundField, aber dieses BoundField sollte nur zu Anzeige Zwecken verwendet werden und sollte nicht vom Benutzer bearbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="2424f-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="2424f-148">Um dies anzuordnen, legen Sie einfach die `ReadOnly` Eigenschaft boundfields auf `true`fest.</span><span class="sxs-lookup"><span data-stu-id="2424f-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>

<span data-ttu-id="2424f-149">[![das "QuantityPerUnit BoundField" schreibgeschützt machen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="2424f-150">**Abbildung 3**: Festlegen des `QuantityPerUnit` BoundField als schreibgeschützt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span></span>

<span data-ttu-id="2424f-151">Aktivieren Sie abschließend das Kontrollkästchen Bearbeitung aktivieren im Smarttags von GridView.</span><span class="sxs-lookup"><span data-stu-id="2424f-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="2424f-152">Nachdem Sie diese Schritte ausgeführt haben, sollte der Designer der `ErrorHandling.aspx` Seite in etwa wie in Abbildung 4 aussehen.</span><span class="sxs-lookup"><span data-stu-id="2424f-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>

<span data-ttu-id="2424f-153">[![alle außer den benötigten boundfields entfernen, und aktivieren Sie das Kontrollkästchen "Bearbeiten aktivieren".](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="2424f-154">**Abbildung 4**: Entfernen aller außer der benötigten boundfields-Datei und Aktivieren des Kontrollkästchens "Bearbeiten aktivieren" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span></span>

<span data-ttu-id="2424f-155">An dieser Stelle wird eine Liste aller Felder `ProductName`, `QuantityPerUnit`, `UnitPrice`und `UnitsInStock` der Produkte angezeigt. Es können jedoch nur die Felder `ProductName`, `UnitPrice`und `UnitsInStock` bearbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="2424f-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>

<span data-ttu-id="2424f-156">[![Benutzer können jetzt ganz einfach die Namen, Preise und Einheiten von Produkten in Aktien Feldern bearbeiten.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="2424f-157">**Abbildung 5**: Benutzer können jetzt ganz einfach die Namen, Preise und Einheiten der Produkte in Aktien Feldern bearbeiten ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span></span>

## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="2424f-158">Schritt 2: ordnungsgemäße Behandlung von Ausnahmen auf dal-Ebene</span><span class="sxs-lookup"><span data-stu-id="2424f-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="2424f-159">Während unsere bearbeitbare GridView wunderbar funktioniert, wenn Benutzer zulässige Werte für den Namen, den Preis und die Einheiten der bearbeiteten Produkte eingeben, führt die Eingabe von ungültigen Werten zu einer Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="2424f-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="2424f-160">Wenn Sie z. b. den `ProductName` Wert weglassen, wird eine " [nonullzuzudexception](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) " ausgelöst, da die Eigenschaft "`ProductName`" in der `ProductsRow` Klasse auf `false`festgelegt `AllowDBNull` ist. Wenn die Datenbank nicht herunter ist, wird vom TableAdapter eine `SqlException` ausgelöst, wenn versucht wird, eine Verbindung mit der Datenbank herzustellen.</span><span class="sxs-lookup"><span data-stu-id="2424f-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProductsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="2424f-161">Ohne eine Aktion Blasen diese Ausnahmen von der Datenzugriffs Ebene bis zur Geschäftslogik Schicht, dann von der ASP.NET Seite und schließlich von der ASP.NET-Laufzeit.</span><span class="sxs-lookup"><span data-stu-id="2424f-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="2424f-162">Abhängig davon, wie Ihre Webanwendung konfiguriert ist und ob Sie die Anwendung von `localhost`aus besuchen, kann eine nicht behandelte Ausnahme zu einer generischen Server Fehlerseite, einem ausführlichen Fehlerbericht oder einer benutzerfreundlichen Webseite führen.</span><span class="sxs-lookup"><span data-stu-id="2424f-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="2424f-163">Weitere Informationen dazu, wie die ASP.NET-Laufzeit auf eine nicht abgefangene Ausnahme antwortet, finden Sie unter [Fehlerbehandlung für Webanwendungen in ASP.net](http://www.15seconds.com/issue/030102.htm) und im [customErrors-Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) .</span><span class="sxs-lookup"><span data-stu-id="2424f-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="2424f-164">Abbildung 6 zeigt den Bildschirm, der beim Versuch aufgetreten ist, ein Produkt zu aktualisieren, ohne den `ProductName` Wert anzugeben.</span><span class="sxs-lookup"><span data-stu-id="2424f-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="2424f-165">Dies ist der standardmäßige ausführliche Fehlerbericht, der angezeigt wird, wenn `localhost`angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>

<span data-ttu-id="2424f-166">[![Weglassen des Produkt namens werden Ausnahme Details angezeigt.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="2424f-167">**Abbildung 6**: das Weglassen des Produkt namens zeigt Ausnahme Details an ([Klicken Sie, um das Bild in voller Größe](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png)anzuzeigen)</span><span class="sxs-lookup"><span data-stu-id="2424f-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span></span>

<span data-ttu-id="2424f-168">Obwohl solche Ausnahme Details beim Testen einer Anwendung hilfreich sind, ist die Darstellung eines Endbenutzers mit einem solchen Bildschirm in einer Ausnahme kleiner als ideal.</span><span class="sxs-lookup"><span data-stu-id="2424f-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="2424f-169">Ein Endbenutzer weiß wahrscheinlich nicht, was ein `NoNullAllowedException` ist oder warum er verursacht wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="2424f-170">Ein besserer Ansatz besteht darin, dem Benutzer eine benutzerfreundliche Meldung zu präsentieren, in der erläutert wird, dass beim Versuch, das Produkt zu aktualisieren, Probleme aufgetreten sind.</span><span class="sxs-lookup"><span data-stu-id="2424f-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="2424f-171">Wenn beim Ausführen des Vorgangs eine Ausnahme auftritt, stellen die Ereignisse auf der Post-Ebene in der ObjectDataSource und im datenweb-Steuerelement ein Mittel bereit, um Sie zu erkennen und die Ausnahme von der Blasen Suche zur ASP.NET-Laufzeit abzubrechen.</span><span class="sxs-lookup"><span data-stu-id="2424f-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="2424f-172">In unserem Beispiel erstellen wir einen Ereignishandler für das `RowUpdated` Ereignis von GridView, das bestimmt, ob eine Ausnahme ausgelöst wurde, und zeigt, wenn dies der Fall ist, die Ausnahme Details in einem Label-websteuer Element an.</span><span class="sxs-lookup"><span data-stu-id="2424f-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="2424f-173">Fügen Sie zunächst der Seite ASP.net eine Bezeichnung hinzu, und legen Sie die `ID`-Eigenschaft auf `ExceptionDetails` und deren `Text`-Eigenschaft fest.</span><span class="sxs-lookup"><span data-stu-id="2424f-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="2424f-174">Um das Auge des Benutzers auf diese Meldung zu zeichnen, legen Sie die `CssClass`-Eigenschaft auf `Warning`fest. dabei handelt es sich um eine CSS-Klasse, die der `Styles.css`-Datei im vorherigen Tutorial hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="2424f-175">Beachten Sie, dass diese CSS-Klasse bewirkt, dass der Text der Bezeichnung in einer roten, kursiv, Fett und extra großen Schriftart angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>

<span data-ttu-id="2424f-176">[![der Seite ein Label-websteuer Element hinzufügen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="2424f-177">**Abbildung 7**: Hinzufügen eines Label-websteuer Elements zur Seite ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span></span>

<span data-ttu-id="2424f-178">Da dieses Bezeichnungs-websteuer Element nur unmittelbar nach dem Auftreten einer Ausnahme sichtbar sein soll, legen Sie die `Visible`-Eigenschaft im `Page_Load`-Ereignishandler auf false fest:</span><span class="sxs-lookup"><span data-stu-id="2424f-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample3.vb)]

<span data-ttu-id="2424f-179">Mit diesem Code wird auf der ersten Seite und nachfolgenden Postbacks das `ExceptionDetails`-Steuerelement seine `Visible`-Eigenschaft auf `false`festgelegt.</span><span class="sxs-lookup"><span data-stu-id="2424f-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="2424f-180">Bei einer Ausnahme auf dal-oder BLL-Ebene, die im `RowUpdated` Ereignishandler von GridView erkannt werden kann, wird die `Visible`-Eigenschaft des `ExceptionDetails` Steuer Elements auf true festgelegt.</span><span class="sxs-lookup"><span data-stu-id="2424f-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="2424f-181">Da websteuer Element-Ereignishandler nach dem `Page_Load`-Ereignishandler im Seiten Lebenszyklus auftreten, wird die Bezeichnung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="2424f-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="2424f-182">Beim nächsten Postback setzt der `Page_Load` Ereignishandler die `Visible`-Eigenschaft jedoch wieder auf `false`zurück, wobei Sie erneut aus der Ansicht ausgeblendet wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="2424f-183">Alternativ dazu können Sie die Notwendigkeit entfernen, die `Visible`-Eigenschaft des `ExceptionDetails`-Steuer Elements in `Page_Load` festzulegen, indem Sie die `Visible`-Eigenschaft `false` in der deklarativen Syntax zuweisen und den Ansichts Zustand (Festlegen der `EnableViewState`-Eigenschaft auf `false`) deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="2424f-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="2424f-184">Dieser Alternative Ansatz wird in einem zukünftigen Tutorial verwendet.</span><span class="sxs-lookup"><span data-stu-id="2424f-184">We'll use this alternative approach in a future tutorial.</span></span>

<span data-ttu-id="2424f-185">Wenn das Label-Steuerelement hinzugefügt wurde, ist der nächste Schritt das Erstellen des Ereignis Handlers für das `RowUpdated` Ereignis der GridView.</span><span class="sxs-lookup"><span data-stu-id="2424f-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="2424f-186">Wählen Sie im Designer die GridView aus, wechseln Sie zum Eigenschaftenfenster, und klicken Sie auf das Blitz Symbol, um die Ereignisse der GridView aufzulisten.</span><span class="sxs-lookup"><span data-stu-id="2424f-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="2424f-187">Für das `RowUpdating` Ereignis der GridView sollte bereits ein Eintrag vorhanden sein, da wir einen Ereignishandler für dieses Ereignis zuvor in diesem Tutorial erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="2424f-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="2424f-188">Erstellen Sie auch einen Ereignishandler für das `RowUpdated` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="2424f-188">Create an event handler for the `RowUpdated` event as well.</span></span>

![Erstellen eines Ereignis Handlers für das rowaktualisierte-Ereignis von GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image22.png)

<span data-ttu-id="2424f-190">**Abbildung 8**: Erstellen eines Ereignis Handlers für das `RowUpdated` Ereignis der GridView</span><span class="sxs-lookup"><span data-stu-id="2424f-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>

> [!NOTE]
> <span data-ttu-id="2424f-191">Sie können den Ereignishandler auch über die Dropdown Listen am Anfang der Code Behind-Klassendatei erstellen.</span><span class="sxs-lookup"><span data-stu-id="2424f-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="2424f-192">Wählen Sie in der Dropdown Liste auf der linken Seite das GridView-Ereignis aus, und klicken Sie auf der rechten Seite `RowUpdated` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="2424f-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>

<span data-ttu-id="2424f-193">Wenn Sie diesen Ereignishandler erstellen, wird der Code Behind-Klasse der ASP.NET-Seite der folgende Code hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="2424f-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample4.vb)]

<span data-ttu-id="2424f-194">Der zweite Eingabeparameter dieses Ereignis Handlers ist ein Objekt vom Typ " [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx)", das drei Eigenschaften hat, die für die Behandlung von Ausnahmen von Interesse sind:</span><span class="sxs-lookup"><span data-stu-id="2424f-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="2424f-195">`Exception` einen Verweis auf die ausgelöste Ausnahme ab. Wenn keine Ausnahme ausgelöst wurde, hat diese Eigenschaft den Wert `null`</span><span class="sxs-lookup"><span data-stu-id="2424f-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="2424f-196">`ExceptionHandled` einen booleschen Wert ab, der angibt, ob die Ausnahme im `RowUpdated`-Ereignishandler behandelt wurde. Wenn `false` (die Standardeinstellung), wird die Ausnahme erneut ausgelöst, die bis zur ASP.NET-Laufzeit durchläuft.</span><span class="sxs-lookup"><span data-stu-id="2424f-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="2424f-197">`KeepInEditMode`, wenn `true` der bearbeiteten GridView-Zeile im Bearbeitungsmodus verbleibt. Wenn `false` (Standardeinstellung), wird die GridView-Zeile wieder in den schreibgeschützten Modus versetzt.</span><span class="sxs-lookup"><span data-stu-id="2424f-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="2424f-198">Der Code sollte dann überprüfen, ob `Exception` nicht `null`ist, was bedeutet, dass bei der Ausführung des Vorgangs eine Ausnahme ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="2424f-199">Wenn dies der Fall ist, möchten wir Folgendes tun:</span><span class="sxs-lookup"><span data-stu-id="2424f-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="2424f-200">Anzeigen einer benutzerfreundlichen Meldung in der `ExceptionDetails` Bezeichnung</span><span class="sxs-lookup"><span data-stu-id="2424f-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="2424f-201">Geben Sie an, dass die Ausnahme behandelt wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="2424f-202">GridView-Zeile im Bearbeitungsmodus belassen</span><span class="sxs-lookup"><span data-stu-id="2424f-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="2424f-203">Mit dem folgenden Code werden die folgenden Ziele erreicht:</span><span class="sxs-lookup"><span data-stu-id="2424f-203">This following code accomplishes these objectives:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample5.vb)]

<span data-ttu-id="2424f-204">Der Ereignishandler beginnt mit der Überprüfung, ob `e.Exception` `null`ist.</span><span class="sxs-lookup"><span data-stu-id="2424f-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="2424f-205">Wenn dies nicht der Fall ist, wird die `Visible`-Eigenschaft der `ExceptionDetails` Bezeichnung auf `true` und deren `Text`-Eigenschaft auf "Es gab ein Problem beim Aktualisieren des Produkts" festgelegt.</span><span class="sxs-lookup"><span data-stu-id="2424f-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="2424f-206">Die Details der eigentlichen Ausnahme, die ausgelöst wurde, befinden sich in der `InnerException`-Eigenschaft des `e.Exception` Objekts.</span><span class="sxs-lookup"><span data-stu-id="2424f-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="2424f-207">Diese innere Ausnahme wird untersucht, und wenn es sich um einen bestimmten Typ handelt, wird eine zusätzliche, hilfreiche Nachricht an die `Text`-Eigenschaft der `ExceptionDetails` Bezeichnung angehängt.</span><span class="sxs-lookup"><span data-stu-id="2424f-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="2424f-208">Zum Schluss sind die Eigenschaften `ExceptionHandled` und `KeepInEditMode` beide auf `true`festgelegt.</span><span class="sxs-lookup"><span data-stu-id="2424f-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="2424f-209">Abbildung 9 zeigt einen Screenshot dieser Seite, wenn der Name des Produkts weggelassen wird. Abbildung 10 zeigt die Ergebnisse bei der Eingabe eines ungültigen `UnitPrice` Werts (-50).</span><span class="sxs-lookup"><span data-stu-id="2424f-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>

<span data-ttu-id="2424f-210">[![ProductName BoundField muss einen Wert enthalten.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span></span>

<span data-ttu-id="2424f-211">**Abbildung 9**: das `ProductName` BoundField muss einen Wert enthalten ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span></span>

<span data-ttu-id="2424f-212">[![negative UnitPrice-Werte sind nicht zulässig.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span></span>

<span data-ttu-id="2424f-213">**Abbildung 10**: negative `UnitPrice` Werte sind nicht zulässig ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="2424f-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span></span>

<span data-ttu-id="2424f-214">Wenn Sie die `e.ExceptionHandled`-Eigenschaft auf `true`festlegen, hat der `RowUpdated`-Ereignishandler angegeben, dass die Ausnahme behandelt wurde.</span><span class="sxs-lookup"><span data-stu-id="2424f-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="2424f-215">Daher wird die Ausnahme nicht bis zur ASP.NET-Laufzeit weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="2424f-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="2424f-216">Die Abbildungen 9 und 10 veranschaulichen eine ordnungsgemäße Methode, um Ausnahmen zu behandeln, die aufgrund ungültiger Benutzereingaben ausgelöst wurden.</span><span class="sxs-lookup"><span data-stu-id="2424f-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="2424f-217">Im Idealfall erreichen solche ungültige Eingaben jedoch nie zuerst die Geschäftslogik Schicht, da die ASP.NET-Seite sicherstellen sollte, dass die Eingaben des Benutzers gültig sind, bevor die `UpdateProduct` Methode der `ProductsBLL` Klasse aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="2424f-218">Im nächsten Tutorial erfahren Sie, wie Sie den Bearbeitungs-und einfügeschnittstellen Validierungs Steuerelemente hinzufügen, um sicherzustellen, dass die an die Geschäftslogik Schicht übermittelten Daten den Geschäftsregeln entsprechen.</span><span class="sxs-lookup"><span data-stu-id="2424f-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="2424f-219">Die Validierungs Steuerelemente verhindern nicht nur den Aufruf der `UpdateProduct` Methode, bis die vom Benutzer bereitgestellten Daten gültig sind, sondern bieten auch eine informative Benutzer Darstellung, um Probleme mit der Dateneingabe zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="2424f-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>

## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="2424f-220">Schritt 3: ordnungsgemäße Behandlung von Ausnahmen auf BLL-Ebene</span><span class="sxs-lookup"><span data-stu-id="2424f-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="2424f-221">Beim Einfügen, aktualisieren oder Löschen von Daten kann die Datenzugriffs Ebene bei einem datenbezogenen Fehler eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="2424f-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="2424f-222">Möglicherweise ist die Datenbank offline, für eine erforderliche Datenbanktabellen Spalte wurde kein Wert angegeben, oder eine Einschränkung auf Tabellenebene wurde verletzt.</span><span class="sxs-lookup"><span data-stu-id="2424f-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="2424f-223">Zusätzlich zu streng datenbezogenen Ausnahmen kann die Geschäftslogik Schicht Ausnahmen verwenden, um anzugeben, wann Geschäftsregeln verletzt wurden.</span><span class="sxs-lookup"><span data-stu-id="2424f-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="2424f-224">Im Lernprogramm zum [Erstellen einer Geschäftslogik Schicht](../introduction/creating-a-business-logic-layer-vb.md) haben wir z. b. eine Geschäftsregel Überprüfung zur ursprünglichen `UpdateProduct` Überladung hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="2424f-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="2424f-225">Insbesondere, wenn der Benutzer ein Produkt als nicht mehr unterstützt markiert hat, ist es erforderlich, dass das Produkt nicht das einzige vom Lieferanten bereitgestellte Produkt ist.</span><span class="sxs-lookup"><span data-stu-id="2424f-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="2424f-226">Wenn diese Bedingung verletzt wurde, wurde ein `ApplicationException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="2424f-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="2424f-227">Fügen Sie für die in diesem Tutorial erstellte `UpdateProduct` Überladung eine Geschäftsregel hinzu, die verhindert, dass das `UnitPrice` Feld auf einen neuen Wert festgelegt wird, der mehr als doppelt so groß ist wie der ursprüngliche `UnitPrice` Wert.</span><span class="sxs-lookup"><span data-stu-id="2424f-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="2424f-228">Um dies zu erreichen, passen Sie die `UpdateProduct` Überladung so an, dass diese Überprüfung durchgeführt wird, und löst eine `ApplicationException`, wenn die Regel verletzt wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="2424f-229">Die aktualisierte Methode folgt:</span><span class="sxs-lookup"><span data-stu-id="2424f-229">The updated method follows:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample6.vb)]

<span data-ttu-id="2424f-230">Durch diese Änderung führt jedes Preis Update, das mehr als doppelt so hoch ist wie der vorhandene Preis, dazu, dass eine `ApplicationException` ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="2424f-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="2424f-231">Genau wie bei der von der dal ausgelöste Ausnahme kann diese BLL-ausgelöste `ApplicationException` erkannt und im `RowUpdated` Ereignishandler der GridView behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="2424f-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="2424f-232">Tatsächlich erkennt der Code des `RowUpdated` Ereignis Handlers diese Ausnahme ordnungsgemäß und zeigt den `Message` Eigenschafts Wert des `ApplicationException`an.</span><span class="sxs-lookup"><span data-stu-id="2424f-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="2424f-233">Abbildung 11 zeigt einen Screenshot, wenn ein Benutzer versucht, den Preis von Chai auf $50,00 zu aktualisieren. Dies ist größer als der aktuelle Preis von $19,95.</span><span class="sxs-lookup"><span data-stu-id="2424f-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>

<span data-ttu-id="2424f-234">[![die Geschäftsregeln Preissteigerungen nicht zulassen, die mehr als den doppelten Preis eines Produkts überschreiten.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="2424f-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span></span>

<span data-ttu-id="2424f-235">**Abbildung 11**: die Geschäftsregeln lassen Preissteigerungen nicht zu, die mehr als den doppelten Preis eines Produkts überschreiten ([Klicken Sie, um das Bild in voller Größe anzuzeigen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png)).</span><span class="sxs-lookup"><span data-stu-id="2424f-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span></span>

> [!NOTE]
> <span data-ttu-id="2424f-236">Im Idealfall würden unsere Geschäftslogik Regeln aus den `UpdateProduct` Methoden Überladungen und in eine gängige Methode umgestaltet werden.</span><span class="sxs-lookup"><span data-stu-id="2424f-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="2424f-237">Dies bleibt für den Reader eine Übung.</span><span class="sxs-lookup"><span data-stu-id="2424f-237">This is left as an exercise for the reader.</span></span>

## <a name="summary"></a><span data-ttu-id="2424f-238">Summary</span><span class="sxs-lookup"><span data-stu-id="2424f-238">Summary</span></span>

<span data-ttu-id="2424f-239">Beim Einfügen, aktualisieren und Löschen von Vorgängen lösen sowohl das datenweb Steuerelement als auch die ObjectDataSource Ereignisse vor und nach der Ebene aus, die den eigentlichen Vorgang beenden.</span><span class="sxs-lookup"><span data-stu-id="2424f-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="2424f-240">Wie in diesem Tutorial und der vorhergehenden erläutert wurde, wird beim Arbeiten mit einem bearbeitbaren GridView-Ereignis das `RowUpdating` Ereignis von GridView ausgelöst, gefolgt vom `Updating`-Ereignis von ObjectDataSource. zu diesem Zeitpunkt wird der Update-Befehl an das zugrunde liegende Objekt von ObjectDataSource vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="2424f-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="2424f-241">Nachdem der Vorgang abgeschlossen wurde, wird das `Updated` Ereignis von ObjectDataSource ausgelöst, gefolgt vom `RowUpdated`-Ereignis der GridView.</span><span class="sxs-lookup"><span data-stu-id="2424f-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="2424f-242">Wir können Ereignishandler für die Ereignisse vor der Ebene erstellen, um die Eingabeparameter oder die Ereignisse auf der Post-Ebene anzupassen, um die Ergebnisse des Vorgangs zu überprüfen und auf diese zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="2424f-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="2424f-243">Ereignishandler auf Post-Ebene werden häufig verwendet, um zu erkennen, ob während des Vorgangs eine Ausnahme aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="2424f-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="2424f-244">Im Falle einer Ausnahme können diese Ereignishandler auf der Post-Ebene optional die Ausnahme selbst verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="2424f-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="2424f-245">In diesem Tutorial haben Sie erfahren, wie Sie eine solche Ausnahme behandeln, indem Sie eine benutzerfreundliche Fehlermeldung anzeigen.</span><span class="sxs-lookup"><span data-stu-id="2424f-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="2424f-246">Im nächsten Tutorial erfahren Sie, wie Sie die Wahrscheinlichkeit von Ausnahmen verringern, die durch Probleme mit der Datenformatierung entstehen (z. b. die Eingabe eines negativen `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="2424f-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="2424f-247">Insbesondere wird erläutert, wie Sie den Bearbeitungs-und einfügeschnittstellen Validierungs Steuerelemente hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="2424f-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="2424f-248">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="2424f-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="2424f-249">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="2424f-249">About the Author</span></span>

<span data-ttu-id="2424f-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="2424f-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2424f-251">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="2424f-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2424f-252">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="2424f-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2424f-253">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2424f-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="2424f-254">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="2424f-254">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2424f-255">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="2424f-255">Special Thanks To</span></span>

<span data-ttu-id="2424f-256">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="2424f-256">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2424f-257">Lead Reviewer für dieses Tutorial war Liz shulok.</span><span class="sxs-lookup"><span data-stu-id="2424f-257">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="2424f-258">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="2424f-258">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2424f-259">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2424f-259">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2424f-260">[Zurück](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
> [Weiter](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2424f-260">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span></span>
