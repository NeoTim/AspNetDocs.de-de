---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Erstellen einer Geschäftslogik Schicht (C#) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial erfahren Sie, wie Sie Ihre Geschäftsregeln in eine Geschäftslogik Schicht (Business Logic Layer, BLL) zentralisieren, die als Vermittler für den Datenaustausch zwischen t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: df96f3e7422a0537bf1b003a33fe8d71a671ac33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78490401"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="2f326-103">Erstellen einer Geschäftslogikebene (C#)</span><span class="sxs-lookup"><span data-stu-id="2f326-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="2f326-104">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2f326-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2f326-105">[Beispiel-app herunterladen](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) oder [PDF herunterladen](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2f326-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="2f326-106">In diesem Tutorial erfahren Sie, wie Sie Ihre Geschäftsregeln in eine Geschäftslogik Schicht (Business Logic Layer, BLL) zentralisieren, die als Vermittler für den Datenaustausch zwischen der Darstellungs Schicht und der dal fungiert.</span><span class="sxs-lookup"><span data-stu-id="2f326-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>

## <a name="introduction"></a><span data-ttu-id="2f326-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="2f326-107">Introduction</span></span>

<span data-ttu-id="2f326-108">Die im [ersten Tutorial](creating-a-data-access-layer-cs.md) erstellte Datenzugriffs Schicht (Data Access Layer, DAL) trennt die Datenzugriffs Logik von der Präsentationslogik.</span><span class="sxs-lookup"><span data-stu-id="2f326-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="2f326-109">Obwohl die DAL die Datenzugriffs Details von der Darstellungs Schicht ordnungsgemäß trennt, erzwingt Sie keine Geschäftsregeln, die angewendet werden können.</span><span class="sxs-lookup"><span data-stu-id="2f326-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="2f326-110">Beispielsweise möchten wir für die Anwendung möglicherweise nicht zulassen, dass die `CategoryID`-oder `SupplierID` Felder der `Products` Tabelle geändert werden, wenn das `Discontinued` Feld auf 1 festgelegt ist, oder es empfiehlt sich, Regeln für die Rangfolge zu erzwingen. Dies verbietet Situationen, in denen ein Mitarbeiter von einem Mitarbeiter verwaltet wird, der nach dem Mitarbeiter eingestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="2f326-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="2f326-111">Ein weiteres häufiges Szenario ist die Autorisierung, bei der möglicherweise nur Benutzer in einer bestimmten Rolle Produkte löschen oder den `UnitPrice` Wert ändern können.</span><span class="sxs-lookup"><span data-stu-id="2f326-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="2f326-112">In diesem Tutorial erfahren Sie, wie Sie diese Geschäftsregeln in eine Geschäftslogik Schicht (Business Logic Layer, BLL) zentralisieren, die als Vermittler für den Datenaustausch zwischen der Darstellungs Schicht und der dal fungiert.</span><span class="sxs-lookup"><span data-stu-id="2f326-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="2f326-113">In einer realen Anwendung sollte die BLL als separates Klassen Bibliotheksprojekt implementiert werden. für diese Tutorials implementieren wir jedoch die BLL als eine Reihe von Klassen in unserem `App_Code` Ordner, um die Projektstruktur zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="2f326-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="2f326-114">Abbildung 1 zeigt die architektonischen Beziehungen zwischen der Darstellungs Schicht, der BLL und der DAL.</span><span class="sxs-lookup"><span data-stu-id="2f326-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>

![Die BLL trennt die Präsentationsebene von der Datenzugriffs Ebene und erzwingt Geschäftsregeln.](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="2f326-116">**Abbildung 1**: die BLL trennt die Präsentationsebene von der Datenzugriffs Ebene und legt Geschäftsregeln fest.</span><span class="sxs-lookup"><span data-stu-id="2f326-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="2f326-117">Schritt 1: Erstellen der BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="2f326-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="2f326-118">Unsere BLL besteht aus vier Klassen, eine für jeden TableAdapter in der DAL. Jede dieser BLL-Klassen verfügt über Methoden zum Abrufen, einfügen, aktualisieren und Löschen von dem jeweiligen TableAdapter in der dal und zum Anwenden der entsprechenden Geschäftsregeln.</span><span class="sxs-lookup"><span data-stu-id="2f326-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="2f326-119">Um die DAL-und BLL-bezogenen Klassen genauer voneinander zu trennen, erstellen wir zwei Unterordner im Ordner "`App_Code`", `DAL` und `BLL`.</span><span class="sxs-lookup"><span data-stu-id="2f326-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="2f326-120">Klicken Sie einfach mit der rechten Maustaste auf den Ordner `App_Code` im Projektmappen-Explorer, und wählen Sie neuer Ordner aus.</span><span class="sxs-lookup"><span data-stu-id="2f326-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="2f326-121">Nachdem Sie diese beiden Ordner erstellt haben, verschieben Sie das typisierte DataSet, das Sie im ersten Tutorial erstellt haben, in den `DAL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="2f326-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="2f326-122">Erstellen Sie als nächstes die vier Dateien der BLL-Klasse im `BLL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="2f326-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="2f326-123">Klicken Sie hierzu mit der rechten Maustaste auf den Unterordner `BLL`, wählen Sie neues Element hinzufügen aus, und wählen Sie die Klassen Vorlage aus.</span><span class="sxs-lookup"><span data-stu-id="2f326-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="2f326-124">Benennen Sie die vier Klassen `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`und `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="2f326-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>

![Fügen Sie dem Ordner "App_Code" vier neue Klassen hinzu.](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="2f326-126">**Abbildung 2**: Hinzufügen von vier neuen Klassen zum Ordner "`App_Code`"</span><span class="sxs-lookup"><span data-stu-id="2f326-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>

<span data-ttu-id="2f326-127">Als Nächstes fügen wir jeder Klasse Methoden hinzu, um die Methoden, die für die TableAdapters definiert sind, aus dem ersten Tutorial zu wrappen.</span><span class="sxs-lookup"><span data-stu-id="2f326-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="2f326-128">Vorerst werden diese Methoden einfach direkt in der dal aufgerufen. Wir werden später zurückkehren, um die erforderliche Geschäftslogik hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="2f326-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="2f326-129">Wenn Sie Visual Studio Standard Edition oder höher verwenden (d. h. Sie verwenden *nicht* Visual Web Developer), können Sie die Klassen optional mithilfe der [Klassen-Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp)visuell entwerfen.</span><span class="sxs-lookup"><span data-stu-id="2f326-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="2f326-130">Weitere Informationen zu diesem neuen Feature in Visual Studio finden Sie im [Klassen-Designer-Blog](https://blogs.msdn.com/classdesigner/default.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2f326-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>

<span data-ttu-id="2f326-131">Für die `ProductsBLL`-Klasse müssen wir insgesamt sieben Methoden hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="2f326-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="2f326-132">`GetProducts()` gibt alle Produkte zurück.</span><span class="sxs-lookup"><span data-stu-id="2f326-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="2f326-133">`GetProductByProductID(productID)` gibt das Produkt mit der angegebenen Produkt-ID zurück.</span><span class="sxs-lookup"><span data-stu-id="2f326-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="2f326-134">`GetProductsByCategoryID(categoryID)` gibt alle Produkte aus der angegebenen Kategorie zurück.</span><span class="sxs-lookup"><span data-stu-id="2f326-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="2f326-135">`GetProductsBySupplier(supplierID)` gibt alle Produkte des angegebenen Lieferanten zurück.</span><span class="sxs-lookup"><span data-stu-id="2f326-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="2f326-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` fügt ein neues Produkt mithilfe der von Ihnen über gebenden Werte in die Datenbank ein. Gibt den `ProductID` Wert des neu eingefügten Datensatzes zurück.</span><span class="sxs-lookup"><span data-stu-id="2f326-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="2f326-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` aktualisiert ein vorhandenes Produkt in der Datenbank mit den bestandenen Werten. gibt `true` zurück, wenn genau eine Zeile aktualisiert wurde `false` andernfalls.</span><span class="sxs-lookup"><span data-stu-id="2f326-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="2f326-138">`DeleteProduct(productID)` löscht das angegebene Produkt aus der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="2f326-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="2f326-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="2f326-139">ProductsBLL.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="2f326-140">Die Methoden, die einfach Daten `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`und `GetProductBySuppliersID` zurückgeben, sind recht unkompliziert, da Sie einfach die DAL aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="2f326-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="2f326-141">In einigen Szenarien können Geschäftsregeln vorhanden sein, die auf dieser Ebene implementiert werden müssen (z. b. Autorisierungs Regeln basierend auf dem aktuell angemeldeten Benutzer oder der Rolle, zu der der Benutzer gehört). wir lassen diese Methoden einfach unverändert.</span><span class="sxs-lookup"><span data-stu-id="2f326-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="2f326-142">Bei diesen Methoden fungiert die BLL nur als Proxy, über den die Präsentationsschicht auf die zugrunde liegenden Daten von der Datenzugriffs Ebene zugreift.</span><span class="sxs-lookup"><span data-stu-id="2f326-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="2f326-143">Die Methoden `AddProduct` und `UpdateProduct` verwenden beide als Parameter die Werte für die verschiedenen Produktfelder und fügen ein neues Produkt hinzu bzw. aktualisieren ein vorhandenes Produkt.</span><span class="sxs-lookup"><span data-stu-id="2f326-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="2f326-144">Da viele Spalten der `Product` Tabelle `NULL` Werte akzeptieren können (`CategoryID`, `SupplierID`und `UnitPrice`, um nur einige zu nennen), werden die Eingabeparameter für `AddProduct` und `UpdateProduct`, die diesen Spalten zugeordnet sind, auf NULL festleg [Bare Typen](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx)verwendet.</span><span class="sxs-lookup"><span data-stu-id="2f326-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="2f326-145">Typen, die NULL-Werte zulassen, sind neu in .NET 2,0 und stellen ein Verfahren bereit, mit dem angegeben wird, ob ein Werttyp stattdessen `null`werden soll.</span><span class="sxs-lookup"><span data-stu-id="2f326-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="2f326-146">In C# können Sie einen Werttyp als Typ markieren, der NULL-Werte zulässt, indem Sie `?` nach dem Typ hinzufügen (wie `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="2f326-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="2f326-147">Weitere Informationen finden Sie im Abschnitt [Nullable-Typen](https://msdn.microsoft.com/library/1t3y8s4s.aspx) im- [ C# Programmier Handbuch](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2f326-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="2f326-148">Alle drei Methoden geben einen booleschen Wert zurück, der angibt, ob eine Zeile eingefügt, aktualisiert oder gelöscht wurde, da der Vorgang möglicherweise nicht zu einer betroffenen Zeile führt.</span><span class="sxs-lookup"><span data-stu-id="2f326-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="2f326-149">Wenn z. b. der Seiten Entwickler `DeleteProduct` die Übergabe eines `ProductID` für ein nicht vorhandenes Produkt aufruft, hat die für die Datenbank ausgegebene `DELETE`-Anweisung keine Auswirkung, weshalb die `DeleteProduct` Methode `false`zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="2f326-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="2f326-150">Beachten Sie, dass beim Hinzufügen eines neuen Produkts oder beim Aktualisieren eines vorhandenen Produkts die Feldwerte der neuen oder geänderten Produkte als Liste von skalaren angenommen werden, anstatt eine `ProductsRow` Instanz zu akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="2f326-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="2f326-151">Diese Vorgehensweise wurde gewählt, da die `ProductsRow`-Klasse von der `DataRow` ADO.NET-Klasse abgeleitet wird, die nicht über einen standardmäßigen Parameter losen Konstruktor verfügt.</span><span class="sxs-lookup"><span data-stu-id="2f326-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="2f326-152">Um eine neue `ProductsRow` Instanz zu erstellen, müssen wir zuerst eine `ProductsDataTable` Instanz erstellen und dann die zugehörige `NewProductRow()`-Methode aufrufen (was wir in `AddProduct`tun).</span><span class="sxs-lookup"><span data-stu-id="2f326-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="2f326-153">Dieses Manko gibt den Anfang zurück, wenn wir das Einfügen und Aktualisieren von Produkten mithilfe von ObjectDataSource aktivieren.</span><span class="sxs-lookup"><span data-stu-id="2f326-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="2f326-154">Kurz gesagt, versucht ObjectDataSource, eine Instanz der Eingabeparameter zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="2f326-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="2f326-155">Wenn die BLL-Methode eine `ProductsRow` Instanz erwartet, versucht ObjectDataSource, eine Instanz zu erstellen, schlägt jedoch fehl, weil ein standardmäßiger Parameter loser Konstruktor fehlt.</span><span class="sxs-lookup"><span data-stu-id="2f326-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="2f326-156">Weitere Informationen zu diesem Problem finden Sie in den folgenden zwei ASP.NET Forums Beiträgen: [Aktualisieren von objectdatasources mit stark typisierten Datasets](https://forums.asp.net/1098630/ShowPost.aspx)und [Problem mit ObjectDataSource und stark typisiertem DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f326-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="2f326-157">Im nächsten Schritt erstellt der Code sowohl in `AddProduct` als auch `UpdateProduct`eine `ProductsRow`-Instanz und füllt diese mit den soeben weiter gegebenen Werten.</span><span class="sxs-lookup"><span data-stu-id="2f326-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="2f326-158">Beim Zuweisen von Werten zu datacolenns einer DataRow können verschiedene Validierungs Überprüfungen auf Feldebene durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="2f326-159">Daher wird die Gültigkeit der an die BLL-Methode übergebenen Daten durch manuelles Zurücksetzen der übergebenen Werte in eine DataRow sichergestellt.</span><span class="sxs-lookup"><span data-stu-id="2f326-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="2f326-160">Leider verwenden die stark typisierten DataRow-Klassen, die von Visual Studio generiert werden, keine Typen, die NULL-Werte zulassen.</span><span class="sxs-lookup"><span data-stu-id="2f326-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="2f326-161">Stattdessen müssen Sie die `SetColumnNameNull()`-Methode verwenden, um anzugeben, dass eine bestimmte datacolenumn in einer DataRow einem `NULL`-Daten Bank Wert entsprechen soll.</span><span class="sxs-lookup"><span data-stu-id="2f326-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="2f326-162">In `UpdateProduct` wir zuerst das Produkt laden, das mithilfe `GetProductByProductID(productID)`aktualisiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="2f326-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="2f326-163">Dies mag ein unnötiger Weg zur Datenbank sein, aber diese zusätzliche Fahrt wird in zukünftigen Tutorials, in denen optimistische Parallelität untersucht wird, als lohnenswert erweisen.</span><span class="sxs-lookup"><span data-stu-id="2f326-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="2f326-164">Optimistische Parallelität ist eine Technik, mit der sichergestellt wird, dass zwei Benutzer, die gleichzeitig an denselben Daten arbeiten, nicht versehentlich die Änderungen überschreiben.</span><span class="sxs-lookup"><span data-stu-id="2f326-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="2f326-165">Das Abrufen des gesamten Datensatzes erleichtert auch das Erstellen von Update Methoden in der BLL, die nur eine Teilmenge der Spalten von DataRow ändern.</span><span class="sxs-lookup"><span data-stu-id="2f326-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="2f326-166">Wenn wir uns die `SuppliersBLL`-Klasse ansehen, sehen wir ein Beispiel.</span><span class="sxs-lookup"><span data-stu-id="2f326-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="2f326-167">Beachten Sie schließlich, dass die `ProductsBLL`-Klasse das [DataObject-Attribut](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) enthält (die `[System.ComponentModel.DataObject]`-Syntax direkt vor der Class-Anweisung am Anfang der Datei) und die-Methoden über [DataObjectMethodAttribute-Attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx)verfügen.</span><span class="sxs-lookup"><span data-stu-id="2f326-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="2f326-168">Das `DataObject` Attribut markiert die Klasse als ein Objekt, das für die Bindung an ein [ObjectDataSource-Steuer](https://msdn.microsoft.com/library/9a4kyhcx.aspx)Element geeignet ist, während der `DataObjectMethodAttribute` den Zweck der Methode angibt.</span><span class="sxs-lookup"><span data-stu-id="2f326-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="2f326-169">Wie wir in zukünftigen Tutorials sehen werden, erleichtert die ObjectDataSource von ASP.NET 2.0 den deklarativen Zugriff auf Daten aus einer Klasse.</span><span class="sxs-lookup"><span data-stu-id="2f326-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="2f326-170">Um die Liste der möglichen Klassen zu filtern, die im Assistenten von ObjectDataSource an BIND gebunden werden sollen, werden standardmäßig nur die als `DataObjects` markierten Klassen in der Dropdown Liste des Assistenten angezeigt.</span><span class="sxs-lookup"><span data-stu-id="2f326-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="2f326-171">Die `ProductsBLL`-Klasse funktioniert auch ohne diese Attribute. durch das Hinzufügen werden Sie jedoch einfacher im Assistenten von ObjectDataSource verwendet.</span><span class="sxs-lookup"><span data-stu-id="2f326-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="2f326-172">Hinzufügen der anderen Klassen</span><span class="sxs-lookup"><span data-stu-id="2f326-172">Adding the Other Classes</span></span>

<span data-ttu-id="2f326-173">Wenn die `ProductsBLL`-Klasse fertiggestellt ist, müssen wir noch die Klassen zum Arbeiten mit Kategorien, Lieferanten und Mitarbeitern hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="2f326-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="2f326-174">Nehmen Sie sich einen Moment Zeit, um die folgenden Klassen und Methoden mit den Konzepten aus dem obigen Beispiel zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="2f326-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="2f326-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2f326-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="2f326-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2f326-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="2f326-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2f326-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="2f326-178">Die einzige Methode, die beachtet werden muss, ist die `UpdateSupplierAddress`-Methode der `SuppliersBLL`-Klasse.</span><span class="sxs-lookup"><span data-stu-id="2f326-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="2f326-179">Diese Methode stellt eine Schnittstelle zum Aktualisieren der Adressinformationen des Lieferanten bereit.</span><span class="sxs-lookup"><span data-stu-id="2f326-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="2f326-180">Intern liest diese Methode das `SupplierDataRow`-Objekt für den angegebenen `supplierID` (mithilfe `GetSupplierBySupplierID`), legt die Adress bezogenen Eigenschaften fest und ruft dann die `Update`-Methode des `SupplierDataTable`auf.</span><span class="sxs-lookup"><span data-stu-id="2f326-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="2f326-181">Die `UpdateSupplierAddress`-Methode folgt:</span><span class="sxs-lookup"><span data-stu-id="2f326-181">The `UpdateSupplierAddress` method follows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="2f326-182">Die gesamte Implementierung der BLL-Klassen finden Sie in diesem Artikel.</span><span class="sxs-lookup"><span data-stu-id="2f326-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="2f326-183">Schritt 2: Zugreifen auf die typisierten Datasets über die BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="2f326-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="2f326-184">Im ersten Tutorial haben wir Beispiele für die programmgesteuerte Arbeit mit dem typisierten DataSet gesehen, aber mit dem Hinzufügen unserer BLL-Klassen sollte die Präsentationsebene stattdessen mit der BLL funktionieren.</span><span class="sxs-lookup"><span data-stu-id="2f326-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="2f326-185">Im `AllProducts.aspx` Beispiel aus dem ersten Tutorial wurde das `ProductsTableAdapter` verwendet, um die Liste der Produkte an eine GridView zu binden, wie im folgenden Code gezeigt:</span><span class="sxs-lookup"><span data-stu-id="2f326-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="2f326-186">Um die neuen BLL-Klassen verwenden zu können, muss nur die erste Codezeile geändert werden. ersetzen Sie dabei einfach das `ProductsTableAdapter` Objekt durch ein `ProductBLL` Objekt:</span><span class="sxs-lookup"><span data-stu-id="2f326-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="2f326-187">Der Zugriff auf die BLL-Klassen kann auch deklarativ (wie das typisierte DataSet) mithilfe von ObjectDataSource erfolgen.</span><span class="sxs-lookup"><span data-stu-id="2f326-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="2f326-188">In den folgenden Tutorials wird die ObjectDataSource ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="2f326-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>

<span data-ttu-id="2f326-189">[![die Liste der Produkte in einer GridView angezeigt wird](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="2f326-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="2f326-190">**Abbildung 3**: die Liste der Produkte wird in einer GridView angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="2f326-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>

## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="2f326-191">Schritt 3: Hinzufügen der Validierung auf Feldebene zu den DataRow-Klassen</span><span class="sxs-lookup"><span data-stu-id="2f326-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="2f326-192">Bei der Validierung auf Feldebene handelt es sich um Überprüfungen, die sich auf die Eigenschaftswerte der Geschäftsobjekte beim Einfügen oder aktualisieren beziehen.</span><span class="sxs-lookup"><span data-stu-id="2f326-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="2f326-193">Einige Validierungsregeln auf Feldebene für Produkte sind:</span><span class="sxs-lookup"><span data-stu-id="2f326-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="2f326-194">Das `ProductName` Feld darf nicht länger als 40 Zeichen sein.</span><span class="sxs-lookup"><span data-stu-id="2f326-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="2f326-195">Das `QuantityPerUnit` Feld darf höchstens 20 Zeichen lang sein.</span><span class="sxs-lookup"><span data-stu-id="2f326-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="2f326-196">Die Felder `ProductID`, `ProductName`und `Discontinued` sind erforderlich, aber alle anderen Felder sind optional.</span><span class="sxs-lookup"><span data-stu-id="2f326-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="2f326-197">Die Felder `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`und `ReorderLevel` müssen größer oder gleich 0 (null) sein.</span><span class="sxs-lookup"><span data-stu-id="2f326-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="2f326-198">Diese Regeln können und auf Datenbankebene ausgedrückt werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="2f326-199">Das Zeichenlimit für die Felder `ProductName` und `QuantityPerUnit` wird von den Datentypen dieser Spalten in der `Products` Tabelle (`nvarchar(40)` bzw. `nvarchar(20)`) aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="2f326-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="2f326-200">Ob Felder erforderlich und optional sind, wird durch ausgedrückt, wenn die Datenbanktabellen Spalte `NULL` s zulässt.</span><span class="sxs-lookup"><span data-stu-id="2f326-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="2f326-201">Es gibt vier [Check-Einschränkungen](https://msdn.microsoft.com/library/ms188258.aspx) , die sicherstellen, dass nur Werte größer oder gleich NULL in die Spalten `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`oder `ReorderLevel` umgewandelt werden können.</span><span class="sxs-lookup"><span data-stu-id="2f326-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="2f326-202">Zusätzlich zum Erzwingen dieser Regeln in der Datenbank sollten Sie auch auf Datasetebene erzwungen werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="2f326-203">Die Feldlänge und ob ein Wert erforderlich oder optional ist, werden für die datasetsätze der einzelnen Datentypen bereits aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="2f326-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="2f326-204">Um die vorhandene Überprüfung auf Feldebene automatisch bereitzustellen, wechseln Sie zum DataSet-Designer, wählen Sie ein Feld aus einem der DataTables aus, und wechseln Sie dann zum Eigenschaftenfenster.</span><span class="sxs-lookup"><span data-stu-id="2f326-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="2f326-205">Wie in Abbildung 4 gezeigt, hat der `QuantityPerUnit` datacolenumn im `ProductsDataTable` eine maximale Länge von 20 Zeichen und lässt `NULL` Werte zu.</span><span class="sxs-lookup"><span data-stu-id="2f326-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="2f326-206">Wenn Sie versuchen, die `QuantityPerUnit`-Eigenschaft des `ProductsDataRow`auf einen Zeichen folgen Wert mit einer Länge von mehr als 20 Zeichen festzulegen, wird eine `ArgumentException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="2f326-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>

<span data-ttu-id="2f326-207">[![die datacolbin eine grundlegende Validierung auf Feldebene bereitstellt.](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="2f326-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="2f326-208">**Abbildung 4**: datacolenn stellt grundlegende Validierung auf Feldebene bereit ([Klicken Sie, um das Bild in voller Größe anzuzeigen](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2f326-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>

<span data-ttu-id="2f326-209">Leider können keine Begrenzungen überprüft werden, z. b. der `UnitPrice` Wert muss größer oder gleich 0 (null) sein, über den Eigenschaftenfenster.</span><span class="sxs-lookup"><span data-stu-id="2f326-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="2f326-210">Um diese Art von Validierung auf Feldebene bereitzustellen, müssen wir einen Ereignishandler für das [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) -Ereignis der Datentabelle erstellen.</span><span class="sxs-lookup"><span data-stu-id="2f326-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="2f326-211">Wie im [vorherigen Tutorial](creating-a-data-access-layer-cs.md)erwähnt, können die vom typisierten DataSet erstellten Datasets, DataTables und DataRow-Objekte durch die Verwendung von partiellen Klassen erweitert werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="2f326-212">Mit dieser Technik können wir einen `ColumnChanging` Ereignishandler für die `ProductsDataTable`-Klasse erstellen.</span><span class="sxs-lookup"><span data-stu-id="2f326-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="2f326-213">Erstellen Sie zunächst eine Klasse im Ordner "`App_Code`" mit dem Namen `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="2f326-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>

<span data-ttu-id="2f326-214">[![dem Ordner "App_Code" eine neue Klasse hinzufügen](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="2f326-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="2f326-215">**Abbildung 5**: Hinzufügen einer neuen Klasse zum `App_Code` Ordner ([Klicken Sie, um das Bild in voller Größe anzuzeigen](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="2f326-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>

<span data-ttu-id="2f326-216">Erstellen Sie als nächstes einen Ereignishandler für das `ColumnChanging` Ereignis, mit dem sichergestellt wird, dass die Spaltenwerte `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`und `ReorderLevel` (falls nicht `NULL`) größer oder gleich 0 (null) sind.</span><span class="sxs-lookup"><span data-stu-id="2f326-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="2f326-217">Wenn eine solche Spalte außerhalb des gültigen Bereichs liegt, lösen Sie eine `ArgumentException`aus.</span><span class="sxs-lookup"><span data-stu-id="2f326-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="2f326-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="2f326-218">ProductsDataTable.ColumnChanging.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="2f326-219">Schritt 4: Hinzufügen von benutzerdefinierten Geschäftsregeln zu den Klassen von BLL</span><span class="sxs-lookup"><span data-stu-id="2f326-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="2f326-220">Zusätzlich zur Validierung auf Feldebene können auch benutzerdefinierte Geschäftsregeln auf hoher Ebene vorhanden sein, die verschiedene Entitäten oder Konzepte enthalten, die auf der Ebene einzelner Spalten nicht ausdrucksfähig sind, wie z. b.:</span><span class="sxs-lookup"><span data-stu-id="2f326-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="2f326-221">Wenn ein Produkt nicht mehr unterstützt wird, kann die `UnitPrice` nicht aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="2f326-222">Das Wohnsitzland eines Mitarbeiters muss mit dem Wohnsitzland des Vorgesetzten identisch sein.</span><span class="sxs-lookup"><span data-stu-id="2f326-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="2f326-223">Ein Produkt kann nicht eingestellt werden, wenn es sich um das einzige vom Lieferanten bereitgestellte Produkt handelt.</span><span class="sxs-lookup"><span data-stu-id="2f326-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="2f326-224">Die BLL-Klassen sollten Überprüfungen enthalten, um sicherzustellen, dass die Geschäftsregeln der Anwendung eingehalten werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="2f326-225">Diese Überprüfungen können direkt den Methoden hinzugefügt werden, auf die Sie angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="2f326-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="2f326-226">Stellen Sie sich vor, dass unsere Geschäftsregeln vorschreiben, dass ein Produkt nicht mehr unterstützt werden konnte, wenn es das einzige Produkt eines bestimmten Lieferanten war.</span><span class="sxs-lookup"><span data-stu-id="2f326-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="2f326-227">Das heißt, wenn Product *X* das einzige Produkt war, das wir von Lieferanten *Y*gekauft haben, konnte *X* nicht als eingestellt gekennzeichnet werden. Wenn uns der Lieferant *Y* jedoch drei Produkte ( *A*, *B*und *C*) zur Verfügung gestellt hat, können wir beliebige und alle diese als nicht mehr unterstützt markieren.</span><span class="sxs-lookup"><span data-stu-id="2f326-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="2f326-228">Eine ungerade Geschäftsregel, aber Geschäftsregeln und allgemeine Sense sind nicht immer ausgerichtet!</span><span class="sxs-lookup"><span data-stu-id="2f326-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="2f326-229">Wenn Sie diese Geschäftsregel in der `UpdateProducts`-Methode erzwingen möchten, überprüfen Sie zunächst, ob `Discontinued` auf `true` festgelegt wurde. wenn dies der Fall ist, wenden wir `GetProductsBySupplierID` an, um zu bestimmen, wie viele Produkte der Lieferant dieses Produkts gekauft hat.</span><span class="sxs-lookup"><span data-stu-id="2f326-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="2f326-230">Wenn nur ein Produkt von diesem Lieferanten erworben wird, wird ein `ApplicationException`ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="2f326-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="2f326-231">Reagieren auf Validierungs Fehler in der Präsentationsebene</span><span class="sxs-lookup"><span data-stu-id="2f326-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="2f326-232">Beim Aufrufen der BLL von der Präsentationsebene können wir entscheiden, ob Sie versuchen, Ausnahmen zu behandeln, die möglicherweise ausgelöst werden, oder Sie in ASP.net hinein Blasen (wodurch das `Error` Ereignis des `HttpApplication`ausgelöst wird).</span><span class="sxs-lookup"><span data-stu-id="2f326-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="2f326-233">Um eine Ausnahme zu behandeln, wenn Sie mit der BLL Programm gesteuert arbeiten, können wir einen [try... Catch](https://msdn.microsoft.com/library/0yd65esw.aspx) -Block, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="2f326-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="2f326-234">Wie wir in zukünftigen Tutorials sehen werden, kann das Behandeln von Ausnahmen, die beim Verwenden eines datenweb-Steuer Elements zum Einfügen, aktualisieren oder Löschen von Daten aus der BLL erfolgen, direkt in einem Ereignishandler behandelt werden, anstatt Code in `try...catch` Blöcken umschließen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="2f326-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="2f326-235">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="2f326-235">Summary</span></span>

<span data-ttu-id="2f326-236">Eine gut strukturierte Anwendung wird in unterschiedliche Ebenen integriert, von denen jede eine bestimmte Rolle kapselt.</span><span class="sxs-lookup"><span data-stu-id="2f326-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="2f326-237">Im ersten Tutorial dieser Artikel Reihe haben wir eine Datenzugriffs Schicht mithilfe typisierter Datasets erstellt. in diesem Tutorial haben wir eine Geschäftslogik Schicht als eine Reihe von Klassen in den `App_Code` Ordner der Anwendung erstellt, die die DAL aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="2f326-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="2f326-238">Die BLL implementiert die Logik auf Feldebene und auf Geschäfts Ebene für die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="2f326-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="2f326-239">Zusätzlich zum Erstellen einer separaten BLL, wie in diesem Tutorial, besteht auch die Möglichkeit, die TableAdapters-Methoden durch die Verwendung von partiellen Klassen zu erweitern.</span><span class="sxs-lookup"><span data-stu-id="2f326-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="2f326-240">Mit dieser Technik können wir jedoch weder vorhandene Methoden außer Kraft setzen noch die DAL und unsere BLL so sauber wie den Ansatz, den wir in diesem Artikel durchgeführt haben.</span><span class="sxs-lookup"><span data-stu-id="2f326-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="2f326-241">Wenn dal und BLL abgeschlossen sind, sind wir bereit, auf der Präsentationsschicht zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="2f326-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="2f326-242">Im [nächsten Tutorial](master-pages-and-site-navigation-cs.md) führen wir eine kurze Umleitung von Datenzugriffs Themen durch und definieren ein konsistentes Seitenlayout für die Verwendung in den Lernprogrammen.</span><span class="sxs-lookup"><span data-stu-id="2f326-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="2f326-243">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="2f326-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="2f326-244">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="2f326-244">About the Author</span></span>

<span data-ttu-id="2f326-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="2f326-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2f326-246">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="2f326-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2f326-247">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="2f326-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2f326-248">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2f326-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="2f326-249">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="2f326-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2f326-250">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="2f326-250">Special Thanks To</span></span>

<span data-ttu-id="2f326-251">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="2f326-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2f326-252">Führende Prüfer für dieses Tutorial waren Liz shulok, Dennis Patterson, Carlos Santos und Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="2f326-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="2f326-253">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="2f326-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2f326-254">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2f326-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2f326-255">[Zurück](creating-a-data-access-layer-cs.md)
> [Weiter](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="2f326-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
