---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Effizientes Paging durch große Datenmengen (C#) | Microsoft-Dokumentation
author: rick-anderson
description: Die Standard-Paging-Option eines Daten Präsentations Steuer Elements ist nicht geeignet, wenn Sie mit großen Datenmengen arbeiten, da das zugrunde liegende Datenquellen-Steuerelement abgerufen wird...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e9562035cb24987b01fcdff5fbfb5fa8a1f894
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78477009"
---
# <a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="08eeb-103">Effizientes Auslagern von großen Datenmengen (C#)</span><span class="sxs-lookup"><span data-stu-id="08eeb-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>

<span data-ttu-id="08eeb-104">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="08eeb-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="08eeb-105">[Beispiel-app herunterladen](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) oder [PDF herunterladen](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="08eeb-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="08eeb-106">Die Standard-Paging-Option eines Daten Präsentations Steuer Elements ist nicht geeignet, wenn Sie mit großen Datenmengen arbeiten, da das zugrunde liegende Datenquellen-Steuerelement alle Datensätze abruft, auch wenn nur eine Teilmenge der Daten angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="08eeb-107">In diesen Fällen müssen wir das benutzerdefinierte Paging aktivieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-107">In such circumstances, we must turn to custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="08eeb-108">Einführung</span><span class="sxs-lookup"><span data-stu-id="08eeb-108">Introduction</span></span>

<span data-ttu-id="08eeb-109">Wie bereits im vorherigen Tutorial erläutert, kann das Paging auf eine von zwei Arten implementiert werden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="08eeb-110">Das **Standardpaging** kann implementiert werden, indem Sie einfach die Option Paging aktivieren im Smarttags des dateiweb-Steuer Elements aktivieren. Wenn Sie jedoch eine Datenseite anzeigen, ruft ObjectDataSource *alle* Datensätze ab, auch wenn nur eine Teilmenge der Daten auf der Seite angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="08eeb-111">Durch **benutzerdefiniertes Paging** wird die Leistung der Standard Auslagerung verbessert, indem nur die Datensätze aus der Datenbank abgerufen werden, die für die vom Benutzer angeforderte Datenseite angezeigt werden müssen. das benutzerdefinierte Paging umfasst jedoch etwas mehr Aufwand für die Implementierung als die Standard Auslagerung.</span><span class="sxs-lookup"><span data-stu-id="08eeb-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="08eeb-112">Aufgrund der einfachen Implementierung aktivieren Sie ein Kontrollkästchen, und Sie haben es wieder getan!</span><span class="sxs-lookup"><span data-stu-id="08eeb-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="08eeb-113">Standard-Paging ist eine attraktive Option.</span><span class="sxs-lookup"><span data-stu-id="08eeb-113">default paging is an attractive option.</span></span> <span data-ttu-id="08eeb-114">Wenn Sie alle Datensätze abrufen, ist dies jedoch eine unplausible Wahl, wenn Sie durch ausreichend große Datenmengen oder für Standorte mit vielen gleichzeitigen Benutzern Paging.</span><span class="sxs-lookup"><span data-stu-id="08eeb-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="08eeb-115">In diesen Fällen müssen wir das benutzerdefinierte Paging aktivieren, um ein reaktionsfähiges System bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="08eeb-116">Die Herausforderung von benutzerdefiniertem Paging besteht darin, eine Abfrage zu schreiben, die den genauen Satz von Datensätzen zurückgibt, die für eine bestimmte Datenseite benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="08eeb-117">Glücklicherweise stellt Microsoft SQL Server 2005 ein neues Schlüsselwort für die Rangfolge der Ergebnisse bereit, das es uns ermöglicht, eine Abfrage zu schreiben, mit der die richtige Teilmenge der Datensätze effizient abgerufen werden kann.</span><span class="sxs-lookup"><span data-stu-id="08eeb-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="08eeb-118">In diesem Tutorial erfahren Sie, wie Sie das neue Schlüsselwort "SQL Server 2005" verwenden, um benutzerdefiniertes Paging in einem GridView-Steuerelement zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="08eeb-119">Obwohl die Benutzeroberfläche für benutzerdefiniertes Paging identisch mit der für die Standard Auslagerung ist, kann das Ausführen eines Einzel Vorgangs von einer Seite zur nächsten mithilfe von benutzerdefiniertem Paging mehrere Größenordnungen beschleunigen als die standardpaginierung.</span><span class="sxs-lookup"><span data-stu-id="08eeb-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="08eeb-120">Der genaue Leistungsgewinn, der durch das benutzerdefinierte Paging festgestellt wird, hängt von der Gesamtzahl der Datensätze ab, die durch den Datenbankserver eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="08eeb-121">Am Ende dieses Tutorials betrachten wir einige grobe Metriken, die die Vorteile der Leistung veranschaulichen, die durch das benutzerdefinierte Paging erzielt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>

## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="08eeb-122">Schritt 1: Grundlegendes zum benutzerdefinierten pagingprozess</span><span class="sxs-lookup"><span data-stu-id="08eeb-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="08eeb-123">Beim Paging durch Daten sind die auf einer Seite angezeigten exakten Datensätze abhängig von der angeforderten Datenmenge und der Anzahl der pro Seite angezeigten Datensätze.</span><span class="sxs-lookup"><span data-stu-id="08eeb-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="08eeb-124">Stellen Sie sich beispielsweise vor, dass Sie die 81-Produkte durchlaufen möchten, die 10 Produkte pro Seite anzeigen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="08eeb-125">Wenn Sie die erste Seite anzeigen, benötigen wir die Produkte 1 bis 10. beim Anzeigen der zweiten Seite interessieren wir uns für die Produkte 11 bis 20 usw.</span><span class="sxs-lookup"><span data-stu-id="08eeb-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="08eeb-126">Es gibt drei Variablen, die vorgeben, welche Datensätze abgerufen werden müssen und wie die pagingschnittstelle gerendert werden soll:</span><span class="sxs-lookup"><span data-stu-id="08eeb-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="08eeb-127">**Zeilen Anfang Index** : der Index der ersten Zeile in der Datenseite, die angezeigt werden soll. Dieser Index kann berechnet werden, indem der Seitenindex von den Datensätzen multipliziert wird, die pro Seite angezeigt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="08eeb-128">Wenn Sie z. b. für die erste Seite (deren Seitenindex den Wert 0 hat) die Datensätze 10 gleichzeitig durchsuchen, ist der Start Zeilen Index 0 \* 10 + 1 oder 1. für die zweite Seite (deren Seitenindex 1 ist) ist der Start Zeilen Index 1 \* 10 + 1 oder 11.</span><span class="sxs-lookup"><span data-stu-id="08eeb-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="08eeb-129">**Maximale Zeilen** Anzahl die maximale Anzahl der Datensätze, die pro Seite angezeigt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="08eeb-130">Diese Variable wird als maximale Anzahl von Zeilen bezeichnet, da für die letzte Seite möglicherweise weniger Datensätze als die Seitengröße zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="08eeb-131">Wenn Sie z. b. das Paging durch die 81 Produkte 10 Datensätze pro Seite durchlaufen, wird auf der neunten und letzten Seite nur ein Datensatz angezeigt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="08eeb-132">Keine Seite zeigt jedoch mehr Datensätze an als der Wert für die maximale Zeilen Anzahl.</span><span class="sxs-lookup"><span data-stu-id="08eeb-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="08eeb-133">**Gesamt** Anzahl der Datensätze die Gesamtanzahl der Datensätze, die durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="08eeb-134">Diese Variable ist zwar nicht erforderlich, um zu bestimmen, welche Datensätze für eine bestimmte Seite abgerufen werden sollen, aber es wird die Paging-Schnittstelle vorgegeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="08eeb-135">Wenn z. b. 81 Produkte durchlaufen werden, weiß die Paging-Schnittstelle, dass neun Seitenzahlen in der Pagingbenutzeroberfläche angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="08eeb-136">Beim standardmäßigen Paging wird der Start Zeilen Index als Produkt des Seiten Indexes und der Seitengröße Plus 1 berechnet, während die maximale Zeilen Anzahl einfach die Seitengröße ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="08eeb-137">Da bei der Standard Auslagerung alle Datensätze aus der Datenbank abgerufen werden, wenn eine Datenseite gerendert wird, ist der Index für jede Zeile bekannt, sodass der Übergang zur Zeile für den Zeilen Index zu einer trivialen Aufgabe wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="08eeb-138">Außerdem ist die Gesamtanzahl der Datensätze sofort verfügbar, da Sie einfach die Anzahl der Datensätze in der Datentabelle (oder das Objekt, das zum Speichern der Daten Bank Ergebnisse verwendet wird) enthält.</span><span class="sxs-lookup"><span data-stu-id="08eeb-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="08eeb-139">Bei Angabe der Variablen "Start Row Index" und "Maximum rows" muss eine benutzerdefinierte pagingimplementierung nur die genaue Teilmenge der Datensätze zurückgeben, beginnend beim Start Zeilen Index und die maximale Zeilen Anzahl von Datensätzen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="08eeb-140">Das benutzerdefinierte Paging bietet zwei Herausforderungen:</span><span class="sxs-lookup"><span data-stu-id="08eeb-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="08eeb-141">Wir müssen in der Lage sein, jeder Zeile in den auslagerbaren Daten einen Zeilen Index effizient zuzuordnen, damit wir mit dem Zurückgeben von Datensätzen am angegebenen Start Zeilen Index beginnen können.</span><span class="sxs-lookup"><span data-stu-id="08eeb-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="08eeb-142">Wir müssen die Gesamtzahl der Datensätze angeben, die durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="08eeb-143">In den nächsten beiden Schritten untersuchen wir das SQL-Skript, das für die Beantwortung dieser beiden Probleme erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="08eeb-144">Zusätzlich zum SQL-Skript müssen auch Methoden in Dal und BLL implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="08eeb-145">Schritt 2: Zurückgeben der Gesamtanzahl von Datensätzen, die durchlaufen werden</span><span class="sxs-lookup"><span data-stu-id="08eeb-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="08eeb-146">Bevor wir untersuchen, wie die genaue Teilmenge der Datensätze für die anzuzeigende Seite abgerufen wird, sehen Sie sich zunächst an, wie die Gesamtanzahl der Datensätze zurückgegeben werden soll, die durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="08eeb-147">Diese Informationen sind erforderlich, um die Auslagerungs Benutzeroberfläche ordnungsgemäß zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="08eeb-148">Die Gesamtanzahl der Datensätze, die von einer bestimmten SQL-Abfrage zurückgegeben werden, kann mithilfe der [`COUNT` Aggregatfunktion](https://msdn.microsoft.com/library/ms175997.aspx)abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="08eeb-149">Wenn Sie z. b. die Gesamtanzahl der Datensätze in der `Products` Tabelle ermitteln möchten, können Sie die folgende Abfrage verwenden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="08eeb-150">Fügen Sie der dal eine Methode hinzu, die diese Informationen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="08eeb-151">Insbesondere erstellen wir eine dal-Methode mit dem Namen `TotalNumberOfProducts()`, die die oben gezeigte `SELECT` Anweisung ausführt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="08eeb-152">Öffnen Sie zunächst die `Northwind.xsd` typisierte DataSet-Datei im Ordner `App_Code/DAL`.</span><span class="sxs-lookup"><span data-stu-id="08eeb-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="08eeb-153">Klicken Sie als nächstes mit der rechten Maustaste auf die `ProductsTableAdapter` im Designer, und wählen Sie Abfrage hinzufügen aus.</span><span class="sxs-lookup"><span data-stu-id="08eeb-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="08eeb-154">Wie bereits in den vorherigen Tutorials gezeigt, können wir der dal eine neue Methode hinzufügen, die, wenn Sie aufgerufen wird, eine bestimmte SQL-Anweisung oder gespeicherte Prozedur ausführt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="08eeb-155">Wie bei unseren TableAdapter-Methoden in vorherigen Tutorials haben Sie sich dafür entschieden, eine Ad-hoc-SQL-Anweisung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>

![Verwenden einer Ad-hoc-SQL-Anweisung](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="08eeb-157">**Abbildung 1**: Verwenden einer Ad-hoc-SQL-Anweisung</span><span class="sxs-lookup"><span data-stu-id="08eeb-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>

<span data-ttu-id="08eeb-158">Auf dem nächsten Bildschirm können Sie angeben, welche Art von Abfrage erstellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="08eeb-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="08eeb-159">Da diese Abfrage einen einzelnen Skalarwert zurückgibt, wird die Gesamtanzahl der Datensätze in der `Products` Tabelle mit der `SELECT`, die die Option für das Debugwert zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>

![Konfigurieren der Abfrage für die Verwendung einer SELECT-Anweisung, die einen einzelnen Wert zurückgibt](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="08eeb-161">**Abbildung 2**: Konfigurieren der Abfrage für die Verwendung einer SELECT-Anweisung, die einen einzelnen Wert zurückgibt</span><span class="sxs-lookup"><span data-stu-id="08eeb-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>

<span data-ttu-id="08eeb-162">Nachdem Sie den Typ der zu verwendenden Abfrage angegeben haben, müssen Sie als nächstes die Abfrage angeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-162">After indicating the type of query to use, we must next specify the query.</span></span>

![Verwenden Sie die Abfrage SELECT count (\*) from products.](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="08eeb-164">**Abbildung 3**: Verwenden der SELECT count (\*) from Products-Abfrage</span><span class="sxs-lookup"><span data-stu-id="08eeb-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>

<span data-ttu-id="08eeb-165">Geben Sie abschließend den Namen für die Methode an.</span><span class="sxs-lookup"><span data-stu-id="08eeb-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="08eeb-166">Wie bereits erwähnt, können Sie `TotalNumberOfProducts`verwenden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>

![Benennen Sie die DAL-Methode totalnumofproducts.](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="08eeb-168">**Abbildung 4**: Benennen der dal-Methode totalnumofproducts</span><span class="sxs-lookup"><span data-stu-id="08eeb-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>

<span data-ttu-id="08eeb-169">Nachdem Sie auf Fertigstellen geklickt haben, fügt der Assistent die `TotalNumberOfProducts` Methode der dal hinzu.</span><span class="sxs-lookup"><span data-stu-id="08eeb-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="08eeb-170">Die skalaren Rückgabe Methoden in der dal geben Werte zulässt-Typen zurück, wenn das Ergebnis der SQL-Abfrage `NULL`ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="08eeb-171">Unsere `COUNT` Abfrage gibt jedoch immer einen Wert zurück, der nicht`NULL` ist. die DAL-Methode gibt eine Ganzzahl zurück, die NULL-Werte zulässt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="08eeb-172">Zusätzlich zur dal-Methode benötigen wir auch eine-Methode in der BLL.</span><span class="sxs-lookup"><span data-stu-id="08eeb-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="08eeb-173">Öffnen Sie die Datei `ProductsBLL`-Klasse, und fügen Sie eine `TotalNumberOfProducts` Methode hinzu, die einfach an die DAL s-`TotalNumberOfProducts`-Methode aufruft:</span><span class="sxs-lookup"><span data-stu-id="08eeb-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="08eeb-174">Die DAL s-`TotalNumberOfProducts` Methode gibt eine Ganzzahl zurück, die NULL zulässt. Wir haben jedoch die `ProductsBLL` Klasse s `TotalNumberOfProducts` Methode erstellt, sodass Sie eine Standard Ganzzahl zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="08eeb-175">Daher muss die `ProductsBLL` Klasse s `TotalNumberOfProducts` Methode den Wert Teil der von der dal s `TotalNumberOfProducts`-Methode zurückgegebenen Ganzzahl zurückgeben, die NULL-Werte zulässt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="08eeb-176">Der Aufruf von `GetValueOrDefault()` gibt den Wert der Ganzzahl zurück, die NULL-Werte zulässt, wenn Sie vorhanden ist. Wenn die Ganzzahl, die NULL-Werte zulässt, `null`ist, gibt Sie jedoch den standardmäßigen ganzzahligen Wert 0 zurück.</span><span class="sxs-lookup"><span data-stu-id="08eeb-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="08eeb-177">Schritt 3: Zurückgeben der exakten Teilmenge von Datensätzen</span><span class="sxs-lookup"><span data-stu-id="08eeb-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="08eeb-178">Die nächste Aufgabe besteht darin, Methoden in der dal und der BLL zu erstellen, die die zuvor erläuterten Zeilen Index-und Maximum Rows-Variablen akzeptieren und die entsprechenden Datensätze zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="08eeb-179">Bevor wir dies tun, betrachten wir zuerst das erforderliche SQL-Skript.</span><span class="sxs-lookup"><span data-stu-id="08eeb-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="08eeb-180">Die Herausforderung besteht darin, dass wir in der Lage sein müssen, jeder Zeile in den gesamten auslagerenden Ergebnissen effizient einen Index zuzuweisen, damit wir nur die Datensätze zurückgeben können, beginnend beim Start Zeilen Index (und bis zur maximalen Anzahl von Datensätzen).</span><span class="sxs-lookup"><span data-stu-id="08eeb-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="08eeb-181">Dies ist keine Herausforderung, wenn in der Datenbanktabelle bereits eine Spalte vorhanden ist, die als Zeilen Index fungiert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="08eeb-182">Auf den ersten Blick könnten wir sehen, dass die `Products` Tabelle s `ProductID` Feld ausreichen würde, weil das erste Produkt `ProductID` von 1, das zweite a 2 usw. hat.</span><span class="sxs-lookup"><span data-stu-id="08eeb-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="08eeb-183">Wenn Sie ein Produkt löschen, bleibt jedoch eine Lücke in der Sequenz, wodurch dieser Ansatz aufgehoben wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="08eeb-184">Es gibt zwei allgemeine Verfahren, mit denen ein Zeilen Index effizient mit den Daten verknüpft wird, die durchlaufen werden können, sodass die genaue Teilmenge der Datensätze abgerufen werden kann:</span><span class="sxs-lookup"><span data-stu-id="08eeb-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="08eeb-185">Wenn **Sie SQL Server 2005 s `ROW_NUMBER()` Schlüsselwort** New in SQL Server 2005 verwenden, ordnet das `ROW_NUMBER()`-Schlüsselwort eine Rangfolge den einzelnen zurückgegebenen Datensätzen zu</span><span class="sxs-lookup"><span data-stu-id="08eeb-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="08eeb-186">Diese Rangfolge kann als Zeilen Index für jede Zeile verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="08eeb-187">**Verwenden einer Tabellen Variablen und `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` Anweisung](https://msdn.microsoft.com/library/ms188774.aspx) kann verwendet werden, um anzugeben, wie viele Datensätze insgesamt von einer Abfrage verarbeitet werden sollen, bevor Sie beendet wird. [Tabellen Variablen](http://www.sqlteam.com/item.asp?ItemID=9454) sind lokale T-SQL-Variablen, die Tabellendaten enthalten können, vergleichbar mit [temporären Tabellen](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="08eeb-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="08eeb-188">Dieser Ansatz funktioniert gleichermaßen gut mit Microsoft SQL Server 2005 und SQL Server 2000 (während der `ROW_NUMBER()` Ansatz nur mit SQL Server 2005) funktioniert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="08eeb-189">Die Idee besteht darin, eine Tabellen Variable zu erstellen, die eine `IDENTITY` Spalte und Spalten für die Primärschlüssel der Tabelle enthält, deren Daten per Pager durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="08eeb-190">Als nächstes wird der Inhalt der Tabelle, deren Daten durchlaufen werden, in die Tabellen Variable eingefügt, wodurch ein sequenzieller Zeilen Index (über die `IDENTITY` Spalte) für jeden Datensatz in der Tabelle zugeordnet wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="08eeb-191">Nachdem die Tabellen Variable aufgefüllt wurde, kann eine `SELECT`-Anweisung für die Tabellen Variable, die mit der zugrunde liegenden Tabelle verknüpft ist, ausgeführt werden, um die jeweiligen Datensätze abzurufen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="08eeb-192">Die `SET ROWCOUNT`-Anweisung wird verwendet, um die Anzahl der Datensätze, die in die Tabellen Variable gekippt werden müssen, intelligent einzuschränken.</span><span class="sxs-lookup"><span data-stu-id="08eeb-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="08eeb-193">Die Effizienz dieses Ansatzes basiert auf der angeforderten Seitenzahl, da dem `SET ROWCOUNT` Wert der Wert des Start Zeilen Index zuzüglich der maximalen Zeilen zugewiesen wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="08eeb-194">Beim Paging durch Seiten mit niedriger Nummerierung, wie z. b. die ersten Seiten der Daten, ist dieser Ansatz sehr effizient.</span><span class="sxs-lookup"><span data-stu-id="08eeb-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="08eeb-195">Sie stellt jedoch beim Abrufen einer Seite am Ende eine standardmäßige Auslagerungs ähnliche Leistung dar.</span><span class="sxs-lookup"><span data-stu-id="08eeb-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="08eeb-196">In diesem Tutorial wird das benutzerdefinierte Paging mit dem `ROW_NUMBER()`-Schlüsselwort implementiert</span><span class="sxs-lookup"><span data-stu-id="08eeb-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="08eeb-197">Weitere Informationen zur Verwendung der Tabellen Variablen und `SET ROWCOUNT` Technik finden Sie in [einer effizienteren Methode zum Paging durch große Resultsets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="08eeb-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="08eeb-198">Das `ROW_NUMBER()`-Schlüsselwort, das einer Rangfolge mit jedem Datensatz zugeordnet ist, der über eine bestimmte Reihenfolge zurückgegeben wird</span><span class="sxs-lookup"><span data-stu-id="08eeb-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="08eeb-199">`ROW_NUMBER()` gibt einen numerischen Wert zurück, der den Rang für jeden Datensatz in Bezug auf die festgestellte Reihenfolge angibt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="08eeb-200">Um z. b. den Rang für jedes Produkt zu sehen, geordnet nach dem teuersten zum geringsten, können wir die folgende Abfrage verwenden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="08eeb-201">Abbildung 5 zeigt die Ergebnisse dieser Abfrage, wenn Sie über das Abfragefenster in Visual Studio ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="08eeb-202">Beachten Sie, dass die Produkte nach Preis zusammen mit einem Preis Rang für jede Zeile geordnet sind.</span><span class="sxs-lookup"><span data-stu-id="08eeb-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>

![Der Preis Rang ist für jeden zurückgegebenen Datensatz enthalten.](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="08eeb-204">**Abbildung 5**: der Preis Rang ist für jeden zurückgegebenen Datensatz enthalten.</span><span class="sxs-lookup"><span data-stu-id="08eeb-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>

> [!NOTE]
> <span data-ttu-id="08eeb-205">`ROW_NUMBER()` ist nur eine der vielen neuen Rang Folge Funktionen, die in SQL Server 2005 verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="08eeb-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="08eeb-206">Eine ausführlichere Erläuterung der `ROW_NUMBER()`sowie der anderen Rang Folge Funktionen finden Sie unter Zurückgeben von [Rang Ergebnissen mit Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="08eeb-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>

<span data-ttu-id="08eeb-207">Beim Sortieren der Ergebnisse anhand der angegebenen `ORDER BY` Spalte in der `OVER`-Klausel (`UnitPrice`im obigen Beispiel) müssen SQL Server die Ergebnisse sortieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="08eeb-208">Dies ist ein schneller Vorgang, wenn ein gruppierter Index für die Spalten vorhanden ist, nach denen die Ergebnisse geordnet werden, oder wenn es einen Abdeck enden Index gibt, der andernfalls kostengünstiger sein kann.</span><span class="sxs-lookup"><span data-stu-id="08eeb-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="08eeb-209">Um die Leistung für ausreichend große Abfragen zu verbessern, sollten Sie einen nicht gruppierten Index für die Spalte hinzufügen, nach der die Ergebnisse geordnet sind.</span><span class="sxs-lookup"><span data-stu-id="08eeb-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="08eeb-210">Eine ausführlichere Betrachtung der Leistungs Überlegungen finden Sie unter [Rang Folge Funktionen und Leistung in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) .</span><span class="sxs-lookup"><span data-stu-id="08eeb-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="08eeb-211">Die von `ROW_NUMBER()` zurückgegebenen Rang Folge Informationen können nicht direkt in der `WHERE`-Klausel verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="08eeb-212">Allerdings kann eine abgeleitete Tabelle verwendet werden, um das `ROW_NUMBER()` Ergebnis zurückzugeben, das dann in der `WHERE`-Klausel angezeigt werden kann.</span><span class="sxs-lookup"><span data-stu-id="08eeb-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="08eeb-213">Beispielsweise wird in der folgenden Abfrage eine abgeleitete Tabelle verwendet, um die Spalten ProductName und UnitPrice zusammen mit dem `ROW_NUMBER()` Ergebnis zurückzugeben, und anschließend wird eine `WHERE` Klausel verwendet, um nur die Produkte zurückzugeben, deren Preis Rang zwischen 11 und 20 liegt:</span><span class="sxs-lookup"><span data-stu-id="08eeb-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="08eeb-214">Um dieses Konzept etwas weiter zu erweitern, können wir diesen Ansatz verwenden, um eine bestimmte Datenseite mithilfe der gewünschten Werte für Start Zeilen Index und maximale Zeilen Anzahl abzurufen:</span><span class="sxs-lookup"><span data-stu-id="08eeb-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>

[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="08eeb-215">Wie wir später in diesem Tutorial sehen werden, wird der von ObjectDataSource bereitgestellte *`StartRowIndex`* ab Null indiziert, wohingegen der von SQL Server 2005 zurückgegebene `ROW_NUMBER()` Wert ab 1 indiziert wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="08eeb-216">Daher gibt die `WHERE`-Klausel die Datensätze zurück, bei denen `PriceRank` streng größer als *`StartRowIndex`* und kleiner als oder gleich *`StartRowIndex`*  +  *`MaximumRows`* ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>

<span data-ttu-id="08eeb-217">Nun haben wir erläutert, wie `ROW_NUMBER()` verwendet werden kann, um eine bestimmte Datenseite mithilfe der Werte für Start Zeilen Index und maximale Zeilen Anzahl abzurufen. nun müssen wir diese Logik als Methoden in Dal und BLL implementieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="08eeb-218">Beim Erstellen dieser Abfrage müssen wir die Reihenfolge festlegen, nach der die Ergebnisse sortiert werden. Sortieren Sie die Produkte nach Ihrem Namen in alphabetischer Reihenfolge.</span><span class="sxs-lookup"><span data-stu-id="08eeb-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="08eeb-219">Dies bedeutet, dass wir mit der Implementierung des benutzerdefinierten Pagings in diesem Tutorial keinen benutzerdefinierten Auslagerungs Bericht erstellen können, der auch sortiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="08eeb-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="08eeb-220">Im nächsten Tutorial erfahren Sie jedoch, wie diese Funktionen bereitgestellt werden können.</span><span class="sxs-lookup"><span data-stu-id="08eeb-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="08eeb-221">Im vorherigen Abschnitt haben wir die DAL-Methode als Ad-hoc-SQL-Anweisung erstellt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="08eeb-222">Leider funktioniert der t-SQL-Parser in Visual Studio, der vom TableAdapter-Assistenten verwendet wird, nicht mit der `OVER` Syntax, die von der `ROW_NUMBER()`-Funktion verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="08eeb-223">Daher müssen wir diese dal-Methode als gespeicherte Prozedur erstellen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="08eeb-224">Wählen Sie im Menü Ansicht die Server-Explorer aus (oder drücken Sie STRG + ALT + S), und erweitern Sie den Knoten `NORTHWND.MDF`.</span><span class="sxs-lookup"><span data-stu-id="08eeb-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="08eeb-225">Um eine neue gespeicherte Prozedur hinzuzufügen, klicken Sie mit der rechten Maustaste auf den Knoten gespeicherte Prozeduren, und wählen Sie neue gespeicherte Prozedur hinzufügen aus (siehe Abbildung 6).</span><span class="sxs-lookup"><span data-stu-id="08eeb-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>

![Fügen Sie eine neue gespeicherte Prozedur für das Paging durch die Produkte hinzu.](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="08eeb-227">**Abbildung 6**: Hinzufügen einer neuen gespeicherten Prozedur für das Paging durch die Produkte</span><span class="sxs-lookup"><span data-stu-id="08eeb-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>

<span data-ttu-id="08eeb-228">Diese gespeicherte Prozedur sollte zwei ganzzahlige Eingabeparameter akzeptieren: `@startRowIndex` und `@maximumRows` und die `ROW_NUMBER()` Funktion verwenden, geordnet nach dem `ProductName` Feld, wobei nur die Zeilen zurückgegeben werden, die größer sind als der angegebene `@startRowIndex` und kleiner oder gleich `@startRowIndex` + `@maximumRow`.</span><span class="sxs-lookup"><span data-stu-id="08eeb-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="08eeb-229">Geben Sie das folgende Skript in die neue gespeicherte Prozedur ein, und klicken Sie dann auf das Symbol speichern, um die gespeicherte Prozedur der Datenbank hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="08eeb-230">Nehmen Sie sich nach dem Erstellen der gespeicherten Prozedur einen Moment Zeit, um Sie zu testen. Klicken Sie mit der rechten Maustaste auf den Namen der gespeicherten Prozedur `GetProductsPaged` im Server-Explorer, und wählen Sie die Option Ausführen aus.</span><span class="sxs-lookup"><span data-stu-id="08eeb-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="08eeb-231">Anschließend werden Sie von Visual Studio zur Eingabe von Eingabe Parametern, `@startRowIndex` und `@maximumRow` s aufgefordert (siehe Abbildung 7).</span><span class="sxs-lookup"><span data-stu-id="08eeb-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="08eeb-232">Testen Sie verschiedene Werte, und überprüfen Sie die Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="08eeb-232">Try different values and examine the results.</span></span>

![Geben Sie einen Wert für die Parameter @startRowIndex und @maximumRows ein.](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="08eeb-234"><strong>Abbildung 7</strong>: Eingeben eines Werts für die Parameter "@startRowIndex" und "@maximumRows"</span><span class="sxs-lookup"><span data-stu-id="08eeb-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>

<span data-ttu-id="08eeb-235">Nachdem Sie diese Eingabeparameter Werte ausgewählt haben, zeigt das Ausgabefenster die Ergebnisse an.</span><span class="sxs-lookup"><span data-stu-id="08eeb-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="08eeb-236">Abbildung 8 zeigt die Ergebnisse bei der Übergabe von 10 für die Parameter `@startRowIndex` und `@maximumRows`.</span><span class="sxs-lookup"><span data-stu-id="08eeb-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>

<span data-ttu-id="08eeb-237">[Es werden ![die Datensätze zurückgegeben, die auf der zweiten Seite der Daten angezeigt werden.](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="08eeb-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="08eeb-238">**Abbildung 8**: die Datensätze, die auf der zweiten Seite der Daten angezeigt werden, werden zurückgegeben ([Klicken Sie, um das Bild in voller Größe anzuzeigen](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="08eeb-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>

<span data-ttu-id="08eeb-239">Nachdem Sie diese gespeicherte Prozedur erstellt haben, können Sie die `ProductsTableAdapter`-Methode erstellen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="08eeb-240">Öffnen Sie das `Northwind.xsd` typisierte DataSet, klicken Sie mit der rechten Maustaste in den `ProductsTableAdapter`, und wählen Sie die Option Abfrage hinzufügen aus.</span><span class="sxs-lookup"><span data-stu-id="08eeb-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="08eeb-241">Anstatt die Abfrage mit einer Ad-hoc-SQL-Anweisung zu erstellen, erstellen Sie Sie mithilfe einer vorhandenen gespeicherten Prozedur.</span><span class="sxs-lookup"><span data-stu-id="08eeb-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>

![Erstellen der dal-Methode mithilfe einer vorhandenen gespeicherten Prozedur](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="08eeb-243">**Abbildung 9**: Erstellen der dal-Methode mithilfe einer vorhandenen gespeicherten Prozedur</span><span class="sxs-lookup"><span data-stu-id="08eeb-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>

<span data-ttu-id="08eeb-244">Als nächstes werden wir aufgefordert, die aufzurufende gespeicherte Prozedur auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="08eeb-245">Wählen Sie in der Dropdown Liste die gespeicherte Prozedur `GetProductsPaged` aus.</span><span class="sxs-lookup"><span data-stu-id="08eeb-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>

![Wählen Sie in der Dropdown Liste die gespeicherte Prozedur getproductspaged aus.](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="08eeb-247">**Abbildung 10**: Auswählen der gespeicherten Prozedur "getproductspaged" aus der Dropdown Liste</span><span class="sxs-lookup"><span data-stu-id="08eeb-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>

<span data-ttu-id="08eeb-248">Im nächsten Bildschirm werden Sie gefragt, welche Art von Daten von der gespeicherten Prozedur zurückgegeben wird: tabellarische Daten, ein einzelner Wert oder kein Wert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="08eeb-249">Da die gespeicherte Prozedur `GetProductsPaged` mehrere Datensätze zurückgeben kann, geben Sie an, dass Tabellendaten zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>

![Gibt an, dass die gespeicherte Prozedur Tabellendaten zurückgibt.](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="08eeb-251">**Abbildung 11**: angeben, dass die gespeicherte Prozedur Tabellendaten zurückgibt</span><span class="sxs-lookup"><span data-stu-id="08eeb-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="08eeb-252">Geben Sie abschließend die Namen der Methoden an, die Sie erstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="08eeb-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="08eeb-253">Wie bei den vorherigen Tutorials können Sie auch Methoden erstellen, indem Sie die Datentabelle ausfüllen verwenden und eine Datentabelle zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="08eeb-254">Benennen Sie die erste Methode `FillPaged` und die zweite `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="08eeb-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>

![Benennen Sie die Methoden fillpout und getproductspaged.](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="08eeb-256">**Abbildung 12**: Benennen der Methoden "fillpout" und "getproductspaged"</span><span class="sxs-lookup"><span data-stu-id="08eeb-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>

<span data-ttu-id="08eeb-257">Zusätzlich zum Erstellen einer dal-Methode, um eine bestimmte Produktseite zurückzugeben, müssen wir diese Funktionalität auch in der BLL bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="08eeb-258">Wie die DAL-Methode muss die getproductspaged-Methode der BLL s zwei ganzzahlige Eingaben zum Angeben des Start Zeilen Indexes und der maximalen Zeilen akzeptieren und nur die Datensätze zurückgeben, die in den angegebenen Bereich fallen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="08eeb-259">Erstellen Sie eine solche BLL-Methode in der productbll-Klasse, die lediglich die getproductspaged-Methode von Dal s aufruft, wie im folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="08eeb-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="08eeb-260">Sie können einen beliebigen Namen für die Eingabeparameter der BLL-Methode verwenden, aber wie wir in Kürze sehen werden, werden wir uns für die Verwendung von `startRowIndex` und `maximumRows` bei der Konfiguration einer ObjectDataSource für die Verwendung dieser Methode von einem zusätzlichen Arbeitsaufwand ersparen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="08eeb-261">Schritt 4: Konfigurieren von ObjectDataSource für die Verwendung von benutzerdefiniertem Paging</span><span class="sxs-lookup"><span data-stu-id="08eeb-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="08eeb-262">Wenn die BLL-und Dal-Methoden für den Zugriff auf eine bestimmte Teilmenge von Datensätzen abgeschlossen sind, können wir ein GridView-Steuerelement erstellen, das die zugrunde liegenden Datensätze mithilfe von benutzerdefiniertem Paging durchläuft.</span><span class="sxs-lookup"><span data-stu-id="08eeb-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="08eeb-263">Öffnen Sie zunächst die Seite `EfficientPaging.aspx` im Ordner `PagingAndSorting`, fügen Sie der Seite eine GridView hinzu, und konfigurieren Sie Sie für die Verwendung eines neuen ObjectDataSource-Steuer Elements.</span><span class="sxs-lookup"><span data-stu-id="08eeb-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="08eeb-264">In unseren vorherigen Tutorials haben wir die ObjectDataSource häufig so konfiguriert, dass Sie die `ProductsBLL` Class s `GetProducts`-Methode verwendet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="08eeb-265">Diesmal möchten wir jedoch die `GetProductsPaged`-Methode verwenden, da die `GetProducts`-Methode *alle* Produkte in der Datenbank zurückgibt, während `GetProductsPaged` nur eine bestimmte Teilmenge von Datensätzen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>

![Konfigurieren von ObjectDataSource für die Verwendung der getproductspaged-Methode der productbll-Klasse](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="08eeb-267">**Abbildung 13**: Konfigurieren von ObjectDataSource für die Verwendung der getproductspaged-Methode der productbll-Klasse</span><span class="sxs-lookup"><span data-stu-id="08eeb-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>

<span data-ttu-id="08eeb-268">Da wir eine schreibgeschützte GridView-Sicht neu erstellen, nehmen Sie sich einen Moment Zeit, um die Dropdown Liste der Methode auf den Registerkarten einfügen, aktualisieren und löschen auf (keine) festzulegen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="08eeb-269">Im nächsten Schritt werden Sie vom Assistenten für ObjectDataSource zur Eingabe der Quellen der `GetProductsPaged` Methode s `startRowIndex` und `maximumRows` Eingabeparameter Werten aufgefordert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="08eeb-270">Diese Eingabeparameter werden tatsächlich automatisch von der GridView festgelegt. lassen Sie die Quelle also auf keine festgelegt, und klicken Sie auf Fertigstellen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>

![Belassen Sie die Eingabe Parameter Quellen als "None".](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="08eeb-272">**Abbildung 14**: belassen der Eingabe Parameter Quellen als "None"</span><span class="sxs-lookup"><span data-stu-id="08eeb-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>

<span data-ttu-id="08eeb-273">Nachdem Sie den ObjectDataSource-Assistenten abgeschlossen haben, enthält das GridView-Objekt ein BoundField-oder CheckBoxField-Objekt für jedes der Product Data-Felder.</span><span class="sxs-lookup"><span data-stu-id="08eeb-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="08eeb-274">Sie können die Darstellung des GridView-s beliebig anpassen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="08eeb-275">Ich habe entschieden, nur die `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`und `UnitPrice` boundfields anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="08eeb-276">Konfigurieren Sie außerdem die GridView so, dass Paging unterstützt wird, indem Sie das Kontrollkästchen Paging aktivieren im Smarttags aktivieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="08eeb-277">Nach diesen Änderungen sollten das deklarative Markup View-und ObjectDataSource-Markup in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="08eeb-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="08eeb-278">Wenn Sie die Seite jedoch über einen Browser besuchen, ist die GridView nicht gefunden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>

![Die GridView wird nicht angezeigt.](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="08eeb-280">**Abbildung 15**: die GridView wird nicht angezeigt</span><span class="sxs-lookup"><span data-stu-id="08eeb-280">**Figure 15**: The GridView is Not Displayed</span></span>

<span data-ttu-id="08eeb-281">Die GridView fehlt, weil ObjectDataSource aktuell 0 als Werte für die `GetProductsPaged` `startRowIndex`-und `maximumRows`-Eingabeparameter verwendet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="08eeb-282">Daher gibt die resultierende SQL-Abfrage keine Datensätze zurück, weshalb die GridView nicht angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="08eeb-283">Um dieses Problem zu beheben, müssen wir ObjectDataSource für die Verwendung von benutzerdefiniertem Paging konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="08eeb-284">Dies kann in den folgenden Schritten erreicht werden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="08eeb-285">**Legen Sie die Eigenschaft ObjectDataSource s `EnablePaging` auf fest `true`** dies der ObjectDataSource angibt, dass Sie an die `SelectMethod` zwei zusätzlichen Parametern übergeben werden muss: eine, um den Start Zeilen Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) anzugeben, und eine, um die maximale Anzahl von Zeilen ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)) anzugeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="08eeb-286">**Legen Sie die Eigenschaften ObjectDataSource s `StartRowIndexParameterName` und `MaximumRowsParameterName` entsprechend** die Eigenschaften `StartRowIndexParameterName` und `MaximumRowsParameterName` die Namen der Eingabeparameter an, die für benutzerdefinierte Paginierung an die `SelectMethod` übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="08eeb-287">Standardmäßig sind diese Parameternamen `startIndexRow` und `maximumRows`. aus diesem Grund wurden beim Erstellen der `GetProductsPaged`-Methode in der BLL diese Werte für die Eingabeparameter verwendet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="08eeb-288">Wenn Sie andere Parameternamen für die BLL s-`GetProductsPaged` Methode verwenden möchten, z. b. `startIndex` und `maxRows`, müssen Sie z. b. die Eigenschaften von ObjectDataSource s `StartRowIndexParameterName` und `MaximumRowsParameterName` entsprechend festlegen (z. b. startIndex für `StartRowIndexParameterName` und MaxRows für `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="08eeb-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="08eeb-289">**Legen Sie die [Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) ObjectDataSource s`SelectCountMethod` auf den Namen der Methode fest, die die Gesamtanzahl der Datensätze zurückgibt, die durchlaufen werden (`TotalNumberOfProducts`)** , dass die `ProductsBLL` Class s `TotalNumberOfProducts`-Methode die Gesamtzahl der Datensätze zurückgibt, die mithilfe einer dal-Methode, die eine `SELECT COUNT(*) FROM Products` Abfrage ausführt, durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="08eeb-290">Diese Informationen werden von ObjectDataSource benötigt, um die Paging-Schnittstelle ordnungsgemäß zu erzeugen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="08eeb-291">**Entfernen Sie die `startRowIndex`-und `maximumRows` `<asp:Parameter>` Elemente aus dem deklarativen Markup von ObjectDataSource s** , wenn Sie ObjectDataSource mithilfe des Assistenten konfigurieren. Visual Studio hat automatisch zwei `<asp:Parameter>` Elemente für die Eingabeparameter der `GetProductsPaged`-Methode hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="08eeb-292">Wenn Sie `EnablePaging` auf `true`festlegen, werden diese Parameter automatisch übermittelt. Wenn Sie auch in der deklarativen Syntax angezeigt werden, versucht ObjectDataSource, *vier* Parameter an die `GetProductsPaged`-Methode und zwei Parameter an die `TotalNumberOfProducts`-Methode zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="08eeb-293">Wenn Sie vergessen, diese `<asp:Parameter>` Elemente zu entfernen, erhalten Sie beim Aufrufen der Seite über einen Browser eine Fehlermeldung wie die folgende: *ObjectDataSource "ObjectDataSource1" konnte keine nicht generische Methode "totalmaximiofproducts" finden, die Parameter hat: StartRowIndex, MaximumRows*.</span><span class="sxs-lookup"><span data-stu-id="08eeb-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="08eeb-294">Nachdem Sie diese Änderungen vorgenommen haben, sollte die deklarative Syntax von ObjectDataSource s wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="08eeb-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="08eeb-295">Beachten Sie, dass die Eigenschaften "`EnablePaging`" und "`SelectCountMethod`" festgelegt wurden und die `<asp:Parameter>` Elemente entfernt wurden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="08eeb-296">Abbildung 16 zeigt einen Screenshot der Eigenschaftenfenster, nachdem diese Änderungen vorgenommen wurden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>

![Konfigurieren Sie zum Verwenden von benutzerdefiniertem Paging das ObjectDataSource-Steuerelement.](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="08eeb-298">**Abbildung 16**: Konfigurieren des ObjectDataSource-Steuer Elements für die Verwendung von benutzerdefiniertem Paging</span><span class="sxs-lookup"><span data-stu-id="08eeb-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>

<span data-ttu-id="08eeb-299">Nachdem Sie diese Änderungen vorgenommen haben, besuchen Sie diese Seite über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="08eeb-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="08eeb-300">Es sollten 10 Produkte aufgelistet werden, die alphabetisch sortiert sind.</span><span class="sxs-lookup"><span data-stu-id="08eeb-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="08eeb-301">Nehmen Sie sich einen Moment Zeit, um die Datenseiten Weise zu durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="08eeb-302">Es gibt zwar keinen visuellen Unterschied zwischen der Perspektive des Endbenutzers zwischen Standard-Paging und benutzerdefiniertem Paging, das benutzerdefinierte Paging wird jedoch effizienter durch große Datenmengen abgerufen, da nur die Datensätze abgerufen werden, die für eine bestimmte Seite angezeigt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>

<span data-ttu-id="08eeb-303">[![die Daten nach dem Namen des Produkts geordnet, werden mithilfe von benutzerdefiniertem Paging ausgelagert.](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="08eeb-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="08eeb-304">**Abbildung 17**: die Daten, geordnet nach dem Namen des Produkts, werden mithilfe von benutzerdefiniertem Paging ausgelagert ([Klicken Sie, um das Bild in voller Größe anzuzeigen](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="08eeb-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="08eeb-305">Bei benutzerdefiniertem Paging wird der von der ObjectDataSource s-`SelectCountMethod` zurückgegebene Wert der Seitenanzahl im GridView s-Ansichts Zustand gespeichert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="08eeb-306">Andere GridView-Variablen die `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` Auflistung usw. werden im Steuerelement *Zustand*gespeichert, der unabhängig vom Wert der Eigenschaft "GridView s `EnableViewState`" beibehalten wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="08eeb-307">Da der `PageCount` Wert über Postbacks hinweg mit dem Ansichts Zustand beibehalten wird, ist es zwingend erforderlich, dass der GridView s-Ansichts Zustand aktiviert ist, wenn Sie eine Paging-Schnittstelle verwenden, die einen Link zur letzten Seite enthält.</span><span class="sxs-lookup"><span data-stu-id="08eeb-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="08eeb-308">(Wenn die pagingschnittstelle keinen direkten Link zur letzten Seite enthält, können Sie den Ansichts Zustand deaktivieren.)</span><span class="sxs-lookup"><span data-stu-id="08eeb-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>

<span data-ttu-id="08eeb-309">Wenn Sie auf den Link letzte Seite klicken, wird ein Postback ausgelöst, und die GridView wird angewiesen, die `PageIndex`-Eigenschaft zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="08eeb-310">Wenn auf den letzten Seiten Link geklickt wird, weist das GridView-Objekt seine `PageIndex`-Eigenschaft einem Wert zu, der kleiner als seine `PageCount`-Eigenschaft ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="08eeb-311">Wenn der Ansichts Zustand deaktiviert ist, geht der `PageCount` Wert über Postbacks verloren, und dem `PageIndex` wird stattdessen der maximale ganzzahlige Wert zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="08eeb-312">Als nächstes versucht die GridView, den Zeilen Index zu ermitteln, indem die Eigenschaften `PageSize` und `PageCount` multipliziert werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="08eeb-313">Dies führt zu einer `OverflowException`, da das Produkt die maximal zulässige ganzzahlige Größe überschreitet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="08eeb-314">Implementieren von benutzerdefiniertem Paging und Sortieren</span><span class="sxs-lookup"><span data-stu-id="08eeb-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="08eeb-315">Die aktuelle Implementierung der benutzerdefinierten Paginierung erfordert, dass die Reihenfolge, in der die Daten durchlaufen werden, bei der Erstellung der gespeicherten Prozedur `GetProductsPaged` statisch angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="08eeb-316">Möglicherweise haben Sie jedoch bemerkt, dass das GridView s-Smarttag neben der Option Paging aktivieren auch das Kontrollkästchen Sortierung aktivieren enthält.</span><span class="sxs-lookup"><span data-stu-id="08eeb-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="08eeb-317">Das Hinzufügen von Sortierungs Unterstützung zu GridView mit unserer aktuellen benutzerdefinierten pagingimplementierung wird jedoch nur die Datensätze auf der aktuell angezeigten Datenseite sortieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="08eeb-318">Wenn Sie z. b. die GridView so konfigurieren, dass auch Paging unterstützt wird, und dann beim Anzeigen der ersten Seite der Daten in absteigender Reihenfolge nach Produktname sortieren, wird die Reihenfolge der Produkte auf Seite 1 umgekehrt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="08eeb-319">Wie in Abbildung 18 gezeigt, zeigt Carnarvon Tigers als erstes Produkt, wenn die Sortierung in umgekehrter alphabetischer Reihenfolge erfolgt, die die 71 anderen Produkte ignoriert, die in alphabetischer Reihenfolge nach Carnarvon Tigers stehen. nur die Datensätze auf der ersten Seite werden in der Sortierung berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>

<span data-ttu-id="08eeb-320">[nur ![die auf der aktuellen Seite angezeigten Daten sortiert werden.](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="08eeb-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="08eeb-321">**Abbildung 18**: nur die auf der aktuellen Seite angezeigten Daten werden sortiert ([Klicken Sie, um das Bild in voller Größe anzuzeigen](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="08eeb-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>

<span data-ttu-id="08eeb-322">Die Sortierung gilt nur für die aktuelle Datenseite, da die Sortierung erfolgt, nachdem die Daten aus der BLL s-`GetProductsPaged`-Methode abgerufen wurden, und diese Methode gibt nur die Datensätze für die jeweilige Seite zurück.</span><span class="sxs-lookup"><span data-stu-id="08eeb-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="08eeb-323">Um die Sortierung ordnungsgemäß zu implementieren, müssen wir den Sortier Ausdruck an die `GetProductsPaged`-Methode übergeben, damit die Daten entsprechend sortiert werden können, bevor die jeweilige Datenseite zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="08eeb-324">Im nächsten Tutorial erfahren Sie, wie Sie dies erreichen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="08eeb-325">Implementieren von benutzerdefiniertem Paging und löschen</span><span class="sxs-lookup"><span data-stu-id="08eeb-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="08eeb-326">Wenn Sie das Löschen von Funktionen in einer GridView aktivieren, deren Daten mithilfe von benutzerdefinierten pagingverfahren ausgelagert werden, werden Sie feststellen, dass beim Löschen des letzten Datensatzes aus der letzten Seite die GridView nicht mehr ordnungsgemäß herabgesetzt wird, anstatt die `PageIndex`der GridView zu verringern.</span><span class="sxs-lookup"><span data-stu-id="08eeb-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="08eeb-327">Zum Reproduzieren dieses Fehlers aktivieren Sie das Löschen für das soeben erstellte Tutorial.</span><span class="sxs-lookup"><span data-stu-id="08eeb-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="08eeb-328">Wechseln Sie zur letzten Seite (Seite 9), auf der ein einzelnes Produkt angezeigt werden soll, da wir das Paging über 81 Produkte, 10 Produkte auf einmal durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="08eeb-329">Löschen Sie dieses Produkt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-329">Delete this product.</span></span>

<span data-ttu-id="08eeb-330">Nach dem Löschen des letzten Produkts *sollte* die GridView automatisch zur achten Seite wechseln, und diese Funktionalität wird mit Standard Auslagerung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="08eeb-331">Mit benutzerdefiniertem Paging wird jedoch nach dem Löschen des letzten Produkts auf der letzten Seite das GridView-Fenster ganz einfach auf dem Bildschirm ausgeblendet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="08eeb-332">Der genaue Grund dafür ist, dass dieser Vorgang etwas über den *Rahmen dieses Tutorials* hinausgeht. Weitere Informationen finden Sie unter [Löschen des letzten Datensatzes auf der letzten Seite aus einer GridView mit benutzerdefiniertem Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) für die Details auf niedriger Ebene.</span><span class="sxs-lookup"><span data-stu-id="08eeb-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="08eeb-333">In der Zusammenfassung werden die folgenden Schritte ausgeführt, die von der GridView ausgeführt werden, wenn auf die Schaltfläche "Löschen" geklickt wird:</span><span class="sxs-lookup"><span data-stu-id="08eeb-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="08eeb-334">Löschen des Datensatzes</span><span class="sxs-lookup"><span data-stu-id="08eeb-334">Delete the record</span></span>
2. <span data-ttu-id="08eeb-335">Hiermit werden die entsprechenden Datensätze zum Anzeigen der angegebenen `PageIndex` und `PageSize`</span><span class="sxs-lookup"><span data-stu-id="08eeb-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="08eeb-336">Stellen Sie sicher, dass die `PageIndex` die Anzahl der Datenseiten in der Datenquelle nicht überschreitet. Wenn dies der Fall ist, wird die `PageIndex` Eigenschaft GridView s automatisch Dekrement</span><span class="sxs-lookup"><span data-stu-id="08eeb-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="08eeb-337">Binden der entsprechenden Datenseite an die GridView mithilfe der in Schritt 2 erhaltenen Datensätze</span><span class="sxs-lookup"><span data-stu-id="08eeb-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="08eeb-338">Das Problem ist darauf zurückzuführen, dass in Schritt 2 die `PageIndex`, die beim Abrufen der anzuzeigenden Datensätze verwendet werden, nach wie vor die `PageIndex` der letzten Seite ist, deren einziger Datensatz soeben gelöscht wurde.</span><span class="sxs-lookup"><span data-stu-id="08eeb-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="08eeb-339">Aus diesem Grund werden in Schritt 2 *keine* Datensätze zurückgegeben, da die letzte Seite der Daten keine Datensätze mehr enthält.</span><span class="sxs-lookup"><span data-stu-id="08eeb-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="08eeb-340">In Schritt 3 erkennt die GridView, dass die `PageIndex`-Eigenschaft größer ist als die Gesamtanzahl der Seiten in der Datenquelle (seit dem Löschen des letzten Datensatzes auf der letzten Seite) und verringert daher seine `PageIndex`-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="08eeb-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="08eeb-341">In Schritt 4 versucht die GridView, sich an die in Schritt 2 abgerufenen Daten zu binden. in Schritt 2 wurden jedoch keine Datensätze zurückgegeben, was zu einer leeren GridView führte.</span><span class="sxs-lookup"><span data-stu-id="08eeb-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="08eeb-342">Beim standardmäßigen Paging wird dieses Problem nicht in der Oberfläche gelöst, da in Schritt 2 *alle* Datensätze aus der Datenquelle abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="08eeb-343">Um dieses Problem zu beheben, haben wir zwei Möglichkeiten.</span><span class="sxs-lookup"><span data-stu-id="08eeb-343">To fix this we have two options.</span></span> <span data-ttu-id="08eeb-344">Der erste besteht darin, einen Ereignishandler für den GridView s `RowDeleted`-Ereignishandler zu erstellen, der bestimmt, wie viele Datensätze auf der Seite angezeigt wurden, die soeben gelöscht wurde.</span><span class="sxs-lookup"><span data-stu-id="08eeb-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="08eeb-345">Wenn nur ein Datensatz vorhanden ist, muss der soeben gelöschte Datensatz der letzte Datensatz sein, und die GridView s-`PageIndex`muss verringert werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="08eeb-346">Natürlich möchten wir nur die `PageIndex` aktualisieren, wenn der Löschvorgang tatsächlich erfolgreich war. Dies kann durch sicherstellen sichergestellt werden, dass die Eigenschaft `e.Exception` `null`ist.</span><span class="sxs-lookup"><span data-stu-id="08eeb-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="08eeb-347">Diese Vorgehensweise funktioniert, weil Sie die `PageIndex` nach Schritt 1, aber vor Schritt 2 aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="08eeb-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="08eeb-348">Daher wird in Schritt 2 der entsprechende Satz von Datensätzen zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="08eeb-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="08eeb-349">Verwenden Sie hierzu Code wie den folgenden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-349">To accomplish this, use code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="08eeb-350">Eine Alternative Problem Umgehung besteht darin, einen Ereignishandler für das Ereignis "ObjectDataSource s `RowDeleted`" zu erstellen und die `AffectedRows`-Eigenschaft auf den Wert "1" festzulegen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="08eeb-351">Nach dem Löschen des Datensatzes in Schritt 1 (aber vor dem erneuten Abrufen der Daten in Schritt 2) aktualisiert die GridView die `PageIndex`-Eigenschaft, wenn eine oder mehrere Zeilen vom Vorgang betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="08eeb-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="08eeb-352">Die `AffectedRows`-Eigenschaft wird jedoch nicht von ObjectDataSource festgelegt, weshalb dieser Schritt ausgelassen wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="08eeb-353">Eine Möglichkeit, diesen Schritt auszuführen, besteht darin, die `AffectedRows`-Eigenschaft manuell festzulegen, wenn der Löschvorgang erfolgreich abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="08eeb-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="08eeb-354">Dies kann mithilfe von Code wie dem folgenden erreicht werden:</span><span class="sxs-lookup"><span data-stu-id="08eeb-354">This can be accomplished using code like the following:</span></span>

[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="08eeb-355">Der Code für beide Ereignishandler finden Sie in der Code Behind-Klasse des `EfficientPaging.aspx` Beispiels.</span><span class="sxs-lookup"><span data-stu-id="08eeb-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="08eeb-356">Vergleichen der Leistung von Default und Custom Paging</span><span class="sxs-lookup"><span data-stu-id="08eeb-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="08eeb-357">Da das benutzerdefinierte Paging nur die benötigten Datensätze abruft, während die Standard Paginierung *alle* Datensätze für jede angezeigte Seite zurückgibt, ist es klar, dass das benutzerdefinierte Paging effizienter ist als das Standardpaging.</span><span class="sxs-lookup"><span data-stu-id="08eeb-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="08eeb-358">Aber wie viel effizienter ist das benutzerdefinierte Paging?</span><span class="sxs-lookup"><span data-stu-id="08eeb-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="08eeb-359">Welche Art von Leistungssteigerungen können Sie anzeigen, indem Sie von der Standard Auslagerung zu benutzerdefiniertem Paging wechseln?</span><span class="sxs-lookup"><span data-stu-id="08eeb-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="08eeb-360">Leider gibt es hier keine Antwort.</span><span class="sxs-lookup"><span data-stu-id="08eeb-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="08eeb-361">Der Leistungsgewinn hängt von einer Reihe von Faktoren ab. die wichtigsten zwei sind die Anzahl der Datensätze, die durchlaufen werden, sowie die Last auf dem Datenbankserver und die Kommunikationskanäle zwischen dem Webserver und dem Datenbankserver.</span><span class="sxs-lookup"><span data-stu-id="08eeb-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="08eeb-362">Bei kleinen Tabellen mit nur wenigen Dutzend Datensätzen kann der Leistungsunterschied vernachlässigbar sein.</span><span class="sxs-lookup"><span data-stu-id="08eeb-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="08eeb-363">Bei großen Tabellen mit Tausenden bis Hunderttausenden von Zeilen ist der Leistungsunterschied jedoch akut.</span><span class="sxs-lookup"><span data-stu-id="08eeb-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="08eeb-364">Ein Artikel von My, [Custom Paging in ASP.NET 2,0 mit SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), enthält einige Leistungstests, die ich ausgeführt habe, um die Unterschiede in der Leistung zwischen diesen beiden Paging-Techniken beim Paging durch eine Datenbanktabelle mit 50.000 Datensätzen zu präsentieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="08eeb-365">In diesen Tests habe ich die Zeit für die Ausführung der Abfrage auf SQL Server Ebene (mithilfe von [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) und auf der ASP.NET-Seite unter Verwendung von [ASP.net s-Ablauf Verfolgungs Funktionen](https://msdn.microsoft.com/library/y13fw6we.aspx)überprüft.</span><span class="sxs-lookup"><span data-stu-id="08eeb-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="08eeb-366">Beachten Sie, dass diese Tests in meinem Entwicklungsfeld mit einem einzelnen aktiven Benutzer ausgeführt wurden und daher nicht sicher sind und keine typischen Website-Auslastungs Muster imitieren.</span><span class="sxs-lookup"><span data-stu-id="08eeb-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="08eeb-367">Unabhängig davon veranschaulichen die Ergebnisse die relativen Unterschiede in der Ausführungszeit für das standardmäßige und benutzerdefinierte Paging bei der Arbeit mit ausreichend großen Datenmengen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>

|  | <span data-ttu-id="08eeb-368">**Durchschn. Dauer (Sek.)**</span><span class="sxs-lookup"><span data-stu-id="08eeb-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="08eeb-369">**Reads**</span><span class="sxs-lookup"><span data-stu-id="08eeb-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="08eeb-370">**Standard-Paging-SQL-Profiler**</span><span class="sxs-lookup"><span data-stu-id="08eeb-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="08eeb-371">1.411</span><span class="sxs-lookup"><span data-stu-id="08eeb-371">1.411</span></span> | <span data-ttu-id="08eeb-372">383</span><span class="sxs-lookup"><span data-stu-id="08eeb-372">383</span></span> |
| <span data-ttu-id="08eeb-373">**Benutzerdefiniertes Paging von SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="08eeb-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="08eeb-374">0.002</span><span class="sxs-lookup"><span data-stu-id="08eeb-374">0.002</span></span> | <span data-ttu-id="08eeb-375">29</span><span class="sxs-lookup"><span data-stu-id="08eeb-375">29</span></span> |
| <span data-ttu-id="08eeb-376">**Standard-Paging ASP.net Ablauf Verfolgung**</span><span class="sxs-lookup"><span data-stu-id="08eeb-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="08eeb-377">2.379</span><span class="sxs-lookup"><span data-stu-id="08eeb-377">2.379</span></span> | <span data-ttu-id="08eeb-378">*N/V*</span><span class="sxs-lookup"><span data-stu-id="08eeb-378">*N/A*</span></span> |
| <span data-ttu-id="08eeb-379">**Benutzerdefiniertes Paging ASP.net Ablauf Verfolgung**</span><span class="sxs-lookup"><span data-stu-id="08eeb-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="08eeb-380">0.029</span><span class="sxs-lookup"><span data-stu-id="08eeb-380">0.029</span></span> | <span data-ttu-id="08eeb-381">*N/V*</span><span class="sxs-lookup"><span data-stu-id="08eeb-381">*N/A*</span></span> |

<span data-ttu-id="08eeb-382">Wie Sie sehen können, erforderte das Abrufen einer bestimmten Datenseite im Durchschnitt 354 weniger Lesevorgänge und wurde in einem Bruchteil der Zeit abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="08eeb-383">Auf der Seite "ASP.net" konnte die Seite in der Nähe des standardmäßigen Auslagerungs Zeitraums (<sup>in der 1/100</sup> Nähe des standardmäßigen Paging) wieder hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="08eeb-384">Weitere Informationen zu diesen Ergebnissen sowie Code und eine Datenbank, die Sie herunterladen können, um diese Tests in ihrer eigenen Umgebung zu reproduzieren, finden Sie in diesem [Artikel](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) .</span><span class="sxs-lookup"><span data-stu-id="08eeb-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="08eeb-385">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="08eeb-385">Summary</span></span>

<span data-ttu-id="08eeb-386">Standard-Paging ist ein geliefert zur Implementierung, aktivieren Sie das Kontrollkästchen Paging aktivieren im Smarttags des dateiweb-Steuer Elements, aber eine solche Einfachheit ergibt sich aus den Kosten der Leistung.</span><span class="sxs-lookup"><span data-stu-id="08eeb-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="08eeb-387">Beim standardmäßigen Paging werden *alle* Datensätze zurückgegeben, wenn ein Benutzer eine beliebige Seite mit Daten anfordert, obwohl möglicherweise nur ein kleiner Bruchteil davon angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="08eeb-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="08eeb-388">Zur Bekämpfung dieses Leistungs Aufwands bietet ObjectDataSource eine Alternative Paging-Option für benutzerdefiniertes Paging.</span><span class="sxs-lookup"><span data-stu-id="08eeb-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="08eeb-389">Während das benutzerdefinierte Paging bei der standardmäßigen Auslagerung von Leistungsproblemen verbessern kann, indem nur die Datensätze abgerufen werden, die angezeigt werden müssen, ist die Implementierung von benutzerdefiniertem Paging mehr beteiligt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="08eeb-390">Zuerst muss eine Abfrage geschrieben werden, die ordnungsgemäß (und effizient) auf die bestimmte Teilmenge der angeforderten Datensätze zugreift.</span><span class="sxs-lookup"><span data-stu-id="08eeb-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="08eeb-391">Dies kann auf verschiedene Arten erreicht werden: das, das wir in diesem Tutorial untersucht haben, besteht darin, die neuen `ROW_NUMBER()` Funktion SQL Server 2005 s zu verwenden, um Ergebnisse zu ordnen und dann nur die Ergebnisse zurückzugeben, deren Rangfolge innerhalb eines angegebenen Bereichs liegt.</span><span class="sxs-lookup"><span data-stu-id="08eeb-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="08eeb-392">Außerdem müssen wir eine Möglichkeit hinzufügen, um die Gesamtanzahl der Datensätze zu ermitteln, die durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="08eeb-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="08eeb-393">Nachdem Sie diese dal-und BLL-Methoden erstellt haben, müssen wir auch die ObjectDataSource so konfigurieren, dass Sie bestimmen kann, wie viele Datensätze durchlaufen werden, und die Werte für Start Zeilen Index und maximale Zeilen Menge an die BLL übergeben können.</span><span class="sxs-lookup"><span data-stu-id="08eeb-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="08eeb-394">Die Implementierung von benutzerdefiniertem Paging erfordert zwar eine Reihe von Schritten und ist nicht so einfach wie das standardmäßige Paging, das benutzerdefinierte Paging ist jedoch beim Paging durch ausreichend große Datenmengen notwendig.</span><span class="sxs-lookup"><span data-stu-id="08eeb-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="08eeb-395">Wenn die untersuchten Ergebnisse angezeigt werden, kann das benutzerdefinierte Paging Sekunden aus der ASP.NET Seiten-Rendering-Zeit verringern und die Last auf dem Datenbankserver um eine oder mehrere Größenordnungen erhöhen.</span><span class="sxs-lookup"><span data-stu-id="08eeb-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="08eeb-396">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="08eeb-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="08eeb-397">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="08eeb-397">About the Author</span></span>

<span data-ttu-id="08eeb-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="08eeb-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="08eeb-399">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="08eeb-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="08eeb-400">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="08eeb-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="08eeb-401">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="08eeb-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="08eeb-402">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="08eeb-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="08eeb-403">[Zurück](paging-and-sorting-report-data-cs.md)
> [Weiter](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="08eeb-403">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
