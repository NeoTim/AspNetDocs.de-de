---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: Einschließen einer dateiuploadoption beim HinzufügenC#eines neuen Datensatzes () | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial wird gezeigt, wie Sie eine Weboberfläche erstellen, die es dem Benutzer ermöglicht, Textdaten einzugeben und Binärdateien hochzuladen. So veranschaulichen Sie die verfügbaren Optionen...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: f1287e180151b3034a7b90ef4b3f1fbe68354a09
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/28/2019
ms.locfileid: "74577171"
---
# <a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="e0d0c-104">Einschließen einer Dateiuploadoption beim Hinzufügen eines neuen Datensatzes (C#)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-104">Including a File Upload Option When Adding a New Record (C#)</span></span>

<span data-ttu-id="e0d0c-105">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e0d0c-106">[Beispiel-app herunterladen](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) oder [PDF herunterladen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="e0d0c-107">In diesem Tutorial wird gezeigt, wie Sie eine Weboberfläche erstellen, die es dem Benutzer ermöglicht, Textdaten einzugeben und Binärdateien hochzuladen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="e0d0c-108">Zum Veranschaulichen der Optionen, die zum Speichern von Binärdaten verfügbar sind, wird eine Datei in der Datenbank gespeichert, während die andere im Dateisystem gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>

## <a name="introduction"></a><span data-ttu-id="e0d0c-109">Einführung</span><span class="sxs-lookup"><span data-stu-id="e0d0c-109">Introduction</span></span>

<span data-ttu-id="e0d0c-110">In den beiden vorherigen Tutorials haben wir Techniken zum Speichern von Binärdaten untersucht, die dem Anwendungs-Datenmodell zugeordnet sind. es wird erläutert, wie das FileUpload-Steuerelement verwendet wird, um Dateien vom Client an den Webserver zu senden, und wie diese Binärdaten in einem Data W angezeigt werden. EB-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="e0d0c-111">Es ist jedoch noch zu besprechen, wie hochgeladene Daten mit dem Datenmodell verknüpft werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="e0d0c-112">In diesem Tutorial wird eine Webseite erstellt, um eine neue Kategorie hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="e0d0c-113">Zusätzlich zu den Textfeldern für die Kategorien "Name" und "Description" muss auf dieser Seite zwei FileUpload-Steuerelemente für die neue Kategorie "s" und eine für die Broschüre enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="e0d0c-114">Das hochgeladene Bild wird direkt in der neuen Spalte "Datensatz s `Picture`" gespeichert, während die Broschüre im Ordner "`~/Brochures`" mit dem Pfad zu der Datei gespeichert wird, die in der `BrochurePath` Spalte "neuer Datensatz" gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="e0d0c-115">Vor dem Erstellen dieser neuen Webseite müssen wir die Architektur aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="e0d0c-116">Die Haupt Abfrage `CategoriesTableAdapter` s ruft nicht die `Picture` Spalte ab.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="e0d0c-117">Folglich enthält die automatisch generierte `Insert` Methode nur Eingaben für die Felder "`CategoryName`", "`Description`" und "`BrochurePath`".</span><span class="sxs-lookup"><span data-stu-id="e0d0c-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="e0d0c-118">Daher müssen wir eine zusätzliche Methode im TableAdapter erstellen, die alle vier `Categories` Felder auffordert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="e0d0c-119">Die `CategoriesBLL`-Klasse in der Geschäftslogik Schicht muss ebenfalls aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="e0d0c-120">Schritt 1: Hinzufügen einer`InsertWithPicture`Methode zum`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="e0d0c-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="e0d0c-121">Beim Erstellen des `CategoriesTableAdapter` im Tutorial [Erstellen einer Datenzugriffs Ebene](../introduction/creating-a-data-access-layer-cs.md) haben wir es so konfiguriert, dass basierend auf der Haupt Abfrage automatisch `INSERT`-, `UPDATE`-und `DELETE`-Anweisungen generiert werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="e0d0c-122">Darüber hinaus haben wir den TableAdapter angewiesen, den direkten DB-Ansatz zu verwenden, der die Methoden `Insert`, `Update`und `Delete`erstellt hat.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="e0d0c-123">Diese Methoden führen die automatisch generierten `INSERT`-, `UPDATE`-und `DELETE`-Anweisungen aus und akzeptieren folglich Eingabeparameter basierend auf den Spalten, die von der Haupt Abfrage zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="e0d0c-124">Im Tutorial [Hochladen von Dateien](uploading-files-cs.md) haben wir die Haupt Abfrage `CategoriesTableAdapter` s erweitert, um die `BrochurePath` Spalte zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="e0d0c-125">Da die Haupt Abfrage von `CategoriesTableAdapter` s nicht auf die `Picture` Spalte verweist, können wir weder einen neuen Datensatz hinzufügen noch einen vorhandenen Datensatz mit einem Wert für die `Picture` Spalte aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="e0d0c-126">Um diese Informationen zu erfassen, können Sie entweder eine neue Methode im TableAdapter erstellen, die speziell zum Einfügen eines Datensatzes mit Binärdaten verwendet wird, oder Sie können die automatisch generierte `INSERT` Anweisung anpassen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="e0d0c-127">Das Problem bei der Anpassung der automatisch generierten `INSERT`-Anweisung besteht darin, dass unsere Anpassungen durch den Assistenten überschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="e0d0c-128">Stellen Sie sich beispielsweise vor, dass die `INSERT`-Anweisung so angepasst wurde, dass Sie die Verwendung der `Picture` Spalte einschließt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="e0d0c-129">Dadurch wird die TableAdapter s-`Insert`-Methode so aktualisiert, dass ein zusätzlicher Eingabeparameter für die Binärdaten der Kategorie s angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="e0d0c-130">Wir könnten dann eine Methode in der Geschäftslogik Schicht erstellen, um diese dal-Methode zu verwenden und diese BLL-Methode über die Darstellungs Schicht aufzurufen, und alles funktioniert wunderbar.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="e0d0c-131">Das heißt, bis zum nächsten Mal, als wir den TableAdapter mit dem TableAdapter-Konfigurations-Assistenten konfiguriert haben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="e0d0c-132">Sobald der Assistent abgeschlossen ist, werden die Anpassungen an der `INSERT`-Anweisung überschrieben, die `Insert`-Methode wird auf das alte Formular zurückgesetzt, und der Code würde nicht mehr kompiliert werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="e0d0c-133">Diese Verärgerung ist ein nicht Problem, wenn Sie gespeicherte Prozeduren anstelle von Ad-hoc-SQL-Anweisungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="e0d0c-134">In einem zukünftigen Tutorial wird die Verwendung von gespeicherten Prozeduren anstelle von Ad-hoc-SQL-Anweisungen in der Datenzugriffs Ebene erläutert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>

<span data-ttu-id="e0d0c-135">Um diese potenziellen Probleme zu vermeiden, sollten Sie nicht die automatisch generierten SQL-Anweisungen anpassen, sondern stattdessen eine neue Methode für den TableAdapter erstellen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="e0d0c-136">Diese Methode mit dem Namen `InsertWithPicture`akzeptiert Werte für die Spalten `CategoryName`, `Description`, `BrochurePath`und `Picture` und führt eine `INSERT` Anweisung aus, die alle vier Werte in einem neuen Datensatz speichert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="e0d0c-137">Öffnen Sie das typisierte DataSet, und klicken Sie im Designer mit der rechten Maustaste auf den `CategoriesTableAdapter` s-Header, und wählen Sie im Kontextmenü Abfrage hinzufügen aus.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="e0d0c-138">Dadurch wird der Konfigurations-Assistent für TableAdapter-Abfragen gestartet, in dem Sie gefragt werden, wie die TableAdapter-Abfrage auf die Datenbank zugreifen soll.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="e0d0c-139">Wählen Sie SQL-Anweisungen verwenden, und klicken Sie auf weiter</span><span class="sxs-lookup"><span data-stu-id="e0d0c-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="e0d0c-140">Im nächsten Schritt werden Sie aufgefordert, den Typ der zu generierenden Abfrage einzugeben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="e0d0c-141">Da wir eine Abfrage neu erstellen, um der `Categories` Tabelle einen neuen Datensatz hinzuzufügen, wählen Sie einfügen aus, und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>

<span data-ttu-id="e0d0c-142">[![wählen Sie die Option Einfügen aus.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span></span>

<span data-ttu-id="e0d0c-143">**Abbildung 1**: Auswählen der Option "Einfügen" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>

<span data-ttu-id="e0d0c-144">Wir müssen nun die `INSERT` SQL-Anweisung angeben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="e0d0c-145">Der Assistent schlägt automatisch eine `INSERT` Anweisung vor, die der TableAdapter s-Haupt Abfrage entspricht.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="e0d0c-146">In diesem Fall ist es eine `INSERT`-Anweisung, die die Werte `CategoryName`, `Description`und `BrochurePath` einfügt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="e0d0c-147">Aktualisieren Sie die-Anweisung so, dass die `Picture`-Spalte zusammen mit einem `@Picture` Parameter enthalten ist, wie im folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>

[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="e0d0c-148">Auf dem letzten Bildschirm des Assistenten werden Sie aufgefordert, die neue TableAdapter-Methode zu benennen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="e0d0c-149">Geben Sie `InsertWithPicture`, und klicken Sie auf Fertigstellen</span><span class="sxs-lookup"><span data-stu-id="e0d0c-149">Enter `InsertWithPicture` and click Finish.</span></span>

<span data-ttu-id="e0d0c-150">[![Name der neuen TableAdapter-Methode insertwithpicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span></span>

<span data-ttu-id="e0d0c-151">**Abbildung 2**: Benennen der neuen TableAdapter-Methode `InsertWithPicture` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>

## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="e0d0c-152">Schritt 2: Aktualisieren der Geschäftslogik Ebene</span><span class="sxs-lookup"><span data-stu-id="e0d0c-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="e0d0c-153">Da die Präsentationsschicht nur eine Schnittstelle mit der Geschäftslogik Schicht herstellen sollte, anstatt Sie zu umgehen, um direkt zur Datenzugriffs Ebene zu wechseln, müssen wir eine BLL-Methode erstellen, die die soeben erstellte dal-Methode aufruft (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="e0d0c-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="e0d0c-154">Erstellen Sie für dieses Tutorial eine Methode in der `CategoriesBLL`-Klasse mit dem Namen `InsertWithPicture`, die als Eingabe drei `string` s und ein `byte` Array akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="e0d0c-155">Die `string` Eingabeparameter gelten für den Namen, die Beschreibung und den Dateipfad der Kategorie, während das `byte` Array für den binären Inhalt des Bild der Kategorie s steht.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="e0d0c-156">Wie der folgende Code zeigt, ruft diese BLL-Methode die entsprechende dal-Methode auf:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="e0d0c-157">Stellen Sie sicher, dass Sie das typisierte Dataset gespeichert haben, bevor Sie der BLL die `InsertWithPicture`-Methode hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="e0d0c-158">Da der `CategoriesTableAdapter`-Klassen Code automatisch basierend auf dem typisierten DataSet generiert wird, wird die `Adapter`-Eigenschaft nicht über die `InsertWithPicture`-Methode informiert, wenn Sie die Änderungen am typisierten Dataset zuerst speichern.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won't know about the `InsertWithPicture` method.</span></span>

## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="e0d0c-159">Schritt 3: Auflisten der vorhandenen Kategorien und ihrer Binärdaten</span><span class="sxs-lookup"><span data-stu-id="e0d0c-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="e0d0c-160">In diesem Tutorial erstellen wir eine Seite, die es einem Endbenutzer ermöglicht, dem System eine neue Kategorie hinzuzufügen, die ein Bild und eine Broschüre für die neue Kategorie bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="e0d0c-161">Im [vorherigen Tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) haben wir eine GridView mit einem TemplateField-und ImageField-Element verwendet, um den Namen, die Beschreibung, das Bild und einen Link für die einzelnen Kategorien anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="e0d0c-162">Lassen Sie diese Funktionalität für dieses Tutorial replizieren, indem Sie eine Seite erstellen, die alle vorhandenen Kategorien auflistet und neue erstellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="e0d0c-163">Öffnen Sie zunächst die Seite `DisplayOrDownload.aspx` aus dem Ordner `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="e0d0c-164">Wechseln Sie zur Quell Ansicht, und kopieren Sie die deklarative Syntax GridView und ObjectDataSource s, indem Sie Sie in das `<asp:Content>`-Element in `UploadInDetailsView.aspx`einfügen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="e0d0c-165">Vergessen Sie auch nicht, die `GenerateBrochureLink`-Methode aus der Code Behind-Klasse `DisplayOrDownload.aspx` in `UploadInDetailsView.aspx`zu kopieren.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>

<span data-ttu-id="e0d0c-166">[![kopieren Sie die deklarative Syntax aus displayordownload. aspx in uploadindetailsview. aspx, und fügen Sie Sie ein.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span></span>

<span data-ttu-id="e0d0c-167">**Abbildung 3**: Kopieren und Einfügen der deklarativen Syntax aus `DisplayOrDownload.aspx` in `UploadInDetailsView.aspx` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>

<span data-ttu-id="e0d0c-168">Nachdem Sie die deklarative Syntax und `GenerateBrochureLink` Methode auf die `UploadInDetailsView.aspx` Seite kopiert haben, können Sie die Seite über einen Browser anzeigen, um sicherzustellen, dass alles ordnungsgemäß kopiert wurde.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="e0d0c-169">Es sollte eine GridView mit den acht Kategorien angezeigt werden, die einen Link zum Herunterladen der Broschüre sowie das Bild der Kategorie enthält.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>

<span data-ttu-id="e0d0c-170">[![Sie nun jede Kategorie zusammen mit den zugehörigen Binärdaten sehen.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span></span>

<span data-ttu-id="e0d0c-171">**Abbildung 4**: Sie sollten nun jede Kategorie zusammen mit den zugehörigen Binärdaten sehen ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>

## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="e0d0c-172">Schritt 4: Konfigurieren des`CategoriesDataSource`für die Unterstützung des Einfügens</span><span class="sxs-lookup"><span data-stu-id="e0d0c-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="e0d0c-173">Der von `Categories` GridView verwendete `CategoriesDataSource` ObjectDataSource bietet derzeit keine Möglichkeit zum Einfügen von Daten.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="e0d0c-174">Um das Einfügen über dieses Datenquellen-Steuerelement zu unterstützen, müssen wir die `Insert` Methode einer Methode im zugrunde liegenden Objekt `CategoriesBLL`zuordnen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="e0d0c-175">Insbesondere möchten wir ihn der `CategoriesBLL` Methode zuordnen, die wir in Schritt 2 `InsertWithPicture`hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="e0d0c-176">Klicken Sie zunächst auf den Link Datenquelle konfigurieren des Smarttags ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="e0d0c-177">Der erste Bildschirm zeigt das Objekt, für das die Datenquelle konfiguriert ist, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="e0d0c-178">Belassen Sie diese Einstellung unverändert, und klicken Sie auf Weiter, um mit dem Bildschirm Daten Methoden definieren fortzufahren.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="e0d0c-179">Wechseln Sie zur Registerkarte Einfügen, und wählen Sie die `InsertWithPicture`-Methode aus der Dropdown Liste aus.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="e0d0c-180">Klicken Sie auf Fertig stellen, um den Assistenten abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-180">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e0d0c-181">[![konfigurieren Sie ObjectDataSource für die Verwendung der insertwithpicture-Methode.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span></span>

<span data-ttu-id="e0d0c-182">**Abbildung 5**: Konfigurieren von ObjectDataSource für die Verwendung der `InsertWithPicture`-Methode ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e0d0c-183">Nachdem Sie den Assistenten abgeschlossen haben, fragt Visual Studio möglicherweise, ob Sie Felder und Schlüssel aktualisieren möchten. Dadurch werden die Felder für die datenweb-Steuerelemente neu generiert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="e0d0c-184">Wählen Sie Nein aus, da bei Auswahl von ja alle Feld Anpassungen überschrieben werden, die Sie möglicherweise vorgenommen haben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>

<span data-ttu-id="e0d0c-185">Nachdem Sie den Assistenten abgeschlossen haben, enthält die ObjectDataSource nun einen Wert für die `InsertMethod`-Eigenschaft und `InsertParameters` für die vier Kategoriespalten, wie das folgende deklaratives Markup veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="e0d0c-186">Schritt 5: Erstellen der einfügeschnittstelle</span><span class="sxs-lookup"><span data-stu-id="e0d0c-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="e0d0c-187">Das DetailsView [-](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)Steuerelement bietet eine integrierte einfügeschnittstelle, die beim Arbeiten mit einem Datenquellen-Steuerelement, das das Einfügen unterstützt, verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="e0d0c-188">Fügen Sie dieser Seite oberhalb der GridView ein DetailsView-Steuerelement hinzu, das die einfügeschnittstelle permanent Rendering, sodass ein Benutzer schnell eine neue Kategorie hinzufügen kann.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="e0d0c-189">Beim Hinzufügen einer neuen Kategorie in der DetailsView wird die darunter liegende GridView automatisch aktualisiert und die neue Kategorie angezeigt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="e0d0c-190">Ziehen Sie zunächst eine DetailsView aus der Toolbox auf den Designer oberhalb der GridView, indem Sie die `ID`-Eigenschaft auf `NewCategory` festlegen und die Eigenschaftswerte `Height` und `Width` löschen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="e0d0c-191">Binden Sie das DetailsView s-Smarttag an den vorhandenen `CategoriesDataSource` und aktivieren Sie dann das Kontrollkästchen einfügen aktivieren.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>

<span data-ttu-id="e0d0c-192">[![die DetailsView an die Kategorie "categoriesdatasource" binden und Einfügen aktivieren.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span></span>

<span data-ttu-id="e0d0c-193">**Abbildung 6**: Binden der DetailsView an den `CategoriesDataSource` und Aktivieren des[Einfügens (Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>

<span data-ttu-id="e0d0c-194">Um die DetailsView dauerhaft in der Einfügungs Schnittstelle zu erzeugen, legen Sie die `DefaultMode`-Eigenschaft auf `Insert`fest.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="e0d0c-195">Beachten Sie, dass die DetailsView fünf boundfields-`CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`und `BrochurePath` enthält, obwohl das `CategoryID` BoundField nicht in der einfügeschnittstelle gerendert wird, da dessen `InsertVisible`-Eigenschaft auf `false`festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="e0d0c-196">Diese boundfields sind vorhanden, da es sich um die Spalten handelt, die von der `GetCategories()`-Methode zurückgegeben werden, was die ObjectDataSource aufruft, um Ihre Daten abzurufen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="e0d0c-197">Zum einfügen möchten wir jedoch nicht, dass der Benutzer einen Wert für `NumberOfProducts`angeben soll.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="e0d0c-198">Außerdem müssen wir zulassen, dass Sie ein Bild für die neue Kategorie hochladen und eine PDF-Datei für die Broschüre hochladen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="e0d0c-199">Entfernen Sie das `NumberOfProducts` BoundField vollständig aus der DetailsView, und aktualisieren Sie dann die `HeaderText` Eigenschaften der `CategoryName` und `BrochurePath` boundfields zu Category bzw.-Prospekt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="e0d0c-200">Konvertieren Sie als nächstes das `BrochurePath` BoundField in ein TemplateField-Element, und fügen Sie ein neues TemplateField-Element für das Bild hinzu. Geben Sie diesem neuen TemplateField einen `HeaderText` Wert Bild an.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="e0d0c-201">Verschieben Sie das `Picture` TemplateField, sodass es zwischen der `BrochurePath` TemplateField und CommandField liegt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>

![Die DetailsView an die Kategorie "kategoriesdatasource" binden und Einfügen aktivieren](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="e0d0c-203">**Abbildung 7**: Binden der DetailsView an den `CategoriesDataSource` und Aktivieren des Einfügens</span><span class="sxs-lookup"><span data-stu-id="e0d0c-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>

<span data-ttu-id="e0d0c-204">Wenn Sie die `BrochurePath` BoundField im Dialogfeld Felder bearbeiten in ein TemplateField konvertiert haben, enthält das TemplateField eine `ItemTemplate`, `EditItemTemplate`und `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="e0d0c-205">Es ist jedoch nur die `InsertItemTemplate` erforderlich, sodass Sie die anderen beiden Vorlagen entfernen können.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="e0d0c-206">Nun sollte die deklarative Syntax der DetailsView s wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="e0d0c-207">Hinzufügen von FileUpload-Steuerelementen für die Felder ""</span><span class="sxs-lookup"><span data-stu-id="e0d0c-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="e0d0c-208">Derzeit enthält das `BrochurePath` TemplateField s-`InsertItemTemplate` ein Textfeld, während das `Picture` TemplateField keine Vorlagen enthält.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="e0d0c-209">Wir müssen diese beiden TemplateField s-`InsertItemTemplate` en aktualisieren, damit Sie FileUpload-Steuerelemente verwenden können.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="e0d0c-210">Wählen Sie im Smarttags DetailsView s die Option Vorlagen bearbeiten aus, und wählen Sie dann die `InsertItemTemplate` `BrochurePath` TemplateField s aus der Dropdown Liste aus.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="e0d0c-211">Entfernen Sie das Textfeld, und ziehen Sie dann ein FileUpload-Steuerelement aus der Toolbox in die Vorlage.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="e0d0c-212">Legen Sie die `ID` für das FileUpload-Steuerelement auf `BrochureUpload`fest.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="e0d0c-213">Fügen Sie der `Picture` TemplateField s `InsertItemTemplate`ein FileUpload-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="e0d0c-214">Legen Sie die `ID` dieses FileUpload-Steuer Elements auf `PictureUpload`fest.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>

<span data-ttu-id="e0d0c-215">[![dem InsertItemTemplate ein FileUpload-Steuerelement hinzufügen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span></span>

<span data-ttu-id="e0d0c-216">**Abbildung 8**: Hinzufügen eines FileUpload-Steuer Elements zum `InsertItemTemplate` ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>

<span data-ttu-id="e0d0c-217">Nachdem Sie diese Ergänzungen erstellt haben, lauten die deklarative Syntax von TemplateField s wie folgt:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="e0d0c-218">Wenn ein Benutzer eine neue Kategorie hinzufügt, möchten wir sicherstellen, dass die Broschüre und das Bild den richtigen Dateityp haben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="e0d0c-219">Der Benutzer muss für die-Broschüre eine PDF-Datei angeben.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="e0d0c-220">Für das Bild benötigen wir den Benutzer, um eine Bilddatei hochzuladen, aber *Wir gestatten eine Bilddatei* oder nur Bilddateien eines bestimmten Typs, wie z. b. "GIFs" oder "jpgs"?</span><span class="sxs-lookup"><span data-stu-id="e0d0c-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="e0d0c-221">Um unterschiedliche Dateitypen zu ermöglichen, müssen wir das `Categories` Schema so erweitern, dass es eine Spalte enthält, die den Dateityp erfasst, sodass dieser Typ über `Response.ContentType` in `DisplayCategoryPicture.aspx`an den Client gesendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="e0d0c-222">Da wir nicht über eine solche Spalte verfügen, wäre es ratsam, Benutzer so einzuschränken, dass Sie nur einen bestimmten Bild Dateityp bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="e0d0c-223">Die vorhandenen Images der `Categories` Tabelle sind Bitmaps, aber JPGs sind ein geeignetere Dateiformat für Images, die über das Web bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="e0d0c-224">Wenn ein Benutzer einen falschen Dateityp hochlädt, muss der Einfügevorgang abgebrochen und eine Meldung angezeigt werden, die auf das Problem hinweist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="e0d0c-225">Fügen Sie ein Label-websteuer Element unterhalb der DetailsView hinzu.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="e0d0c-226">Legen Sie die `ID`-Eigenschaft auf `UploadWarning`, löschen Sie die `Text`-Eigenschaft, legen Sie die `CssClass`-Eigenschaft auf Warning und die `Visible`-und `EnableViewState`-Eigenschaften auf `false`fest.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="e0d0c-227">Die `Warning` CSS-Klasse wird in `Styles.css` definiert und rendert den Text in einer großen, roten, kursiv formatierten Schriftart.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="e0d0c-228">Im Idealfall werden die `CategoryName`-und `Description` boundfields in templatefields konvertiert und ihre einfügeschnittstellen angepasst.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="e0d0c-229">Die `Description` einfügeschnittstelle wäre z. b. wahrscheinlich besser durch ein mehrzeilige Textfeld geeignet.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="e0d0c-230">Da die `CategoryName` Spalte `NULL` Werte nicht akzeptiert, sollte ein "Requirements dfieldvalidator"-Element hinzugefügt werden, um sicherzustellen, dass der Benutzer einen Wert für den neuen Kategorienamen bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="e0d0c-231">Diese Schritte werden dem Reader als Übung überlassen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="e0d0c-232">Weitere Informationen zum Anpassen der Daten Änderungs Schnittstellen finden Sie unter [Anpassen der Daten Änderungs Schnittstelle](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="e0d0c-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>

## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="e0d0c-233">Schritt 6: Speichern der hochgeladenen Broschüre im Datei System des Webserver s</span><span class="sxs-lookup"><span data-stu-id="e0d0c-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="e0d0c-234">Wenn Benutzer die Werte für eine neue Kategorie eingeben und auf die Schaltfläche einfügen klicken, wird ein Postback durchgeführt, und der Einfügungs Workflow wird ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="e0d0c-235">Zuerst wird das Ereignis "DetailsView s [`ItemInserting`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) " ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="e0d0c-236">Im nächsten Schritt wird die ObjectDataSource s-`Insert()`-Methode aufgerufen, was dazu führt, dass der `Categories` Tabelle ein neuer Datensatz hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="e0d0c-237">Danach wird das Ereignis "DetailsView s [`ItemInserted`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) " ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="e0d0c-238">Bevor die ObjectDataSource s-`Insert()` Methode aufgerufen wird, müssen wir zuerst sicherstellen, dass die entsprechenden Dateitypen vom Benutzer hochgeladen wurden, und dann die PDF-PDF-Datei im Webserver Dateisystem speichern.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="e0d0c-239">Erstellen Sie einen Ereignishandler für das DetailsView s `ItemInserting`-Ereignis, und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="e0d0c-240">Der Ereignishandler beginnt mit dem Verweis auf das `BrochureUpload` FileUpload-Steuerelement aus den DetailsView s-Vorlagen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="e0d0c-241">Wenn eine Broschüre hochgeladen wurde, wird die Erweiterung für hochgeladene Dateien untersucht.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="e0d0c-242">, Wenn die Erweiterung nicht ist. PDF, dann wird eine Warnung angezeigt, die Einfügung wird abgebrochen, und die Ausführung des Ereignis Handlers wird beendet.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="e0d0c-243">Die Verwendung der Erweiterung für hochgeladene Dateien ist keine sichere Methode, um sicherzustellen, dass es sich bei der hochgeladenen Datei um ein PDF-Dokument handelt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="e0d0c-244">Der Benutzer kann über ein gültiges PDF-Dokument mit der Erweiterung `.Brochure`verfügen oder ein nicht-PDF-Dokument und eine `.pdf` Erweiterung erhalten.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="e0d0c-245">Der binäre Inhalt der Datei muss Programm gesteuert überprüft werden, um den Dateityp genauer zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="e0d0c-246">Solch gründliche Ansätze sind jedoch häufig übertrieben. die Überprüfung der Erweiterung ist für die meisten Szenarien ausreichend.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>

<span data-ttu-id="e0d0c-247">Wie im Tutorial [Hochladen von Dateien](uploading-files-cs.md) erläutert, muss beim Speichern von Dateien im Dateisystem darauf geachtet werden, dass ein Benutzer das Hochladen anderer e nicht überschreibt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="e0d0c-248">In diesem Tutorial versuchen wir, den gleichen Namen wie die hochgeladene Datei zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="e0d0c-249">Wenn bereits eine Datei im `~/Brochures` Verzeichnis mit demselben Dateinamen vorhanden ist, fügen wir eine Zahl am Ende an, bis ein eindeutiger Name gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="e0d0c-250">Wenn der Benutzer z. b. eine Datei mit dem Namen `Meats.pdf`hochlädt, aber bereits eine Datei mit dem Namen `Meats.pdf` im Ordner `~/Brochures`, ändern wir den Namen der gespeicherten Datei in `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="e0d0c-251">Wenn dies der Fall ist, versuchen wir es `Meats-2.pdf`usw., bis ein eindeutiger Dateiname gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="e0d0c-252">Im folgenden Code wird die [`File.Exists(path)`-Methode](https://msdn.microsoft.com/library/system.io.file.exists.aspx) verwendet, um zu bestimmen, ob eine Datei bereits mit dem angegebenen Dateinamen vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="e0d0c-253">Wenn dies der Fall ist, werden neue Dateinamen für die Broschüre weiterhin ausprobiert, bis kein Konflikt gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="e0d0c-254">Nachdem ein gültiger Dateiname gefunden wurde, muss die Datei im Dateisystem gespeichert werden, und der Wert von ObjectDataSource s `brochurePath``InsertParameter` muss aktualisiert werden, damit der Dateiname in die Datenbank geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="e0d0c-255">Wie bereits im Tutorial Hochladen von *Dateien* gezeigt, kann die Datei mithilfe der `SaveAs(path)` Methode FileUpload-Steuerelement s gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="e0d0c-256">Um den Parameter ObjectDataSource s `brochurePath` zu aktualisieren, verwenden Sie die `e.Values` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="e0d0c-257">Schritt 7: Speichern des hochgeladenen Bilds in der Datenbank</span><span class="sxs-lookup"><span data-stu-id="e0d0c-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="e0d0c-258">Zum Speichern des hochgeladenen Bilds im neuen `Categories` Datensatz müssen wir den hochgeladenen Binär Inhalt dem ObjectDataSource s-`picture` Parameter im `ItemInserting` Ereignis DetailsView s zuweisen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="e0d0c-259">Bevor wir diese Zuweisung vornehmen, müssen wir jedoch zunächst sicherstellen, dass das hochgeladene Bild ein JPG und kein anderer Bildtyp ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="e0d0c-260">Verwenden Sie wie in Schritt 6 die Dateierweiterung für hochgeladene Bilder, um den Typ zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="e0d0c-261">Obwohl die `Categories` Tabelle `NULL` Werte für die `Picture` Spalte zulässt, haben alle Kategorien derzeit ein Bild.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="e0d0c-262">Erzwingen Sie, dass der Benutzer ein Bild bereitstellt, wenn Sie auf dieser Seite eine neue Kategorie hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="e0d0c-263">Der folgende Code überprüft, um sicherzustellen, dass ein Bild hochgeladen wurde und über eine entsprechende Erweiterung verfügt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="e0d0c-264">Dieser Code sollte *vor* dem Code aus Schritt 6 platziert werden, sodass der Ereignishandler bei einem Problem mit dem Bild Upload beendet wird, bevor die Datei im Dateisystem gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="e0d0c-265">Wenn Sie davon ausgehen, dass eine geeignete Datei hochgeladen wurde, weisen Sie den hochgeladenen binären Inhalt dem Wert des Bildparameter s mit der folgenden Codezeile zu:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="e0d0c-266">Der Complete`ItemInserting`-Ereignis Handler</span><span class="sxs-lookup"><span data-stu-id="e0d0c-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="e0d0c-267">Der Vollständigkeit halber wird hier der `ItemInserting` Ereignishandler in seiner Gesamtheit aufgeführt:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="e0d0c-268">Schritt 8: Beheben der`DisplayCategoryPicture.aspx`Seite</span><span class="sxs-lookup"><span data-stu-id="e0d0c-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="e0d0c-269">Nehmen Sie sich einen Moment Zeit, um die einfügeschnittstelle und den `ItemInserting` Ereignishandler zu testen, der in den letzten Schritten erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="e0d0c-270">Besuchen Sie die Seite `UploadInDetailsView.aspx` über einen Browser, und versuchen Sie, eine Kategorie hinzuzufügen, aber lassen Sie das Bild Weg, oder geben Sie ein nicht-JPG-Bild oder eine nicht-PDF-Datei an.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="e0d0c-271">In jedem dieser Fälle wird eine Fehlermeldung angezeigt, und der INSERT-Workflow wurde abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>

<span data-ttu-id="e0d0c-272">[![eine Warnmeldung angezeigt wird, wenn ein ungültiger Dateityp hochgeladen wird](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span></span>

<span data-ttu-id="e0d0c-273">**Abbildung 9**: eine Warnmeldung wird angezeigt, wenn ein ungültiger Dateityp hochgeladen wird ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>

<span data-ttu-id="e0d0c-274">Wenn Sie sich vergewissert haben, dass für die Seite ein Bild hochgeladen werden muss, und nicht-PDF-oder nicht-JPG-Dateien akzeptieren, fügen Sie eine neue Kategorie mit einem gültigen JPG-Bild hinzu, und lassen Sie das Feld für die Broschüre leer.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-274">Once you have verified that the page requires a picture to be uploaded and won't accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="e0d0c-275">Nachdem Sie auf die Schaltfläche Einfügen geklickt haben, wird die Seite Postback, und der `Categories` Tabelle wird ein neuer Datensatz hinzugefügt, wobei die binären Inhalte der hochgeladenen Bilder direkt in der Datenbank gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="e0d0c-276">Die GridView wird aktualisiert und zeigt eine Zeile für die neu hinzugefügte Kategorie an, aber wie in Abbildung 10 gezeigt, wird das Bild der neuen Kategorie nicht ordnungsgemäß gerendert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>

<span data-ttu-id="e0d0c-277">[![das Bild der neuen Kategorie s nicht angezeigt wird.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span></span>

<span data-ttu-id="e0d0c-278">**Abbildung 10**: das Bild der neuen Kategorie s wird nicht angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>

<span data-ttu-id="e0d0c-279">Der Grund für die nicht Anzeige des neuen Bilds ist, dass die `DisplayCategoryPicture.aspx` Seite, die ein bestimmtes Bild der Kategorie zurückgibt, so konfiguriert ist, dass Bitmaps mit einem OLE-Header verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="e0d0c-280">Dieser 78-Byte-Header wird aus den Binär Inhalten der `Picture` Spalte entfernt, bevor Sie an den Client zurückgesendet werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="e0d0c-281">Die JPG-Datei, die wir soeben für die neue Kategorie hochgeladen haben, verfügt jedoch nicht über diesen OLE-Header. Daher werden gültige, erforderliche Bytes aus den Binärdaten des Images entfernt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="e0d0c-282">Da jetzt sowohl Bitmaps mit OLE-Headern als auch JPGs in der `Categories` Tabelle vorhanden sind, müssen Sie `DisplayCategoryPicture.aspx` aktualisieren, damit der OLE-Header für die ursprünglichen acht Kategorien entfernt wird, und dieses entfernen für die neueren Kategoriedatensätze umgeht.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="e0d0c-283">Im nächsten Tutorial wird erläutert, wie Sie ein vorhandenes Image eines Datensatzes aktualisieren, und wir aktualisieren alle alten Kategoriebilder, sodass es sich um JPGs handelt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="e0d0c-284">Verwenden Sie den folgenden Code jedoch in `DisplayCategoryPicture.aspx`, um die OLE-Header nur für die ursprünglichen acht Kategorien zu entfernen:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="e0d0c-285">Mit dieser Änderung wird das JPG-Bild jetzt ordnungsgemäß in der GridView gerendert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>

<span data-ttu-id="e0d0c-286">[![die JPG-Bilder für neue Kategorien korrekt gerendert werden](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span></span>

<span data-ttu-id="e0d0c-287">**Abbildung 11**: die JPG-Bilder für neue Kategorien werden korrekt gerendert ([Klicken Sie, um das Bild in voller Größe anzuzeigen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="e0d0c-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>

## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="e0d0c-288">Schritt 9: Löschen der Broschüre im Falle einer Ausnahme</span><span class="sxs-lookup"><span data-stu-id="e0d0c-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="e0d0c-289">Eine der Herausforderungen beim Speichern von Binärdaten auf dem Dateisystem des Webservers besteht darin, dass eine Verbindung zwischen dem Datenmodell und den zugehörigen Binärdaten getrennt wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="e0d0c-290">Wenn ein Datensatz gelöscht wird, müssen daher die entsprechenden Binärdaten im Dateisystem ebenfalls entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="e0d0c-291">Dies kann auch beim Einfügen von auftreten.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="e0d0c-292">Betrachten Sie das folgende Szenario: ein Benutzer fügt eine neue Kategorie hinzu und gibt ein gültiges Bild und eine neue Broschüre an.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="e0d0c-293">Wenn Sie auf die Schaltfläche einfügen klicken, erfolgt ein Postback, und das DetailsView s-`ItemInserting` Ereignis wird ausgelöst, und die-Datei wird im Dateisystem des Webserver s gespeichert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="e0d0c-294">Im nächsten Schritt wird die ObjectDataSource s-`Insert()`-Methode aufgerufen, die die `CategoriesBLL` Class s `InsertWithPicture`-Methode aufruft, die die `CategoriesTableAdapter` s `InsertWithPicture`-Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="e0d0c-295">Was geschieht, wenn die Datenbank offline ist, oder wenn ein Fehler in der `INSERT` SQL-Anweisung vorliegt?</span><span class="sxs-lookup"><span data-stu-id="e0d0c-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="e0d0c-296">Wenn die Einfügung eindeutig ist, wird der Datenbank keine neue Kategoriezeile hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="e0d0c-297">Die hochgeladene Infodatei befindet sich jedoch immer noch auf dem Dateisystem des Webservers!</span><span class="sxs-lookup"><span data-stu-id="e0d0c-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="e0d0c-298">Diese Datei muss im Falle einer Ausnahme während des einfügeworkflows gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="e0d0c-299">Wie bereits im Tutorial [Behandeln von Ausnahmen der BLL-und Dal-Ebene in einer ASP.NET-Seite](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) erläutert, wird eine Ausnahme durch die verschiedenen Ebenen durchlaufen, wenn eine Ausnahme innerhalb der tiefen der Architektur ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="e0d0c-300">Auf der Darstellungs Ebene können wir ermitteln, ob eine Ausnahme vom DetailsView s `ItemInserted`-Ereignis aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="e0d0c-301">Dieser Ereignishandler stellt auch die Werte der ObjectDataSource s `InsertParameters`bereit.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="e0d0c-302">Daher können wir einen Ereignishandler für das `ItemInserted` Ereignis erstellen, das überprüft, ob eine Ausnahme aufgetreten ist. wenn dies der Fall ist, wird die durch den ObjectDataSource s `brochurePath` Parameter angegebene Datei gelöscht:</span><span class="sxs-lookup"><span data-stu-id="e0d0c-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="e0d0c-303">Summary</span><span class="sxs-lookup"><span data-stu-id="e0d0c-303">Summary</span></span>

<span data-ttu-id="e0d0c-304">Zum Bereitstellen einer webbasierten Schnittstelle zum Hinzufügen von Datensätzen, die Binärdaten enthalten, müssen mehrere Schritte ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="e0d0c-305">Wenn die Binärdaten direkt in der Datenbank gespeichert werden, ist es wahrscheinlich, dass Sie die Architektur aktualisieren und bestimmte Methoden hinzufügen, um den Fall zu behandeln, in dem Binärdaten eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="e0d0c-306">Nachdem die Architektur aktualisiert wurde, ist der nächste Schritt das Erstellen der einfügeschnittstelle, die mit einer DetailsView durchgeführt werden kann, die so angepasst wurde, dass für jedes binäre Datenfeld ein FileUpload-Steuerelement enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="e0d0c-307">Die hochgeladenen Daten können dann im Dateisystem des Webserver s gespeichert oder einem Datenquellen Parameter im Ereignishandler DetailsView s `ItemInserting` zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="e0d0c-308">Das Speichern von Binärdaten im Dateisystem erfordert mehr Planung als das direkte Speichern von Daten in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="e0d0c-309">Ein Benennungs Schema muss ausgewählt werden, um zu verhindern, dass ein Benutzer das Hochladen von anderen en überschreibt.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="e0d0c-310">Außerdem müssen zusätzliche Schritte ausgeführt werden, um die hochgeladene Datei zu löschen, wenn die Datenbank nicht eingefügt werden kann.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="e0d0c-311">Wir haben nun die Möglichkeit, dem System neue Kategorien mit einer-Grafik und einem Bild hinzuzufügen, aber wir haben noch erfahren, wie Sie Binärdaten für eine vorhandene Kategorie aktualisieren oder die Binärdaten für eine gelöschte Kategorie ordnungsgemäß entfernen.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="e0d0c-312">Diese beiden Themen werden im nächsten Tutorial erläutert.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="e0d0c-313">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="e0d0c-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e0d0c-314">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="e0d0c-314">About the Author</span></span>

<span data-ttu-id="e0d0c-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor der sieben ASP/ASP. net-Bücher und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e0d0c-316">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e0d0c-317">Sein letztes Buch ist [*Sams Teach Yourself ASP.NET 2,0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e0d0c-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e0d0c-318">Er kann übermitchell@4GuysFromRolla.comerreicht werden [.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e0d0c-319">oder über seinen Blog finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e0d0c-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e0d0c-320">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="e0d0c-320">Special Thanks To</span></span>

<span data-ttu-id="e0d0c-321">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e0d0c-322">Die führenden Reviewer für dieses Tutorial waren Dave Gardner, Teresa Murphy und Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="e0d0c-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="e0d0c-323">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="e0d0c-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e0d0c-324">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.comablegen.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e0d0c-325">[Zurück](displaying-binary-data-in-the-data-web-controls-cs.md)
> [Weiter](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e0d0c-325">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
