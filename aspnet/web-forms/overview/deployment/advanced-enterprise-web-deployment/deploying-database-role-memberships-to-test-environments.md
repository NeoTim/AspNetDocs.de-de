---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments
title: Bereitstellen von Daten bankrollen Mitgliedschaften in Test Umgebungen | Microsoft-Dokumentation
author: jrjlee
description: In diesem Thema wird beschrieben, wie Sie Benutzerkonten zu Daten bankrollen als Teil einer Lösungs Bereitstellung in einer Testumgebung hinzufügen. Beim Bereitstellen einer Projekt Mappe, die...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 9b2af539-7ad9-47aa-b66e-873bd9906e79
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments
msc.type: authoredcontent
ms.openlocfilehash: a15f5bf5f659d151e91ef9e53c5ad55bcd8e2b01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78474945"
---
# <a name="deploying-database-role-memberships-to-test-environments"></a><span data-ttu-id="4a6b0-104">Bereitstellen von Datenbankrollenmitgliedschaften in Testumgebungen</span><span class="sxs-lookup"><span data-stu-id="4a6b0-104">Deploying Database Role Memberships to Test Environments</span></span>

<span data-ttu-id="4a6b0-105">von [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="4a6b0-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="4a6b0-106">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="4a6b0-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="4a6b0-107">In diesem Thema wird beschrieben, wie Sie Benutzerkonten zu Daten bankrollen als Teil einer Lösungs Bereitstellung in einer Testumgebung hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-107">This topic describes how to add user accounts to database roles as part of a solution deployment to a test environment.</span></span>
> 
> <span data-ttu-id="4a6b0-108">Wenn Sie eine Lösung mit einem Datenbankprojekt in einer Staging-oder Produktionsumgebung bereitstellen, möchten Sie in der Regel nicht, dass Entwickler das Hinzufügen von Benutzerkonten zu Daten bankrollen automatisieren.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-108">When you deploy a solution containing a database project to a staging or production environment, you typically don't want the developer to automate the addition of user accounts to database roles.</span></span> <span data-ttu-id="4a6b0-109">In den meisten Fällen weiß der Entwickler nicht, welche Benutzerkonten zu welchen Daten bankrollen hinzugefügt werden müssen, und diese Anforderungen können sich jederzeit ändern.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-109">In most cases, the developer won't know which user accounts need to be added to which database roles, and these requirements could change at any time.</span></span> <span data-ttu-id="4a6b0-110">Wenn Sie jedoch eine Lösung bereitstellen, die ein Datenbankprojekt in einer Entwicklungs-oder Testumgebung enthält, ist die Situation in der Regel eher anders:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-110">However, when you deploy a solution containing a database project to a development or test environment, the situation is usually rather different:</span></span>
> 
> - <span data-ttu-id="4a6b0-111">Der Entwickler stellt die Lösung normalerweise regelmäßig mehrmals täglich wieder her.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-111">The developer typically re-deploys the solution on a regular basis, often several times a day.</span></span>
> - <span data-ttu-id="4a6b0-112">Die Datenbank wird in der Regel bei jeder Bereitstellung neu erstellt. Dies bedeutet, dass Datenbankbenutzer erstellt und nach jeder Bereitstellung Rollen hinzugefügt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-112">The database is typically re-created on every deployment, which means that database users must be created and added to roles after every deployment.</span></span>
> - <span data-ttu-id="4a6b0-113">Der Entwickler verfügt in der Regel über vollständige Kontrolle über die zielentwicklungs-oder Testumgebung.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-113">The developer typically has full control over the target development or test environment.</span></span>
> 
> <span data-ttu-id="4a6b0-114">In diesem Szenario ist es häufig vorteilhaft, Datenbankbenutzer automatisch zu erstellen und im Rahmen des Bereitstellungs Prozesses Daten bankrollen Mitgliedschaften zuzuweisen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-114">In this scenario, it's often beneficial to automatically create database users and assign database role memberships as part of the deployment process.</span></span>
> 
> <span data-ttu-id="4a6b0-115">Der Hauptfaktor ist, dass dieser Vorgang abhängig von der Zielumgebung bedingt sein muss.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-115">The key factor is that this operation needs to be conditional based on the target environment.</span></span> <span data-ttu-id="4a6b0-116">Wenn Sie in einer Staging-oder Produktionsumgebung bereitstellen, möchten Sie den Vorgang überspringen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-116">If you're deploying to a staging or a production environment, you want to skip the operation.</span></span> <span data-ttu-id="4a6b0-117">Wenn Sie in einer Entwicklungs-oder Testumgebung bereitstellen, möchten Sie die Rollen Mitgliedschaften ohne weiteren Eingriff bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-117">If you're deploying to a developer or test environment, you want to deploy role memberships without further intervention.</span></span> <span data-ttu-id="4a6b0-118">In diesem Thema wird ein Ansatz beschrieben, mit dem Sie diese Herausforderung meistern können.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-118">This topic describes one approach you can use to address this challenge.</span></span>

<span data-ttu-id="4a6b0-119">Dieses Thema ist Teil einer Reihe von Tutorials, basierend auf den Anforderungen an die Unternehmens Bereitstellung eines fiktiven Unternehmens namens Fabrikam, Inc. In dieser tutorialreihe wird&#x2014;eine Beispiellösung der [Contact Manager-Lösung](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;verwendet, um eine Webanwendung mit einem realistischen Komplexitäts Grad darzustellen, einschließlich einer ASP.NET MVC 3-Anwendung, eines Windows Communication Foundation (WCF)-Diensts und eines Datenbankprojekts.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-119">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="4a6b0-120">Die Bereitstellungs Methode im Kern dieser Tutorials basiert auf dem Untergrund Legendes [zur Projektdatei](../web-deployment-in-the-enterprise/understanding-the-project-file.md)beschriebenen Ansatz, in dem der Buildprozess von zwei Projektdateien&#x2014;gesteuert wird, die Buildanweisungen enthalten, die für jede Zielumgebung gelten, und eine mit Umgebungs spezifischen Build-und Bereitstellungs Einstellungen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-120">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="4a6b0-121">Zum Zeitpunkt der Erstellung wird die Umgebungs spezifische Projektdatei in der Umgebungs unabhängigen Projektdatei zusammengeführt, um einen kompletten Satz von Buildanweisungen zu bilden.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-121">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="4a6b0-122">Aufgaben Übersicht</span><span class="sxs-lookup"><span data-stu-id="4a6b0-122">Task Overview</span></span>

<span data-ttu-id="4a6b0-123">In diesem Thema wird Folgendes vorausgesetzt:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-123">This topic assumes that:</span></span>

- <span data-ttu-id="4a6b0-124">Sie verwenden den Ansatz zum Aufteilen von Projektdateien für die Lösungs Bereitstellung, wie in Grundlegendes [zur Projektdatei](../web-deployment-in-the-enterprise/understanding-the-project-file.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-124">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="4a6b0-125">Sie können VSDBCmd aus der Projektdatei abrufen, um das Datenbankprojekt bereitzustellen, wie Untergrund Legendes [zum Buildprozess](../web-deployment-in-the-enterprise/understanding-the-build-process.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-125">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="4a6b0-126">Wenn Sie Datenbankbenutzer erstellen und Rollen Mitgliedschaften zuweisen möchten, wenn Sie ein Datenbankprojekt in einer Testumgebung bereitstellen, müssen Sie folgende Schritte ausführen:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-126">To create database users and assign role memberships when you deploy a database project to a test environment, you'll need to:</span></span>

- <span data-ttu-id="4a6b0-127">Erstellen Sie ein Transact-strukturierte Abfragesprache-Skript (Transact-SQL), das die erforderlichen Daten Bank Änderungen vornimmt.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-127">Create a Transact Structured Query Language (Transact-SQL) script that makes the necessary database changes.</span></span>
- <span data-ttu-id="4a6b0-128">Erstellen Sie ein Microsoft-Build-Engine-Ziel (MSBuild), das das sqlcmd. exe-Hilfsprogramm zum Ausführen des SQL-Skripts verwendet.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-128">Create a Microsoft Build Engine (MSBuild) target that uses the sqlcmd.exe utility to run the SQL script.</span></span>
- <span data-ttu-id="4a6b0-129">Konfigurieren Sie die Projektdateien, um das Ziel beim Bereitstellen der Projekt Mappe in einer Testumgebung aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-129">Configure your project files to invoke the target when you're deploying your solution to a test environment.</span></span>

<span data-ttu-id="4a6b0-130">In diesem Thema wird gezeigt, wie Sie die einzelnen Prozeduren ausführen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-130">This topic will show you how to perform each of these procedures.</span></span>

## <a name="scripting-the-database-role-memberships"></a><span data-ttu-id="4a6b0-131">Skripterstellung für die Daten bankrollen Mitgliedschaften</span><span class="sxs-lookup"><span data-stu-id="4a6b0-131">Scripting the Database Role Memberships</span></span>

<span data-ttu-id="4a6b0-132">Sie können ein Transact-SQL-Skript auf viele verschiedene Arten erstellen und an jedem beliebigen Ort auswählen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-132">You can create a Transact-SQL script in a lot of different ways, and in any location you choose.</span></span> <span data-ttu-id="4a6b0-133">Der einfachste Ansatz besteht darin, das Skript in der Projekt Mappe in Visual Studio 2010 zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-133">The easiest approach is to create the script within your solution in Visual Studio 2010.</span></span>

<span data-ttu-id="4a6b0-134">**So erstellen Sie ein SQL-Skript**</span><span class="sxs-lookup"><span data-stu-id="4a6b0-134">**To create a SQL script**</span></span>

1. <span data-ttu-id="4a6b0-135">Erweitern Sie im Fenster **Projektmappen-Explorer** den Knoten Datenbankprojekt.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-135">In the **Solution Explorer** window, expand your database project node.</span></span>
2. <span data-ttu-id="4a6b0-136">Klicken Sie mit der rechten Maustaste auf den Ordner **Scripts** , zeigen Sie auf **Hinzufügen**, und klicken Sie dann auf **neuer Ordner**</span><span class="sxs-lookup"><span data-stu-id="4a6b0-136">Right-click the **Scripts** folder, point to **Add**, and then click **New Folder**.</span></span>
3. <span data-ttu-id="4a6b0-137">Geben Sie **Test** als Ordnernamen ein, und drücken Sie dann die EINGABETASTE.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-137">Type **Test** as the folder name, and then press Enter.</span></span>
4. <span data-ttu-id="4a6b0-138">Klicken Sie mit der rechten Maustaste auf den Ordner **Test** , zeigen Sie auf **Hinzufügen**, und klicken Sie auf **Skript**.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-138">Right-click the **Test** folder, point to **Add**, and then click **Script**.</span></span>
5. <span data-ttu-id="4a6b0-139">Geben Sie im Dialogfeld **Neues Element hinzufügen** einen aussagekräftigen Namen (z **. b. addrolemembership. SQL**), und klicken Sie dann auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-139">In the **Add New Item** dialog box, give your script a meaningful name (for example, **AddRoleMemberships.sql**), and then click **Add**.</span></span>

    ![](deploying-database-role-memberships-to-test-environments/_static/image1.png)
6. <span data-ttu-id="4a6b0-140">Fügen Sie in der Datei *addrolemembership. SQL* folgende Transact-SQL-Anweisungen hinzu:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-140">In the *AddRoleMemberships.sql* file, add Transact-SQL statements that:</span></span>

    1. <span data-ttu-id="4a6b0-141">Erstellen Sie einen Datenbankbenutzer für den SQL Server Anmelde Namen, der auf Ihre Datenbank zugreift.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-141">Create a database user for the SQL Server login that will access your database.</span></span>
    2. <span data-ttu-id="4a6b0-142">Fügen Sie den Datenbankbenutzer allen erforderlichen Daten bankrollen hinzu.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-142">Add the database user to any required database roles.</span></span>
7. <span data-ttu-id="4a6b0-143">Die Datei sollte in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-143">The file should resemble this:</span></span>

    [!code-sql[Main](deploying-database-role-memberships-to-test-environments/samples/sample1.sql)]
8. <span data-ttu-id="4a6b0-144">Speichern Sie die Datei .</span><span class="sxs-lookup"><span data-stu-id="4a6b0-144">Save the file.</span></span>

## <a name="executing-the-script-on-the-target-database"></a><span data-ttu-id="4a6b0-145">Ausführen des Skripts in der Zieldatenbank</span><span class="sxs-lookup"><span data-stu-id="4a6b0-145">Executing the Script on the Target Database</span></span>

<span data-ttu-id="4a6b0-146">Im Idealfall würden Sie alle erforderlichen Transact-SQL-Skripts als Teil eines Skripts nach der Bereitstellung ausführen, wenn Sie das Datenbankprojekt bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-146">Ideally, you'd run any required Transact-SQL scripts as part of a post-deployment script when you deploy your database project.</span></span> <span data-ttu-id="4a6b0-147">Skripts nach der Bereitstellung ermöglichen es Ihnen jedoch nicht, Logik bedingt auf der Grundlage von Projektmappenkonfigurationen oder Buildeigenschaften auszuführen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-147">However, post-deployment scripts don't allow you to execute logic conditionally based on solution configurations or build properties.</span></span> <span data-ttu-id="4a6b0-148">Alternativ können Sie die SQL-Skripts direkt aus der MSBuild-Projektdatei ausführen, indem Sie ein **target** -Element erstellen, das einen sqlcmd. exe-Befehl ausführt.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-148">The alternative is to run your SQL scripts directly from the MSBuild project file, by creating a **Target** element that executes a sqlcmd.exe command.</span></span> <span data-ttu-id="4a6b0-149">Sie können diesen Befehl verwenden, um das Skript in der Zieldatenbank auszuführen:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-149">You can use this command to run your script on the target database:</span></span>

[!code-console[Main](deploying-database-role-memberships-to-test-environments/samples/sample2.cmd)]

> [!NOTE]
> <span data-ttu-id="4a6b0-150">Weitere Informationen zu sqlcmd-Befehlszeilenoptionen finden Sie unter [sqlcmd Utility](https://msdn.microsoft.com/library/ms162773.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a6b0-150">For more information on sqlcmd command-line options, see [sqlcmd Utility](https://msdn.microsoft.com/library/ms162773.aspx).</span></span>

<span data-ttu-id="4a6b0-151">Bevor Sie diesen Befehl in ein MSBuild-Ziel einbetten, müssen Sie berücksichtigen, unter welchen Bedingungen das Skript ausgeführt werden soll:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-151">Before you embed this command in an MSBuild target, you need to consider under what conditions you want the script to run:</span></span>

- <span data-ttu-id="4a6b0-152">Die Zieldatenbank muss vorhanden sein, bevor Sie die Rollen Mitgliedschaften ändern.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-152">The target database must exist before you change its role memberships.</span></span> <span data-ttu-id="4a6b0-153">Daher müssen Sie dieses Skript *nach* der Daten Bank Bereitstellung ausführen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-153">As such, you need to run this script *after* the database deployment.</span></span>
- <span data-ttu-id="4a6b0-154">Sie müssen eine Bedingung einschließen, damit das Skript nur für Testumgebungen ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-154">You need to include a condition so that the script is only executed for test environments.</span></span>
- <span data-ttu-id="4a6b0-155">Wenn Sie eine "Was-wäre-wenn"&#x2014;-Bereitstellung mit anderen Worten ausführen, sollten Sie das SQL-Skript nicht&#x2014;ausführen, wenn Sie Bereitstellungs Skripts erstellen, aber nicht ausführen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-155">If you're running a "what if" deployment&#x2014;in other words, if you're generating deployment scripts but not actually running them&#x2014;you shouldn't run the SQL script.</span></span>

<span data-ttu-id="4a6b0-156">Wenn Sie den in Grundlegendes [zur Projektdatei](../web-deployment-in-the-enterprise/understanding-the-project-file.md)beschriebenen Ansatz zum Aufteilen von Projektdateien verwenden, können Sie die Buildanweisungen für das SQL-Skript wie folgt aufteilen:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-156">If you're using the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), as demonstrated by the Contact Manager sample solution, you can split the build instructions for your SQL script like this:</span></span>

- <span data-ttu-id="4a6b0-157">Alle erforderlichen Umgebungs spezifischen Eigenschaften und die-Eigenschaft, die bestimmt, ob Berechtigungen bereitgestellt werden sollen, sollten in die Umgebungs spezifische Projektdatei (z. *b. env-dev. proj*) gelangen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-157">Any required environment-specific properties, together with the property that determines whether to deploy permissions, should go in the environment-specific project file (for example, *Env-Dev.proj*).</span></span>
- <span data-ttu-id="4a6b0-158">Das MSBuild-Ziel selbst und alle Eigenschaften, die sich nicht Zwischenziel Umgebungen ändern, sollten in die universelle Projektdatei (z. b. *Publish. proj*) gelangen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-158">The MSBuild target itself, together with any properties that will not change between destination environments, should go in the universal project file (for example, *Publish.proj*).</span></span>

<span data-ttu-id="4a6b0-159">In der Umgebungs spezifischen Projektdatei müssen Sie den Namen des Datenbankservers, den Namen der Zieldatenbank und eine boolesche Eigenschaft definieren, mit der der Benutzer angeben kann, ob Rollen Mitgliedschaften bereitgestellt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-159">In the environment-specific project file, you need to define the database server name, the target database name, and a Boolean property that lets the user specify whether to deploy role memberships.</span></span>

[!code-xml[Main](deploying-database-role-memberships-to-test-environments/samples/sample3.xml)]

<span data-ttu-id="4a6b0-160">In der universellen Projektdatei müssen Sie den Speicherort der ausführbaren sqlcmd-Datei und den Speicherort des SQL-Skripts angeben, das Sie ausführen möchten.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-160">In the universal project file, you need to provide the location of the sqlcmd executable and the location of the SQL script you want to run.</span></span> <span data-ttu-id="4a6b0-161">Diese Eigenschaften bleiben unabhängig von der Zielumgebung unverändert.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-161">These properties will remain the same regardless of the destination environment.</span></span> <span data-ttu-id="4a6b0-162">Sie müssen auch ein MSBuild-Ziel erstellen, um den SQLCMD-Befehl auszuführen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-162">You also need to create an MSBuild target to execute the sqlcmd command.</span></span>

[!code-xml[Main](deploying-database-role-memberships-to-test-environments/samples/sample4.xml)]

<span data-ttu-id="4a6b0-163">Beachten Sie, dass Sie den Speicherort der ausführbaren Datei sqlcmd als statische Eigenschaft hinzufügen, da dies für andere Ziele nützlich sein könnte.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-163">Notice that you add the location of the sqlcmd executable as a static property, as this could be useful to other targets.</span></span> <span data-ttu-id="4a6b0-164">Im Gegensatz dazu definieren Sie den Speicherort des SQL-Skripts und die Syntax des sqlcmd-Befehls als dynamische Eigenschaften innerhalb des Ziels, da Sie vor der Ausführung des Ziels nicht benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-164">In contrast, you define the location of your SQL script and the syntax of the sqlcmd command as dynamic properties within the target, as they will not be required before the target is executed.</span></span> <span data-ttu-id="4a6b0-165">In diesem Fall wird das Bereitstellungs Ziel " **deploytestdbberechtigungs** " nur ausgeführt, wenn die folgenden Bedingungen erfüllt sind:</span><span class="sxs-lookup"><span data-stu-id="4a6b0-165">In this case, the **DeployTestDBPermissions** target will only be executed if these conditions are met:</span></span>

- <span data-ttu-id="4a6b0-166">Die **deploytestdbrolemembership** -Eigenschaft ist auf **true**festgelegt.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-166">The **DeployTestDBRoleMemberships** property is set to **true**.</span></span>
- <span data-ttu-id="4a6b0-167">Der Benutzer hat kein **WhatIf = true** -Flag angegeben.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-167">The user hasn't specified a **WhatIf=true** flag.</span></span>

<span data-ttu-id="4a6b0-168">Vergessen Sie schließlich nicht, das Ziel aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-168">Finally, don't forget to invoke the target.</span></span> <span data-ttu-id="4a6b0-169">In der Datei " *Publish. proj* " können Sie dies tun, indem Sie das Ziel der Abhängigkeits Liste für das standardmäßige **fullpublish** -Ziel hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-169">In the *Publish.proj* file, you can do this by adding the target to the dependency list for the default **FullPublish** target.</span></span> <span data-ttu-id="4a6b0-170">Sie müssen sicherstellen, dass das Ziel " **deploytestdbberechtigungs** " nicht ausgeführt wird, bis das Ziel " **publishdbpackages** " ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-170">You need to ensure that the **DeployTestDBPermissions** target is not executed until the **PublishDbPackages** target has been executed.</span></span>

[!code-xml[Main](deploying-database-role-memberships-to-test-environments/samples/sample5.xml)]

## <a name="conclusion"></a><span data-ttu-id="4a6b0-171">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="4a6b0-171">Conclusion</span></span>

<span data-ttu-id="4a6b0-172">In diesem Thema wurde eine Möglichkeit beschrieben, wie Sie Datenbankbenutzer und Rollen Mitgliedschaften als Aktion nach der Bereitstellung hinzufügen können, wenn Sie ein Datenbankprojekt bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-172">This topic described one way in which you can add database users and role memberships as a post-deployment action when you deploy a database project.</span></span> <span data-ttu-id="4a6b0-173">Dies ist in der Regel hilfreich, wenn Sie eine Datenbank regelmäßig in einer Testumgebung neu erstellen, aber Sie sollte in der Regel vermieden werden, wenn Sie Datenbanken in Staging-oder Produktionsumgebungen bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-173">This is typically useful when you regularly re-create a database in a test environment, but it should usually be avoided when you deploy databases to staging or production environments.</span></span> <span data-ttu-id="4a6b0-174">Daher sollten Sie sicherstellen, dass Sie die erforderliche bedingte Logik verwenden, damit Datenbankbenutzer und Rollen Mitgliedschaften nur erstellt werden, wenn dies angemessen ist.</span><span class="sxs-lookup"><span data-stu-id="4a6b0-174">As such, you should ensure that you use the necessary conditional logic so that database users and role memberships are only created when it's appropriate to do so.</span></span>

## <a name="further-reading"></a><span data-ttu-id="4a6b0-175">Weitere nützliche Informationen</span><span class="sxs-lookup"><span data-stu-id="4a6b0-175">Further Reading</span></span>

<span data-ttu-id="4a6b0-176">Weitere Informationen zur Verwendung von VSDBCMD zum Bereitstellen von Datenbankprojekten finden Sie unter Bereitstellen von [Datenbankprojekten](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="4a6b0-176">For more information on using VSDBCMD to deploy database projects, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="4a6b0-177">Anleitungen zum Anpassen von Daten Bank Bereitstellungen für verschiedene Ziel Umgebungen finden Sie unter [Anpassen von Daten Bank Bereitstellungen für mehrere Umgebungen](customizing-database-deployments-for-multiple-environments.md).</span><span class="sxs-lookup"><span data-stu-id="4a6b0-177">For guidance on customizing database deployments for different target environments, see [Customizing Database Deployments for Multiple Environments](customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="4a6b0-178">Weitere Informationen zur Verwendung von benutzerdefinierten MSBuild-Projektdateien zum Steuern des Bereitstellungs Prozesses finden Sie Untergrund Legendes [zur Projektdatei](../web-deployment-in-the-enterprise/understanding-the-project-file.md) und Grundlegendes [zum Buildprozess](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="4a6b0-178">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span> <span data-ttu-id="4a6b0-179">Weitere Informationen zu sqlcmd-Befehlszeilenoptionen finden Sie unter [sqlcmd Utility](https://msdn.microsoft.com/library/ms162773.aspx).</span><span class="sxs-lookup"><span data-stu-id="4a6b0-179">For more information on sqlcmd command-line options, see [sqlcmd Utility](https://msdn.microsoft.com/library/ms162773.aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4a6b0-180">[Zurück](customizing-database-deployments-for-multiple-environments.md)
> [Weiter](deploying-membership-databases-to-enterprise-environments.md)</span><span class="sxs-lookup"><span data-stu-id="4a6b0-180">[Previous](customizing-database-deployments-for-multiple-environments.md)
[Next](deploying-membership-databases-to-enterprise-environments.md)</span></span>
