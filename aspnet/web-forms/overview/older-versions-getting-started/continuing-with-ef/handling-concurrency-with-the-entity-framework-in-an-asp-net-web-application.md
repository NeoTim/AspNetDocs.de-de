---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
title: Behandeln von Parallelität mit dem Entity Framework 4,0 in einer ASP.NET 4-Webanwendung | Microsoft-Dokumentation
author: tdykstra
description: Diese tutorialreihe basiert auf der Webanwendung der Website von "Web", die in der tutorialreihe für die ersten Schritte mit Entity Framework 4,0 erstellt wurde. I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: a5aa22a6-fb7f-4f41-9c7f-addda151940b
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: 3df5f7d9c8fb22e1ea34fe16560bdb9a1309bb56
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78513501"
---
# <a name="handling-concurrency-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="9d0bc-104">Behandeln von Parallelität mit dem Entity Framework 4,0 in einer ASP.NET 4-Webanwendung</span><span class="sxs-lookup"><span data-stu-id="9d0bc-104">Handling Concurrency with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>

<span data-ttu-id="9d0bc-105">von [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="9d0bc-106">Diese tutorialreihe basiert auf der Webanwendung der Website von "Web", die in der tutorialreihe für die ersten Schritte [mit Entity Framework 4,0](https://asp.net/entity-framework/tutorials#Getting%20Started) erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="9d0bc-107">Wenn Sie die vorherigen Tutorials nicht durchgearbeitet haben, können Sie die Anwendung, die Sie erstellt haben, als Ausgangspunkt für dieses Tutorial [herunterladen](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) .</span><span class="sxs-lookup"><span data-stu-id="9d0bc-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="9d0bc-108">Sie können auch [die Anwendung herunterladen](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , die von der kompletten tutorialreihe erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="9d0bc-109">Wenn Sie Fragen zu den Tutorials haben, können Sie Sie im ASP.net- [Entity Framework Forum](https://forums.asp.net/1227.aspx)Posten.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>

<span data-ttu-id="9d0bc-110">Im vorherigen Tutorial haben Sie gelernt, wie Sie Daten mithilfe des `ObjectDataSource`-Steuer Elements und des Entity Framework sortieren und filtern.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-110">In the previous tutorial you learned how to sort and filter data using the `ObjectDataSource` control and the Entity Framework.</span></span> <span data-ttu-id="9d0bc-111">Dieses Tutorial zeigt Optionen für die Handhabung von Parallelität in einer ASP.NET-Webanwendung, die die Entity Framework verwendet.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-111">This tutorial shows options for handling concurrency in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="9d0bc-112">Sie erstellen eine neue Webseite, die für das Aktualisieren von Dozenten-Office-Zuweisungen reserviert ist.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-112">You will create a new web page that's dedicated to updating instructor office assignments.</span></span> <span data-ttu-id="9d0bc-113">Sie behandeln Parallelitäts Probleme auf dieser Seite und auf der Seite "Abteilungen", die Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-113">You'll handle concurrency issues in that page and in the Departments page that you created earlier.</span></span>

<span data-ttu-id="9d0bc-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="9d0bc-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

## <a name="concurrency-conflicts"></a><span data-ttu-id="9d0bc-116">Nebenläufigkeitskonflikte</span><span class="sxs-lookup"><span data-stu-id="9d0bc-116">Concurrency Conflicts</span></span>

<span data-ttu-id="9d0bc-117">Ein Parallelitäts Konflikt tritt auf, wenn ein Benutzer einen Datensatz bearbeitet und ein anderer Benutzer denselben Datensatz bearbeitet, bevor die Änderung des ersten Benutzers in die Datenbank geschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-117">A concurrency conflict occurs when one user edits a record and another user edits the same record before the first user's change is written to the database.</span></span> <span data-ttu-id="9d0bc-118">Wenn Sie die Entity Framework nicht so einrichten, dass solche Konflikte erkannt werden, überschreibt der Benutzer, der die Datenbank zuletzt aktualisiert hat, die Änderungen des anderen Benutzers.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-118">If you don't set up the Entity Framework to detect such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="9d0bc-119">In vielen Anwendungen ist dieses Risiko akzeptabel, und Sie müssen die Anwendung nicht so konfigurieren, dass mögliche Parallelitäts Konflikte behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-119">In many applications, this risk is acceptable, and you don't have to configure the application to handle possible concurrency conflicts.</span></span> <span data-ttu-id="9d0bc-120">(Wenn es nur wenige Benutzer oder wenige Updates gibt, oder wenn nicht wirklich wichtig ist, wenn einige Änderungen überschrieben werden, können die Kosten für die Programmierung für Parallelität den Vorteil überwiegen.) Wenn Sie sich keine Gedanken über Parallelitäts Konflikte machen müssen, können Sie dieses Tutorial überspringen. die verbleibenden beiden Tutorials in der Reihe sind nicht von etwas abhängig, das Sie in diesem erstellen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-120">(If there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.) If you don't need to worry about concurrency conflicts, you can skip this tutorial; the remaining two tutorials in the series don't depend on anything you build in this one.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="9d0bc-121">Pessimistische Parallelität (Sperren)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-121">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="9d0bc-122">Wenn Ihre Anwendung versehentliche Datenverluste in Parallelitätsszenarios verhindern muss, ist die Verwendung von Datenbanksperren eine Möglichkeit.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-122">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="9d0bc-123">Dies wird als *pessimistische*Parallelität bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-123">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="9d0bc-124">Bevor Sie zum Beispiel eine Zeile aus einer Datenbank lesen, fordern Sie eine Sperre für den schreibgeschützten Zugriff oder den Aktualisierungszugriff an.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-124">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="9d0bc-125">Wenn Sie eine Zeile für den Aktualisierungszugriff sperren, kann kein anderer Benutzer diese Zeile für den schreibgeschützten Zugriff oder den Aktualisierungszugriff sperren, da er eine Kopie der Daten erhalten würde, die gerade geändert werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-125">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="9d0bc-126">Wenn Sie eine Zeile für den schreibgeschützten Zugriff sperren, können andere diese Zeile ebenfalls für den schreibgeschützten Zugriff sperren, aber nicht für den Aktualisierungszugriff.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-126">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="9d0bc-127">Das Verwalten von Sperren hat einige Nachteile.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-127">Managing locks has some disadvantages.</span></span> <span data-ttu-id="9d0bc-128">Es kann komplex sein, sie zu programmieren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-128">It can be complex to program.</span></span> <span data-ttu-id="9d0bc-129">Hierfür sind beträchtliche Ressourcen für die Datenbankverwaltung erforderlich, und es kann zu Leistungsproblemen führen, wenn die Anzahl der Benutzer einer Anwendung zunimmt (das heißt, es ist nicht gut skalierbar).</span><span class="sxs-lookup"><span data-stu-id="9d0bc-129">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases (that is, it doesn't scale well).</span></span> <span data-ttu-id="9d0bc-130">Aus diesen Gründen unterstützen nicht alle Datenbankverwaltungssysteme die pessimistische Parallelität.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-130">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="9d0bc-131">Die Entity Framework bietet keine integrierte Unterstützung für diese, und dieses Tutorial zeigt Ihnen nicht, wie Sie Sie implementieren können.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-131">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="9d0bc-132">Optimistische Nebenläufigkeit</span><span class="sxs-lookup"><span data-stu-id="9d0bc-132">Optimistic Concurrency</span></span>

<span data-ttu-id="9d0bc-133">Die Alternative zur pessimistischen Parallelität ist die *optimistische*Parallelität.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-133">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="9d0bc-134">Die Verwendung der optimistischen Parallelität bedeutet, Nebenläufigkeitskonflikte zu erlauben und entsprechend zu reagieren, wenn diese auftreten.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-134">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="9d0bc-135">John führt z. b. die Seite *Department. aspx* aus, klickt auf den Link **Bearbeiten** für die Verlaufs Abteilung und reduziert den **Budget** Betrag von $1.000.000,00 auf $125.000,00.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-135">For example, John runs the *Department.aspx* page, clicks the **Edit** link for the History department, and reduces the **Budget** amount from $1,000,000.00 to $125,000.00.</span></span> <span data-ttu-id="9d0bc-136">(John verwaltet eine konkurrierende Abteilung und möchte Geld für seine eigene Abteilung freigeben.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-136">(John administers a competing department and wants to free up money for his own department.)</span></span>

<span data-ttu-id="9d0bc-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="9d0bc-138">Bevor John auf **Update**klickt, führt Jane dieselbe Seite aus, klickt auf den Link **Bearbeiten** für die Verlaufs Abteilung und ändert dann das Feld **Start Datum** von 1/10/2011 in 1/1/1999.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-138">Before John clicks **Update**, Jane runs the same page, clicks the **Edit** link for the History department, and then changes the **Start Date** field from 1/10/2011 to 1/1/1999.</span></span> <span data-ttu-id="9d0bc-139">(Jane verwaltet die Verlaufs Abteilung und möchte ihr eine höhere Rangfolge einräumen.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-139">(Jane administers the History department and wants to give it more seniority.)</span></span>

<span data-ttu-id="9d0bc-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

<span data-ttu-id="9d0bc-141">John klickt zuerst auf **Aktualisieren** und dann auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-141">John clicks **Update** first, then Jane clicks **Update**.</span></span> <span data-ttu-id="9d0bc-142">Der Browser von Jane listet jetzt den **Budget** Betrag als $1.000.000,00 auf, aber dies ist falsch, da der Betrag von John in $125.000,00 geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-142">Jane's browser now lists the **Budget** amount as $1,000,000.00, but this is incorrect because the amount has been changed by John to $125,000.00.</span></span>

<span data-ttu-id="9d0bc-143">In diesem Szenario können Sie beispielsweise folgende Aktionen ausführen:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-143">Some of the actions you can take in this scenario include the following:</span></span>

- <span data-ttu-id="9d0bc-144">Sie können nachverfolgen, welche Eigenschaft ein Benutzer geändert hat und nur die entsprechenden Spalten in der Datenbank aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-144">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="9d0bc-145">Im Beispielszenario würden keine Daten verloren gehen, da verschiedene Eigenschaften von zwei Benutzern aktualisiert wurden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-145">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="9d0bc-146">Wenn das nächste Mal die Verlaufs Abteilung durchsucht, werden 1/1/1999 und $125.000,00 angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-146">The next time someone browses the History department, they will see 1/1/1999 and $125,000.00.</span></span> 

    <span data-ttu-id="9d0bc-147">Dies ist das Standardverhalten im Entity Framework, das die Anzahl der Konflikte erheblich reduzieren kann, die zu Datenverlusten führen können.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-147">This is the default behavior in the Entity Framework, and it can substantially reduce the number of conflicts that could result in data loss.</span></span> <span data-ttu-id="9d0bc-148">Dieses Verhalten vermeidet jedoch keinen Datenverlust, wenn an derselben Eigenschaft einer Entität konkurrierende Änderungen vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-148">However, this behavior doesn't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="9d0bc-149">Außerdem ist dieses Verhalten nicht immer möglich. Wenn Sie gespeicherte Prozeduren einem Entitätstyp zuordnen, werden alle Eigenschaften einer Entität aktualisiert, wenn Änderungen an der Entität in der Datenbank vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-149">In addition, this behavior isn't always possible; when you map stored procedures to an entity type, all of an entity's properties are updated when any changes to the entity are made in the database.</span></span>
- <span data-ttu-id="9d0bc-150">Sie können die Änderung von John überschreiben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-150">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="9d0bc-151">Nachdem Andrea auf " **Aktualisieren**" geklickt hat, wird der **Budget** Betrag auf $1.000.000,00 zurückgeleitet.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-151">After Jane clicks **Update**, the **Budget** amount goes back to $1,000,000.00.</span></span> <span data-ttu-id="9d0bc-152">Das ist entweder ein *Client gewinnt*- oder ein *Letzter Schreiber gewinnt*-Szenario.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-152">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="9d0bc-153">(Die Client Werte haben Vorrang vor dem, was im Datenspeicher liegt.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-153">(The client's values take precedence over what's in the data store.)</span></span>
- <span data-ttu-id="9d0bc-154">Sie können verhindern, dass die Änderungen von Jane in der Datenbank aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-154">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="9d0bc-155">Normalerweise würden Sie eine Fehlermeldung anzeigen, den aktuellen Zustand der Daten anzeigen und zulassen, dass die Änderungen erneut eingegeben werden, wenn Sie Sie noch erstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-155">Typically, you would display an error message, show her the current state of the data, and allow her to reenter her changes if she still wants to make them.</span></span> <span data-ttu-id="9d0bc-156">Sie können den Prozess weiter automatisieren, indem Sie die Eingabe speichern und Ihnen die Möglichkeit geben, Sie erneut anzuwenden, ohne Sie erneut eingeben zu müssen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-156">You could further automate the process by saving her input and giving her an opportunity to reapply it without having to reenter it.</span></span> <span data-ttu-id="9d0bc-157">Dieses Szenario wird *Store Wins* (Speicher gewinnt) genannt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-157">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="9d0bc-158">(Die Werte des Datenspeichers haben Vorrang vor den Werten, die vom Client gesendet werden.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-158">(The data-store values take precedence over the values submitted by the client.)</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="9d0bc-159">Erkennen von Parallelitäts Konflikten</span><span class="sxs-lookup"><span data-stu-id="9d0bc-159">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="9d0bc-160">Im Entity Framework können Sie Konflikte lösen, indem Sie `OptimisticConcurrencyException` Ausnahmen behandeln, die vom Entity Framework ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-160">In the Entity Framework, you can resolve conflicts by handling `OptimisticConcurrencyException` exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="9d0bc-161">Entity Framework muss dazu in der Lage sein, Konflikte zu erkennen, damit es weiß, wann diese Ausnahmen ausgelöst werden sollen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-161">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="9d0bc-162">Aus diesem Grund müssen Sie die Datenbank und das Datenmodell entsprechend konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-162">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="9d0bc-163">Einige der Optionen für das Aktivieren der Konflikterkennung schließen Folgendes ein:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-163">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="9d0bc-164">Fügen Sie in der-Datenbank eine Tabellenspalte ein, die verwendet werden kann, um zu bestimmen, wann eine Zeile geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-164">In the database, include a table column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="9d0bc-165">Anschließend können Sie die Entity Framework so konfigurieren, dass Sie diese Spalte in die `Where`-Klausel von SQL `Update` oder `Delete`-Befehlen einschließt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-165">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="9d0bc-166">Dies ist der Zweck der `Timestamp` Spalte in der `OfficeAssignment` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-166">That's the purpose of the `Timestamp` column in the `OfficeAssignment` table.</span></span>

    <span data-ttu-id="9d0bc-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

    <span data-ttu-id="9d0bc-168">Der Datentyp der Spalte `Timestamp` wird auch als `Timestamp`bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-168">The data type of the `Timestamp` column is also called `Timestamp`.</span></span> <span data-ttu-id="9d0bc-169">Die Spalte enthält jedoch keinen Datums-oder Uhrzeitwert.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-169">However, the column doesn't actually contain a date or time value.</span></span> <span data-ttu-id="9d0bc-170">Stattdessen ist der Wert eine sequenzielle Zahl, die jedes Mal erhöht wird, wenn die Zeile aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-170">Instead, the value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="9d0bc-171">In einem `Update`-oder `Delete`-Befehl enthält die `Where`-Klausel den ursprünglichen `Timestamp` Wert.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-171">In an `Update` or `Delete` command, the `Where` clause includes the original `Timestamp` value.</span></span> <span data-ttu-id="9d0bc-172">Wenn die zu Aktualisier Ende Zeile von einem anderen Benutzer geändert wurde, unterscheidet sich der Wert in `Timestamp` vom ursprünglichen Wert, sodass die `Where`-Klausel keine zu Aktualisier Ende Zeile zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-172">If the row being updated has been changed by another user, the value in `Timestamp` is different than the original value, so the `Where` clause returns no row to update.</span></span> <span data-ttu-id="9d0bc-173">Wenn das Entity Framework feststellt, dass keine Zeilen mit dem aktuellen `Update` oder `Delete` Befehl aktualisiert wurden (d. h., wenn die Anzahl der betroffenen Zeilen 0 (null) ist), wird dies als Parallelitäts Konflikt interpretiert.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-173">When the Entity Framework finds that no rows have been updated by the current `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="9d0bc-174">Konfigurieren Sie die Entity Framework, um die ursprünglichen Werte jeder Spalte in der Tabelle in der `Where`-Klausel der Befehle `Update` und `Delete` einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-174">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="9d0bc-175">Wie bei der ersten Option gibt die `Where`-Klausel keine zu Aktualisier Ende Zeile zurück, wenn in der Zeile nach dem ersten Lesen der Zeile Änderungen vorgenommen wurden, die der Entity Framework als Parallelitäts Konflikt interpretiert.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-175">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="9d0bc-176">Diese Methode ist so effektiv wie die Verwendung eines `Timestamp` Felds, kann jedoch ineffizient sein.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-176">This method is as effective as using a `Timestamp` field, but can be inefficient.</span></span> <span data-ttu-id="9d0bc-177">Bei Datenbanktabellen, die viele Spalten enthalten, kann dies zu sehr großen `Where` Klauseln führen, und in einer Webanwendung kann es erforderlich sein, dass Sie große Mengen an Zuständen aufbewahren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-177">For database tables that have many columns, it can result in very large `Where` clauses, and in a web application it can require that you maintain large amounts of state.</span></span> <span data-ttu-id="9d0bc-178">Die Verwaltung großer Zustands Mengen kann die Leistung der Anwendung beeinträchtigen, da Sie entweder Server Ressourcen (z. b. den Sitzungszustand) erfordert oder in der Webseite selbst enthalten sein muss (z. b. Ansichts Zustand).</span><span class="sxs-lookup"><span data-stu-id="9d0bc-178">Maintaining large amounts of state can affect application performance because it either requires server resources (for example, session state) or must be included in the web page itself (for example, view state).</span></span>

<span data-ttu-id="9d0bc-179">In diesem Tutorial fügen Sie eine Fehlerbehandlung für Konflikte mit optimistischen Parallelität für eine Entität hinzu, die keine nach Verfolgungs Eigenschaft (die `Department` Entität) und eine Entität mit einer nach Verfolgungs Eigenschaft (der `OfficeAssignment` Entität) besitzt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-179">In this tutorial you will add error handling for optimistic concurrency conflicts for an entity that doesn't have a tracking property (the `Department` entity) and for an entity that does have a tracking property (the `OfficeAssignment` entity).</span></span>

## <a name="handling-optimistic-concurrency-without-a-tracking-property"></a><span data-ttu-id="9d0bc-180">Verarbeiten von optimistischer Parallelität ohne Überwachungs Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="9d0bc-180">Handling Optimistic Concurrency Without a Tracking Property</span></span>

<span data-ttu-id="9d0bc-181">Zum Implementieren der vollständigen Parallelität für die `Department`-Entität, die über keine Überwachungs Eigenschaft (`Timestamp`) verfügt, führen Sie die folgenden Aufgaben aus:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-181">To implement optimistic concurrency for the `Department` entity, which doesn't have a tracking (`Timestamp`) property, you will complete the following tasks:</span></span>

- <span data-ttu-id="9d0bc-182">Ändern Sie das Datenmodell, um die Parallelitäts Verfolgung für `Department` Entitäten zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-182">Change the data model to enable concurrency tracking for `Department` entities.</span></span>
- <span data-ttu-id="9d0bc-183">Behandeln Sie in der `SchoolRepository`-Klasse Parallelitäts Ausnahmen in der `SaveChanges`-Methode.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-183">In the `SchoolRepository` class, handle concurrency exceptions in the `SaveChanges` method.</span></span>
- <span data-ttu-id="9d0bc-184">Behandeln Sie Parallelitäts Ausnahmen auf der Seite " *Departments. aspx* ", indem Sie eine Meldung an die Benutzerwarnung anzeigen, dass die versuchten Änderungen nicht erfolgreich waren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-184">In the *Departments.aspx* page, handle concurrency exceptions by displaying a message to the user warning that the attempted changes were unsuccessful.</span></span> <span data-ttu-id="9d0bc-185">Der Benutzer kann dann die aktuellen Werte sehen und die Änderungen wiederholen, wenn Sie noch benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-185">The user can then see the current values and retry the changes if they are still needed.</span></span>

### <a name="enabling-concurrency-tracking-in-the-data-model"></a><span data-ttu-id="9d0bc-186">Aktivieren der Parallelitäts Verfolgung im Datenmodell</span><span class="sxs-lookup"><span data-stu-id="9d0bc-186">Enabling Concurrency Tracking in the Data Model</span></span>

<span data-ttu-id="9d0bc-187">Öffnen Sie in Visual Studio die Webanwendung "Web-App für die Internet-app", mit der Sie im vorherigen Tutorial dieser Reihe gearbeitet haben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-187">In Visual Studio, open the Contoso University web application that you were working with in the previous tutorial in this series.</span></span>

<span data-ttu-id="9d0bc-188">Öffnen Sie *School Model. edmx*, und klicken Sie im Datenmodell-Designer mit der rechten Maustaste auf die `Name`-Eigenschaft in der `Department` Entität, und klicken Sie dann auf **Eigenschaften**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-188">Open *SchoolModel.edmx*, and in the data model designer, right-click the `Name` property in the `Department` entity and then click **Properties**.</span></span> <span data-ttu-id="9d0bc-189">Ändern Sie im **Eigenschaften** Fenster die `ConcurrencyMode`-Eigenschaft in `Fixed`.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-189">In the **Properties** window, change the `ConcurrencyMode` property to `Fixed`.</span></span>

<span data-ttu-id="9d0bc-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="9d0bc-191">Führen Sie die gleichen Schritte für die anderen skalaren Eigenschaften aus, die keine Primärschlüssel sind (`Budget`, `StartDate`und `Administrator`.) (Dies ist für Navigations Eigenschaften nicht möglich.) Dies gibt an, dass die Spalten (mit ursprünglichen Werten) in der `Where`-Klausel enthalten sein müssen, wenn die Entity Framework eine `Update` oder `Delete` SQL-Befehl generiert, um die `Department` Entität in der Datenbank zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-191">Do the same for the other non-primary-key scalar properties (`Budget`, `StartDate`, and `Administrator`.) (You can't do this for navigation properties.) This specifies that whenever the Entity Framework generates a `Update` or `Delete` SQL command to update the `Department` entity in the database, these columns (with original values) must be included in the `Where` clause.</span></span> <span data-ttu-id="9d0bc-192">Wenn bei der Ausführung des `Update`-oder `Delete` Befehls keine Zeile gefunden wird, löst der Entity Framework eine Ausnahme der vollständigen Parallelität aus.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-192">If no row is found when the `Update` or `Delete` command executes, the Entity Framework will throw an optimistic-concurrency exception.</span></span>

<span data-ttu-id="9d0bc-193">Speichern und schließen Sie das Datenmodell.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-193">Save and close the data model.</span></span>

### <a name="handling-concurrency-exceptions-in-the-dal"></a><span data-ttu-id="9d0bc-194">Behandeln von Parallelitäts Ausnahmen in der Dal</span><span class="sxs-lookup"><span data-stu-id="9d0bc-194">Handling Concurrency Exceptions in the DAL</span></span>

<span data-ttu-id="9d0bc-195">Öffnen Sie *SchoolRepository.cs* , und fügen Sie die folgende `using`-Anweisung für den `System.Data`-Namespace hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-195">Open *SchoolRepository.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="9d0bc-196">Fügen Sie die folgende neue `SaveChanges`-Methode hinzu, die Ausnahmen bei der vollständigen Parallelität behandelt:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-196">Add the following new `SaveChanges` method, which handles optimistic concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="9d0bc-197">Wenn beim Aufrufen dieser Methode ein Parallelitäts Fehler auftritt, werden die Eigenschaftswerte der Entität im Arbeitsspeicher durch die aktuell in der Datenbank vorhandenen Werte ersetzt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-197">If a concurrency error occurs when this method is called, the property values of the entity in memory are replaced with the values currently in the database.</span></span> <span data-ttu-id="9d0bc-198">Die Parallelitäts Ausnahme wird erneut ausgelöst, sodass Sie von der Webseite behandelt werden kann.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-198">The concurrency exception is rethrown so that the web page can handle it.</span></span>

<span data-ttu-id="9d0bc-199">Ersetzen Sie in den Methoden `DeleteDepartment` und `UpdateDepartment` den vorhandenen Aufruf von `context.SaveChanges()` durch einen Aufruf von `SaveChanges()`, um die neue Methode aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-199">In the `DeleteDepartment` and `UpdateDepartment` methods, replace the existing call to `context.SaveChanges()` with a call to `SaveChanges()` in order to invoke the new method.</span></span>

### <a name="handling-concurrency-exceptions-in-the-presentation-layer"></a><span data-ttu-id="9d0bc-200">Behandeln von Parallelitäts Ausnahmen in der Darstellungs Schicht</span><span class="sxs-lookup"><span data-stu-id="9d0bc-200">Handling Concurrency Exceptions in the Presentation Layer</span></span>

<span data-ttu-id="9d0bc-201">Öffnen Sie " *Departments. aspx* ", und fügen Sie dem `DepartmentsObjectDataSource` Steuerelement ein `OnDeleted="DepartmentsObjectDataSource_Deleted"` Attribut hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-201">Open *Departments.aspx* and add an `OnDeleted="DepartmentsObjectDataSource_Deleted"` attribute to the `DepartmentsObjectDataSource` control.</span></span> <span data-ttu-id="9d0bc-202">Das öffnende Tag für das-Steuerelement ähnelt nun dem folgenden Beispiel.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-202">The opening tag for the control will now resemble the following example.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="9d0bc-203">Geben Sie im `DepartmentsGridView`-Steuerelement alle Tabellen Spalten im `DataKeyNames`-Attribut an, wie im folgenden Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-203">In the `DepartmentsGridView` control, specify all of the table columns in the `DataKeyNames` attribute, as shown in the following example.</span></span> <span data-ttu-id="9d0bc-204">Beachten Sie, dass dadurch sehr große Ansichts Zustands Felder erstellt werden. Dies ist ein Grund, warum die Verwendung eines nach Verfolgungs Felds im Allgemeinen die bevorzugte Methode zum Nachverfolgen von Parallelitäts Konflikten ist.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-204">Note that this will create very large view state fields, which is one reason why using a tracking field is generally the preferred way to track concurrency conflicts.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="9d0bc-205">Öffnen Sie *Departments.aspx.cs* , und fügen Sie die folgende `using`-Anweisung für den `System.Data`-Namespace hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-205">Open *Departments.aspx.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

<span data-ttu-id="9d0bc-206">Fügen Sie die folgende neue Methode hinzu, die Sie aus dem `Updated` des Datenquellen-Steuer Elements und `Deleted` Ereignis Handlern für die Behandlung von Parallelitäts Ausnahmen aufzurufen:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-206">Add the following new method, which you will call from the data source control's `Updated` and `Deleted` event handlers for handling concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

<span data-ttu-id="9d0bc-207">Dieser Code überprüft den Ausnahmetyp. wenn es sich um eine Parallelitäts Ausnahme handelt, erstellt der Code dynamisch ein `CustomValidator` Steuerelement, das wiederum eine Meldung im `ValidationSummary` Steuerelement anzeigt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-207">This code checks the exception type, and if it's a concurrency exception, the code dynamically creates a `CustomValidator` control that in turn displays a message in the `ValidationSummary` control.</span></span>

<span data-ttu-id="9d0bc-208">Nennen Sie die neue Methode aus dem `Updated` Ereignishandler, den Sie zuvor hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-208">Call the new method from the `Updated` event handler that you added earlier.</span></span> <span data-ttu-id="9d0bc-209">Erstellen Sie außerdem einen neuen `Deleted` Ereignishandler, der dieselbe Methode aufruft (aber nichts anderes tut):</span><span class="sxs-lookup"><span data-stu-id="9d0bc-209">In addition, create a new `Deleted` event handler that calls the same method (but doesn't do anything else):</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

### <a name="testing-optimistic-concurrency-in-the-departments-page"></a><span data-ttu-id="9d0bc-210">Testen optimistischer Parallelität auf der Seite "Abteilungen"</span><span class="sxs-lookup"><span data-stu-id="9d0bc-210">Testing Optimistic Concurrency in the Departments Page</span></span>

<span data-ttu-id="9d0bc-211">Führen Sie die Seite " *Departments. aspx* " aus.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-211">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="9d0bc-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="9d0bc-213">Klicken Sie in einer Zeile auf **Bearbeiten** , und ändern Sie den Wert in der Spalte **Budget** .</span><span class="sxs-lookup"><span data-stu-id="9d0bc-213">Click **Edit** in a row and change the value in the **Budget** column.</span></span> <span data-ttu-id="9d0bc-214">(Denken Sie daran, dass Sie nur die Datensätze bearbeiten können, die Sie für dieses Tutorial erstellt haben, da die vorhandenen `School` Datenbankdaten Sätze ungültige Daten enthalten.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-214">(Remember that you can only edit records that you've created for this tutorial, because the existing `School` database records contain some invalid data.</span></span> <span data-ttu-id="9d0bc-215">Der Datensatz für die Wirtschaftsabteilung ist ein sicherer, mit dem Sie experimentieren können.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-215">The record for the Economics department is a safe one to experiment with.)</span></span>

<span data-ttu-id="9d0bc-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="9d0bc-217">Öffnen Sie ein neues Browserfenster, und führen Sie die Seite erneut aus (Kopieren Sie die URL aus dem Adressfeld des ersten Browserfensters in das zweite Browserfenster).</span><span class="sxs-lookup"><span data-stu-id="9d0bc-217">Open a new browser window and run the page again (copy the URL from the first browser window's address box to the second browser window).</span></span>

<span data-ttu-id="9d0bc-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="9d0bc-219">Klicken Sie in derselben Zeile, die Sie zuvor bearbeitet haben, auf **Bearbeiten** , und ändern Sie den Wert für **Budget** in etwas anderes</span><span class="sxs-lookup"><span data-stu-id="9d0bc-219">Click **Edit** in the same row you edited earlier and change the **Budget** value to something different.</span></span>

<span data-ttu-id="9d0bc-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="9d0bc-221">Klicken Sie im zweiten Browserfenster auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-221">In the second browser window, click **Update**.</span></span> <span data-ttu-id="9d0bc-222">Der **Budget** Betrag wurde erfolgreich auf diesen neuen Wert geändert.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-222">The **Budget** amount is successfully changed to this new value.</span></span>

<span data-ttu-id="9d0bc-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="9d0bc-224">Klicken Sie im ersten Browserfenster auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-224">In the first browser window, click **Update**.</span></span> <span data-ttu-id="9d0bc-225">Die Aktualisierung schlägt fehl.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-225">The update fails.</span></span> <span data-ttu-id="9d0bc-226">Der **Budget** Betrag wird mit dem Wert, den Sie im zweiten Browserfenster festgelegt haben, erneut angezeigt, und es wird eine Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-226">The **Budget** amount is redisplayed using the value you set in the second browser window, and you see an error message.</span></span>

<span data-ttu-id="9d0bc-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

## <a name="handling-optimistic-concurrency-using-a-tracking-property"></a><span data-ttu-id="9d0bc-228">Verarbeiten von optimistischer Parallelität mithilfe einer nach Verfolgungs Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="9d0bc-228">Handling Optimistic Concurrency Using a Tracking Property</span></span>

<span data-ttu-id="9d0bc-229">Zum Verarbeiten der vollständigen Parallelität für eine Entität, die über eine Überwachungs Eigenschaft verfügt, führen Sie die folgenden Aufgaben aus:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-229">To handle optimistic concurrency for an entity that has a tracking property, you will complete the following tasks:</span></span>

- <span data-ttu-id="9d0bc-230">Fügen Sie dem Datenmodell gespeicherte Prozeduren hinzu, um `OfficeAssignment` Entitäten zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-230">Add stored procedures to the data model to manage `OfficeAssignment` entities.</span></span> <span data-ttu-id="9d0bc-231">(Überwachungs Eigenschaften und gespeicherte Prozeduren müssen nicht zusammen verwendet werden. Sie werden hier nur zur Veranschaulichung zusammengefasst.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-231">(Tracking properties and stored procedures don't have to be used together; they're just grouped together here for illustration.)</span></span>
- <span data-ttu-id="9d0bc-232">Fügen Sie die CRUD-Methoden der dal und der BLL für `OfficeAssignment` Entitäten hinzu, einschließlich Code zum Behandeln von Ausnahmen in der vollständigen Parallelität in der DAL.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-232">Add CRUD methods to the DAL and the BLL for `OfficeAssignment` entities, including code to handle optimistic concurrency exceptions in the DAL.</span></span>
- <span data-ttu-id="9d0bc-233">Erstellen einer Webseite für Office-Zuweisungen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-233">Create an office-assignments web page.</span></span>
- <span data-ttu-id="9d0bc-234">Testen Sie die optimistische Parallelität auf der neuen Webseite.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-234">Test optimistic concurrency in the new web page.</span></span>

### <a name="adding-officeassignment-stored-procedures-to-the-data-model"></a><span data-ttu-id="9d0bc-235">Hinzufügen von officezuweisung-gespeicherten Prozeduren zum Datenmodell</span><span class="sxs-lookup"><span data-stu-id="9d0bc-235">Adding OfficeAssignment Stored Procedures to the Data Model</span></span>

<span data-ttu-id="9d0bc-236">Öffnen Sie die Datei " *SchoolModel. edmx* " im Modell-Designer, klicken Sie mit der rechten Maustaste auf die Entwurfs Oberfläche, und klicken Sie auf **Modell aus Datenbank aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-236">Open the *SchoolModel.edmx* file in the model designer, right-click the design surface, and click **Update Model from Database**.</span></span> <span data-ttu-id="9d0bc-237">Erweitern Sie im Dialogfeld **Wählen Sie Ihre Datenbankobjekte** auf der Registerkarte **Hinzufügen** die Option **gespeicherte Prozeduren** , und wählen Sie die drei gespeicherten Prozeduren `OfficeAssignment` aus (siehe den folgenden Screenshot **).**</span><span class="sxs-lookup"><span data-stu-id="9d0bc-237">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures** and select the three `OfficeAssignment` stored procedures (see the following screenshot), and then click **Finish**.</span></span> <span data-ttu-id="9d0bc-238">(Diese gespeicherten Prozeduren waren bereits in der Datenbank vorhanden, als Sie Sie mithilfe eines Skripts heruntergeladen oder erstellt haben.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-238">(These stored procedures were already in the database when you downloaded or created it using a script.)</span></span>

<span data-ttu-id="9d0bc-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="9d0bc-240">Klicken Sie mit der rechten Maustaste auf die `OfficeAssignment` Entität, und wählen Sie **Zuordnung der gespeicherten**</span><span class="sxs-lookup"><span data-stu-id="9d0bc-240">Right-click the `OfficeAssignment` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="9d0bc-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="9d0bc-242">Legen Sie die Funktionen **Insert**, **Update**und **Delete** so fest, dass Sie die entsprechenden gespeicherten Prozeduren verwenden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-242">Set the **Insert**, **Update**, and **Delete** functions to use their corresponding stored procedures.</span></span> <span data-ttu-id="9d0bc-243">Legen Sie für den `OrigTimestamp`-Parameter der `Update`-Funktion die- **Eigenschaft** auf `Timestamp` fest, und wählen Sie die Option **ursprünglichen Wert verwenden** aus.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-243">For the `OrigTimestamp` parameter of the `Update` function, set the **Property** to `Timestamp` and select the **Use Original Value** option.</span></span>

<span data-ttu-id="9d0bc-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span></span>

<span data-ttu-id="9d0bc-245">Wenn das Entity Framework die gespeicherte Prozedur `UpdateOfficeAssignment` aufruft, übergibt es den ursprünglichen Wert der Spalte `Timestamp` im `OrigTimestamp`-Parameter.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-245">When the Entity Framework calls the `UpdateOfficeAssignment` stored procedure, it will pass the original value of the `Timestamp` column in the `OrigTimestamp` parameter.</span></span> <span data-ttu-id="9d0bc-246">Die gespeicherte Prozedur verwendet diesen Parameter in der `Where`-Klausel:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-246">The stored procedure uses this parameter in its `Where` clause:</span></span>

[!code-sql[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.sql)]

<span data-ttu-id="9d0bc-247">Die gespeicherte Prozedur wählt auch den neuen Wert der `Timestamp` Spalte nach dem Update aus, damit die Entity Framework die `OfficeAssignment` Entität, die sich im Arbeitsspeicher befindet, mit der entsprechenden Datenbankzeile synchron halten können.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-247">The stored procedure also selects the new value of the `Timestamp` column after the update so that the Entity Framework can keep the `OfficeAssignment` entity that's in memory in sync with the corresponding database row.</span></span>

<span data-ttu-id="9d0bc-248">(Beachten Sie, dass die gespeicherte Prozedur zum Löschen einer Office-Zuweisung nicht über einen `OrigTimestamp`-Parameter verfügt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-248">(Note that the stored procedure for deleting an office assignment doesn't have an `OrigTimestamp` parameter.</span></span> <span data-ttu-id="9d0bc-249">Aus diesem Grund kann der Entity Framework nicht überprüfen, ob eine Entität vor dem Löschen unverändert ist.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-249">Because of this, the Entity Framework can't verify that an entity is unchanged before deleting it.)</span></span>

<span data-ttu-id="9d0bc-250">Speichern und schließen Sie das Datenmodell.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-250">Save and close the data model.</span></span>

### <a name="adding-officeassignment-methods-to-the-dal"></a><span data-ttu-id="9d0bc-251">Hinzufügen von officezuweisungs Methoden zur Dal</span><span class="sxs-lookup"><span data-stu-id="9d0bc-251">Adding OfficeAssignment Methods to the DAL</span></span>

<span data-ttu-id="9d0bc-252">Öffnen Sie *ISchoolRepository.cs* , und fügen Sie die folgenden CRUD-Methoden für die `OfficeAssignment` Entitätenmenge hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-252">Open *ISchoolRepository.cs* and add the following CRUD methods for the `OfficeAssignment` entity set:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="9d0bc-253">Fügen Sie *SchoolRepository.cs*die folgenden neuen Methoden hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-253">Add the following new methods to *SchoolRepository.cs*.</span></span> <span data-ttu-id="9d0bc-254">In der `UpdateOfficeAssignment`-Methode wird die lokale `SaveChanges`-Methode anstelle von `context.SaveChanges`aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-254">In the `UpdateOfficeAssignment` method, you call the local `SaveChanges` method instead of `context.SaveChanges`.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="9d0bc-255">Öffnen Sie *MockSchoolRepository.cs* im Testprojekt, und fügen Sie ihm die folgenden `OfficeAssignment` Collection-und CRUD-Methoden hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-255">In the test project, open *MockSchoolRepository.cs* and add the following `OfficeAssignment` collection and CRUD methods to it.</span></span> <span data-ttu-id="9d0bc-256">(Das mockrepository muss die Repository-Schnittstelle implementieren, oder die Lösung wird nicht kompiliert.)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-256">(The mock repository must implement the repository interface, or the solution won't compile.)</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

### <a name="adding-officeassignment-methods-to-the-bll"></a><span data-ttu-id="9d0bc-257">Hinzufügen von officezuweisungs Methoden zur BLL</span><span class="sxs-lookup"><span data-stu-id="9d0bc-257">Adding OfficeAssignment Methods to the BLL</span></span>

<span data-ttu-id="9d0bc-258">Öffnen Sie im Hauptprojekt *SchoolBL.cs* , und fügen Sie die folgenden CRUD-Methoden für die `OfficeAssignment` Entitätenmenge hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-258">In the main project, open *SchoolBL.cs* and add the following CRUD methods for the `OfficeAssignment` entity set to it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

## <a name="creating-an-officeassignments-web-page"></a><span data-ttu-id="9d0bc-259">Erstellen einer officezuweisungen-Webseite</span><span class="sxs-lookup"><span data-stu-id="9d0bc-259">Creating an OfficeAssignments Web Page</span></span>

<span data-ttu-id="9d0bc-260">Erstellen Sie eine neue Webseite, die die Master Seite *Site. Master* verwendet, und nennen Sie Sie *officezuweisungen. aspx*.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-260">Create a new web page that uses the *Site.Master* master page and name it *OfficeAssignments.aspx*.</span></span> <span data-ttu-id="9d0bc-261">Fügen Sie das folgende Markup dem `Content`-Steuerelement mit dem Namen `Content2`hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-261">Add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.aspx)]

<span data-ttu-id="9d0bc-262">Beachten Sie, dass im `DataKeyNames`-Attribut das Markup die `Timestamp`-Eigenschaft und den Daten Satz Schlüssel (`InstructorID`) angibt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-262">Notice that in the `DataKeyNames` attribute, the markup specifies the `Timestamp` property as well as the record key (`InstructorID`).</span></span> <span data-ttu-id="9d0bc-263">Das Angeben von Eigenschaften im `DataKeyNames`-Attribut bewirkt, dass das Steuerelement diese im Steuerelement Zustand (ähnlich dem Ansichts Zustand) speichert, sodass die ursprünglichen Werte während der Post Back Verarbeitung verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-263">Specifying properties in the `DataKeyNames` attribute causes the control to save them in control state (which is similar to view state) so that the original values are available during postback processing.</span></span>

<span data-ttu-id="9d0bc-264">Wenn Sie den `Timestamp` Wert nicht gespeichert haben, hat der Entity Framework ihn nicht für die `Where`-Klausel des SQL-`Update` Befehls.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-264">If you didn't save the `Timestamp` value, the Entity Framework would not have it for the `Where` clause of the SQL `Update` command.</span></span> <span data-ttu-id="9d0bc-265">Folglich würde nichts zu aktualisieren gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-265">Consequently nothing would be found to update.</span></span> <span data-ttu-id="9d0bc-266">Folglich würde der Entity Framework jedes Mal, wenn eine `OfficeAssignment` Entität aktualisiert wird, eine vollständige Parallelitäts Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-266">As a result, the Entity Framework would throw an optimistic concurrency exception every time an `OfficeAssignment` entity is updated.</span></span>

<span data-ttu-id="9d0bc-267">Öffnen Sie *OfficeAssignments.aspx.cs* , und fügen Sie die folgende `using`-Anweisung für die Datenzugriffs Ebene hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-267">Open *OfficeAssignments.aspx.cs* and add the following `using` statement for the data access layer:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="9d0bc-268">Fügen Sie die folgende `Page_Init`-Methode hinzu, die dynamische Daten Funktionalität ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-268">Add the following `Page_Init` method, which enables Dynamic Data functionality.</span></span> <span data-ttu-id="9d0bc-269">Fügen Sie außerdem den folgenden Handler für das `Updated` Ereignis des `ObjectDataSource`-Steuer Elements hinzu, um nach Parallelitäts Fehlern zu suchen:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-269">Also add the following handler for the `ObjectDataSource` control's `Updated` event in order to check for concurrency errors:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

### <a name="testing-optimistic-concurrency-in-the-officeassignments-page"></a><span data-ttu-id="9d0bc-270">Testen der optimistischen Parallelität auf der Seite "officezuweisungen"</span><span class="sxs-lookup"><span data-stu-id="9d0bc-270">Testing Optimistic Concurrency in the OfficeAssignments Page</span></span>

<span data-ttu-id="9d0bc-271">Führen Sie die Seite *officezuweisungen. aspx* aus.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-271">Run the *OfficeAssignments.aspx* page.</span></span>

<span data-ttu-id="9d0bc-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span></span>

<span data-ttu-id="9d0bc-273">Klicken Sie in einer Zeile auf **Bearbeiten** , und ändern Sie den Wert in der Spalte **Speicherort** .</span><span class="sxs-lookup"><span data-stu-id="9d0bc-273">Click **Edit** in a row and change the value in the **Location** column.</span></span>

<span data-ttu-id="9d0bc-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span></span>

<span data-ttu-id="9d0bc-275">Öffnen Sie ein neues Browserfenster, und führen Sie die Seite erneut aus (Kopieren Sie die URL aus dem ersten Browserfenster in das zweite Browserfenster).</span><span class="sxs-lookup"><span data-stu-id="9d0bc-275">Open a new browser window and run the page again (copy the URL from the first browser window to the second browser window).</span></span>

<span data-ttu-id="9d0bc-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span></span>

<span data-ttu-id="9d0bc-277">Klicken Sie in derselben Zeile, die Sie zuvor bearbeitet haben, auf **Bearbeiten** , und ändern Sie den **Speicherort** Wert in einen anderen</span><span class="sxs-lookup"><span data-stu-id="9d0bc-277">Click **Edit** in the same row you edited earlier and change the **Location** value to something different.</span></span>

<span data-ttu-id="9d0bc-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span></span>

<span data-ttu-id="9d0bc-279">Klicken Sie im zweiten Browserfenster auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-279">In the second browser window, click **Update**.</span></span>

<span data-ttu-id="9d0bc-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span></span>

<span data-ttu-id="9d0bc-281">Wechseln Sie zum ersten Browserfenster, und klicken Sie auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-281">Switch to the first browser window and click **Update**.</span></span>

<span data-ttu-id="9d0bc-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span></span>

<span data-ttu-id="9d0bc-283">Es wird eine Fehlermeldung angezeigt, und der **Location** -Wert wurde aktualisiert, um den Wert anzuzeigen, den Sie im zweiten Browserfenster geändert haben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-283">You see an error message and the **Location** value has been updated to show the value you changed it to in the second browser window.</span></span>

## <a name="handling-concurrency-with-the-entitydatasource-control"></a><span data-ttu-id="9d0bc-284">Behandeln von Parallelität mit dem EntityDataSource-Steuerelement</span><span class="sxs-lookup"><span data-stu-id="9d0bc-284">Handling Concurrency with the EntityDataSource Control</span></span>

<span data-ttu-id="9d0bc-285">Das `EntityDataSource` Steuerelement enthält integrierte Logik, die die Parallelitäts Einstellungen im Datenmodell erkennt und Aktualisierungs-und Löschvorgänge entsprechend behandelt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-285">The `EntityDataSource` control includes built-in logic that recognizes the concurrency settings in the data model and handles update and delete operations accordingly.</span></span> <span data-ttu-id="9d0bc-286">Wie bei allen Ausnahmen müssen Sie jedoch `OptimisticConcurrencyException` Ausnahmen selbst behandeln, um eine benutzerfreundliche Fehlermeldung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-286">However, as with all exceptions, you must handle `OptimisticConcurrencyException` exceptions yourself in order to provide a user-friendly error message.</span></span>

<span data-ttu-id="9d0bc-287">Als Nächstes konfigurieren Sie die Seite " *Courses. aspx* " (die ein `EntityDataSource`-Steuerelement verwendet), um Aktualisierungs-und Löschvorgänge zuzulassen und eine Fehlermeldung anzuzeigen, wenn ein Parallelitäts Konflikt auftritt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-287">Next, you will configure the *Courses.aspx* page (which uses an `EntityDataSource` control) to allow update and delete operations and to display an error message if a concurrency conflict occurs.</span></span> <span data-ttu-id="9d0bc-288">Die `Course`-Entität verfügt nicht über eine Spalte für die Parallelitäts Nachverfolgung, daher verwenden Sie dieselbe Methode wie für die `Department`-Entität: Nachverfolgen der Werte aller nicht Schlüsseleigenschaften.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-288">The `Course` entity doesn't have a concurrency tracking column, so you will use the same method that you did with the `Department` entity: track the values of all non-key properties.</span></span>

<span data-ttu-id="9d0bc-289">Öffnen Sie die Datei " *SchoolModel. edmx* ".</span><span class="sxs-lookup"><span data-stu-id="9d0bc-289">Open the *SchoolModel.edmx* file.</span></span> <span data-ttu-id="9d0bc-290">Legen Sie für die nicht Schlüsseleigenschaften der `Course` Entität (`Title`, `Credits`und `DepartmentID`) die Eigenschaft Parallelitäts **Modus** auf `Fixed`fest.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-290">For the non-key properties of the `Course` entity (`Title`, `Credits`, and `DepartmentID`), set the **Concurrency Mode** property to `Fixed`.</span></span> <span data-ttu-id="9d0bc-291">Speichern und schließen Sie dann das Datenmodell.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-291">Then save and close the data model.</span></span>

<span data-ttu-id="9d0bc-292">Öffnen Sie die Seite " *Courses. aspx* ", und nehmen Sie die folgenden Änderungen vor:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-292">Open the *Courses.aspx* page and make the following changes:</span></span>

- <span data-ttu-id="9d0bc-293">Fügen Sie im `CoursesEntityDataSource`-Steuerelement die Attribute `EnableUpdate="true"` und `EnableDelete="true"` hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-293">In the `CoursesEntityDataSource` control, add `EnableUpdate="true"` and `EnableDelete="true"` attributes.</span></span> <span data-ttu-id="9d0bc-294">Das öffnende Tag für dieses Steuerelement ähnelt nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-294">The opening tag for that control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample16.aspx)]
- <span data-ttu-id="9d0bc-295">Ändern Sie im `CoursesGridView` Steuerelement den Wert des `DataKeyNames` Attributs in `"CourseID,Title,Credits,DepartmentID"`.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-295">In the `CoursesGridView` control, change the `DataKeyNames` attribute value to `"CourseID,Title,Credits,DepartmentID"`.</span></span> <span data-ttu-id="9d0bc-296">Fügen Sie dem `Columns` Element, das die Schaltflächen **Bearbeiten** und **Löschen** anzeigt (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`), ein `CommandField` Element hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-296">Then add a `CommandField` element to the `Columns` element that shows **Edit** and **Delete** buttons (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`).</span></span> <span data-ttu-id="9d0bc-297">Das `GridView`-Steuerelement ähnelt nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-297">The `GridView` control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample17.aspx)]

<span data-ttu-id="9d0bc-298">Führen Sie die Seite aus, und erstellen Sie wie zuvor auf der Seite "Abteilungen" eine Konfliktsituation.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-298">Run the page and create a conflict situation as you did before in the Departments page.</span></span> <span data-ttu-id="9d0bc-299">Führen Sie die Seite in zwei Browserfenstern aus, klicken Sie in jedem Fenster in derselben Zeile auf **Bearbeiten** , und nehmen Sie jeweils eine andere Änderung vor.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-299">Run the page in two browser windows, click **Edit** in the same line in each window, and make a different change in each one.</span></span> <span data-ttu-id="9d0bc-300">Klicken Sie in einem Fenster auf **Aktualisieren** , und klicken Sie dann im anderen Fenster auf **Aktualisieren** .</span><span class="sxs-lookup"><span data-stu-id="9d0bc-300">Click **Update** in one window and then click **Update** in the other window.</span></span> <span data-ttu-id="9d0bc-301">Wenn Sie zum zweiten Mal auf **Aktualisieren** klicken, wird die Fehlerseite angezeigt, die sich aus einer nicht behandelten Parallelitäts Ausnahme ergibt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-301">When you click **Update** the second time, you see the error page that results from an unhandled concurrency exception.</span></span>

<span data-ttu-id="9d0bc-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span></span>

<span data-ttu-id="9d0bc-303">Dieser Fehler wird so behandelt, wie Sie ihn für das `ObjectDataSource` Steuerelement behandelt haben.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-303">You handle this error in a manner very similar to how you handled it for the `ObjectDataSource` control.</span></span> <span data-ttu-id="9d0bc-304">Öffnen Sie die Seite " *Courses. aspx* ", und geben Sie im `CoursesEntityDataSource`-Steuerelement Handler für die `Deleted`-und `Updated`-Ereignisse an.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-304">Open the *Courses.aspx* page, and in the `CoursesEntityDataSource` control, specify handlers for the `Deleted` and `Updated` events.</span></span> <span data-ttu-id="9d0bc-305">Das öffnende Tag des-Steuer Elements ähnelt nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-305">The opening tag of the control now resembles the following example:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample18.aspx)]

<span data-ttu-id="9d0bc-306">Fügen Sie vor dem `CoursesGridView`-Steuerelement das folgende `ValidationSummary` Steuerelement hinzu:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-306">Before the `CoursesGridView` control, add the following `ValidationSummary` control:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample19.aspx)]

<span data-ttu-id="9d0bc-307">Fügen Sie in *Courses.aspx.cs*eine `using`-Anweisung für den `System.Data`-Namespace hinzu, fügen Sie eine Methode hinzu, die auf neben läufigkeits Ausnahmen prüft, und fügen Sie Handler für die `Updated`-und `Deleted` Handler des `EntityDataSource`-Steuer Elements hinzu.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-307">In *Courses.aspx.cs*, add a `using` statement for the `System.Data` namespace, add a method that checks for concurrency exceptions, and add handlers for the `EntityDataSource` control's `Updated` and `Deleted` handlers.</span></span> <span data-ttu-id="9d0bc-308">Der Code sieht wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-308">The code will look like the following:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample20.cs)]

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample21.cs)]

<span data-ttu-id="9d0bc-309">Der einzige Unterschied zwischen diesem Code und dem `ObjectDataSource` Steuerelement besteht darin, dass in diesem Fall die Parallelitäts Ausnahme in der `Exception`-Eigenschaft des Ereignis arguments-Objekts statt in der `InnerException`-Eigenschaft dieser Ausnahme liegt.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-309">The only difference between this code and what you did for the `ObjectDataSource` control is that in this case the concurrency exception is in the `Exception` property of the event arguments object rather than in that exception's `InnerException` property.</span></span>

<span data-ttu-id="9d0bc-310">Führen Sie die Seite aus, und erstellen Sie einen Parallelitäts Konflikt erneut.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-310">Run the page and create a concurrency conflict again.</span></span> <span data-ttu-id="9d0bc-311">Dieses Mal wird eine Fehlermeldung angezeigt:</span><span class="sxs-lookup"><span data-stu-id="9d0bc-311">This time you see an error message:</span></span>

<span data-ttu-id="9d0bc-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span></span>

<span data-ttu-id="9d0bc-313">Damit ist die Einführung in die Behandlung von Nebenläufigkeitskonflikten abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-313">This completes the introduction to handling concurrency conflicts.</span></span> <span data-ttu-id="9d0bc-314">Im nächsten Tutorial finden Sie Anleitungen zur Verbesserung der Leistung in einer Webanwendung, die die Entity Framework verwendet.</span><span class="sxs-lookup"><span data-stu-id="9d0bc-314">The next tutorial will provide guidance on how to improve performance in a web application that uses the Entity Framework.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9d0bc-315">[Zurück](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
> [Weiter](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="9d0bc-315">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
[Next](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span></span>
