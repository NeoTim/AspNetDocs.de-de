---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Mit den Entity Framework 4,0 und dem ObjectDataSource-Steuerelement, Teil 1: ersten Schritte | Microsoft-Dokumentation'
author: tdykstra
description: Diese tutorialreihe basiert auf der Webanwendung der Website "Web-so University", die durch die Reihe "Getting Started with the Entity Framework Tutorial Wenn yo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78440403"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="230da-104">Mit den Entity Framework 4,0 und dem ObjectDataSource-Steuerelement, Teil 1: ersten Schritten</span><span class="sxs-lookup"><span data-stu-id="230da-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="230da-105">von [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="230da-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="230da-106">Diese tutorialreihe basiert auf der Webanwendung der Website von "Web", die in der tutorialreihe für die ersten Schritte [mit Entity Framework 4,0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="230da-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="230da-107">Wenn Sie die vorherigen Tutorials nicht durchgearbeitet haben, können Sie die Anwendung, die Sie erstellt haben, als Ausgangspunkt für dieses Tutorial [herunterladen](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) .</span><span class="sxs-lookup"><span data-stu-id="230da-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="230da-108">Sie können auch [die Anwendung herunterladen](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , die von der kompletten tutorialreihe erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="230da-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="230da-109">Die Beispiel-Webanwendung der Beispiel-Web-App veranschaulicht, wie Sie ASP.net-Web Forms Anwendungen mithilfe von Entity Framework 4,0 und Visual Studio 2010 erstellen.</span><span class="sxs-lookup"><span data-stu-id="230da-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="230da-110">Die Beispielanwendung ist eine Website für eine fiktive.</span><span class="sxs-lookup"><span data-stu-id="230da-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="230da-111">Sie enthält Funktionen wie die Zulassung von Studenten, die Erstellung von Kursen und Aufgaben von Dozenten.</span><span class="sxs-lookup"><span data-stu-id="230da-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="230da-112">Das Tutorial zeigt Beispiele in C#.</span><span class="sxs-lookup"><span data-stu-id="230da-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="230da-113">Das [herunterladbare Beispiel](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) enthält Code C# sowohl in als auch in Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="230da-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="230da-114">Database First</span><span class="sxs-lookup"><span data-stu-id="230da-114">Database First</span></span>
> 
> <span data-ttu-id="230da-115">Es gibt drei Möglichkeiten, wie Sie mit Daten in der Entity Framework arbeiten können: *Database First*, *Model First*und *Code First*.</span><span class="sxs-lookup"><span data-stu-id="230da-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="230da-116">Dieses Tutorial ist für Database First.</span><span class="sxs-lookup"><span data-stu-id="230da-116">This tutorial is for Database First.</span></span> <span data-ttu-id="230da-117">Informationen zu den Unterschieden zwischen diesen Workflows und Anleitungen zum Auswählen des besten für Ihr Szenario finden Sie unter [Entity Framework Entwicklungs Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="230da-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="230da-118">Web Forms</span><span class="sxs-lookup"><span data-stu-id="230da-118">Web Forms</span></span>
> 
> <span data-ttu-id="230da-119">Wie die Reihe "Getting Started" verwendet diese tutorialreihe das ASP.net-Web Forms Modell und geht davon aus, dass Sie mit der Verwendung von ASP.net Web Forms in Visual Studio vertraut sind.</span><span class="sxs-lookup"><span data-stu-id="230da-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="230da-120">Wenn Sie dies nicht tun, finden Sie weitere Informationen unter [Getting Started with ASP.NET 4,5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="230da-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="230da-121">Wenn Sie lieber mit dem ASP.NET MVC-Framework arbeiten möchten, finden Sie weitere Informationen unter [Getting Started with the Entity Framework Using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="230da-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="230da-122">Software Versionen</span><span class="sxs-lookup"><span data-stu-id="230da-122">Software versions</span></span>
> 
> | <span data-ttu-id="230da-123">**Im Tutorial**</span><span class="sxs-lookup"><span data-stu-id="230da-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="230da-124">**Funktioniert auch mit**</span><span class="sxs-lookup"><span data-stu-id="230da-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="230da-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="230da-125">Windows 7</span></span> | <span data-ttu-id="230da-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="230da-126">Windows 8</span></span> |
> | <span data-ttu-id="230da-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="230da-127">Visual Studio 2010</span></span> | <span data-ttu-id="230da-128">Visual Studio 2010 Express für Web.</span><span class="sxs-lookup"><span data-stu-id="230da-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="230da-129">Das Tutorial wurde nicht mit neueren Versionen von Visual Studio getestet.</span><span class="sxs-lookup"><span data-stu-id="230da-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="230da-130">Es gibt viele Unterschiede bei der Menü Auswahl, Dialogfeldern und Vorlagen.</span><span class="sxs-lookup"><span data-stu-id="230da-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="230da-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="230da-131">.NET 4</span></span> | <span data-ttu-id="230da-132">.NET 4,5 ist abwärts kompatibel mit .NET 4, aber das Tutorial wurde nicht mit .NET 4,5 getestet.</span><span class="sxs-lookup"><span data-stu-id="230da-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="230da-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="230da-133">Entity Framework 4</span></span> | <span data-ttu-id="230da-134">Das Tutorial wurde nicht mit neueren Versionen von Entity Framework getestet.</span><span class="sxs-lookup"><span data-stu-id="230da-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="230da-135">Ab Entity Framework 5 verwendet EF standardmäßig den `DbContext API`, der mit EF 4,1 eingeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="230da-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="230da-136">Das EntityDataSource-Steuerelement wurde entwickelt, um die `ObjectContext`-API zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="230da-137">Informationen zur Verwendung des EntityDataSource-Steuer Elements mit der `DbContext`-API finden Sie in [diesem Blogbeitrag](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="230da-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="230da-138">Fragen</span><span class="sxs-lookup"><span data-stu-id="230da-138">Questions</span></span>
> 
> <span data-ttu-id="230da-139">Wenn Sie Fragen haben, die nicht direkt mit dem Tutorial zusammenhängen, können Sie Sie im Forum [ASP.NET Entity Framework](https://forums.asp.net/1227.aspx), im [Forum zu Entity Framework und LINQ to Entities](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/)oder in [StackOverflow.com](http://stackoverflow.com/)veröffentlichen.</span><span class="sxs-lookup"><span data-stu-id="230da-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="230da-140">Mit dem `EntityDataSource`-Steuerelement können Sie eine Anwendung sehr schnell erstellen, aber in der Regel müssen Sie eine beträchtliche Menge an Geschäftslogik und Datenzugriffs Logik auf Ihren *aspx* -Seiten aufbewahren.</span><span class="sxs-lookup"><span data-stu-id="230da-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="230da-141">Wenn Sie davon ausgehen, dass Ihre Anwendung komplexer wird und eine kontinuierliche Wartung erforderlich ist, können Sie mehr Entwicklungszeit in den Vordergrund investieren, um eine *n-* *schichtige oder geschichtete* Anwendungs Struktur zu erstellen, die besser verwaltierbar ist.</span><span class="sxs-lookup"><span data-stu-id="230da-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="230da-142">Zum Implementieren dieser Architektur trennen Sie die Darstellungs Schicht von der Geschäftslogik Schicht (Business Logic Layer, BLL) und der Datenzugriffs Schicht (Data Access Layer, DAL).</span><span class="sxs-lookup"><span data-stu-id="230da-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="230da-143">Eine Möglichkeit, diese Struktur zu implementieren, besteht darin, das `ObjectDataSource`-Steuerelement anstelle des `EntityDataSource` Steuer Elements zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="230da-144">Wenn Sie das `ObjectDataSource`-Steuerelement verwenden, implementieren Sie Ihren eigenen Datenzugriffs Code und rufen ihn dann in *aspx* -Seiten mithilfe eines Steuer Elements auf, das viele der gleichen Funktionen wie andere Datenquellen-Steuerelemente aufweist.</span><span class="sxs-lookup"><span data-stu-id="230da-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="230da-145">Auf diese Weise können Sie die Vorteile eines n-Tier-Ansatzes mit den Vorteilen der Verwendung eines Web Forms-Steuer Elements für den Datenzugriff kombinieren.</span><span class="sxs-lookup"><span data-stu-id="230da-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="230da-146">Das `ObjectDataSource` Steuerelement bietet Ihnen auch mehr Flexibilität auf andere Weise.</span><span class="sxs-lookup"><span data-stu-id="230da-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="230da-147">Da Sie Ihren eigenen Datenzugriffs Code schreiben, ist es einfacher, einen bestimmten Entitätstyp zu lesen, einzufügen, zu aktualisieren oder zu löschen. dabei handelt es sich um die Aufgaben, die das `EntityDataSource` Steuerelement ausführen soll.</span><span class="sxs-lookup"><span data-stu-id="230da-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="230da-148">Sie können z. b. die Protokollierung jedes Mal ausführen, wenn eine Entität aktualisiert wird. Sie können Daten immer dann archivieren, wenn eine Entität gelöscht wird, oder die zugehörigen Daten beim Einfügen einer Zeile mit einem Fremdschlüssel Wert automatisch überprüfen und aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="230da-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="230da-149">Geschäftslogik-und Repository-Klassen</span><span class="sxs-lookup"><span data-stu-id="230da-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="230da-150">Ein `ObjectDataSource` Steuerelement funktioniert, indem eine von Ihnen erstellte Klasse aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="230da-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="230da-151">Die-Klasse enthält Methoden, mit denen Daten abgerufen und aktualisiert werden, und die Namen dieser Methoden werden dem `ObjectDataSource`-Steuerelement im Markup bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="230da-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="230da-152">Während der Rendering-oder Postback Verarbeitung ruft der `ObjectDataSource` die von Ihnen angegebenen Methoden auf.</span><span class="sxs-lookup"><span data-stu-id="230da-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="230da-153">Neben grundlegenden CRUD-Vorgängen muss die Klasse, die Sie für die Verwendung mit dem `ObjectDataSource`-Steuerelement erstellen, möglicherweise Geschäftslogik ausführen, wenn die `ObjectDataSource` Daten liest oder aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="230da-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="230da-154">Wenn Sie z. b. eine Abteilung aktualisieren, müssen Sie möglicherweise überprüfen, ob keine anderen Abteilungen denselben Administrator haben, da eine Person nicht als Administrator für mehr als eine Abteilung angemeldet sein darf.</span><span class="sxs-lookup"><span data-stu-id="230da-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="230da-155">In einigen `ObjectDataSource` Dokumentation, wie z. [b. der ObjectDataSource-Klasse](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), ruft das-Steuerelement eine-Klasse auf, die als *Geschäftsobjekt* bezeichnet wird, das sowohl Geschäftslogik-als auch Datenzugriffs Logik umfasst.</span><span class="sxs-lookup"><span data-stu-id="230da-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="230da-156">In diesem Tutorial erstellen Sie separate Klassen für die Geschäftslogik und die Datenzugriffs Logik.</span><span class="sxs-lookup"><span data-stu-id="230da-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="230da-157">Die Klasse, die Datenzugriffs Logik kapselt, wird als *Repository*bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="230da-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="230da-158">Die Geschäftslogik Klasse umfasst sowohl Geschäftslogik Methoden als auch Datenzugriffs Methoden, aber die Datenzugriffs Methoden aufrufen das Repository, um Datenzugriffs Aufgaben auszuführen.</span><span class="sxs-lookup"><span data-stu-id="230da-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="230da-159">Außerdem erstellen Sie eine Abstraktions Ebene zwischen Ihrer BLL-und Dal-Komponente, die automatisierte Unittests der BLL ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="230da-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="230da-160">Diese Abstraktions Ebene wird implementiert, indem eine Schnittstelle erstellt und die-Schnittstelle verwendet wird, wenn Sie das Repository in der Geschäftslogik Klasse instanziieren.</span><span class="sxs-lookup"><span data-stu-id="230da-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="230da-161">Dies ermöglicht es Ihnen, die Geschäftslogik Klasse mit einem Verweis auf jedes Objekt bereitzustellen, das die Repository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="230da-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="230da-162">Für den normalen Betrieb geben Sie ein Repository-Objekt an, das mit dem Entity Framework funktioniert.</span><span class="sxs-lookup"><span data-stu-id="230da-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="230da-163">Zum Testen stellen Sie ein Repository-Objekt bereit, das mit gespeicherten Daten auf eine Weise funktioniert, die Sie leicht bearbeiten können, z. b. als Auflistungen definierte Klassen Variablen.</span><span class="sxs-lookup"><span data-stu-id="230da-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="230da-164">Die folgende Abbildung zeigt den Unterschied zwischen einer Geschäftslogik Klasse, die Datenzugriffs Logik ohne ein Repository und eine, die ein Repository verwendet, enthält.</span><span class="sxs-lookup"><span data-stu-id="230da-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="230da-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="230da-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="230da-166">Zunächst erstellen Sie Webseiten, in denen das `ObjectDataSource`-Steuerelement direkt an ein Repository gebunden ist, da nur grundlegende Datenzugriffs Aufgaben ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="230da-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="230da-167">Im nächsten Tutorial erstellen Sie eine Geschäftslogik Klasse mit Validierungs Logik und binden das `ObjectDataSource`-Steuerelement an diese Klasse anstelle an die Repository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="230da-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="230da-168">Außerdem erstellen Sie Komponententests für die Validierungs Logik.</span><span class="sxs-lookup"><span data-stu-id="230da-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="230da-169">Im dritten Tutorial dieser Reihe fügen Sie der Anwendung Sortier-und Filterfunktionen hinzu.</span><span class="sxs-lookup"><span data-stu-id="230da-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="230da-170">Die Seiten, die Sie in diesem Tutorial erstellen, funktionieren mit dem `Departments` Entitätenmenge des Datenmodells, das Sie in der [Reihe "Getting Started Tutorial](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)" erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="230da-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="230da-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="230da-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="230da-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="230da-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="230da-173">Aktualisieren der Datenbank und des Datenmodells</span><span class="sxs-lookup"><span data-stu-id="230da-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="230da-174">Sie beginnen mit diesem Tutorial, indem Sie zwei Änderungen an der Datenbank vornehmen. beide erfordern entsprechende Änderungen am Datenmodell, das Sie in den Tutorials erste Schritte [mit den Entity Framework und Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="230da-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="230da-175">In einem dieser Tutorials haben Sie Änderungen im Designer manuell vorgenommen, um das Datenmodell nach einer Daten Bank Änderung mit der Datenbank zu synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="230da-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="230da-176">In diesem Tutorial verwenden Sie das Tool **Update Model von Database** des Designers, um das Datenmodell automatisch zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="230da-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="230da-177">Hinzufügen einer Beziehung zur Datenbank</span><span class="sxs-lookup"><span data-stu-id="230da-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="230da-178">Öffnen Sie in Visual Studio die Webanwendung der Website "Web", die Sie in der Reihe " [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) Tutorial" erstellt haben, und öffnen Sie dann das `SchoolDiagram` Daten Bank Diagramm.</span><span class="sxs-lookup"><span data-stu-id="230da-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="230da-179">Wenn Sie die `Department` Tabelle im Daten Bank Diagramm betrachten, sehen Sie, dass Sie über eine `Administrator` Spalte verfügt.</span><span class="sxs-lookup"><span data-stu-id="230da-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="230da-180">Diese Spalte ist ein Fremdschlüssel für die `Person` Tabelle, aber in der Datenbank ist keine Fremdschlüssel Beziehung definiert.</span><span class="sxs-lookup"><span data-stu-id="230da-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="230da-181">Sie müssen die Beziehung erstellen und das Datenmodell aktualisieren, damit das Entity Framework diese Beziehung automatisch verarbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="230da-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="230da-182">Klicken Sie im Daten Bank Diagramm mit der rechten Maustaste auf die `Department` Tabelle, und wählen Sie **Beziehungen**aus.</span><span class="sxs-lookup"><span data-stu-id="230da-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="230da-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="230da-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="230da-184">Klicken Sie im Feld **Fremdschlüssel Beziehungen** auf **Hinzufügen**, und klicken Sie dann auf die Auslassungs Punkte für **Tabellen-und Spaltenspezifikation**.</span><span class="sxs-lookup"><span data-stu-id="230da-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="230da-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="230da-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="230da-186">Legen Sie im Dialogfeld **Tabellen und Spalten** die Tabelle und das Feld Primärschlüssel auf `Person` und `PersonID`fest, und legen Sie die Fremdschlüssel Tabelle und das Feld auf `Department` und `Administrator`fest.</span><span class="sxs-lookup"><span data-stu-id="230da-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="230da-187">(Wenn Sie dies tun, ändert sich der Beziehungs Name von `FK_Department_Department` in `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="230da-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="230da-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="230da-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="230da-189">Klicken Sie im Feld **Tabellen und Spalten** auf **OK** , klicken Sie im Feld **Fremdschlüssel Beziehungen** auf **Schließen** , und speichern Sie die Änderungen.</span><span class="sxs-lookup"><span data-stu-id="230da-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="230da-190">Wenn Sie gefragt werden, ob Sie die `Person`-und `Department` Tabellen speichern möchten, klicken Sie auf **Ja**.</span><span class="sxs-lookup"><span data-stu-id="230da-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="230da-191">Wenn Sie `Person` Zeilen gelöscht haben, die den Daten entsprechen, die bereits in der Spalte `Administrator` vorhanden sind, können Sie diese Änderung nicht speichern.</span><span class="sxs-lookup"><span data-stu-id="230da-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="230da-192">Verwenden Sie in diesem Fall den Tabellen-Editor in **Server-Explorer** , um sicherzustellen, dass der `Administrator` Wert in jeder `Department` Zeile die ID eines Datensatzes enthält, der in der `Person` Tabelle tatsächlich vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="230da-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="230da-193">Nachdem Sie die Änderung gespeichert haben, können Sie keine Zeile aus der `Person` Tabelle löschen, wenn diese Person ein Abteilungs Administrator ist.</span><span class="sxs-lookup"><span data-stu-id="230da-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="230da-194">In einer Produktionsanwendung würden Sie eine bestimmte Fehlermeldung angeben, wenn eine Daten Bank Einschränkung einen Löschvorgang verhindert, oder Sie geben ein kaskadierliches löschen an.</span><span class="sxs-lookup"><span data-stu-id="230da-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="230da-195">Ein Beispiel für die Angabe eines kaskadierenden Löschvorgang finden Sie unter den ersten Schritten für [Entity Framework und ASP.net –, Teil 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="230da-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="230da-196">Hinzufügen einer Ansicht zur Datenbank</span><span class="sxs-lookup"><span data-stu-id="230da-196">Adding a View to the Database</span></span>

<span data-ttu-id="230da-197">Auf der Seite "neue *Abteilungen. aspx* ", die Sie erstellen möchten, können Sie eine Dropdown Liste mit Dozenten mit Namen im Format "Letztes, erstes" bereitstellen, sodass Benutzer Abteilungs Administratoren auswählen können.</span><span class="sxs-lookup"><span data-stu-id="230da-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="230da-198">Um dies zu vereinfachen, erstellen Sie eine Sicht in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="230da-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="230da-199">Die Ansicht besteht lediglich aus den Daten, die in der Dropdown Liste benötigt werden: der vollständige Name (ordnungsgemäß formatiert) und der Daten Satz Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="230da-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="230da-200">Erweitern Sie in **Server-Explorer**den Eintrag *School. mdf*, klicken Sie mit der rechten Maustaste auf den Ordner **views** , und wählen Sie **neue Ansicht hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="230da-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="230da-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="230da-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="230da-202">Klicken Sie im angezeigten Dialogfeld **Tabelle hinzufügen** auf **Schließen** , und fügen Sie die folgende SQL-Anweisung in den SQL-Bereich ein:</span><span class="sxs-lookup"><span data-stu-id="230da-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="230da-203">Speichern Sie die Ansicht als `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="230da-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="230da-204">Aktualisieren des Datenmodells</span><span class="sxs-lookup"><span data-stu-id="230da-204">Updating the Data Model</span></span>

<span data-ttu-id="230da-205">Öffnen Sie im Ordner *dal* die Datei *School Model. edmx* , klicken Sie mit der rechten Maustaste auf die Entwurfs Oberfläche, und wählen Sie **Modell aus Datenbank aktualisieren aus**.</span><span class="sxs-lookup"><span data-stu-id="230da-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="230da-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="230da-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="230da-207">Wählen Sie im Dialogfeld **Wählen Sie Ihre Datenbankobjekte** aus die Registerkarte **Hinzufügen** aus, und wählen Sie die soeben erstellte Ansicht aus.</span><span class="sxs-lookup"><span data-stu-id="230da-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="230da-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="230da-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="230da-209">Klicken Sie auf **Fertig stellen**.</span><span class="sxs-lookup"><span data-stu-id="230da-209">Click **Finish**.</span></span>

<span data-ttu-id="230da-210">Im Designer sehen Sie, dass das Tool eine `vInstructorName` Entität und eine neue Zuordnung zwischen den Entitäten `Department` und `Person` erstellt hat.</span><span class="sxs-lookup"><span data-stu-id="230da-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="230da-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="230da-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="230da-212">Im Fenster **Ausgabe** und **Fehlerliste** wird möglicherweise eine Warnmeldung angezeigt, in der Sie darüber informiert werden, dass das Tool automatisch einen Primärschlüssel für die neue `vInstructorName` Ansicht erstellt hat.</span><span class="sxs-lookup"><span data-stu-id="230da-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="230da-213">Dieses Verhalten wird erwartet.</span><span class="sxs-lookup"><span data-stu-id="230da-213">This is expected behavior.</span></span>

<span data-ttu-id="230da-214">Wenn Sie im Code auf die neue `vInstructorName` Entität verweisen, sollten Sie die Daten Bank Konvention "v" nicht als präfixvorgang verwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="230da-215">Daher benennen Sie die Entität und Entitätenmenge im Modell um.</span><span class="sxs-lookup"><span data-stu-id="230da-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="230da-216">Öffnen Sie den **Modell Browser**.</span><span class="sxs-lookup"><span data-stu-id="230da-216">Open the **Model Browser**.</span></span> <span data-ttu-id="230da-217">`vInstructorName` als Entitätstyp und Ansicht aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="230da-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="230da-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="230da-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="230da-219">Klicken Sie unter **SchoolModel** (nicht **SchoolModel. Store**) mit der rechten Maustaste auf **vinstructor Name** , und wählen Sie **Eigenschaften**aus.</span><span class="sxs-lookup"><span data-stu-id="230da-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="230da-220">Ändern Sie im Eigenschaften Fenster die **Name** -Eigenschaft in "Instructor Name", und ändern Sie die Eigenschaft " **entitätenmengenname** " in "Instructor Names".</span><span class="sxs-lookup"><span data-stu-id="230da-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="230da-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="230da-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="230da-222">Speichern und schließen Sie das Datenmodell, und erstellen Sie dann das Projekt neu.</span><span class="sxs-lookup"><span data-stu-id="230da-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="230da-223">Verwenden einer Repository-Klasse und eines ObjectDataSource-Steuer Elements</span><span class="sxs-lookup"><span data-stu-id="230da-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="230da-224">Erstellen Sie eine neue Klassendatei im Ordner *dal* , benennen Sie Sie *SchoolRepository.cs*, und ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="230da-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="230da-225">Dieser Code stellt eine einzelne `GetDepartments`-Methode bereit, die alle Entitäten in der `Departments` Entitätenmenge zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="230da-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="230da-226">Da Sie wissen, dass Sie für jede zurückgegebene Zeile auf die `Person` Navigations Eigenschaft zugreifen werden, geben Sie Eager Loading für diese Eigenschaft an, indem Sie die `Include`-Methode verwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="230da-227">Die Klasse implementiert auch die `IDisposable`-Schnittstelle, um sicherzustellen, dass die Datenbankverbindung freigegeben wird, wenn das Objekt verworfen wird.</span><span class="sxs-lookup"><span data-stu-id="230da-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="230da-228">Eine gängige Vorgehensweise besteht darin, eine Repository-Klasse für jeden Entitätstyp zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="230da-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="230da-229">In diesem Tutorial wird eine Repository-Klasse für mehrere Entitäts Typen verwendet.</span><span class="sxs-lookup"><span data-stu-id="230da-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="230da-230">Weitere Informationen zum Repository-Muster finden Sie in den Beiträgen im [Blog des Entity Framework Teams](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) und im [Blog von Julie Lerman](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="230da-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="230da-231">Die `GetDepartments`-Methode gibt ein `IEnumerable` Objekt anstelle eines `IQueryable`-Objekts zurück, um sicherzustellen, dass die zurückgegebene Auflistung auch dann verwendbar ist, nachdem das Repository-Objekt selbst verworfen wurde.</span><span class="sxs-lookup"><span data-stu-id="230da-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="230da-232">Ein `IQueryable`-Objekt kann Datenbankzugriffe auslösen, wenn darauf zugegriffen wird. das Repository-Objekt kann jedoch von dem Zeitpunkt verworfen werden, an dem ein Daten gebundene-Steuerelement versucht, die Daten zu erzeugen.</span><span class="sxs-lookup"><span data-stu-id="230da-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="230da-233">Sie können einen anderen Sammlungstyp, z. b. ein `IList` Objekt, anstelle eines `IEnumerable`-Objekts zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="230da-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="230da-234">Wenn Sie jedoch ein `IEnumerable` Objekt zurückgeben, stellen Sie sicher, dass Sie typische Aufgaben für die schreibgeschützte Listen Verarbeitung ausführen können, wie z. b. `foreach` Schleifen und LINQ-Abfragen, aber Sie können keine Elemente in der Auflistung hinzufügen oder entfernen, was darauf hindeuten könnte, dass solche Änderungen in der Datenbank persistent gespeichert werden</span><span class="sxs-lookup"><span data-stu-id="230da-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="230da-235">Erstellen Sie eine Seite " *Departments. aspx* ", die die Master Seite " *Site. Master* " verwendet, und fügen Sie das folgende Markup im `Content` Steuerelement mit dem Namen `Content2`hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="230da-236">Dieses Markup erstellt ein `ObjectDataSource` Steuerelement, das die soeben erstellte Repository-Klasse verwendet, sowie ein `GridView` Steuerelement zum Anzeigen der Daten.</span><span class="sxs-lookup"><span data-stu-id="230da-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="230da-237">Das `GridView`-Steuerelement gibt Befehle zum **Bearbeiten** und **Löschen** an, aber Sie haben noch keinen Code zur Unterstützung hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="230da-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="230da-238">Mehrere Spalten verwenden `DynamicField` Steuerelemente, damit Sie die automatische Datenformatierung und Validierungs Funktionalität nutzen können.</span><span class="sxs-lookup"><span data-stu-id="230da-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="230da-239">Damit diese funktionieren, müssen Sie die `EnableDynamicData`-Methode im `Page_Init`-Ereignishandler aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="230da-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="230da-240">(`DynamicControl` Steuerelemente werden nicht im Feld `Administrator` verwendet, da Sie nicht mit Navigations Eigenschaften funktionieren.)</span><span class="sxs-lookup"><span data-stu-id="230da-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="230da-241">Die `Vertical-Align="Top"` Attribute werden später wichtig, wenn Sie dem Raster eine Spalte hinzufügen, die über ein `GridView`-Steuerelement verfügt.</span><span class="sxs-lookup"><span data-stu-id="230da-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="230da-242">Öffnen Sie die Datei *Departments.aspx.cs* , und fügen Sie die folgende `using`-Anweisung hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="230da-243">Fügen Sie dann den folgenden Handler für das `Init`-Ereignis der Seite hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="230da-244">Erstellen Sie im Ordner *dal* eine neue Klassendatei mit dem Namen *Department.cs* , und ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="230da-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="230da-245">Mit diesem Code werden dem Datenmodell Metadaten hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="230da-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="230da-246">Er gibt an, dass die `Budget`-Eigenschaft der `Department` Entität tatsächlich Currency darstellt, obwohl der Datentyp `Decimal`ist, und gibt an, dass der Wert zwischen 0 und $1.000.000,00 liegen muss.</span><span class="sxs-lookup"><span data-stu-id="230da-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="230da-247">Außerdem wird angegeben, dass die `StartDate`-Eigenschaft als Datum im Format mm/dd/yyyy formatiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="230da-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="230da-248">Führen Sie die Seite " *Departments. aspx* " aus.</span><span class="sxs-lookup"><span data-stu-id="230da-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="230da-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="230da-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="230da-250">Obwohl Sie keine Format Zeichenfolge im Seiten Markup " *Departments. aspx* " für die **Budget** -oder **Start Datums** Spalten angegeben haben, wurden die standardmäßigen Währungs-und Datums Formatierung durch die `DynamicField`-Steuerelemente mithilfe der Metadaten, die Sie in der *Department.cs* -Datei angegeben haben, auf diese angewendet.</span><span class="sxs-lookup"><span data-stu-id="230da-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="230da-251">Hinzufügen und Löschen von Funktionen</span><span class="sxs-lookup"><span data-stu-id="230da-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="230da-252">Öffnen Sie *SchoolRepository.cs*, und fügen Sie den folgenden Code hinzu, um eine `Insert`-Methode und eine `Delete`-Methode zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="230da-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="230da-253">Der Code enthält außerdem eine Methode mit dem Namen `GenerateDepartmentID`, die den nächsten verfügbaren Daten Satz Schlüsselwert zur Verwendung durch die `Insert`-Methode berechnet.</span><span class="sxs-lookup"><span data-stu-id="230da-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="230da-254">Dies ist erforderlich, da die Datenbank nicht so konfiguriert ist, dass Sie automatisch für die `Department` Tabelle berechnet wird.</span><span class="sxs-lookup"><span data-stu-id="230da-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="230da-255">Die Attach-Methode</span><span class="sxs-lookup"><span data-stu-id="230da-255">The Attach Method</span></span>

<span data-ttu-id="230da-256">Die `DeleteDepartment`-Methode ruft die `Attach`-Methode auf, um den Link, der im Objektstatus-Manager des Objekt Kontexts verwaltet wird, zwischen der Entität im Arbeitsspeicher und der Datenbankzeile, die Sie darstellt, wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="230da-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="230da-257">Dies muss eintreten, bevor die-Methode die `SaveChanges`-Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="230da-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="230da-258">Der Begriff *Objekt Kontext* verweist auf die Entity Framework Klasse, die von der `ObjectContext`-Klasse abgeleitet wird, die Sie für den Zugriff auf die Entitätenmengen und Entitäten verwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="230da-259">Im Code für dieses Projekt heißt die Klasse `SchoolEntities`, und eine Instanz davon wird immer `context`benannt.</span><span class="sxs-lookup"><span data-stu-id="230da-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="230da-260">Der *Objekt Zustands-Manager* des Objekt Kontexts ist eine Klasse, die von der `ObjectStateManager`-Klasse abgeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="230da-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="230da-261">Die Objekt Verbindung verwendet den Objekt Zustands-Manager, um Entitäts Objekte zu speichern, und um nachzuverfolgen, ob beide mit der entsprechenden Tabellenzeile oder den Zeilen in der Datenbank synchronisiert sind.</span><span class="sxs-lookup"><span data-stu-id="230da-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="230da-262">Wenn Sie eine Entität lesen, speichert der Objekt Kontext Sie im Objekt Zustands-Manager und verfolgt, ob die Darstellung des Objekts mit der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="230da-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="230da-263">Wenn Sie z. b. einen Eigenschafts Wert ändern, wird ein Flag festgelegt, um anzugeben, dass die geänderte Eigenschaft nicht mehr mit der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="230da-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="230da-264">Wenn Sie dann die `SaveChanges`-Methode aufzurufen, weiß der Objekt Kontext, was in der Datenbank zu tun ist, da der Objekt Zustands-Manager genau weiß, was sich zwischen dem aktuellen Zustand der Entität und dem Status der Datenbank unterscheidet.</span><span class="sxs-lookup"><span data-stu-id="230da-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="230da-265">Allerdings funktioniert dieser Prozess in der Regel nicht in einer Webanwendung, da die Objekt Kontext Instanz, die eine Entität liest, zusammen mit allen Elementen im Objekt Zustands-Manager verworfen wird, nachdem eine Seite gerendert wurde.</span><span class="sxs-lookup"><span data-stu-id="230da-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="230da-266">Die Objekt Kontext Instanz, die Änderungen anwenden muss, ist eine neue, die für die Post Back Verarbeitung instanziiert wird.</span><span class="sxs-lookup"><span data-stu-id="230da-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="230da-267">Im Fall der `DeleteDepartment`-Methode erstellt das `ObjectDataSource`-Steuerelement die ursprüngliche Version der Entität von Werten im Ansichts Zustand neu, aber diese neu `Department` erstellte Entität ist im Objekt Zustands-Manager nicht vorhanden.</span><span class="sxs-lookup"><span data-stu-id="230da-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="230da-268">Wenn Sie die `DeleteObject`-Methode für diese neu erstellte Entität aufgerufen haben, schlägt der Aufruf fehl, da der Objekt Kontext nicht weiß, ob die Entität mit der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="230da-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="230da-269">Wenn Sie jedoch die `Attach`-Methode aufrufen, wird die gleiche Überwachung zwischen der neu erstellten Entität und den Werten in der Datenbank wieder hergestellt, die ursprünglich automatisch erfolgt sind, als die Entität in einer früheren Instanz des Objekt Kontexts gelesen wurde.</span><span class="sxs-lookup"><span data-stu-id="230da-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="230da-270">Es gibt Zeiten, in denen Sie nicht möchten, dass der Objekt Kontext Entitäten im Objekt Zustands-Manager nachverfolgt, und Sie können Flags festlegen, um dies zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="230da-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="230da-271">Beispiele hierfür finden Sie in späteren Tutorials in dieser Reihe.</span><span class="sxs-lookup"><span data-stu-id="230da-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="230da-272">Die SaveChanges-Methode</span><span class="sxs-lookup"><span data-stu-id="230da-272">The SaveChanges Method</span></span>

<span data-ttu-id="230da-273">Diese einfache Repository-Klasse veranschaulicht grundlegende Prinzipien der Durchführung von CRUD-Vorgängen.</span><span class="sxs-lookup"><span data-stu-id="230da-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="230da-274">In diesem Beispiel wird die `SaveChanges`-Methode unmittelbar nach jedem Update aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="230da-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="230da-275">In einer Produktionsanwendung empfiehlt es sich, die `SaveChanges`-Methode aus einer separaten Methode aufzurufen, um Ihnen mehr Kontrolle darüber zu verschaffen, wann die Datenbank aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="230da-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="230da-276">(Am Ende des nächsten Tutorials finden Sie einen Link zu einem Whitepaper, in dem das Arbeitseinheits Muster erläutert wird, das ein Ansatz zum koordinieren verwandter Updates ist.) Beachten Sie auch, dass die `DeleteDepartment`-Methode im Beispiel keinen Code zum Behandeln von Parallelitäts Konflikten enthält. zu verwendende Code wird in einem späteren Tutorial dieser Reihe hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="230da-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="230da-277">Abrufen von beim Einfügen zu ausgewäfnenden Dozenten Namen</span><span class="sxs-lookup"><span data-stu-id="230da-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="230da-278">Benutzer müssen in der Lage sein, in einer Dropdown Liste einen Administrator aus einer Liste von Dozenten auszuwählen, wenn Sie neue Abteilungen erstellen.</span><span class="sxs-lookup"><span data-stu-id="230da-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="230da-279">Fügen Sie daher *SchoolRepository.cs* den folgenden Code hinzu, um eine Methode zum Abrufen der Liste der Dozenten mithilfe der Ansicht zu erstellen, die Sie zuvor erstellt haben:</span><span class="sxs-lookup"><span data-stu-id="230da-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="230da-280">Erstellen einer Seite zum Einfügen von Abteilungen</span><span class="sxs-lookup"><span data-stu-id="230da-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="230da-281">Erstellen Sie eine Seite " *departmentsadd. aspx* ", die die *Site. Master* -Seite verwendet, und fügen Sie das folgende Markup im `Content`-Steuerelement mit dem Namen `Content2`hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="230da-282">Dieses Markup erstellt zwei `ObjectDataSource` Steuerelemente, eine zum Einfügen neuer `Department` Entitäten und eine zum Abrufen von Dozenten Namen für das `DropDownList`-Steuerelement, das zum Auswählen von Abteilungs Administratoren verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="230da-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="230da-283">Das Markup erstellt ein `DetailsView` Steuerelement für die Eingabe neuer Abteilungen und gibt einen Handler für das `ItemInserting` Ereignis des Steuer Elements an, sodass Sie den `Administrator` Fremdschlüssel Wert festlegen können.</span><span class="sxs-lookup"><span data-stu-id="230da-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="230da-284">Am Ende befindet sich ein `ValidationSummary`-Steuerelement zum Anzeigen von Fehlermeldungen.</span><span class="sxs-lookup"><span data-stu-id="230da-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="230da-285">Öffnen Sie *DepartmentsAdd.aspx.cs* , und fügen Sie die folgende `using`-Anweisung hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="230da-286">Fügen Sie die folgende Klassen Variable und die folgenden Methoden hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="230da-287">Die `Page_Init`-Methode ermöglicht dynamische Daten Funktionalität.</span><span class="sxs-lookup"><span data-stu-id="230da-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="230da-288">Der-Handler für das `Init` Ereignis des `DropDownList`-Steuer Elements speichert einen Verweis auf das-Steuerelement, und der-Handler für das `Inserting` Ereignis des `DetailsView`-Steuer Elements verwendet diesen Verweis, um den `PersonID` Wert des ausgewählten Dozenten zu erhalten und die `Administrator` Fremdschlüssel Eigenschaft der `Department` Entität zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="230da-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="230da-289">Führen Sie die Seite aus, fügen Sie Informationen für eine neue Abteilung hinzu, und klicken Sie dann auf den Link **Einfügen** .</span><span class="sxs-lookup"><span data-stu-id="230da-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="230da-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="230da-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="230da-291">Geben Sie Werte für eine andere neue Abteilung ein.</span><span class="sxs-lookup"><span data-stu-id="230da-291">Enter values for another new department.</span></span> <span data-ttu-id="230da-292">Geben Sie im Feld **Budget** eine Zahl größer als 1.000.000,00 ein, und wechseln Sie zum nächsten Feld.</span><span class="sxs-lookup"><span data-stu-id="230da-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="230da-293">Im Feld wird ein Sternchen angezeigt, und wenn Sie den Mauszeiger darüber halten, wird die Fehlermeldung angezeigt, die Sie in den Metadaten für dieses Feld eingegeben haben.</span><span class="sxs-lookup"><span data-stu-id="230da-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="230da-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="230da-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="230da-295">Klicken Sie auf **Einfügen**, um die Fehlermeldung anzuzeigen, die vom `ValidationSummary`-Steuerelement am unteren Rand der Seite angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="230da-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="230da-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="230da-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="230da-297">Schließen Sie dann den Browser, und öffnen Sie die Seite " *Departments. aspx* ".</span><span class="sxs-lookup"><span data-stu-id="230da-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="230da-298">Fügen Sie der Seite " *Departments. aspx* " die Löschfunktion hinzu, indem Sie ein `DeleteMethod` Attribut zum `ObjectDataSource`-Steuerelement und ein `DataKeyNames`-Attribut zum `GridView` Steuerelement hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="230da-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="230da-299">Die öffnenden Tags für diese Steuerelemente ähneln nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="230da-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="230da-300">Führen Sie die Seite aus.</span><span class="sxs-lookup"><span data-stu-id="230da-300">Run the page.</span></span>

<span data-ttu-id="230da-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="230da-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="230da-302">Löschen Sie die Abteilung, die Sie beim Durchlaufen der Seite *departmentsadd. aspx* hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="230da-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="230da-303">Hinzufügen von Update Funktionen</span><span class="sxs-lookup"><span data-stu-id="230da-303">Adding Update Functionality</span></span>

<span data-ttu-id="230da-304">Öffnen Sie *SchoolRepository.cs* , und fügen Sie die folgende `Update`-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="230da-305">Wenn Sie auf der Seite " *Departments. aspx* " auf **Aktualisieren** klicken, erstellt das `ObjectDataSource`-Steuerelement zwei `Department` Entitäten, die an die `UpdateDepartment`-Methode übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="230da-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="230da-306">Eine enthält die ursprünglichen Werte, die im Ansichts Zustand gespeichert wurden, und die andere enthält die neuen Werte, die im `GridView` Steuerelement eingegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="230da-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="230da-307">Der Code in der `UpdateDepartment`-Methode übergibt die `Department` Entität mit den ursprünglichen Werten an die `Attach`-Methode, um die Überwachung zwischen der Entität und den Daten in der Datenbank herzustellen.</span><span class="sxs-lookup"><span data-stu-id="230da-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="230da-308">Anschließend übergibt der Code die `Department` Entität mit den neuen Werten an die `ApplyCurrentValues`-Methode.</span><span class="sxs-lookup"><span data-stu-id="230da-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="230da-309">Der Objekt Kontext vergleicht die alten und neuen Werte.</span><span class="sxs-lookup"><span data-stu-id="230da-309">The object context compares the old and new values.</span></span> <span data-ttu-id="230da-310">Wenn ein neuer Wert von einem alten Wert abweicht, ändert der Objekt Kontext den Eigenschafts Wert.</span><span class="sxs-lookup"><span data-stu-id="230da-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="230da-311">Die `SaveChanges`-Methode aktualisiert dann nur die geänderten Spalten in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="230da-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="230da-312">(Wenn die Update-Funktion für diese Entität einer gespeicherten Prozedur zugeordnet wurde, würde jedoch unabhängig davon, welche Spalten geändert wurden, die gesamte Zeile aktualisiert.)</span><span class="sxs-lookup"><span data-stu-id="230da-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="230da-313">Öffnen Sie die Datei " *Departments. aspx* ", und fügen Sie dem `DepartmentsObjectDataSource`-Steuerelement die folgenden Attribute hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="230da-314">Dies bewirkt, dass alte Werte im Ansichts Zustand gespeichert werden, sodass Sie mit den neuen Werten in der `Update`-Methode verglichen werden können.</span><span class="sxs-lookup"><span data-stu-id="230da-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="230da-315">Dadurch wird dem Steuerelement mitgeteilt, dass der Name des ursprünglichen Values-Parameters `origDepartment` ist.</span><span class="sxs-lookup"><span data-stu-id="230da-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="230da-316">Das Markup für das öffnende Tag des `ObjectDataSource`-Steuer Elements ähnelt nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="230da-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="230da-317">Fügen Sie ein `OnRowUpdating="DepartmentsGridView_RowUpdating"`-Attribut zum `GridView`-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="230da-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="230da-318">Sie verwenden diese Eigenschaft, um den Wert der `Administrator`-Eigenschaft basierend auf der Zeile festzulegen, die der Benutzer in einer Dropdown Liste auswählt.</span><span class="sxs-lookup"><span data-stu-id="230da-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="230da-319">Das `GridView` öffnende Tag ähnelt nun dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="230da-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="230da-320">Fügen Sie dem `GridView`-Steuerelement unmittelbar nach dem `ItemTemplate` Steuerelement für diese Spalte ein `EditItemTemplate`-Steuerelement für die Spalte `Administrator` hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="230da-321">Dieses `EditItemTemplate` Steuerelement ähnelt dem `InsertItemTemplate`-Steuerelement auf der Seite *departmentsadd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="230da-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="230da-322">Der Unterschied besteht darin, dass der Anfangswert des-Steuer Elements mit dem `SelectedValue`-Attribut festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="230da-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="230da-323">Fügen Sie vor dem `GridView`-Steuerelement wie auf der Seite *departmentsadd. aspx* ein `ValidationSummary`-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="230da-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="230da-324">Öffnen Sie *Departments.aspx.cs* , und fügen Sie unmittelbar nach der Deklaration der partiellen Klasse den folgenden Code hinzu, um ein privates Feld zu erstellen, das auf das `DropDownList` Steuerelement verweist</span><span class="sxs-lookup"><span data-stu-id="230da-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="230da-325">Fügen Sie dann Handler für das `Init` Ereignis des `DropDownList`-Steuer Elements und das `RowUpdating` Ereignis des `GridView`-Steuer Elements hinzu:</span><span class="sxs-lookup"><span data-stu-id="230da-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="230da-326">Der-Handler für das `Init`-Ereignis speichert einen Verweis auf das `DropDownList`-Steuerelement im-Feld der Klasse.</span><span class="sxs-lookup"><span data-stu-id="230da-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="230da-327">Der-Handler für das `RowUpdating`-Ereignis verwendet den-Verweis, um den vom Benutzer eingegebenen Wert zu erhalten und ihn auf die `Administrator`-Eigenschaft der `Department`-Entität anzuwenden.</span><span class="sxs-lookup"><span data-stu-id="230da-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="230da-328">Verwenden Sie die Seite *departmentsadd. aspx* , um eine neue Abteilung hinzuzufügen, führen Sie dann die Seite *Departments. aspx* aus, und klicken Sie in der hinzugefügten Zeile auf **Bearbeiten** .</span><span class="sxs-lookup"><span data-stu-id="230da-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="230da-329">Aufgrund ungültiger Daten in der Datenbank können keine Zeilen bearbeitet werden, die Sie nicht hinzugefügt haben (d. h., Sie waren bereits in der Datenbank vorhanden). die Administratoren für die Zeilen, die mit der-Datenbank erstellt wurden, sind Schüler/Studenten.</span><span class="sxs-lookup"><span data-stu-id="230da-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="230da-330">Wenn Sie versuchen, eines dieser Elemente zu bearbeiten, wird eine Fehlerseite angezeigt, die einen Fehler meldet, wie `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="230da-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="230da-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="230da-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="230da-332">Wenn Sie einen ungültigen **Budget** Betrag eingeben und dann auf **Aktualisieren**klicken, sehen Sie das gleiche Sternchen und die Fehlermeldung, die Sie auf der Seite " *Departments. aspx* " gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="230da-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="230da-333">Ändern Sie einen Feldwert, oder wählen Sie einen anderen Administrator, und klicken Sie auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="230da-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="230da-334">Die Änderung wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="230da-334">The change is displayed.</span></span>

<span data-ttu-id="230da-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="230da-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="230da-336">Dadurch wird die Einführung in die Verwendung des `ObjectDataSource`-Steuer Elements für grundlegende CRUD-Vorgänge (erstellen, lesen, aktualisieren, löschen) mit dem Entity Framework abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="230da-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="230da-337">Sie haben eine einfache n-Tier-Anwendung erstellt, aber die Geschäftslogik Ebene ist weiterhin eng an die Datenzugriffs Ebene gekoppelt, die automatisierte Komponententests erschwert.</span><span class="sxs-lookup"><span data-stu-id="230da-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="230da-338">Im folgenden Tutorial erfahren Sie, wie Sie das Repository-Muster implementieren, um Unittests zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="230da-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="230da-339">Weiter</span><span class="sxs-lookup"><span data-stu-id="230da-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
