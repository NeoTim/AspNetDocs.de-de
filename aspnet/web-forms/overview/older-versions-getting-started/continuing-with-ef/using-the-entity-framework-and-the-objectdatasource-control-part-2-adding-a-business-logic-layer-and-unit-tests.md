---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
title: 'Verwenden von Entitätsframework 4.0 und das ObjectDataSource-Steuerelement, Teil 2: Hinzufügen einer Geschäftslogikebene und Komponententests | Microsoft-Dokumentation'
author: tdykstra
description: Dieser tutorialreihe erstellt in der Contoso University-Webanwendung, die von den ersten Schritten mit der Entity Framework 4.0-Tutorial-Reihe erstellt wird. ICH...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: efb0e677-10b8-48dc-93d3-9ba3902dd807
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
msc.type: authoredcontent
ms.openlocfilehash: 4d436b0e5d605027cfcf5243f615f9ac167c5888
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/17/2019
ms.locfileid: "59388048"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests"></a><span data-ttu-id="5d3ca-104">Verwenden von Entitätsframework 4.0 und das ObjectDataSource-Steuerelement, Teil 2: Hinzufügen einer Geschäftslogikschicht und von Komponententests</span><span class="sxs-lookup"><span data-stu-id="5d3ca-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 2: Adding a Business Logic Layer and Unit Tests</span></span>

<span data-ttu-id="5d3ca-105">durch [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="5d3ca-106">Dieser tutorialreihe erstellt, in der Contoso University-Webanwendung, die erstellt wird die [erste Schritte mit Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) Tutorial-Reihe.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="5d3ca-107">Wenn Sie den vorherigen Tutorials wurde nicht abgeschlossen haben, als Ausgangspunkt für dieses Tutorial können Sie [Laden Sie die Anwendung](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) , die Sie erstellt haben würden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="5d3ca-108">Sie können auch [Laden Sie die Anwendung](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , indem Sie die vollständige Reihe von Tutorials erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="5d3ca-109">Wenn Sie Fragen zu den Lernprogrammen haben, können Sie sie veröffentlichen das [ASP.NET Entity Framework-Forum](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="5d3ca-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="5d3ca-110">Im vorherigen Tutorial erstellt Sie eine n-Tier-Webanwendung mithilfe von Entity Framework und die `ObjectDataSource` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-110">In the previous tutorial you created an n-tier web application using the Entity Framework and the `ObjectDataSource` control.</span></span> <span data-ttu-id="5d3ca-111">In diesem Tutorial wird gezeigt, wie Geschäftslogik hinzufügen, während die Geschäftslogik-Ebene (BLL) und der Datenzugriffsebene (DAL) separaten beibehalten, und es wird gezeigt, wie die BLL automatisierte Komponententests zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-111">This tutorial shows how to add business logic while keeping the business-logic layer (BLL) and the data-access layer (DAL) separate, and it shows how to create automated unit tests for the BLL.</span></span>

<span data-ttu-id="5d3ca-112">In diesem Tutorial müssen Sie die folgenden Aufgaben ausführen:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-112">In this tutorial you'll complete the following tasks:</span></span>

- <span data-ttu-id="5d3ca-113">Erstellen Sie eine Repositoryschnittstelle, die die Datenzugriffs-Methoden deklariert, die Sie benötigen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-113">Create a repository interface that declares the data-access methods you need.</span></span>
- <span data-ttu-id="5d3ca-114">Implementieren Sie die Repositoryschnittstelle, in der repositoryklasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-114">Implement the repository interface in the repository class.</span></span>
- <span data-ttu-id="5d3ca-115">Erstellen Sie eine Geschäftslogik-Klasse, die "Repository"-Klasse zum Ausführen von Datenzugriffs-Funktionen aufruft.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-115">Create a business-logic class that calls the repository class to perform data-access functions.</span></span>
- <span data-ttu-id="5d3ca-116">Verbinden der `ObjectDataSource` Steuerelement auf die Geschäftslogik Klasse anstelle von "Repository"-Klasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-116">Connect the `ObjectDataSource` control to the business-logic class instead of to the repository class.</span></span>
- <span data-ttu-id="5d3ca-117">Erstellen Sie ein Komponententestprojekt und einer Repository-Klasse, die Auflistungen im Arbeitsspeicher für den Datenspeicher verwendet.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-117">Create a unit-test project and a repository class that uses in-memory collections for its data store.</span></span>
- <span data-ttu-id="5d3ca-118">Erstellen Sie einen Komponententest für Geschäftslogik, die Sie die Geschäftslogik-Klasse, und klicken Sie dann den Test ausführen, und finden Sie unter Fehler hinzufügen möchten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-118">Create a unit test for business logic that you want to add to the business-logic class, then run the test and see it fail.</span></span>
- <span data-ttu-id="5d3ca-119">Die Geschäftslogik in der Geschäftslogik-Klasse implementieren und führen Sie erneut die Einheit zu testen, und finden Sie unter er erfolgreich abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-119">Implement the business logic in the business-logic class, then re-run the unit test and see it pass.</span></span>

<span data-ttu-id="5d3ca-120">Arbeiten Sie mit der *Departments.aspx* und *DepartmentsAdd.aspx* Seiten, die Sie im vorherigen Tutorial erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-120">You'll work with the *Departments.aspx* and *DepartmentsAdd.aspx* pages that you created in the previous tutorial.</span></span>

## <a name="creating-a-repository-interface"></a><span data-ttu-id="5d3ca-121">Erstellen einer Repositoryschnittstelle</span><span class="sxs-lookup"><span data-stu-id="5d3ca-121">Creating a Repository Interface</span></span>

<span data-ttu-id="5d3ca-122">Sie erstellen Sie zunächst die Repositoryschnittstelle.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-122">You'll begin by creating the repository interface.</span></span>

<span data-ttu-id="5d3ca-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span></span>

<span data-ttu-id="5d3ca-124">In der *DAL* Ordner eine neue Klassendatei zu erstellen, nennen Sie es *ISchoolRepository.cs*, und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-124">In the *DAL* folder, create a new class file, name it *ISchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample1.cs)]

<span data-ttu-id="5d3ca-125">Die Schnittstelle definiert eine Methode für jede der die CRUD-Vorgänge (erstellen, lesen, aktualisieren und löschen) Methoden, die Sie in der "Repository"-Klasse erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-125">The interface defines one method for each of the CRUD (create, read, update, delete) methods that you created in the repository class.</span></span>

<span data-ttu-id="5d3ca-126">In der `SchoolRepository` -Klasse im *SchoolRepository.cs*, um anzugeben, dass diese Klasse implementiert die `ISchoolRepository` Schnittstelle:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-126">In the `SchoolRepository` class in *SchoolRepository.cs*, indicate that this class implements the `ISchoolRepository` interface:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample2.cs)]

## <a name="creating-a-business-logic-class"></a><span data-ttu-id="5d3ca-127">Erstellen einer Geschäftslogik-Klasse</span><span class="sxs-lookup"><span data-stu-id="5d3ca-127">Creating a Business-Logic Class</span></span>

<span data-ttu-id="5d3ca-128">Als Nächstes erstellen Sie die Geschäftslogik-Klasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-128">Next, you'll create the business-logic class.</span></span> <span data-ttu-id="5d3ca-129">Sie tun dies, damit Sie die Geschäftslogik hinzufügen können, die von ausgeführt werden, die `ObjectDataSource` zu steuern, obwohl Sie nicht, die noch ist.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-129">You do this so that you can add business logic that will be executed by the `ObjectDataSource` control, although you will not do that yet.</span></span> <span data-ttu-id="5d3ca-130">Jetzt wird die neue Geschäftslogik-Klasse nur die gleichen CRUD-Vorgänge ausführen, die das Repository ausführt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-130">For now, the new business-logic class will only perform the same CRUD operations that the repository does.</span></span>

<span data-ttu-id="5d3ca-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span></span>

<span data-ttu-id="5d3ca-132">Erstellen Sie einen neuen Ordner, und nennen Sie sie *BLL*.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-132">Create a new folder and name it *BLL*.</span></span> <span data-ttu-id="5d3ca-133">(In einer realen Anwendung würde die Geschäftslogik-Ebene in der Regel als Klassenbibliothek implementiert werden, ein separates Projekt, aber in diesem Tutorial der Einfachheit halber werden BLL-Klassen in einem Projektordner gespeichert.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-133">(In a real-world application, the business-logic layer would typically be implemented as a class library — a separate project — but to keep this tutorial simple, BLL classes will be kept in a project folder.)</span></span>

<span data-ttu-id="5d3ca-134">In der *BLL* Ordner eine neue Klassendatei zu erstellen, nennen Sie es *SchoolBL.cs*, und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-134">In the *BLL* folder, create a new class file, name it *SchoolBL.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample3.cs)]

<span data-ttu-id="5d3ca-135">Dieser Code erstellt die gleichen CRUD-Methoden, die Sie gesehen haben, weiter oben in der repositoryklasse, anstatt direkt auf die Entity Framework-Methoden, er ruft jedoch das Repository-Klasse, Methoden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-135">This code creates the same CRUD methods you saw earlier in the repository class, but instead of accessing the Entity Framework methods directly, it calls the repository class methods.</span></span>

<span data-ttu-id="5d3ca-136">Die Class-Variable, die einen Verweis auf die "Repository"-Klasse enthält, die als ein Schnittstellentyp definiert ist, und der Code, der die "Repository"-Klasse instanziiert ist in zwei Konstruktoren enthalten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-136">The class variable that holds a reference to the repository class is defined as an interface type, and the code that instantiates the repository class is contained in two constructors.</span></span> <span data-ttu-id="5d3ca-137">Der parameterlose Konstruktor wird von verwendet die `ObjectDataSource` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-137">The parameterless constructor will be used by the `ObjectDataSource` control.</span></span> <span data-ttu-id="5d3ca-138">Es erstellt eine Instanz der `SchoolRepository` -Klasse, die Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-138">It creates an instance of the `SchoolRepository` class that you created earlier.</span></span> <span data-ttu-id="5d3ca-139">Der andere Konstruktor kann jeden beliebigen Code, der instanziiert die Geschäftslogik-Klasse ein Objekt übergeben, die die Repositoryschnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-139">The other constructor allows whatever code that instantiates the business-logic class to pass in any object that implements the repository interface.</span></span>

<span data-ttu-id="5d3ca-140">Die CRUD-Methoden, die "Repository"-Klasse und die beiden Konstruktoren aufrufen ermöglichen die Geschäftslogik-Klasse mit den Back-End-Datenspeicher verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-140">The CRUD methods that call the repository class and the two constructors make it possible to use the business-logic class with whatever back-end data store you choose.</span></span> <span data-ttu-id="5d3ca-141">Die Geschäftslogik-Klasse muss nicht zu beachten, wie die Klasse, die sie aufrufen, wird die Daten werden beibehalten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-141">The business-logic class does not need to be aware of how the class that it's calling persists the data.</span></span> <span data-ttu-id="5d3ca-142">(Dies wird häufig als *ignorieren der Persistenz*.) Dadurch werden Komponententests, erleichtert, da Sie zu einer Repository-Implementierung die Geschäftslogik-Klasse verbinden können, die etwas ganz einfachen verwendet als in-Memory- `List` Sammlungen zum Speichern von Daten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-142">(This is often called *persistence ignorance*.) This facilitates unit testing, because you can connect the business-logic class to a repository implementation that uses something as simple as in-memory `List` collections to store data.</span></span>

> [!NOTE]
> <span data-ttu-id="5d3ca-143">Technisch gesehen die Entitätsobjekte sind noch keine Dauerhaftigkeit, da sie eine Instanziierung von Klassen sind, die von Entity Framework erben `EntityObject` Klasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-143">Technically, the entity objects are still not persistence-ignorant, because they're instantiated from classes that inherit from the Entity Framework's `EntityObject` class.</span></span> <span data-ttu-id="5d3ca-144">Für vollständige ignorieren der Persistenz, können Sie *plain old CLR Objekte*, oder *POCOs*, anstelle von Objekten, die von erben die `EntityObject` Klasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-144">For complete persistence ignorance, you can use *plain old CLR objects*, or *POCOs*, in place of objects that inherit from the `EntityObject` class.</span></span> <span data-ttu-id="5d3ca-145">Die Verwendung von POCOs ist, würde den Rahmen dieses Tutorials.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-145">Using POCOs is beyond the scope of this tutorial.</span></span> <span data-ttu-id="5d3ca-146">Weitere Informationen finden Sie unter [Prüfbarkeit und Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) auf der MSDN-Website.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-146">For more information, see [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) on the MSDN website.)</span></span>


<span data-ttu-id="5d3ca-147">Nachdem Sie eine Verbindung herstellen können die `ObjectDataSource` Steuerelemente auf die Geschäftslogik-Klasse anstelle von an das Repository, und stellen Sie sicher, dass alles funktioniert wie vorher.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-147">Now you can connect the `ObjectDataSource` controls to the business-logic class instead of to the repository and verify that everything works as it did before.</span></span>

<span data-ttu-id="5d3ca-148">In *Departments.aspx* und *DepartmentsAdd.aspx*, ändern Sie jedes Vorkommen von `TypeName="ContosoUniversity.DAL.SchoolRepository"` zu `TypeName="ContosoUniversity.BLL.SchoolBL`".</span><span class="sxs-lookup"><span data-stu-id="5d3ca-148">In *Departments.aspx* and *DepartmentsAdd.aspx*, change each occurrence of `TypeName="ContosoUniversity.DAL.SchoolRepository"` to `TypeName="ContosoUniversity.BLL.SchoolBL`".</span></span> <span data-ttu-id="5d3ca-149">(Es gibt vier Instanzen in allen.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-149">(There are four instances in all.)</span></span>

<span data-ttu-id="5d3ca-150">Führen Sie die *Departments.aspx* und *DepartmentsAdd.aspx* Seiten, um sicherzustellen, dass sie weiterhin funktionieren wie bisher.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-150">Run the *Departments.aspx* and *DepartmentsAdd.aspx* pages to verify that they still work as they did before.</span></span>

<span data-ttu-id="5d3ca-151">[![Image01 abgerufen wird](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span></span>

<span data-ttu-id="5d3ca-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span></span>

## <a name="creating-a-unit-test-project-and-repository-implementation"></a><span data-ttu-id="5d3ca-153">Erstellen eines Komponententestprojekts und der Repository-Implementierung</span><span class="sxs-lookup"><span data-stu-id="5d3ca-153">Creating a Unit-Test Project and Repository Implementation</span></span>

<span data-ttu-id="5d3ca-154">Fügen Sie ein neues Projekt der Projektmappe mithilfe der **Testprojekt** Vorlage, und nennen Sie sie `ContosoUniversity.Tests`.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-154">Add a new project to the solution using the **Test Project** template, and name it `ContosoUniversity.Tests`.</span></span>

<span data-ttu-id="5d3ca-155">Fügen Sie im Testprojekt einen Verweis auf `System.Data.Entity` und fügen Sie einen Projektverweis auf die `ContosoUniversity` Projekt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-155">In the test project, add a reference to `System.Data.Entity` and add a project reference to the `ContosoUniversity` project.</span></span>

<span data-ttu-id="5d3ca-156">Sie können jetzt die "Repository"-Klasse erstellen, die Sie mit Komponententests verwenden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-156">You can now create the repository class that you'll use with unit tests.</span></span> <span data-ttu-id="5d3ca-157">Der Datenspeicher für dieses Repository wird in der Klasse sein.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-157">The data store for this repository will be within the class.</span></span>

<span data-ttu-id="5d3ca-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span></span>

<span data-ttu-id="5d3ca-159">Klicken Sie in das Testprojekt, und erstellen Sie eine neue Klassendatei, nennen Sie es *MockSchoolRepository.cs*, und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-159">In the test project, create a new class file, name it *MockSchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample4.cs)]

<span data-ttu-id="5d3ca-160">Dieses Repository-Klasse verfügt über die gleichen CRUD-Methoden, die das Entity Framework direkt zugreift, aber sie funktionieren mit `List` Auflistungen im Arbeitsspeicher, nicht mit einer Datenbank.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-160">This repository class has the same CRUD methods as the one that accesses the Entity Framework directly, but they work with `List` collections in memory instead of with a database.</span></span> <span data-ttu-id="5d3ca-161">Dies erleichtert es für eine Testklasse einrichten und überprüfen Komponententests für die Geschäftslogik-Klasse.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-161">This makes it easier for a test class to set up and validate unit tests for the business-logic class.</span></span>

## <a name="creating-unit-tests"></a><span data-ttu-id="5d3ca-162">Erstellen von Komponententests</span><span class="sxs-lookup"><span data-stu-id="5d3ca-162">Creating Unit Tests</span></span>

<span data-ttu-id="5d3ca-163">Die **testen** Projektvorlage eine Stub-Komponententestklasse für Sie erstellt und die nächste Aufgabe ist, ändern Sie diese Klasse von Komponententestmethoden hinzugefügt, für die Geschäftslogik, die die Geschäftslogik-Klasse hinzugefügt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-163">The **Test** project template created a stub unit test class for you, and your next task is to modify this class by adding unit test methods to it for business logic that you want to add to the business-logic class.</span></span>

<span data-ttu-id="5d3ca-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span></span>

<span data-ttu-id="5d3ca-165">Contoso University jeder einzelnen "Instructor" kann nur der Administrator eine einzelne Abteilung sein, und Sie Geschäftslogik zum Erzwingen dieser Regel hinzufügen möchten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-165">At Contoso University, any individual instructor can only be the administrator of a single department, and you need to add business logic to enforce this rule.</span></span> <span data-ttu-id="5d3ca-166">Sie werden gestartet, durch Hinzufügen von Tests und Ausführen der Tests aus, um Fehler anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-166">You will start by adding tests and running the tests to see them fail.</span></span> <span data-ttu-id="5d3ca-167">Anschließend fügen Sie den Code und führen Sie erneut aus den Tests erfolgreich erhalten.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-167">You'll then add the code and rerun the tests, expecting to see them pass.</span></span>

<span data-ttu-id="5d3ca-168">Öffnen der *"UnitTest1.cs"* -Datei und fügen `using` -Anweisungen für die Business-Logik und die Datenzugriffs-Ebenen, die Sie in der "ContosoUniversity"-Projekt erstellt haben:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-168">Open the *UnitTest1.cs* file and add `using` statements for the business logic and data-access layers that you created in the ContosoUniversity project:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample5.cs)]

<span data-ttu-id="5d3ca-169">Ersetzen Sie die `TestMethod1` Methode mit den folgenden Methoden:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-169">Replace the `TestMethod1` method with the following methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample6.cs)]

<span data-ttu-id="5d3ca-170">Die `CreateSchoolBL` Methode erstellt eine Instanz der repositoryklasse, die Sie erstellt haben, für die Einheit Testprojekt, die sie dann auf eine neue Instanz der Geschäftslogik-Klasse übergibt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-170">The `CreateSchoolBL` method creates an instance of the repository class that you created for the unit test project, which it then passes to a new instance of the business-logic class.</span></span> <span data-ttu-id="5d3ca-171">Die Methode verwendet dann die Geschäftslogik-Klasse zum Einfügen von drei Abteilungen, die Sie verwenden können, in den Testmethoden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-171">The method then uses the business-logic class to insert three departments that you can use in test methods.</span></span>

<span data-ttu-id="5d3ca-172">Die Testmethoden, stellen Sie sicher, dass die Geschäftslogik-Klasse eine Ausnahme auslöst, wenn jemand versucht, eine neue Abteilung mit dem gleichen Administrator als einer vorhandenen Abteilung einfügen, oder wenn jemand versucht, eine Abteilung Administrator zu aktualisieren, indem er auf die ID einer Person Wer ist bereits einer anderen Abteilung-Administrator.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-172">The test methods verify that the business-logic class throws an exception if someone tries to insert a new department with the same administrator as an existing department, or if someone tries to update a department's administrator by setting it to the ID of a person who is already the administrator of another department.</span></span>

<span data-ttu-id="5d3ca-173">Die Exception-Klasse noch nicht noch erstellt werden, damit dieser Code nicht kompiliert werden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-173">You haven't created the exception class yet, so this code will not compile.</span></span> <span data-ttu-id="5d3ca-174">Rufen Sie kompilieren Maustaste `DuplicateAdministratorException` , und wählen Sie **generieren**, und klicken Sie dann **Klasse**.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-174">To get it to compile, right-click `DuplicateAdministratorException` and select **Generate**, and then **Class**.</span></span>

<span data-ttu-id="5d3ca-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span></span>

<span data-ttu-id="5d3ca-176">Dadurch wird eine Klasse erstellt, in das Testprojekt, das Sie löschen können, nachdem Sie die Exception-Klasse im Hauptprojekt erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-176">This creates a class in the test project which you can delete after you've created the exception class in the main project.</span></span> <span data-ttu-id="5d3ca-177">und die Geschäftslogik implementiert.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-177">and implemented the business logic.</span></span>

<span data-ttu-id="5d3ca-178">Führen Sie das Testprojekt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-178">Run the test project.</span></span> <span data-ttu-id="5d3ca-179">Wie erwartet, ein Fehler auf die Tests.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-179">As expected, the tests fail.</span></span>

<span data-ttu-id="5d3ca-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span></span>

## <a name="adding-business-logic-to-make-a-test-pass"></a><span data-ttu-id="5d3ca-181">Hinzufügen von Geschäftslogik, um einen Testdurchlauf zu machen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-181">Adding Business Logic to Make a Test Pass</span></span>

<span data-ttu-id="5d3ca-182">Als Nächstes implementieren Sie die Geschäftslogik, die macht es unmöglich, Sie als Administrator einer Abteilung eine Person festgelegt, der bereits einer anderen Abteilung ist.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-182">Next, you'll implement the business logic that makes it impossible to set as the administrator of a department someone who is already administrator of another department.</span></span> <span data-ttu-id="5d3ca-183">Sie löst eine Ausnahme von der Geschäftslogik-Ebene und fange ihn dann in der Darstellungsschicht, wenn ein Benutzer eine Abteilung bearbeitet und klickt auf **Update** nach der Auswahl eine Person, die bereits ein Administrator ist.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-183">You'll throw an exception from the business-logic layer, and then catch it in the presentation layer if a user edits a department and clicks **Update** after selecting someone who is already an administrator.</span></span> <span data-ttu-id="5d3ca-184">(Sie könnten auch Dozenten entfernen, aus der Dropdown-Liste, die bereits die Administratoren sind, bevor Sie auf die Seite rendern, aber hier dient dazu, mit der Geschäftslogik-Ebene zu arbeiten.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-184">(You could also remove instructors from the drop-down list who are already administrators before you render the page, but the purpose here is to work with the business-logic layer.)</span></span>

<span data-ttu-id="5d3ca-185">Zunächst erstellen die Exception-Klasse, die Sie auslösen müssen, wenn ein Benutzer versucht, ein "Instructor" mehr als eine Abteilung ernennen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-185">Start by creating the exception class that you'll throw when a user tries to make an instructor the administrator of more than one department.</span></span> <span data-ttu-id="5d3ca-186">In dem Hauptprojekt, erstellen Sie eine neue Klassendatei in der *BLL* Ordner, nennen Sie sie *DuplicateAdministratorException.cs*, und Ersetzen Sie den vorhandenen Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-186">In the main project, create a new class file in the *BLL* folder, name it *DuplicateAdministratorException.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample7.cs)]

<span data-ttu-id="5d3ca-187">Jetzt löschen die temporäre *DuplicateAdministratorException.cs* im Testprojekt zuvor erstellte Datei zu kompilieren können.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-187">Now delete the temporary *DuplicateAdministratorException.cs* file that you created in the test project earlier in order to be able to compile.</span></span>

<span data-ttu-id="5d3ca-188">Öffnen Sie in dem Hauptprojekt, das *SchoolBL.cs* Datei, und fügen Sie die folgende Methode, die die Validierungslogik enthält.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-188">In the main project, open the *SchoolBL.cs* file and add the following method that contains the validation logic.</span></span> <span data-ttu-id="5d3ca-189">(Der Code bezieht sich auf eine Methode, die Sie später erstellen.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-189">(The code refers to a method that you'll create later.)</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample8.cs)]

<span data-ttu-id="5d3ca-190">Sie müssen diese Methode aufrufen, wenn Sie einfügen oder aktualisieren `Department` Entitäten, um zu überprüfen, ob eine andere Abteilung bereits die gleiche Administrator verfügt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-190">You'll call this method when you're inserting or updating `Department` entities in order to check whether another department already has the same administrator.</span></span>

<span data-ttu-id="5d3ca-191">Der Code Ruft eine Methode zum Suchen der Datenbank für eine `Department` Entität mit dem gleichen `Administrator` Eigenschaftswert als die Entität eingefügt oder aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-191">The code calls a method to search the database for a `Department` entity that has the same `Administrator` property value as the entity being inserted or updated.</span></span> <span data-ttu-id="5d3ca-192">Wenn eine gefunden wird, löst der Code eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-192">If one is found, the code throws an exception.</span></span> <span data-ttu-id="5d3ca-193">Keine Überprüfung ist erforderlich, wenn die Entität eingefügt oder aktualisiert werden keine `Administrator` Wert und keine Ausnahme wird ausgelöst, wenn die Methode aufgerufen wird, während einer Aktualisierung und die `Department` Entität Übereinstimmungen gefunden der `Department` Entität aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-193">No validation check is required if the entity being inserted or updated has no `Administrator` value, and no exception is thrown if the method is called during an update and the `Department` entity found matches the `Department` entity being updated.</span></span>

<span data-ttu-id="5d3ca-194">Rufen Sie die neue Methode über die `Insert` und `Update` Methoden:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-194">Call the new method from the `Insert` and `Update` methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample9.cs)]

<span data-ttu-id="5d3ca-195">In *ISchoolRepository.cs*, fügen Sie die folgende Deklaration für die neue Datenzugriffs-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-195">In *ISchoolRepository.cs*, add the following declaration for the new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample10.cs)]

<span data-ttu-id="5d3ca-196">In *SchoolRepository.cs*, fügen Sie die folgenden `using` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-196">In *SchoolRepository.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample11.cs)]

<span data-ttu-id="5d3ca-197">In *SchoolRepository.cs*, fügen Sie die folgende neue Datenzugriffs-Methode hinzu:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-197">In *SchoolRepository.cs*, add the following new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample12.cs)]

<span data-ttu-id="5d3ca-198">Dieser Code ruft `Department` Entitäten, die einen angegebenen Administrator haben.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-198">This code retrieves `Department` entities that have a specified administrator.</span></span> <span data-ttu-id="5d3ca-199">Nur eine Abteilung sollten (sofern vorhanden) wurde gefunden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-199">Only one department should be found (if any).</span></span> <span data-ttu-id="5d3ca-200">Aber da keine Einschränkung in der Datenbank erstellt wurde, ist der Rückgabetyp eine Auflistung für den Fall, dass mehrere Abteilungen gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-200">However, because no constraint is built into the database, the return type is a collection in case multiple departments are found.</span></span>

<span data-ttu-id="5d3ca-201">In der Standardeinstellung, wenn der Objektkontext Entitäten aus der Datenbank abruft verfolgt des sie sie in der Objektstatus-Manager.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-201">By default, when the object context retrieves entities from the database, it keeps track of them in its object state manager.</span></span> <span data-ttu-id="5d3ca-202">Die `MergeOption.NoTracking` Parameter gibt an, dass diese nachverfolgung für diese Abfrage nicht ausgeführt werden wird.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-202">The `MergeOption.NoTracking` parameter specifies that this tracking will not be done for this query.</span></span> <span data-ttu-id="5d3ca-203">Dies ist erforderlich, da die Abfrage die genaue Entität zurückgeben kann, die Sie aktualisieren möchten, und klicken Sie dann Sie nicht diese Entität anfügen können.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-203">This is necessary because the query might return the exact entity that you're trying to update, and then you would not be able to attach that entity.</span></span> <span data-ttu-id="5d3ca-204">Angenommen, Sie bearbeiten, dass die Abteilung der Verlauf der *Departments.aspx* Seite und der Administrator unverändert lassen, gibt diese Abfrage die Verlaufs-Abteilung.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-204">For example, if you edit the History department in the *Departments.aspx* page and leave the administrator unchanged, this query will return the History department.</span></span> <span data-ttu-id="5d3ca-205">Wenn `NoTracking` ist nicht festgelegt ist, wird der Objektkontext müsste bereits die Verlaufs-Entität "Department" in einen Objekt-Zustands-Manager.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-205">If `NoTracking` is not set, the object context would already have the History department entity in its object state manager.</span></span> <span data-ttu-id="5d3ca-206">Und wenn Sie die abteilungsentität Verlauf, die aus dem Ansichtszustand neu erstellt wird anfügen, der Objektkontext eine Ausnahme auslösen würde, die besagt, `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-206">Then when you attach the History department entity that's re-created from view state, the object context would throw an exception that says `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span></span>

<span data-ttu-id="5d3ca-207">(Als Alternative zum Angeben von `MergeOption.NoTracking`, können Sie einem neuen Objektkontext nur für diese Abfrage erstellen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-207">(As an alternative to specifying `MergeOption.NoTracking`, you could create a new object context just for this query.</span></span> <span data-ttu-id="5d3ca-208">Da die neuen Objektkontext eine eigene Objektstatus-Manager einrichten möchten, wäre kein Konflikt beim Aufrufen der `Attach` Methode.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-208">Because the new object context would have its own object state manager, there would be no conflict when you call the `Attach` method.</span></span> <span data-ttu-id="5d3ca-209">Die neuen Objektkontext teilten Metadaten und die Datenbank mit dem ursprünglichen Objektkontext dieser Alternativen Vorgehensweise die Leistungseinbußen durch minimale wäre.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-209">The new object context would share metadata and database connection with the original object context, so the performance penalty of this alternate approach would be minimal.</span></span> <span data-ttu-id="5d3ca-210">Der hier gezeigte Ansatz führt jedoch die `NoTracking` option, die in anderen Kontexten nützlich finden Sie.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-210">The approach shown here, however, introduces the `NoTracking` option, which you'll find useful in other contexts.</span></span> <span data-ttu-id="5d3ca-211">Die `NoTracking` Option erläutert wird weiter unten in einem späteren Tutorial dieser Reihe.)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-211">The `NoTracking` option is discussed further in a later tutorial in this series.)</span></span>

<span data-ttu-id="5d3ca-212">Fügen Sie in das Testprojekt, und die neue Datenzugriffs-Methode *MockSchoolRepository.cs*:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-212">In the test project, add the new data-access method to *MockSchoolRepository.cs*:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample13.cs)]

<span data-ttu-id="5d3ca-213">Dieser Code verwendet LINQ, um die Datenauswahl der gleichen durchführen, die die `ContosoUniversity` projektrepository verwendet LINQ to Entities für.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-213">This code uses LINQ to perform the same data selection that the `ContosoUniversity` project repository uses LINQ to Entities for.</span></span>

<span data-ttu-id="5d3ca-214">Führen Sie das Testprojekt erneut aus.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-214">Run the test project again.</span></span> <span data-ttu-id="5d3ca-215">Dieses Mal werden die Tests bestanden.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-215">This time the tests pass.</span></span>

<span data-ttu-id="5d3ca-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span></span>

## <a name="handling-objectdatasource-exceptions"></a><span data-ttu-id="5d3ca-217">Behandeln von Ausnahmen von "ObjectDataSource"</span><span class="sxs-lookup"><span data-stu-id="5d3ca-217">Handling ObjectDataSource Exceptions</span></span>

<span data-ttu-id="5d3ca-218">In der `ContosoUniversity` Projekt, und führen Sie die *Departments.aspx* Seite, und versuchen Sie, die der Administrator für eine Abteilung an eine Person zu ändern, die bereits einer anderen Abteilung-Administrator ist.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-218">In the `ContosoUniversity` project, run the *Departments.aspx* page and try to change the administrator for a department to someone who is already administrator for another department.</span></span> <span data-ttu-id="5d3ca-219">(Beachten Sie, dass Sie nur Abteilungen, die Sie im Verlauf dieses Lernprogramms hinzugefügt bearbeiten können, da die Datenbank mit ungültigen Daten vorab geladen wird.) Sie erhalten eine die folgenden Seite der Server-Fehler:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-219">(Remember that you can only edit departments that you added during this tutorial, because the database comes preloaded with invalid data.) You get the following server error page:</span></span>

<span data-ttu-id="5d3ca-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span></span>

<span data-ttu-id="5d3ca-221">Sie möchten nicht die Benutzer sehen diese Art von Fehler (Seite), müssen Sie Fehlerbehandlungscode hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-221">You don't want users to see this kind of error page, so you need to add error-handling code.</span></span> <span data-ttu-id="5d3ca-222">Open *Departments.aspx* , und geben Sie einen Handler für die `OnUpdated` Ereignis die `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-222">Open *Departments.aspx* and specify a handler for the `OnUpdated` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="5d3ca-223">Die `ObjectDataSource` öffnungstag jetzt das folgende Beispiel ähnelt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-223">The `ObjectDataSource` opening tag now resembles the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample14.aspx)]

<span data-ttu-id="5d3ca-224">In *Departments.aspx.cs*, fügen Sie die folgenden `using` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-224">In *Departments.aspx.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample15.cs)]

<span data-ttu-id="5d3ca-225">Fügen Sie den folgenden Ereignishandler für die `Updated` Ereignis:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-225">Add the following handler for the `Updated` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample16.cs)]

<span data-ttu-id="5d3ca-226">Wenn die `ObjectDataSource` Steuerelement wird eine Ausnahme abgefangen, wenn er versucht, das Update auszuführen, die er übergibt die Ausnahme im Ereignisargument (`e`), die diesem Handler.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-226">If the `ObjectDataSource` control catches an exception when it tries to perform the update, it passes the exception in the event argument (`e`) to this handler.</span></span> <span data-ttu-id="5d3ca-227">Der Code im Ereignishandler überprüft, um festzustellen, ob die Ausnahme, die doppelte Administrator-Ausnahme ist.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-227">The code in the handler checks to see if the exception is the duplicate administrator exception.</span></span> <span data-ttu-id="5d3ca-228">Wenn es sich handelt, wird der Code erstellt ein Validator-Steuerelement, das für eine Fehlermeldung enthält die `ValidationSummary` -Steuerelement angezeigt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-228">If it is, the code creates a validator control that contains an error message for the `ValidationSummary` control to display.</span></span>

<span data-ttu-id="5d3ca-229">Führen Sie die Seite, und versuchen Sie, eine Person wieder den Administrator zwei Abteilungen zu machen.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-229">Run the page and attempt to make someone the administrator of two departments again.</span></span> <span data-ttu-id="5d3ca-230">Dieses Mal die `ValidationSummary` Steuerelement wird eine Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-230">This time the `ValidationSummary` control displays an error message.</span></span>

<span data-ttu-id="5d3ca-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span></span>

<span data-ttu-id="5d3ca-232">Nehmen Sie ähnliche Änderungen an der *DepartmentsAdd.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-232">Make similar changes to the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="5d3ca-233">In *DepartmentsAdd.aspx*, geben Sie einen Handler für die `OnInserted` Ereignis die `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-233">In *DepartmentsAdd.aspx*, specify a handler for the `OnInserted` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="5d3ca-234">Das daraus resultierende Markup wird im folgende Beispiel ähneln.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-234">The resulting markup will resemble the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample17.aspx)]

<span data-ttu-id="5d3ca-235">In *DepartmentsAdd.aspx.cs*, fügen Sie dem `using` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-235">In *DepartmentsAdd.aspx.cs*, add the same `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample18.cs)]

<span data-ttu-id="5d3ca-236">Fügen Sie den folgenden Ereignishandler hinzu:</span><span class="sxs-lookup"><span data-stu-id="5d3ca-236">Add the following event handler:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample19.cs)]

<span data-ttu-id="5d3ca-237">Sie können nun testen der *DepartmentsAdd.aspx.cs* Seite, um sicherzustellen, dass sie auch richtig versucht, eine Person mehr als eine Abteilung ernennen behandelt.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-237">You can now test the *DepartmentsAdd.aspx.cs* page to verify that it also correctly handles attempts to make one person the administrator of more than one department.</span></span>

<span data-ttu-id="5d3ca-238">Dies schließt die Einführung zum Implementieren der Repositorymuster für die Verwendung der `ObjectDataSource` Steuerelement mit dem Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-238">This completes the introduction to implementing the repository pattern for using the `ObjectDataSource` control with the Entity Framework.</span></span> <span data-ttu-id="5d3ca-239">Weitere Informationen über die Repository-Muster und testbarkeit finden Sie im MSDN-Whitepaper [Prüfbarkeit und Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span><span class="sxs-lookup"><span data-stu-id="5d3ca-239">For more information about the repository pattern and testability, see the MSDN whitepaper [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span></span>

<span data-ttu-id="5d3ca-240">Im folgenden Tutorial sehen Sie das Hinzufügen von Sortier- und Filterfunktionen zur Anwendung.</span><span class="sxs-lookup"><span data-stu-id="5d3ca-240">In the following tutorial you'll see how to add sorting and filtering functionality to the application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5d3ca-241">[Zurück](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
> [Weiter](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span><span class="sxs-lookup"><span data-stu-id="5d3ca-241">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
[Next](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span></span>
