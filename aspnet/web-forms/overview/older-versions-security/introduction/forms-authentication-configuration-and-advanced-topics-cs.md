---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Konfiguration der Formularauthentifizierung und Weiterführende Themen (c#) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial werden wir untersuchen Sie die verschiedenen Einstellungen für die Formularauthentifizierung und erfahren Sie, wie sie über das Forms-Element zu ändern. Dadurch wird eine detaillierte gelten...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: 75e7da4c993bc59a2ff34c2838f36312e1571668
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/06/2019
ms.locfileid: "65134380"
---
# <a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="ce332-104">Konfiguration der Formularauthentifizierung und weiterführende Themen (C#)</span><span class="sxs-lookup"><span data-stu-id="ce332-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>

<span data-ttu-id="ce332-105">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ce332-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ce332-106">[Code herunterladen](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) oder [PDF-Datei herunterladen](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="ce332-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="ce332-107">In diesem Tutorial werden wir untersuchen Sie die verschiedenen Einstellungen für die Formularauthentifizierung und erfahren Sie, wie sie über das Forms-Element zu ändern.</span><span class="sxs-lookup"><span data-stu-id="ce332-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="ce332-108">Dadurch wird eine ausführliche Übersicht über das Anpassen der Timeoutwert für das Formularauthentifizierungsticket über eine Anmeldeseite mit einer benutzerdefinierten URL (z. B. SignIn.aspx anstelle von "Login.aspx") und ohne Cookies Formularauthentifizierungstickets gelten.</span><span class="sxs-lookup"><span data-stu-id="ce332-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="ce332-109">Einführung</span><span class="sxs-lookup"><span data-stu-id="ce332-109">Introduction</span></span>

<span data-ttu-id="ce332-110">In der [vorherigen Tutorial](an-overview-of-forms-authentication-cs.md) wir haben uns über die erforderlichen Schritte zum Implementieren der Formularauthentifizierung in einer ASP.NET-Anwendung aus, von der Angabe von Konfigurationseinstellungen in Web.config-Datei zum Erstellen eines Protokolls für die andere Seite für die Anzeige Inhalte für authentifizierte und anonyme Benutzer.</span><span class="sxs-lookup"><span data-stu-id="ce332-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="ce332-111">Denken Sie daran, dass wir die Website, um die Verwendung der Formularauthentifizierung durch Festlegen des modusattributs des konfiguriert die &lt;Authentifizierung&gt; Element für Formulare.</span><span class="sxs-lookup"><span data-stu-id="ce332-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="ce332-112">Die &lt;Authentifizierung&gt; Element kann optional enthalten eine &lt;Forms&gt; untergeordnetes Element darstellt, kann eine Sammlung von Einstellungen für die Formularauthentifizierung über die angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="ce332-113">In diesem Tutorial werden wir untersuchen Sie die verschiedenen Einstellungen für die Formularauthentifizierung und finden Sie unter Vorgehensweise: Ändern sie in der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="ce332-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="ce332-114">Dadurch wird eine ausführliche Übersicht über das Anpassen der Timeoutwert für das Formularauthentifizierungsticket über eine Anmeldeseite mit einer benutzerdefinierten URL (z. B. SignIn.aspx anstelle von "Login.aspx") und ohne Cookies Formularauthentifizierungstickets gelten.</span><span class="sxs-lookup"><span data-stu-id="ce332-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="ce332-115">Wir auch die Zusammensetzung des Formularauthentifizierungstickets genauer untersuchen, und die Vorsichtsmaßnahmen, die ASP.NET benötigt, um sicherzustellen, dass das Ticket für die Daten vor Überprüfungen und Manipulation sicher ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="ce332-116">Abschließend werden wir wie zusätzliche Benutzerdaten in das Formularauthentifizierungsticket gespeichert und wie diese Daten über einen benutzerdefinierten Prinzipalobjekts modelliert betrachten.</span><span class="sxs-lookup"><span data-stu-id="ce332-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="ce332-117">Schritt 1: Untersuchen der &lt;Forms&gt; -Konfigurationseinstellungen</span><span class="sxs-lookup"><span data-stu-id="ce332-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="ce332-118">Das Authentifizierungssystem "Forms" in ASP.NET bietet es sich um eine Reihe von Konfigurationseinstellungen, die auf Basis von Anwendung angepasst werden kann.</span><span class="sxs-lookup"><span data-stu-id="ce332-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="ce332-119">Hierzu zählen Einstellungen wie: die Lebensdauer der Formularauthentifizierung ticket; Welche Art von Schutz wird auf das Ticket angewendet; Tickets werden verwendet, unter welchen Bedingungen Authentifizierung ohne Cookies verwendet. der Pfad zur Anmeldeseite. und andere Informationen.</span><span class="sxs-lookup"><span data-stu-id="ce332-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="ce332-120">Um die Standardwerte zu ändern, fügen eine [ &lt;Forms&gt; Element](https://msdn.microsoft.com/library/1d3t3c61.aspx) als untergeordnetes Element der [ &lt;Authentifizierung&gt; Element](https://msdn.microsoft.com/library/532aee0e.aspx), diese Eigenschaft angeben Werte, die Sie als XML-Attribute anpassen möchten, wie folgt:</span><span class="sxs-lookup"><span data-stu-id="ce332-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="ce332-121">In Tabelle 1 sind die Eigenschaften, die mithilfe von angepasst werden, können die &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="ce332-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="ce332-122">Da "Web.config" eine XML-Datei ist, sind die Namen der Attribute in der linken Spalte Groß-/Kleinschreibung beachtet.</span><span class="sxs-lookup"><span data-stu-id="ce332-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="ce332-123"><strong>Attribut</strong></span><span class="sxs-lookup"><span data-stu-id="ce332-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="ce332-124"><strong>Beschreibung</strong></span><span class="sxs-lookup"><span data-stu-id="ce332-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="ce332-125">cookieless</span><span class="sxs-lookup"><span data-stu-id="ce332-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="ce332-126">Dieses Attribut gibt an, unter welchen Bedingungen das Authentifizierungsticket in ein Cookie im Vergleich zu, die in der URL eingebettet gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="ce332-127">Zulässige Werte sind: UseCookies; UseUri; AutoErmittlung; und UseDeviceProfile (Standard).</span><span class="sxs-lookup"><span data-stu-id="ce332-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="ce332-128">Schritt 2 werden diese Einstellung im Detail untersucht.</span><span class="sxs-lookup"><span data-stu-id="ce332-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="ce332-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="ce332-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="ce332-130">Gibt die URL, die Benutzer in umgeleitet werden, nach der Anmeldung über die Anmeldeseite, wenn kein umleitungs-URL-in der Abfragezeichenfolge angegeben Wert.</span><span class="sxs-lookup"><span data-stu-id="ce332-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="ce332-131">Der Standardwert ist "default.aspx".</span><span class="sxs-lookup"><span data-stu-id="ce332-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="ce332-132">Domäne</span><span class="sxs-lookup"><span data-stu-id="ce332-132">domain</span></span>           | <span data-ttu-id="ce332-133">Wenn Sie cookiebasierte Authentifizierungstickets zu verwenden, gibt diese Einstellung Domäne Cookiewert.</span><span class="sxs-lookup"><span data-stu-id="ce332-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="ce332-134">Der Standardwert ist eine leere Zeichenfolge und bewirkt, dass der Browser mit der Domäne, von der es (z. B. www.yourdomain.com) ausgestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="ce332-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="ce332-135">In diesem Fall das Cookie wird <strong>nicht</strong> gesendet werden, wenn die Erstellung von Unterdomänen, z. B. admin.yourdomain.com Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="ce332-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="ce332-136">Wenn Sie möchten das Cookie an alle Unterdomänen übergeben werden, Sie die Festlegung auf "ihredomaene.com" Domänenattribut anpassen müssen.</span><span class="sxs-lookup"><span data-stu-id="ce332-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="ce332-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="ce332-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="ce332-138">Ein boolescher Wert, der angibt, ob authentifizierte Benutzer gespeichert werden, wenn URLs in anderen Webanwendungen auf demselben Server umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="ce332-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="ce332-139">Der Standardwert ist FALSE.</span><span class="sxs-lookup"><span data-stu-id="ce332-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="ce332-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="ce332-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="ce332-141">Die URL der Anmeldeseite.</span><span class="sxs-lookup"><span data-stu-id="ce332-141">The URL of the login page.</span></span> <span data-ttu-id="ce332-142">Der Standardwert ist "Login.aspx".</span><span class="sxs-lookup"><span data-stu-id="ce332-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="ce332-143">Name</span><span class="sxs-lookup"><span data-stu-id="ce332-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="ce332-144">Wenn Sie cookiebasierte Authentifizierungstickets, die den Namen des Cookies verwenden zu können.</span><span class="sxs-lookup"><span data-stu-id="ce332-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="ce332-145">Der Standardwert ist. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="ce332-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="ce332-146">path</span><span class="sxs-lookup"><span data-stu-id="ce332-146">path</span></span>            |                                                                             <span data-ttu-id="ce332-147">Wenn Sie cookiebasierte Authentifizierungstickets zu verwenden, gibt diese Einstellung das Cookie des Path-Attribut.</span><span class="sxs-lookup"><span data-stu-id="ce332-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="ce332-148">Das Path-Attribut kann ein Entwickler den Umfang eines Cookies zu einer bestimmten Verzeichnishierarchie zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="ce332-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="ce332-149">Der Standardwert ist /, dem informiert des Browsers, um das Ticket Authentifizierungscookie an alle Anforderungen an die Domäne zu senden.</span><span class="sxs-lookup"><span data-stu-id="ce332-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="ce332-150">Schutz</span><span class="sxs-lookup"><span data-stu-id="ce332-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="ce332-151">Gibt an, welche Verfahren verwendet werden, um das Formularauthentifizierungsticket zu schützen.</span><span class="sxs-lookup"><span data-stu-id="ce332-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="ce332-152">Die zulässigen Werte sind: Alle (Standard); Verschlüsselung None; und Überprüfung.</span><span class="sxs-lookup"><span data-stu-id="ce332-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="ce332-153">Diese Einstellungen werden in Schritt 3 ausführlich erläutert.</span><span class="sxs-lookup"><span data-stu-id="ce332-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="ce332-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="ce332-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="ce332-155">Ein boolescher Wert, der angibt, ob eine SSL-Verbindung erforderlich ist, um das Authentifizierungscookie zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="ce332-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="ce332-156">Der Standardwert ist false.</span><span class="sxs-lookup"><span data-stu-id="ce332-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="ce332-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="ce332-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="ce332-158">Ein boolescher Wert, der angibt, ob das Authentifizierungscookie Timeout jedes Mal zurückgesetzt, wird der Benutzer die Website während einer Sitzung besucht.</span><span class="sxs-lookup"><span data-stu-id="ce332-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="ce332-159">Der Standardwert ist true.</span><span class="sxs-lookup"><span data-stu-id="ce332-159">The default value is true.</span></span> <span data-ttu-id="ce332-160">Die Ticket-Timeoutwert Authentifizierungsrichtlinie wird ausführlicher in der Angabe im Ticket-Timeoutwert-Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="ce332-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="ce332-161">timeout</span><span class="sxs-lookup"><span data-stu-id="ce332-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="ce332-162">Gibt die Zeit in Minuten an, nach denen das Ticket Authentifizierungscookie abläuft.</span><span class="sxs-lookup"><span data-stu-id="ce332-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="ce332-163">Der Standardwert ist 30.</span><span class="sxs-lookup"><span data-stu-id="ce332-163">The default value is 30.</span></span> <span data-ttu-id="ce332-164">Die Ticket-Timeoutwert Authentifizierungsrichtlinie wird ausführlicher in der Angabe im Ticket-Timeoutwert-Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="ce332-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="ce332-165">**Tabelle 1**: Eine Zusammenfassung der &lt;Forms&gt; Attribute des Elements</span><span class="sxs-lookup"><span data-stu-id="ce332-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="ce332-166">In ASP.NET 2.0 und jenseits der Standardgrenze sind Forms Authentication Werte an, in der FormsAuthenticationConfiguration-Klasse in .NET Framework hartcodiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="ce332-167">Alle Änderungen müssen auf Basis von Anwendung in der Datei "Web.config" angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="ce332-168">Dies unterscheidet sich von ASP.NET 1.x, in dem die Standardwerte für Forms Authentication wurden gespeichert, in der Datei "Machine.config" (und können daher geändert werden, per Bearbeitung der Datei machine.config).</span><span class="sxs-lookup"><span data-stu-id="ce332-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="ce332-169">Klicken Sie auf das Thema von ASP.NET 1.x, lohnt es sich, ganz zu schweigen, dass eine Anzahl von den Einstellungen für Formularauthentifizierung System unterschiedliche Werte in ASP.NET 2.0 haben und darüber hinaus als in ASP.NET 1.x.</span><span class="sxs-lookup"><span data-stu-id="ce332-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="ce332-170">Wenn Sie Ihre Anwendung aus einer ASP.NET 1.x-Umgebung migrieren, ist es wichtig, diese Unterschiede berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="ce332-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="ce332-171">Wenden Sie sich an [der &lt;Forms&gt; Element technische Dokumentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) eine Liste der Unterschiede.</span><span class="sxs-lookup"><span data-stu-id="ce332-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-172">Verschiedene Einstellungen für die Formularauthentifizierung, z. B. das Timeout, die Domäne und den Pfad, geben Sie Details für die resultierende Ticket Formularauthentifizierungscookies.</span><span class="sxs-lookup"><span data-stu-id="ce332-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="ce332-173">Weitere Informationen zu Cookies, wie sie funktionieren und die verschiedenen Eigenschaften zu erhalten, lesen [in diesem Tutorial Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="ce332-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="ce332-174">Der Tickettimeoutwert angeben</span><span class="sxs-lookup"><span data-stu-id="ce332-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="ce332-175">Das Formularauthentifizierungsticket ist ein Token, das eine Identität darstellt.</span><span class="sxs-lookup"><span data-stu-id="ce332-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="ce332-176">Mit cookiebasierte Authentifizierungstickets wird dieses Token, die in der Form eines Cookies gespeichert und bei jeder Anforderung an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="ce332-177">Besitz des Tokens, im Wesentlichen deklariert, ich bin *Benutzername*, ich bereits angemeldet sind, und wird verwendet, damit die Identität eines Benutzers gespeichert werden kann, auf der Seite besuchen.</span><span class="sxs-lookup"><span data-stu-id="ce332-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="ce332-178">Das Formularauthentifizierungsticket nicht nur die Identität des Benutzers enthält, sondern enthält auch Informationen, um die Integrität und Sicherheit des Tokens zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="ce332-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="ce332-179">Schließlich möchten wir keinen böswilligen Benutzer zum Erstellen eines Tokens gefälschten oder ein legitim Token underhanded irgendwie ändern kann.</span><span class="sxs-lookup"><span data-stu-id="ce332-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="ce332-180">Eine solche Bit der Informationen in das Ticket ist eine *Ablauf*, Datum und Uhrzeit, die das Ticket nicht mehr gültig ist ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="ce332-181">Jedes Mal die FormsAuthenticationModule ein Authentifizierungsticket untersucht wird sichergestellt, dass das Ticket für den Ablauf noch nicht überschritten hat.</span><span class="sxs-lookup"><span data-stu-id="ce332-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="ce332-182">Falls Ja, ignoriert das Ticket und den Benutzer als anonyme identifiziert.</span><span class="sxs-lookup"><span data-stu-id="ce332-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="ce332-183">Diese Schutzmaßnahme Schutz vor Replay-Angriffe.</span><span class="sxs-lookup"><span data-stu-id="ce332-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="ce332-184">Ohne ein Ablauf, wenn ein Hacker ihr praxisnahe gültiges Authentifizierungsticket eines Benutzers - möglicherweise abrufen, indem physischer Zugriff auf ihren Computer und über ihre Cookies rooting konnte-sie eine Anforderung, an den Server mit diesem gestohlenen Authentifizierungsticket senden können und gewinnen Sie Eintrag.</span><span class="sxs-lookup"><span data-stu-id="ce332-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="ce332-185">Während des Ablaufs dieses Szenario zu verhindern, dass nicht, wird es im Fenster beschränkt, in dem ein solcher Angriff erfolgreich ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="ce332-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-186">Schritt 3 Details zusätzliche Techniken, die dem Authentifizierungssystem Formulare für das Authentifizierungsticket geschützt.</span><span class="sxs-lookup"><span data-stu-id="ce332-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="ce332-187">Wenn Sie das Authentifizierungsticket erstellen zu können, bestimmt das Authentifizierungssystem Forms der ablaufzeitperiode von consulting der Timeouteinstellung festgelegt.</span><span class="sxs-lookup"><span data-stu-id="ce332-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="ce332-188">Dies bedeutet, dass es sich bei Ablauf dieser Frist auf Datum und Uhrzeit in der Zukunft 30 Minuten festgelegt ist, wenn das Formularauthentifizierungsticket erstellt wird, wie in Tabelle 1, das Festlegen von Standardwerten auf 30 Minuten Timeout erwähnt.</span><span class="sxs-lookup"><span data-stu-id="ce332-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="ce332-189">Die Ablaufzeit definiert eine absolute Uhrzeit des Ablaufs das Formularauthentifizierungsticket in der Zukunft.</span><span class="sxs-lookup"><span data-stu-id="ce332-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="ce332-190">Aber in der Regel Entwickler einen gleitenden Ablauf, einer implementieren, die zurückgesetzt wird, jedes Mal, wenn der Benutzer die Website erneut ansehen möchten.</span><span class="sxs-lookup"><span data-stu-id="ce332-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="ce332-191">Dieses Verhalten wird durch die SlidingExpiration Einstellungen bestimmt.</span><span class="sxs-lookup"><span data-stu-id="ce332-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="ce332-192">Wenn Sie auf "true" (Standard), jedes Mal die FormsAuthenticationModule einen Benutzer authentifiziert festgelegt, wird das Ticket für den Ablauf aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="ce332-193">Wenn es sich bei false wird der Ablauf nicht bei jeder Anforderung aktualisiert wird, erstellt, wodurch das Ticket abläuft genau Timeouts Anzahl der Minuten nach, wenn das Ticket wurde.</span><span class="sxs-lookup"><span data-stu-id="ce332-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-194">Der Ablauf des in das Authentifizierungsticket gespeichert ist, ein absolutes Datum und Uhrzeitwert, z. B. 2. August 2008 11:34 Uhr.</span><span class="sxs-lookup"><span data-stu-id="ce332-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="ce332-195">Darüber hinaus sind das Datum und die Uhrzeit relativ zur Ortszeit des Servers ein.</span><span class="sxs-lookup"><span data-stu-id="ce332-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="ce332-196">Diese entwurfsentscheidung haben einige interessante Nebenwirkungen auf Sommerzeit (DST), handelt es sich bei der Uhren in den Vereinigten Staaten jetzt eine Stunde (vorausgesetzt, dass der Webserver in einem Gebietsschema gehostet wird, in dem Sommerzeit erkannt wird) verschoben werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="ce332-197">Beachten Sie, was für eine ASP.NET-Website mit einer 30-minütigen Ablauf der Zeitanzeige passieren würde, die Sommerzeit beginnt (Dies ist um 2:00 Uhr).</span><span class="sxs-lookup"><span data-stu-id="ce332-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="ce332-198">Angenommen Sie, ein Besucher mit dem Standort am 11. März 2008 um 1:55 Uhr anmeldet.</span><span class="sxs-lookup"><span data-stu-id="ce332-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="ce332-199">Dadurch würde ein Formularauthentifizierungsticket generiert, die am 11. März 2008 um 2:25 Uhr (30 Minuten in der Zukunft) abläuft.</span><span class="sxs-lookup"><span data-stu-id="ce332-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="ce332-200">Allerdings nach um 02:00 Uhr wird, springt die Uhr auf 3:00 Uhr aufgrund der Sommerzeit.</span><span class="sxs-lookup"><span data-stu-id="ce332-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="ce332-201">Wenn der Benutzer eine neue Seite sechs Minuten nach der Anmeldung (um 15:01 Uhr) geladen wird, vermerkt die FormsAuthenticationModule an, dass das Ticket ist abgelaufen, und den Benutzer zur Anmeldeseite leitet.</span><span class="sxs-lookup"><span data-stu-id="ce332-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="ce332-202">Für eine ausführlichere Erläuterung dieser und anderen Authentifizierung Ticket Timeout eigentümlichkeiten, sowie problemumgehungen, wählen Sie eine Kopie des Stefan Schackow *Professional ASP.NET 2.0 Security, Mitgliedschafts- und Rollenverwaltung* (ISBN-Nummer: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="ce332-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="ce332-203">Abbildung 1 veranschaulicht den Workflow aus, wenn SlidingExpiration auf "false" festgelegt wird und das Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="ce332-204">Beachten Sie, dass das Authentifizierungsticket, die bei der Anmeldung generiert, das Ablaufdatum enthält aus, und dieser Wert wird bei nachfolgenden Anforderungen nicht aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="ce332-205">Wenn die FormsAuthenticationModule feststellt, dass das Ticket abgelaufen ist, wird diese verworfen und behandelt die Anforderung als anonym.</span><span class="sxs-lookup"><span data-stu-id="ce332-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="ce332-206">[![Es ist eine Grafische Darstellung der SlidingExpiration für das Formularauthentifizierungsticket Ablauf bei "false"](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="ce332-207">**Abbildung 01**: Es ist eine Grafische Darstellung der SlidingExpiration für das Formularauthentifizierungsticket Ablauf bei "false" ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>

<span data-ttu-id="ce332-208">Abbildung 2 zeigt den Workflow aus, wenn SlidingExpiration festgelegt ist, auf "true" und Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="ce332-209">Wenn eine authentifizierte Anforderung, (mit einer Ticket nicht abgelaufene empfangen wird) wird der ablaufzeitperiode Timeouts Anzahl von Minuten in der Zukunft aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="ce332-210">[![Eine Grafische Darstellung der das Formularauthentifizierungsticket SlidingExpiration wird bei "true"](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="ce332-211">**Abbildung 02**: Eine Grafische Darstellung der das Formularauthentifizierungsticket SlidingExpiration wird bei "true" ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>

<span data-ttu-id="ce332-212">Wenn Sie cookiebasierte Authentifizierungstickets (Standard) zu verwenden, wird hier ein wenig verwirrender, da es sich bei Cookies auch ihre eigenen Cacheobjekte angegeben haben, können.</span><span class="sxs-lookup"><span data-stu-id="ce332-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="ce332-213">Ein Cookie Ablauf (oder deren Fehlen) weist den Browser auf, wenn das Cookie zerstört werden soll.</span><span class="sxs-lookup"><span data-stu-id="ce332-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="ce332-214">Wenn das Cookie nicht über ein Ablaufdatum verfügt, wird es zerstört, wenn der Browser geschlossen.</span><span class="sxs-lookup"><span data-stu-id="ce332-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="ce332-215">Wenn eine ablaufangabe vorhanden ist, jedoch das Cookie auf dem Computer des Benutzers gespeichert bleibt, bis das Datum und die in der Ablauf des angegebenen Zeit vergangen.</span><span class="sxs-lookup"><span data-stu-id="ce332-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="ce332-216">Wenn vom Browser ein Cookie zerstört wird, wird es nicht mehr an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="ce332-217">Aus diesem Grund ist die Zerstörung eines Cookies analog zu den Benutzer, die Abmeldung von der Website.</span><span class="sxs-lookup"><span data-stu-id="ce332-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-218">Natürlich kann ein Benutzer proaktiv alle Cookies auf ihrem Computer gespeicherten entfernen.</span><span class="sxs-lookup"><span data-stu-id="ce332-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="ce332-219">In Internet Explorer 7 würden Sie wechseln Sie zu Extras, Optionen, und klicken Sie auf die Schaltfläche "löschen" im Abschnitt Verlauf durchsuchen.</span><span class="sxs-lookup"><span data-stu-id="ce332-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="ce332-220">Klicken Sie dort auf die Schaltfläche zum Löschen von Cookies.</span><span class="sxs-lookup"><span data-stu-id="ce332-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="ce332-221">Das Forms-Authentifizierungssystem erstellt sitzungsbasierte oder Ablauf-basierten Cookies je nach Wert übergeben die *PersistCookie* Parameter.</span><span class="sxs-lookup"><span data-stu-id="ce332-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="ce332-222">Beachten Sie, mit denen Methoden für das FormsAuthentication-Klasse GetAuthCookie, SetAuthCookie und RedirectFromLoginPage in zwei Eingabeparameter: *Benutzername* und *PersistCookie*.</span><span class="sxs-lookup"><span data-stu-id="ce332-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="ce332-223">Die Anmeldeseite, die wir im vorherigen Tutorial erstellt haben, enthalten ein Anmeldedaten Kontrollkästchen, die bestimmt, ob ein persistentes Cookie erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="ce332-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="ce332-224">Dauerhafte Cookies sind Ablauf-basiert. nicht beständige Cookies sind sitzungsbasiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="ce332-225">Bereits vorgestellten Konzepte Timeout und SlidingExpiration gelten identisch für beide Sitzungen und Ablauf-basierende Cookies.</span><span class="sxs-lookup"><span data-stu-id="ce332-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="ce332-226">Es gibt nur einen kleinerer Unterschied bei der Ausführung: Verwendung von Cookies Ablauf-basierte mit SlidingTimeout auf "true" festgelegt ist, das Cookie des Ablauf wird nur aktualisiert, wenn mehr als die Hälfte der angegebenen Zeit abgelaufen.</span><span class="sxs-lookup"><span data-stu-id="ce332-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="ce332-227">Aktualisieren wir unsere Website, die Authentifizierungsrichtlinien Ticket Timeout, damit, das Timeout nach einer Stunde (60 Minuten), die mit einer gleitenden Ablaufzeit tickets.</span><span class="sxs-lookup"><span data-stu-id="ce332-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="ce332-228">Diese Änderung wirksam, aktualisieren Sie die Datei "Web.config" Hinzufügen einer &lt;Forms&gt; Element der &lt;Authentifizierung&gt; Element durch das folgende Markup:</span><span class="sxs-lookup"><span data-stu-id="ce332-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="ce332-229">Verwenden eine URL für die Anmeldeseite als "Login.aspx"</span><span class="sxs-lookup"><span data-stu-id="ce332-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="ce332-230">Da die FormsAuthenticationModule nicht autorisierte Benutzer automatisch zur Anmeldeseite umgeleitet wird, muss sie die Anmeldeseite-URL kennen.</span><span class="sxs-lookup"><span data-stu-id="ce332-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="ce332-231">Diese URL wird angegeben, durch das Attribut "LoginUrl" in der &lt;Forms&gt; Element und der Standardwert ist "Login.aspx".</span><span class="sxs-lookup"><span data-stu-id="ce332-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="ce332-232">Wenn Sie über eine vorhandene Website portieren, müssen Sie bereits eine Anmeldeseite mit einer anderen URL, eine möglicherweise, die bereits mit einem Lesezeichen versehen und von Suchmaschinen indiziert wurden.</span><span class="sxs-lookup"><span data-stu-id="ce332-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="ce332-233">Anstatt die vorhandene Anmeldeseite an "Login.aspx" umbenennen und wichtige Links und Lesezeichen, Benutzer, können Sie stattdessen das Attribut "LoginUrl", zeigen Sie auf der Anmeldeseite ändern.</span><span class="sxs-lookup"><span data-stu-id="ce332-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="ce332-234">Beispielsweise wenn Ihre Anmeldeseite SignIn.aspx benannt wurde, befand sich im Verzeichnis Benutzer Sie konnte zeigen die Konfigurationseinstellung LoginUrl ~/Users/SignIn.aspx wie folgt:</span><span class="sxs-lookup"><span data-stu-id="ce332-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="ce332-235">Da unsere aktuelle Anwendung bereits eine Anmeldeseite mit dem Namen "Login.aspx" aufweist, ist es nicht erforderlich, geben Sie einen benutzerdefinierten Wert in der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="ce332-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="ce332-236">Schritt 2: Verwenden von ohne Cookies Forms Authentifizierungstickets</span><span class="sxs-lookup"><span data-stu-id="ce332-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="ce332-237">Standardmäßig bestimmt der Forms-Authentifizierungssystem, ob die Authentifizierungstickets in der Auflistung der Cookies speichern oder Sie betten sie in der URL, die basierend auf der Website für den Benutzer-Agent.</span><span class="sxs-lookup"><span data-stu-id="ce332-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="ce332-238">Alle grundlegenden Desktopbrowser wie Cookies für Internet Explorer, Firefox, Opera und Safari unterstützt, aber nicht alle mobilen Geräte tun.</span><span class="sxs-lookup"><span data-stu-id="ce332-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="ce332-239">Die Cookierichtlinie, die vom System Forms-Authentifizierung verwendet, hängt von der ohne Cookies-Einstellung in der &lt;Forms&gt; -Element, das einen von vier Werten annehmen kann:</span><span class="sxs-lookup"><span data-stu-id="ce332-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="ce332-240">UseCookies - gibt an, dass cookiebasierte Authentifizierungstickets immer verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="ce332-241">UseUri - gibt an, dass Tickets von Cookie-basierte Authentifizierung nie verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="ce332-242">AutoErmittlung – Wenn das Geräteprofil Cookies, cookiebasierte Authentifizierungstickets nicht unterstützt wird, werden nicht verwendet. Wenn das Geräteprofil Cookies unterstützt, wird ein Überprüfungsmechanismus verwendet, um festzustellen, ob Cookies aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="ce332-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="ce332-243">UseDeviceProfile – der Standardwert; verwendet cookiebasierte Authentifizierungstickets, nur dann, wenn das Geräteprofil Cookies unterstützt.</span><span class="sxs-lookup"><span data-stu-id="ce332-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="ce332-244">Es wird keine Testmechanismus verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-244">No probing mechanism is used.</span></span>

<span data-ttu-id="ce332-245">Die Einstellungen automatisch erkennen und UseDeviceProfile basieren auf einer *Geräteprofil* in der Feststellung, ob cookiebasierte oder ohne Cookies Authentifizierungstickets verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="ce332-246">ASP.NET verwaltet eine Datenbank von verschiedenen Geräten und ihre Funktionen, wie z. B., ob sie Cookies unterstützen, welche Version von JavaScript, die sie unterstützen und So weiter.</span><span class="sxs-lookup"><span data-stu-id="ce332-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="ce332-247">Jedes Mal ein Gerät fordert eine Webseite von einem Webserver, er entlang sendet, einer *Benutzer-Agent* HTTP-Header, der den Gerätetyp identifiziert.</span><span class="sxs-lookup"><span data-stu-id="ce332-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="ce332-248">ASP.NET entspricht automatisch die bereitgestellten Benutzer-Agent-Zeichenfolge mit dem entsprechenden Profil in der Datenbank angegeben.</span><span class="sxs-lookup"><span data-stu-id="ce332-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-249">Diese Datenbank von Gerätefunktionen befindet sich in einer Reihe von XML-Dateien, die folgen, der [Browserdefinitionsdatei-Schema](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce332-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="ce332-250">Die Standard-Gerät Profildateien befinden sich in % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="ce332-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="ce332-251">Sie können auch benutzerdefinierte Dateien hinzufügen, Ihrer Anwendung App\_Ordner "Browser".</span><span class="sxs-lookup"><span data-stu-id="ce332-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="ce332-252">Weitere Informationen finden Sie unter [so wird's gemacht: Erkennen von Browsertypen in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce332-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="ce332-253">Da die Standardeinstellung UseDeviceProfile ist, werden ohne Cookies Formularauthentifizierungstickets verwendet werden, wenn die Website von einem Gerät zugegriffen wird, dessen Profil gibt an, dass es keine Cookies unterstützt.</span><span class="sxs-lookup"><span data-stu-id="ce332-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="ce332-254">Das Authentifizierungsticket in der URL-Codierung</span><span class="sxs-lookup"><span data-stu-id="ce332-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="ce332-255">Cookies sind eine natürliche Mittel zum Einfügen von Informationen über den Browser in jede Anforderung an einer bestimmten Website, die standardmäßigen Einstellungen für die Formularauthentifizierung Cookies verwenden, wenn die Website besucht Gerät unterstützt wird.</span><span class="sxs-lookup"><span data-stu-id="ce332-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="ce332-256">Wenn Cookies nicht unterstützt werden, muss eine alternative Möglichkeit für die Übergabe von des Authentifizierungstickets vom Client an den Server eingesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="ce332-257">Die Cookiedaten in der URL zu codieren ist eine häufig verwendete problemumgehung in Umgebungen mit ohne Cookies verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="ce332-258">Die beste Möglichkeit, um festzustellen, wie solche Informationen in der URL eingebettet werden kann ist den Standort ohne Cookies Authentifizierungstickets zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="ce332-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="ce332-259">Dies kann durch die ohne Cookies Konfigurationseinstellung auf UseUri erfolgen:</span><span class="sxs-lookup"><span data-stu-id="ce332-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="ce332-260">Nachdem Sie diese Änderung vorgenommen haben, besuchen Sie die Website über einen Browser ein.</span><span class="sxs-lookup"><span data-stu-id="ce332-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="ce332-261">Wenn als anonymer Benutzer besuchen, sieht die URLs, genau wie zuvor.</span><span class="sxs-lookup"><span data-stu-id="ce332-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="ce332-262">Beispielsweise zeigt Adressleiste des Browsers beim Besuch der Seite "default.aspx" die folgende URL:</span><span class="sxs-lookup"><span data-stu-id="ce332-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="ce332-263">Nach der Anmeldung wird das Formularauthentifizierungsticket jedoch in der URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="ce332-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="ce332-264">Z. B. nach dem Zugriff auf die Anmeldeseite und Anmeldung als Sam, ich bin zurückgegeben, auf der Seite "default.aspx", aber die URL dieses Mal ist:</span><span class="sxs-lookup"><span data-stu-id="ce332-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="ce332-265">Das Formularauthentifizierungsticket wurde in der URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="ce332-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="ce332-266">Die Zeichenfolge (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) stellt den Hexadezimal-codierten Informationen für das Formularauthentifizierungsticket aus, und sind die gleichen Daten, die in der Regel in einem Cookie gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="ce332-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="ce332-267">In der Reihenfolge für die Authentifizierung ohne Cookies Tickets arbeiten das System muss alle URLs auf der Seite enthält die Authentifizierungsticketdaten codieren, andernfalls das Authentifizierungsticket verloren klickt der Benutzer auf einen Link.</span><span class="sxs-lookup"><span data-stu-id="ce332-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="ce332-268">Glücklicherweise wird dieses einbetten Logik automatisch ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="ce332-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="ce332-269">Klicken Sie zum demonstrieren dieser Funktionalität, öffnen Sie die Seite "default.aspx", und fügen Sie ein HyperLink-Steuerelement, das bzw. die die Eigenschaften für Text und NavigateUrl Testlink und SomePage.aspx, festlegen.</span><span class="sxs-lookup"><span data-stu-id="ce332-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="ce332-270">Es spielt keine Rolle, dass es darüber gar keine Seite in Ihrem Projekt mit dem Namen SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="ce332-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="ce332-271">Speichern Sie die Änderungen an "default.aspx", und besuchen Sie es dann über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="ce332-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="ce332-272">Melden Sie sich an den Standort so, dass das Formularauthentifizierungsticket in der URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="ce332-273">Als Nächstes "default.aspx", klicken Sie auf den Link "testen"-Link.</span><span class="sxs-lookup"><span data-stu-id="ce332-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="ce332-274">Was ist passiert?</span><span class="sxs-lookup"><span data-stu-id="ce332-274">What happened?</span></span> <span data-ttu-id="ce332-275">Wenn keine Seite, die mit dem Namen SomePage.aspx vorhanden ist, klicken Sie dann einen 404-Fehler ist aufgetreten, aber nicht wichtig, hier ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="ce332-276">Konzentrieren Sie stattdessen auf der Adressleiste in Ihrem Browser.</span><span class="sxs-lookup"><span data-stu-id="ce332-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="ce332-277">Beachten Sie, dass sie in der URL das Formularauthentifizierungsticket enthält.</span><span class="sxs-lookup"><span data-stu-id="ce332-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="ce332-278">Die SomePage.aspx URL, unter dem Link automatisch in eine URL konvertiert wurde, der das Authentifizierungsticket - enthalten schon nicht jeglichen Code zu schreiben!</span><span class="sxs-lookup"><span data-stu-id="ce332-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="ce332-279">Das Authentifizierungsticket Formular automatisch eingebettet wird, in der URL für alle Links, die nicht mit beginnen `http://` oder `/`.</span><span class="sxs-lookup"><span data-stu-id="ce332-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="ce332-280">Es spielt keine Rolle, wenn der Link angezeigt, in einem Aufruf von Response.Redirect, in ein HyperLink-Steuerelement oder in ein HTML-Ankerelement wird (d. h. `<a href="...">...</a>`).</span><span class="sxs-lookup"><span data-stu-id="ce332-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="ce332-281">Solange die URL ist nicht, etwa `http://www.someserver.com/SomePage.aspx` oder `/SomePage.aspx`, das Formularauthentifizierungsticket eingebettet wird, für uns.</span><span class="sxs-lookup"><span data-stu-id="ce332-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-282">Ohne Cookies Formularauthentifizierungstickets befolgen die gleichen Timeout-Richtlinien als cookiebasierte Authentifizierungstickets.</span><span class="sxs-lookup"><span data-stu-id="ce332-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="ce332-283">Allerdings sind die Authentifizierung ohne Cookies Tickets anfälliger für Angriffe wiedergeben, da das Authentifizierungsticket direkt in der URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="ce332-284">Stellen Sie sich ein Benutzer, der eine Website aufruft, Anmeldung und fügt dann die URL in eine e-Mail an Kollegen.</span><span class="sxs-lookup"><span data-stu-id="ce332-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="ce332-285">Der Kollegen auf diesen Link klickt, bevor die Ablaufzeit erreicht wird, werden sie als Benutzer angemeldet sein, die die e-Mail-Adresse gesendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="ce332-286">Schritt 3: Sichern das Authentifizierungsticket</span><span class="sxs-lookup"><span data-stu-id="ce332-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="ce332-287">Das Formularauthentifizierungsticket wird über das Netzwerk übertragen entweder in einem Cookie oder direkt in der URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="ce332-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="ce332-288">Zusätzlich zu den Informationen zur Identität kann das Authentifizierungsticket auch Benutzerdaten enthalten, (wie in Schritt 4).</span><span class="sxs-lookup"><span data-stu-id="ce332-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="ce332-289">Daher ist es wichtig, dass das Ticket für die Daten verschlüsselt werden vor neugierigen Blicken und (noch wichtiger ist), kann das Authentifizierungssystem Forms garantieren, dass das Ticket nicht manipuliert wurde.</span><span class="sxs-lookup"><span data-stu-id="ce332-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="ce332-290">Um die Privatsphäre des Tickets zu gewährleisten, kann die Forms-Authentifizierungssystem die Ticketdaten verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="ce332-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="ce332-291">Fehler beim Verschlüsseln der Ticketdaten sendet potenziell vertraulichen Informationen über das Netzwerk im nur-Text.</span><span class="sxs-lookup"><span data-stu-id="ce332-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="ce332-292">Um ein Ticket für die Authentizität zu gewährleisten, muss das Authentifizierungssystem Forms *überprüfen* des Tickets.</span><span class="sxs-lookup"><span data-stu-id="ce332-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="ce332-293">Überprüfung wird der Vorgang, um sicherzustellen, dass ein bestimmtes Datenelement nicht geändert wurde, und es über erfolgt eine  *[message Authentication Code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="ce332-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="ce332-294">Kurz gesagt, ist der MAC ein kleiner Teil der Informationen, die die Daten zu, die identifizieren (in diesem Fall das Ticket) überprüft werden muss.</span><span class="sxs-lookup"><span data-stu-id="ce332-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="ce332-295">Wenn die von den MAC dargestellten Daten geändert werden, werden dann dem MAC und die Daten nicht übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="ce332-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="ce332-296">Darüber hinaus ist es rechnerisch schwer Hackern den Zugriff auf die Daten ändern, sowohl generieren eigene MAC, um die geänderten Daten entsprechen.</span><span class="sxs-lookup"><span data-stu-id="ce332-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="ce332-297">Beim Erstellen (oder ändern) ist ein Ticket, das Forms-Authentifizierungssystem erstellt einen MAC und auf das Ticket für die Daten angefügt.</span><span class="sxs-lookup"><span data-stu-id="ce332-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="ce332-298">Wenn eine nachfolgende Anforderung eingeht, vergleicht das Authentifizierungssystem Forms die Mac- und Ticket-Daten, um die Authentizität des Ticketdaten überprüft.</span><span class="sxs-lookup"><span data-stu-id="ce332-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="ce332-299">Abbildung 3 zeigt diesen Workflow grafisch an.</span><span class="sxs-lookup"><span data-stu-id="ce332-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="ce332-300">[![Das Ticket für die Authentizität wird über einen MAC sichergestellt.](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="ce332-301">**Abbildung 03**: Das Ticket für die Authentizität gewährleistet ist, über einen MAC ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>

<span data-ttu-id="ce332-302">Welche Sicherheitsmaßnahmen für das Authentifizierungsticket angewendet werden, hängt davon ab, der schutzeinstellung in der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="ce332-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="ce332-303">Die schutzeinstellung kann einen der folgenden drei Werte zugewiesen werden:</span><span class="sxs-lookup"><span data-stu-id="ce332-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="ce332-304">Alle – das Ticket ist verschlüsselt und digital signiert (Standard).</span><span class="sxs-lookup"><span data-stu-id="ce332-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="ce332-305">Verschlüsselung – nur Verschlüsselung angewendet wird – keine MAC wird generiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="ce332-306">None: das Ticket ist also weder verschlüsselt noch digital signiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="ce332-307">Überprüfung: einen MAC wird generiert, aber die Ticketdaten über das Netzwerk im nur-Text gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="ce332-308">Microsoft empfiehlt dringend, mit der alle Einstellung.</span><span class="sxs-lookup"><span data-stu-id="ce332-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="ce332-309">Festlegen der Validierung und Entschlüsselungsschlüssel</span><span class="sxs-lookup"><span data-stu-id="ce332-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="ce332-310">Die verschlüsselungs- und Hashalgorithmen, die von dem Authentifizierungssystem Forms verwendet werden, um zu verschlüsseln, und überprüfen das Authentifizierungsticket über anpassbare sind die [ &lt;MachineKey&gt; Element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in "Web.config". Tabelle 2 zeigt die &lt;MachineKey&gt; Attribute des Elements und ihren möglichen Werten.</span><span class="sxs-lookup"><span data-stu-id="ce332-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="ce332-311">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="ce332-311">**Attribute**</span></span> | <span data-ttu-id="ce332-312">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="ce332-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="ce332-313">Entschlüsselung</span><span class="sxs-lookup"><span data-stu-id="ce332-313">decryption</span></span> | <span data-ttu-id="ce332-314">Gibt den Algorithmus an, für die Verschlüsselung verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="ce332-315">Dieses Attribut kann einen der folgenden vier Werten aufweisen: - Auto - die Standardeinstellung; Bestimmt den Algorithmus basierend auf der Länge des DecryptionKey-Attributs.</span><span class="sxs-lookup"><span data-stu-id="ce332-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="ce332-316">-AES - verwendet die [erweiterte Verschlüsselung (Advanced Encryption Standard, AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="ce332-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="ce332-317">-DES - verwendet die [Standard DES (Data Encryption)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) dieser Algorithmus rechnerisch schwache gilt und sollte nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="ce332-318">-3DES - verwendet die [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) -Algorithmus, der durch Anwenden des DES-Algorithmus drei Mal funktioniert.</span><span class="sxs-lookup"><span data-stu-id="ce332-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="ce332-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="ce332-319">decryptionKey</span></span> | <span data-ttu-id="ce332-320">Der geheime Schlüssel, die von den Verschlüsselungsalgorithmus verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="ce332-321">Dieser Wert muss entweder eine hexadezimale Zeichenfolge die entsprechende Länge (basierend auf den Wert in der Entschlüsselung), automatisch generieren oder einer der Werte mit der Endung IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="ce332-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="ce332-322">Hinzufügen von IsolateApps weist ASP.NET einen eindeutigen Wert für jede Anwendung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="ce332-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="ce332-323">Der Standardwert ist AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="ce332-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="ce332-324">Überprüfung</span><span class="sxs-lookup"><span data-stu-id="ce332-324">validation</span></span> | <span data-ttu-id="ce332-325">Gibt an, der für die Validierung verwendeten Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="ce332-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="ce332-326">Dieses Attribut kann einen der folgenden vier Werten aufweisen: - AES - verwendet den Advanced Encryption Standard (AES)-Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="ce332-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="ce332-327">-MD5 - verwendet die [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="ce332-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="ce332-328">-SHA1 - verwendet die [SHA1](http://en.wikipedia.org/wiki/Sha1) Algorithmus (Standard).</span><span class="sxs-lookup"><span data-stu-id="ce332-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="ce332-329">-3DES - wird den Triple DES-Algorithmus verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="ce332-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="ce332-330">validationKey</span></span> | <span data-ttu-id="ce332-331">Der geheime Schlüssel, die von den Validierungsalgorithmus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="ce332-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="ce332-332">Dieser Wert muss entweder eine hexadezimale Zeichenfolge die entsprechende Länge (basierend auf den Wert in Überprüfung), automatisch generieren oder einer der Werte mit der Endung IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="ce332-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="ce332-333">Hinzufügen von IsolateApps weist ASP.NET einen eindeutigen Wert für jede Anwendung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="ce332-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="ce332-334">Der Standardwert ist AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="ce332-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="ce332-335">**Tabelle 2**: Die &lt;MachineKey&gt; Elementattribute</span><span class="sxs-lookup"><span data-stu-id="ce332-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="ce332-336">Eine ausführliche Beschreibung dieser Optionen Verschlüsselung und gültigkeitsprüfung, sowie die vor- und Nachteile der verschiedenen Algorithmen ist nicht Gegenstand dieses Tutorials.</span><span class="sxs-lookup"><span data-stu-id="ce332-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="ce332-337">Für eine ausführliche sehen Sie sich diese Probleme, einschließlich Anleitungen, welche Algorithmen für Verschlüsselung und gültigkeitsprüfung zu verwenden, welche Schlüssellängen und zu verwenden, und wie diese Schlüssel generiert haben, finden am besten *Professional ASP.NET 2.0 Security, Mitgliedschafts- und Rollenverwaltung* .</span><span class="sxs-lookup"><span data-stu-id="ce332-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="ce332-338">Klicken Sie in der Standardeinstellung die Schlüssel für die Verschlüsselung und gültigkeitsprüfung für jede Anwendung automatisch generiert werden, und diese Schlüssel werden in die lokale Sicherheitsinstanz (LSA) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="ce332-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="ce332-339">Kurz gesagt, garantieren die Standardeinstellungen für eindeutige Schlüssel für eine Web-Server-von-Web-Server und jede Anwendung durch.</span><span class="sxs-lookup"><span data-stu-id="ce332-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="ce332-340">Dieses Standardverhalten funktioniert daher nicht für die zwei folgenden Szenarien:</span><span class="sxs-lookup"><span data-stu-id="ce332-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="ce332-341">**Webfarmen** – in einem [Webfarm](http://en.wikipedia.org/wiki/Web_farm) Szenario einer Webanwendung auf mehreren Webservern für Zwecke der Skalierbarkeit und Redundanz gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="ce332-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="ce332-342">Jede eingehende Anforderung wird gesendet, auf einem Server in der Farm, was bedeutet, dass während der Lebensdauer der Sitzung eines Benutzers, unterschiedliche-Servern verwendet werden können, um seine verschiedenen Anforderungen zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="ce332-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="ce332-343">Daher jeden Server muss die gleichen Schlüssel für Verschlüsselung und gültigkeitsprüfung verwenden, sodass das Formularauthentifizierungsticket erstellt, verschlüsselt und überprüft auf einem Server entschlüsselt und überprüft Sie auf einem anderen Server in der Farm.</span><span class="sxs-lookup"><span data-stu-id="ce332-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="ce332-344">**Plattformübergreifende, Anwendungsfreigabe Ticket** – ein einziger Webserver kann mehrere ASP.NET-Anwendungen hosten.</span><span class="sxs-lookup"><span data-stu-id="ce332-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="ce332-345">Wenn Sie für diese verschiedenen Anwendungen ein einzelnes Formularauthentifizierungsticket gemeinsam nutzen müssen, ist es zwingend erforderlich, dass ihre Verschlüsselung und gültigkeitsprüfung Schlüssel übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="ce332-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="ce332-346">Bei der Arbeit in einer Webfarm festlegen oder das Freigeben von Authentifizierungstickets für Anwendungen auf demselben Server müssen Sie konfigurieren die &lt;MachineKey&gt; Element in der betroffenen Anwendungen, damit ihre DecryptionKey und ValidationKey Werte übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="ce332-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="ce332-347">Während keines der oben genannten Szenarien für unsere beispielanwendung gilt, können wir ValidationKey-Werte und explizite DecryptionKey angeben und definieren die Algorithmen, die verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="ce332-348">Hinzufügen einer &lt;MachineKey&gt; auf die Datei "Web.config" festlegen:</span><span class="sxs-lookup"><span data-stu-id="ce332-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="ce332-349">Weitere Informationen finden Sie [so wird's gemacht: Konfigurieren von MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce332-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-350">Die Werte für DecryptionKey und ValidationKey entnommen wurden [Steve Gibson](http://www.grc.com/stevegibson.htm)des [perfekte Kennwörter Webseite](https://www.grc.com/passwords.htm), generiert 64 zufällige Hexadezimalzeichen auf jeder Seite finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="ce332-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="ce332-351">Um die Wahrscheinlichkeit, dass dieser Schlüssel, sodass ihren Weg in Ihre Produktionsanwendungen zu verringern, sollten Sie sich, die obigen Schlüssel mit zufällig generierten Werten, die auf der perfekte Kennwörter zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="ce332-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="ce332-352">Schritt 4: Zusätzliche Benutzerdaten speichern in das Ticket</span><span class="sxs-lookup"><span data-stu-id="ce332-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="ce332-353">Viele Webanwendungen Anzeigen von Informationen zu, oder der Seite anzeigen als Grundlage für den derzeit angemeldeten Benutzer.</span><span class="sxs-lookup"><span data-stu-id="ce332-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="ce332-354">Beispielsweise kann eine Webseite angezeigt, den Benutzernamen und das Datum, die, das Sie zuletzt in der oberen Ecke von jeder Seite angemeldet haben, auf.</span><span class="sxs-lookup"><span data-stu-id="ce332-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="ce332-355">Das Formularauthentifizierungsticket gespeichert, den derzeit angemeldeten Benutzernamen des Benutzers muss, wenn alle anderen Informationen benötigt wird, die Seite aber im Benutzerspeicher – in der Regel eine Datenbank – suchen Sie die Informationen, die nicht in das Authentifizierungsticket gespeichert.</span><span class="sxs-lookup"><span data-stu-id="ce332-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="ce332-356">Mit nur wenigen Codezeilen können wir zusätzliche Informationen in das Formularauthentifizierungsticket speichern.</span><span class="sxs-lookup"><span data-stu-id="ce332-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="ce332-357">Solche Daten ausgedrückt werden können, über die [FormsAuthenticationTicket-Klasse](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)des [UserData-Eigenschaft](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce332-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="ce332-358">Dies ist nützlich zum Ablegen kleine Mengen von Informationen über den Benutzer zu platzieren, die im Allgemeinen benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="ce332-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="ce332-359">In der Eigenschaft ist als Bestandteil des Authentifizierungscookies Ticket und, wie die anderen Felder Ticket verschlüsselt und überprüft UserData angegebene Wert basierend auf der Forms-Authentifizierung Konfiguration des Systems.</span><span class="sxs-lookup"><span data-stu-id="ce332-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="ce332-360">Standardmäßig ist die UserData eine leere Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="ce332-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="ce332-361">Um die Benutzerdaten in das Authentifizierungsticket speichern zu können, müssen wir ein paar Codezeilen in die Anmeldeseite zu schreiben, die die benutzerspezifische Informationen erfasst und speichert sie in das Ticket.</span><span class="sxs-lookup"><span data-stu-id="ce332-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="ce332-362">Da UserData eine Eigenschaft vom Typzeichenfolge ist, müssen die darin gespeicherten Daten ordnungsgemäß als Zeichenfolge serialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="ce332-363">Angenommen Sie, dass unsere Speicher des Benutzers, das Geburtsdatum des Benutzers und den Namen des Arbeitgebers enthalten, und wir diese zwei Eigenschaftswerte in das Authentifizierungsticket speichern möchten.</span><span class="sxs-lookup"><span data-stu-id="ce332-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="ce332-364">Wir konnten diese Werte in eine Zeichenfolge serialisiert werden durch die Verkettung des Benutzers Datum Geburtsdatum der Zeichenfolge durch einen senkrechten Strich (|), gefolgt vom Arbeitgeber-Namen.</span><span class="sxs-lookup"><span data-stu-id="ce332-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="ce332-365">Damit ein Benutzer auf 15 August 1974 geborenen, der für Northwind Traders ist, würden wir der UserData-Eigenschaft die Zeichenfolge zuweisen: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="ce332-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="ce332-366">Wenn wir die Daten in das Ticket zugreifen müssen, können wir dazu die aktuelle Anforderung FormsAuthenticationTicket abrufen und Deserialisieren der UserData-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="ce332-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="ce332-367">Bei das Datum der Geburtsdatum und Arbeitgeber Beispielname würden wir die UserData-Zeichenfolge in beiden Teilzeichenfolgen, die auf Grundlage des Trennzeichens (|) aufgeteilt.</span><span class="sxs-lookup"><span data-stu-id="ce332-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="ce332-368">[![Zusätzliche Informationen kann in das Authentifizierungsticket gespeichert werden](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="ce332-369">**Abbildung 04**: Zusätzliche Benutzer Daten gespeichert werden können in das Authentifizierungsticket ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="ce332-370">Schreiben von Informationen in UserData</span><span class="sxs-lookup"><span data-stu-id="ce332-370">Writing Information to UserData</span></span>

<span data-ttu-id="ce332-371">Leider ist es nicht so einfach, wie zu erwarten wäre, die ein Formularauthentifizierungsticket benutzerspezifische Informationen hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="ce332-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="ce332-372">Die Eigenschaft "UserData" der FormsAuthenticationTicket-Klasse ist schreibgeschützt und kann nur über den Klassenkonstruktor FormsAuthenticationTicket angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="ce332-373">Wenn Sie die UserData-Eigenschaft im Konstruktor angeben, wir müssen auch angeben, das Ticket ist, andere Werte: den Benutzernamen, das Datum, Ablauf und So weiter.</span><span class="sxs-lookup"><span data-stu-id="ce332-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="ce332-374">Wenn wir die Anmeldeseite im vorherigen Tutorial erstellt haben, wurde dies alle uns durch die FormsAuthentication-Klasse behandelt.</span><span class="sxs-lookup"><span data-stu-id="ce332-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="ce332-375">Wenn UserData FormsAuthenticationTicket hinzufügen, müssen wir Code schreiben, um den Großteil der Funktionen, die bereits von der FormsAuthentication-Klasse bereitgestellte replizieren.</span><span class="sxs-lookup"><span data-stu-id="ce332-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="ce332-376">Sehen wir uns den erforderlichen Code für die Arbeit mit UserData durch Aktualisieren der Seite "Login.aspx", um zusätzliche Informationen über den Benutzer an das Authentifizierungsticket aufzuzeichnen.</span><span class="sxs-lookup"><span data-stu-id="ce332-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="ce332-377">Nehmen Sie, dass unsere Benutzerspeicher enthält Informationen über das Unternehmen, die für die der Benutzer arbeitet und deren Position und, dass wir diese Informationen in das Authentifizierungsticket erfassen möchten.</span><span class="sxs-lookup"><span data-stu-id="ce332-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="ce332-378">Aktualisieren Sie der Seite "Login.aspx" LoginButton Click-Ereignishandler, sodass der Code wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="ce332-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="ce332-379">Gehen wir Codezeile zu einem Zeitpunkt.</span><span class="sxs-lookup"><span data-stu-id="ce332-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="ce332-380">Die Methode beginnt, durch die Definition von vier Zeichenfolgenarrays: Benutzer, Kennwörter, CompanyName und TitleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="ce332-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="ce332-381">Diese Arrays enthalten den Benutzernamen, Kennwörter, Firmennamen und Titel für die Benutzerkonten im System, der es sind drei: Scott Jisun und Sam.</span><span class="sxs-lookup"><span data-stu-id="ce332-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="ce332-382">In einer echten Anwendung würden diese Werte aus dem Benutzerspeicher, nicht hartcodiert im Quellcode der Seite abgefragt werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="ce332-383">Im vorherigen Tutorial Wenn die angegebenen Anmeldeinformationen gültig sind aufgerufen wir einfach FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), die die folgenden Schritte ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="ce332-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="ce332-384">Erstellt die Forms-Authentifizierungsticket</span><span class="sxs-lookup"><span data-stu-id="ce332-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="ce332-385">Das Ticket in der entsprechenden Speicher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="ce332-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="ce332-386">Für Cookies basierende Authentifizierungstickets wird die Auflistung der Cookies im Browser auf die verwendet. für die Authentifizierung ohne Cookies Tickets werden die Ticketdaten in der URL serialisiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="ce332-387">Den Benutzer umgeleitet auf die entsprechende Seite</span><span class="sxs-lookup"><span data-stu-id="ce332-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="ce332-388">Diese Schritte werden im obigen Code repliziert.</span><span class="sxs-lookup"><span data-stu-id="ce332-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="ce332-389">Zunächst wird die Zeichenfolge, die wir schließlich in der UserData-Eigenschaft gespeichert wird gebildet, durch die Kombination der Unternehmensname und den vollständigen Titel, begrenzen die beiden Werte mit einem senkrechten Strich (|).</span><span class="sxs-lookup"><span data-stu-id="ce332-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="ce332-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="ce332-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="ce332-391">Als Nächstes die FormsAuthentication.GetAuthCookie Methode aufgerufen wird, der das Authentifizierungsticket erstellt, verschlüsselt gemäß den Konfigurationseinstellungen überprüft und platziert sie in einem HttpCookie-Objekt.</span><span class="sxs-lookup"><span data-stu-id="ce332-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="ce332-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="ce332-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="ce332-393">Um mit der in das Cookie eingebettet FormAuthenticationTicket arbeiten, müssen wir die FormAuthentication-Klasse aufrufen, [entschlüsseln Methode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), und übergeben Sie den Cookiewert.</span><span class="sxs-lookup"><span data-stu-id="ce332-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="ce332-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="ce332-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="ce332-395">Anschließend erstellen wir eine *neue* FormsAuthenticationTicket-Instanz auf Grundlage der vorhandenen FormsAuthenticationTicket-Werte.</span><span class="sxs-lookup"><span data-stu-id="ce332-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="ce332-396">Dieses neue Ticket enthält jedoch die benutzerspezifische Informationen (UserDataString).</span><span class="sxs-lookup"><span data-stu-id="ce332-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="ce332-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="ce332-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="ce332-398">Wir dann verschlüsseln (und überprüfen) die neue FormsAuthenticationTicket-Instanz durch Aufrufen der [verschlüsseln Methode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), und fügen Sie diese Daten verschlüsselten (und überprüften) zurück in AuthCookie.</span><span class="sxs-lookup"><span data-stu-id="ce332-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="ce332-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="ce332-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="ce332-400">Klicken Sie abschließend AuthCookie der Response.Cookies-Auflistung hinzugefügt wird, und die GetRedirectUrl-Methode wird aufgerufen, um zu bestimmen, die entsprechende Seite, um den Benutzer zu senden.</span><span class="sxs-lookup"><span data-stu-id="ce332-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="ce332-401">All dieser Code ist erforderlich, da die UserData-Eigenschaft ist schreibgeschützt, und die FormsAuthentication-Klasse stellt Methoden zum Angeben von UserData-Informationen in den Methoden GetAuthCookie SetAuthCookie oder RedirectFromLoginPage nicht bereit.</span><span class="sxs-lookup"><span data-stu-id="ce332-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-402">Der Code, den wir gerade untersucht speichert benutzerspezifische Informationen in einem Ticket Cookies basierende Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="ce332-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="ce332-403">Die Klassen, die zum Serialisieren von Formularauthentifizierungstickets an die URL sind für das .NET Framework intern.</span><span class="sxs-lookup"><span data-stu-id="ce332-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="ce332-404">Lange Rede kurzer, können nicht Sie Benutzerdaten in einer ohne Cookies Formularauthentifizierungsticket speichern.</span><span class="sxs-lookup"><span data-stu-id="ce332-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="ce332-405">Zugreifen auf die UserData-Informationen</span><span class="sxs-lookup"><span data-stu-id="ce332-405">Accessing the UserData Information</span></span>

<span data-ttu-id="ce332-406">An diesem Punkt Unternehmensname und den Titel jedes Benutzers in das Formularauthentifizierungsticket UserData Eigenschaft gespeichert, wenn er sich anmeldet.</span><span class="sxs-lookup"><span data-stu-id="ce332-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="ce332-407">Diese Informationen kann über das Authentifizierungsticket auf einer beliebigen Seite zugegriffen werden, ohne dass eine Reise zu den Speicher des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="ce332-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="ce332-408">Aktualisieren Sie zur Veranschaulichung, wie diese Informationen aus der UserData-Eigenschaft abgerufen werden kann, lassen Sie uns "default.aspx", sodass eine Begrüßung enthält, nicht nur den Namen des Benutzers, aber auch das Unternehmen, die für die Zusammenarbeit und deren Position.</span><span class="sxs-lookup"><span data-stu-id="ce332-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="ce332-409">"Default.aspx" wird derzeit ein AuthenticatedMessagePanel-Bereich mit einem Bezeichnungssteuerelement, das mit dem Namen WelcomeBackMessage enthält.</span><span class="sxs-lookup"><span data-stu-id="ce332-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="ce332-410">In diesem Bereich wird nur für authentifizierte Benutzer angezeigt.</span><span class="sxs-lookup"><span data-stu-id="ce332-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="ce332-411">Aktualisieren Sie den Code in die Seite "default.aspx" des\_Ereignishandler zum Laden, damit sie wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="ce332-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="ce332-412">Wenn Request.IsAuthenticated "true ist", dann die WelcomeBackMessages Text-Eigenschaft zunächst auf Willkommen zurück, *Benutzername*.</span><span class="sxs-lookup"><span data-stu-id="ce332-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="ce332-413">Klicken Sie dann wird die User.Identity-Eigenschaft auf ein FormsIdentity-Objekt umgewandelt, damit wir den zugrunde liegenden FormsAuthenticationTicket zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="ce332-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="ce332-414">Sobald wir FormsAuthenticationTicket haben, Deserialisieren wir die UserData-Eigenschaft in den Firmennamen und den Titel an.</span><span class="sxs-lookup"><span data-stu-id="ce332-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="ce332-415">Dies erfolgt durch Teilen der Zeichenfolge in einen senkrechten Strich.</span><span class="sxs-lookup"><span data-stu-id="ce332-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="ce332-416">Der Firmenname und Titel werden dann in die WelcomeBackMessage Bezeichnung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="ce332-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="ce332-417">Abbildung 5 zeigt einen Screenshot der diese Anzeige in Aktion.</span><span class="sxs-lookup"><span data-stu-id="ce332-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="ce332-418">Anmeldung als Scott in einer Meldung Willkommen zurück, die Unternehmen und Titel von Scott enthält.</span><span class="sxs-lookup"><span data-stu-id="ce332-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="ce332-419">[![Der derzeit angemeldeten Benutzer des Unternehmens und Titel werden angezeigt.](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="ce332-420">**Abbildung 05**: Der derzeit angemeldeten Benutzer des Unternehmens und Titel angezeigt werden ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-421">Das Authentifizierungsticket UserData-Eigenschaft dient als Cache für den Speicher des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="ce332-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="ce332-422">Z. B. einen Cache muss sie aktualisiert werden, wenn die zugrunde liegenden Daten geändert werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="ce332-423">Ist eine Webseite, in der Benutzer ihre Profile aktualisieren können, müssen z. B. die Felder, die zwischengespeichert werden, in der UserData-Eigenschaft aktualisiert werden, die vom Benutzer vorgenommene Änderungen widerzuspiegeln.</span><span class="sxs-lookup"><span data-stu-id="ce332-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="ce332-424">Schritt 5: Verwenden eines benutzerdefinierten Prinzipals</span><span class="sxs-lookup"><span data-stu-id="ce332-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="ce332-425">Versucht, jede eingehende Anforderung die FormsAuthenticationModule zum Authentifizieren des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="ce332-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="ce332-426">Wenn ein nicht abgelaufene Authentifizierungsticket vorhanden ist, weist der FormsAuthenticationModule die HttpContext.User-Eigenschaft auf ein neues GenericPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="ce332-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="ce332-427">Diese GenericPrincipal-Objekt verfügt über eine Identität vom Typ FormsIdentity, die einen Verweis auf das Formularauthentifizierungsticket enthält.</span><span class="sxs-lookup"><span data-stu-id="ce332-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="ce332-428">GenericPrincipal-Klasse enthält, der bare Mindestfunktionalität, die von einer Klasse, die IPrincipal implementiert benötigt werden – sie muss lediglich eine Identity-Eigenschaft und eine "IsInRole"-Methode.</span><span class="sxs-lookup"><span data-stu-id="ce332-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="ce332-429">Das Prinzipalobjekt hat zwei Aufgaben: welche Rollen gibt an, der Benutzer angehört, und die Identitätsinformationen zu bieten.</span><span class="sxs-lookup"><span data-stu-id="ce332-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="ce332-430">Dies erfolgt über die IPrincipal-Schnittstelle "IsInRole" (*RoleName*)-Methode und die Identity-Eigenschaft bzw.</span><span class="sxs-lookup"><span data-stu-id="ce332-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="ce332-431">GenericPrincipal-Klasse ermöglicht ein Zeichenfolgenarray mit Rollennamen, aus denen über seinen Konstruktor angegeben werden. die "IsInRole" (*RoleName*)-Methode lediglich überprüft, ob das übergebene in *RoleName* innerhalb der Zeichenfolgen-Array vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="ce332-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="ce332-432">Wenn die FormsAuthenticationModule GenericPrincipal erstellt, übergibt sie an GenericPrincipals-Konstruktor in ein leeres Zeichenfolgenarray.</span><span class="sxs-lookup"><span data-stu-id="ce332-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="ce332-433">Daher wird jeder Aufruf von "IsInRole" immer "false" zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="ce332-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="ce332-434">GenericPrincipal-Klasse erfüllt die Anforderungen für die meisten Szenarien des Forms-Authentifizierung, in denen Rollen nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="ce332-435">Für diese Fälle, in denen die Standardbehandlung für die Rolle nicht ausreichend ist, oder wenn Sie ein benutzerdefiniertes IIdentity-Objekt mit dem Benutzer zuordnen möchten, erstellen Sie ein benutzerdefiniertes IPrincipal-Objekt während des Workflows für die Authentifizierung und die HttpContext.User-Eigenschaft zuweisen.</span><span class="sxs-lookup"><span data-stu-id="ce332-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-436">Wie wir in Zukunft Tutorials, sehen beim ASP. NET Rollen-Framework ist aktiviert. er erstellt ein benutzerdefiniertes principal-Objekt des Typs [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) und überschreibt die Forms-Authentifizierung erstellten GenericPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="ce332-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="ce332-437">Dies wird zum Anpassen des Prinzipals "IsInRole"-Methode für die Kommunikation mit dem Rollen-Framework-API.</span><span class="sxs-lookup"><span data-stu-id="ce332-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="ce332-438">Da wir nicht selbst mit Rollen noch befasst haben, wäre der einzige Grund für das Erstellen von einem benutzerdefinierten Prinzipal an diesem Punkt müsste eine benutzerdefinierte IIdentity-Objekte, die dem Prinzipal verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="ce332-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="ce332-439">In Schritt 4 erläutert Speichern von zusätzlichen Benutzerinformationen in das Authentifizierungsticket UserData-Eigenschaft, insbesondere bei den Namen des Benutzers Unternehmen und deren Position.</span><span class="sxs-lookup"><span data-stu-id="ce332-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="ce332-440">Die UserData-Informationen ist jedoch nur Zugriff über das Authentifizierungsticket und nur dann als Zeichenfolge serialisiert, was bedeutet, dass jedes Mal, wenn wir die Benutzerinformationen im Ticket gespeichert werden soll, wir beim Analysieren der UserData-Eigenschaft müssen.</span><span class="sxs-lookup"><span data-stu-id="ce332-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="ce332-441">Wir verbessern die entwicklererfahrung durch Erstellen einer Klasse, die IIdentity implementiert und CompanyName "und" Title "enthält.</span><span class="sxs-lookup"><span data-stu-id="ce332-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="ce332-442">Auf diese Weise ein Entwickler kann Unternehmensname des aktuell angemeldeten Benutzers zugreifen und Titel direkt über die Eigenschaften "CompanyName" und "Title" ohne erforderlich sind, wissen, wie Sie die UserData-Eigenschaft zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="ce332-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="ce332-443">Erstellen von benutzerdefinierten Identitäts- und Prinzipalklassen</span><span class="sxs-lookup"><span data-stu-id="ce332-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="ce332-444">In diesem Tutorial erstellen Sie lassen Sie uns die benutzerdefinierten Objekte für Haupt- und Identitätsobjekte, in der App\_Ordner "Code".</span><span class="sxs-lookup"><span data-stu-id="ce332-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="ce332-445">Hinzufügen einer App zunächst\_Ordner zu Ihrem Projekt Code – mit der rechten Maustaste auf den Projektnamen im Projektmappen-Explorer, wählen Sie die Option ASP.NET-Ordner hinzufügen, und wählen Sie eine App\_Code.</span><span class="sxs-lookup"><span data-stu-id="ce332-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="ce332-446">Die App\_Ordner "Code" ist ein spezieller ASP.NET-Ordner, der enthält Dateien spezifisch für die Website.</span><span class="sxs-lookup"><span data-stu-id="ce332-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="ce332-447">Die App\_Ordner "Code" sollte nur verwendet werden, wenn Sie Ihrem Projekt über das Website-Modell zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="ce332-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="ce332-448">Bei Verwendung der [Webanwendungsprojekt-Modell](https://msdn.microsoft.com/asp.net/Aa336618.aspx), erstellen Sie einen standard-Ordner, und fügen Sie der Klassen hinzu, die.</span><span class="sxs-lookup"><span data-stu-id="ce332-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="ce332-449">Sie können z. B. Fügen Sie einen neuen Ordner namens Klassen hinzu und legen Ihren Code dort.</span><span class="sxs-lookup"><span data-stu-id="ce332-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="ce332-450">Fügen Sie zwei neue Klassendateien für die App\_Ordner "Code", eine benannte CustomIdentity.cs und eine mit dem Namen CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="ce332-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>

<span data-ttu-id="ce332-451">[![Hinzufügen von der CustomIdentity und CustomPrincipal-Klassen zu Ihrem Projekt](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="ce332-452">**Abbildung 06**: Hinzufügen von der CustomIdentity und CustomPrincipal-Klassen in Ihr Projekt ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>

<span data-ttu-id="ce332-453">Der CustomIdentity-Klasse ist verantwortlich für die Implementierung der IIdentity-Schnittstelle, die die AuthenticationType IsAuthenticated und Name-Eigenschaften definiert.</span><span class="sxs-lookup"><span data-stu-id="ce332-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="ce332-454">Zusätzlich zu diesen erforderlichen Eigenschaften interessieren uns die zugrunde liegenden Formularauthentifizierungsticket als auch Eigenschaften für Unternehmensname und den Titel des Benutzers verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="ce332-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="ce332-455">Geben Sie den folgenden Code aus, in der CustomIdentity-Klasse.</span><span class="sxs-lookup"><span data-stu-id="ce332-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="ce332-456">Beachten Sie, dass die Klasse eine FormsAuthenticationTicket-Membervariable enthält (\_Ticket) und die diesem Ticketinformationen muss durch den Konstruktor bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="ce332-457">Dieses Ticketdaten werden in das Zurückgeben der Identität des Namens verwendet. Die UserData-Eigenschaft wird analysiert, um die Werte für die CompanyName "und" Title "zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="ce332-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="ce332-458">Erstellen Sie als Nächstes die CustomPrincipal-Klasse.</span><span class="sxs-lookup"><span data-stu-id="ce332-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="ce332-459">Da wir nicht mit Rollen an diesem Punkt sind, akzeptiert der Konstruktor der CustomPrincipal-Klasse nur ein CustomIdentity-Objekt; die "IsInRole"-Methode gibt immer "false" zurück.</span><span class="sxs-lookup"><span data-stu-id="ce332-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="ce332-460">Sicherheitskontext für die eingehende Anforderung ein CustomPrincipal-Objekt zugewiesen</span><span class="sxs-lookup"><span data-stu-id="ce332-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="ce332-461">Wir haben jetzt eine Klasse, die IIdentity-Standardspezifikation CompanyName "und" Title "Einbeziehung erweitert, als auch eine benutzerdefinierte Prinzipalklasse, die die benutzerdefinierte Identität verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="ce332-462">Wir können mit Schritt in der ASP.NET-Pipeline und Sicherheitskontext für die eingehende Anforderung unsere benutzerdefinierte Prinzipalobjekt zuweisen.</span><span class="sxs-lookup"><span data-stu-id="ce332-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="ce332-463">Die ASP.NET-Pipeline eine eingehende Anforderung akzeptiert und verarbeitet diese durch eine Reihe von Schritten.</span><span class="sxs-lookup"><span data-stu-id="ce332-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="ce332-464">Bei jedem Schritt wird ein bestimmtes Ereignis ausgelöst, wodurch Entwickler profitieren von der ASP.NET-Pipeline und ändern Sie die Anforderung an bestimmten Punkten im Lebenszyklus.</span><span class="sxs-lookup"><span data-stu-id="ce332-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="ce332-465">Die FormsAuthenticationModule wartet z. B. ASP.NET zum Auslösen der [AuthenticateRequest-Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), an diesem Punkt die eingehende Anforderung für ein Authentifizierungsticket überprüft.</span><span class="sxs-lookup"><span data-stu-id="ce332-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="ce332-466">Wenn ein Authentifizierungsticket gefunden wird, wird ein GenericPrincipal-Objekt erstellt und die HttpContext.User-Eigenschaft zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="ce332-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="ce332-467">Nach dem das AuthenticateRequest-Ereignis, löst die ASP.NET-Pipeline die [PostAuthenticateRequest-Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), ist, in dem wir das GenericPrincipal-Objekt, das von der FormsAuthenticationModule mit einer Instanz von erstellt ersetzen können unsere CustomPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="ce332-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="ce332-468">Abbildung 7 zeigt diesen Workflow.</span><span class="sxs-lookup"><span data-stu-id="ce332-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="ce332-469">[![GenericPrincipal wird durch eine CustomPrincipal im Ereignis PostAuthenticationRequest ersetzt.](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="ce332-470">**Abbildung 07**: GenericPrincipal wird durch eine CustomPrincipal im Ereignis PostAuthenticationRequest ersetzt ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>

<span data-ttu-id="ce332-471">Um Code als Reaktion auf eine Pipelineereignis von ASP.NET ausführen, können wir entweder den passenden Ereignishandler in "Global.asax" oder erstellen eigene HTTP-Modul.</span><span class="sxs-lookup"><span data-stu-id="ce332-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="ce332-472">In diesem Tutorial erstellen Sie den Ereignishandler wir in "Global.asax".</span><span class="sxs-lookup"><span data-stu-id="ce332-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="ce332-473">Starten Sie durch das Hinzufügen von "Global.asax" zu Ihrer Website.</span><span class="sxs-lookup"><span data-stu-id="ce332-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="ce332-474">Mit der rechten Maustaste auf den Projektnamen im Projektmappen-Explorer, und fügen Sie ein Element vom Typ globale Anwendungsklasse mit dem Namen "Global.asax" hinzu.</span><span class="sxs-lookup"><span data-stu-id="ce332-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="ce332-475">[![Fügen Sie eine Datei "Global.asax" zu Ihrer Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="ce332-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="ce332-476">**Abbildung 08**: Hinzufügen einer Global.asax-Datei auf Ihrer Website ([klicken Sie, um das Bild in voller Größe anzeigen](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="ce332-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>

<span data-ttu-id="ce332-477">Die Standardvorlage für die "Global.asax" enthält die Ereignishandler für eine Reihe von ASP.NET-Pipelineereignisse, einschließlich der Start, Ende und [Fehlerereignis](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), u. a.</span><span class="sxs-lookup"><span data-stu-id="ce332-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="ce332-478">Diese Ereignishandler entfernt werden, da wir nicht für diese Anwendung benötigt werden können.</span><span class="sxs-lookup"><span data-stu-id="ce332-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="ce332-479">Das Ereignis, dem wir interessiert sind, ist PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="ce332-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="ce332-480">Aktualisieren Sie die Datei "Global.asax" aus, damit dessen Markup sieht etwa wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="ce332-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="ce332-481">Die Anwendung\_OnPostAuthenticateRequest-Methode führt jedes Mal die ASP.NET-Laufzeit löst das PostAuthenticateRequest-Ereignis, das einmal für jede eingehende Seitenanforderung durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="ce332-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="ce332-482">Der Ereignishandler wird gestartet, indem überprüft wird, wenn der Benutzer authentifiziert wird und über Formularauthentifizierung authentifiziert wurde.</span><span class="sxs-lookup"><span data-stu-id="ce332-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="ce332-483">Wenn dies der Fall ist, wird ein neues CustomIdentity-Objekt erstellt und die aktuelle Anforderung Authentifizierungsticket in seinem Konstruktor übergeben.</span><span class="sxs-lookup"><span data-stu-id="ce332-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="ce332-484">Danach wird ein CustomPrincipal-Objekt erstellt und übergeben den gerade erstellten CustomIdentity-Objekt in seinem Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="ce332-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="ce332-485">Schließlich wird der Sicherheitskontext für die aktuelle Anforderung auf das neu erstellte CustomPrincipal-Objekt zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="ce332-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="ce332-486">Beachten Sie, dass der letzte Schritt - Sicherheitskontext der Anforderung das CustomPrincipal-Objekt zugeordnet: den Prinzipal auf zwei Eigenschaften zugewiesen: HttpContext.User und Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="ce332-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="ce332-487">Diese beiden Zuweisungen sind erforderlich, aufgrund der Art und Weise, die Sicherheitskontexten, die in ASP.NET verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="ce332-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="ce332-488">.NET Framework ordnet jeden ausgeführten Thread einen Sicherheitskontext; Diese Informationen sind verfügbar, als ein IPrincipal-Objekt, durch die [Threadobjekt](https://msdn.microsoft.com/library/system.threading.thread.aspx)des [CurrentPrincipal-Eigenschaft](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="ce332-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="ce332-489">Was ist eine verwirrend ist, dass ASP.NET einen eigenen Sicherheitskontextinformationen (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="ce332-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="ce332-490">In bestimmten Szenarien wird die Eigenschaft "Thread.CurrentPrincipal" untersucht, wenn den Sicherheitskontext bestimmt; in anderen Szenarien wird die HttpContext.User verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="ce332-491">Z. B. es wurden Sicherheitsfunktionen in .NET, mit denen Entwickler deklarativ angeben, welche Benutzer oder Rollen können eine Klasse instanziieren oder bestimmte Methoden aufrufen (finden Sie unter [Autorisierungsregeln hinzufügen, Business und Daten mithilfe von Ebenen PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="ce332-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="ce332-492">Im Hintergrund bestimmen diese deklarative Verfahren den Sicherheitskontext, über die Eigenschaft "Thread.CurrentPrincipal".</span><span class="sxs-lookup"><span data-stu-id="ce332-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="ce332-493">In anderen Szenarien wird die HttpContext.User-Eigenschaft verwendet.</span><span class="sxs-lookup"><span data-stu-id="ce332-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="ce332-494">Zum Beispiel im vorherigen Tutorial haben wir verwendet diese Eigenschaft den derzeit angemeldeten Benutzernamen des Benutzers angezeigt.</span><span class="sxs-lookup"><span data-stu-id="ce332-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="ce332-495">Klicken Sie dann, es ist zwingend erforderlich, dass die Sicherheitskontextinformationen in den Eigenschaften Thread.CurrentPrincipal und HttpContext.User übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="ce332-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="ce332-496">Die ASP.NET-Laufzeit synchronisiert diese Eigenschaftswerte automatisch für uns.</span><span class="sxs-lookup"><span data-stu-id="ce332-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="ce332-497">Aber diese Synchronisierung tritt ein, nachdem das AuthenticateRequest-Ereignis, aber *vor* das PostAuthenticateRequest-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="ce332-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="ce332-498">Daher beim Hinzufügen von eines benutzerdefinierten Prinzipals im PostAuthenticateRequest-Ereignis müssen wir bestimmte sonst Thread.CurrentPrincipal der Thread.CurrentPrincipal manuell zugewiesen werden, und HttpContext.User wird nicht mehr synchron. Finden Sie unter [Context.User Visual Studio. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) für eine ausführlichere Erläuterung zu diesem Problem.</span><span class="sxs-lookup"><span data-stu-id="ce332-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="ce332-499">Zugreifen auf die CompanyName und Eigenschaften</span><span class="sxs-lookup"><span data-stu-id="ce332-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="ce332-500">Jedes Mal, wenn eine Anforderung eingeht und wird an die ASP.NET-Engine, die Anwendung gesendet\_OnPostAuthenticateRequest-Ereignishandler in "Global.asax" wird ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="ce332-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="ce332-501">Wenn die Anforderung von der FormsAuthenticationModule erfolgreich authentifiziert wurde, erstellt der Ereignishandler ein neues CustomPrincipal-Objekt mit einem CustomIdentity-Objekt, das basierend auf das Formularauthentifizierungsticket.</span><span class="sxs-lookup"><span data-stu-id="ce332-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="ce332-502">Mit dieser Logik vorhanden ist erfolgt der Zugriff auf Informationen zu den Firmennamen und den Titel des aktuell angemeldeten Benutzers unglaublich einfach.</span><span class="sxs-lookup"><span data-stu-id="ce332-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="ce332-503">Kehren Sie zur Seite\_Load-Ereignishandler in "default.aspx", in dem in Schritt 4 wir Code zum Abrufen des Authentifizierungstickets Formular und analysieren die UserData-Eigenschaft schrieb, um Unternehmensname und den Titel des Benutzers anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="ce332-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="ce332-504">Mit den CustomPrincipal und CustomIdentity-Objekten in jetzt verwenden ist es nicht erforderlich, die Werte aus UserData-Eigenschaft des Tickets zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="ce332-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="ce332-505">Rufen Sie stattdessen einfach einen Verweis auf das CustomIdentity-Objekt und verwenden Sie ihre Eigenschaften CompanyName "und" Title:</span><span class="sxs-lookup"><span data-stu-id="ce332-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="ce332-506">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="ce332-506">Summary</span></span>

<span data-ttu-id="ce332-507">In diesem Tutorial untersucht es die Forms Authentication Standardeinstellungen des Systems über "Web.config" anpassen. Erläutert, wie das Authentifizierungsticket Ablauf erfolgt und wie die Verschlüsselung und gültigkeitsprüfung Schutzvorrichtungen verwendet werden, um das Ticket vor Überprüfung und Änderung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="ce332-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="ce332-508">Abschließend wird erläutert, mit das Authentifizierungsticket UserData-Eigenschaft zum Speichern von zusätzlichen Benutzerinformationen in das Ticket selbst und wie Sie benutzerdefinierte Haupt- und Identitätsobjekte-Objekte verwenden, um diese Informationen auf Entwickler Benutzerfreundlicher Weise verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="ce332-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="ce332-509">Dieses Lernprogramm schließt unserer Untersuchung der Formularauthentifizierung in ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ce332-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="ce332-510">Im nächste Tutorial wird die unserem Weg in das mitgliedschaftsframework gestartet.</span><span class="sxs-lookup"><span data-stu-id="ce332-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="ce332-511">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="ce332-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="ce332-512">Weiterführende Themen</span><span class="sxs-lookup"><span data-stu-id="ce332-512">Further Reading</span></span>

<span data-ttu-id="ce332-513">Weitere Informationen zu den Themen in diesem Tutorial erläutert finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="ce332-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="ce332-514">Analyse der Formularauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="ce332-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="ce332-515">Erläutert: Formularauthentifizierung in ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="ce332-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="ce332-516">How To: Schützen Sie die Formularauthentifizierung in ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="ce332-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="ce332-517">[Professional ASP.NET 2.0 Security, Mitgliedschafts- und Rollenverwaltung](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN-Nummer: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="ce332-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="ce332-518">Sichern die Steuerelemente für die Anmeldung</span><span class="sxs-lookup"><span data-stu-id="ce332-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="ce332-519">Die &lt;Authentifizierung&gt; Element</span><span class="sxs-lookup"><span data-stu-id="ce332-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="ce332-520">Die &lt;Forms&gt; -Element für &lt;Authentifizierung&gt;</span><span class="sxs-lookup"><span data-stu-id="ce332-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="ce332-521">Die &lt;MachineKey&gt; Element</span><span class="sxs-lookup"><span data-stu-id="ce332-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="ce332-522">Grundlegendes zu den Formularauthentifizierungsticket und Cookies</span><span class="sxs-lookup"><span data-stu-id="ce332-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="ce332-523">In den Themen in diesem Tutorial-Videotraining</span><span class="sxs-lookup"><span data-stu-id="ce332-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="ce332-524">Gewusst wie: Ändern der Eigenschaften der Formularauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="ce332-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="ce332-525">Wie Sie die Einrichtung und Verwendung Authentifizierung ohne Cookies in einer ASP.NET-Anwendung</span><span class="sxs-lookup"><span data-stu-id="ce332-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="ce332-526">Verschieben der ASP-Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="ce332-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="ce332-527">Benutzerdefinierte Schlüsselkonfiguration für die Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="ce332-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="ce332-528">Hinzufügen von benutzerdefinierten Daten zur Authentifizierungsmethode</span><span class="sxs-lookup"><span data-stu-id="ce332-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="ce332-529">Verwenden von benutzerdefinierten Prinzipalobjekten</span><span class="sxs-lookup"><span data-stu-id="ce332-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="ce332-530">Der Autor</span><span class="sxs-lookup"><span data-stu-id="ce332-530">About the Author</span></span>

<span data-ttu-id="ce332-531">Scott Mitchell, Autor von mehreren Büchern zu ASP/ASP.NET und Gründer von 4GuysFromRolla.com, ist seit 1998 mit Microsoft-Web-Technologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="ce332-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ce332-532">Er ist als ein unabhängiger Berater, Schulungsleiter und Autor.</span><span class="sxs-lookup"><span data-stu-id="ce332-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ce332-533">Sein neueste Buch wird *[Sams Schulen selbst ASP.NET 2.0 in 24 Stunden](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="ce332-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="ce332-534">Scott erreicht werden kann, zur [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) oder über seinen Blog unter [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="ce332-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="ce332-535">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="ce332-535">Special Thanks To</span></span>

<span data-ttu-id="ce332-536">Diese tutorialreihe wurde durch viele hilfreiche Reviewer überprüft.</span><span class="sxs-lookup"><span data-stu-id="ce332-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ce332-537">Führendes Prüfer für dieses Tutorial wurde Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="ce332-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="ce332-538">Meine zukünftigen MSDN-Artikeln überprüfen möchten?</span><span class="sxs-lookup"><span data-stu-id="ce332-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ce332-539">Wenn dies der Fall ist, löschen Sie mir eine Linie an [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="ce332-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ce332-540">[Zurück](an-overview-of-forms-authentication-cs.md)
> [Weiter](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ce332-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
