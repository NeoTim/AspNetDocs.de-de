---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: Konfiguration der Formular Authentifizierung und weiterführende Themen (VB) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial werden die verschiedenen Formular Authentifizierungs Einstellungen untersucht, und es wird erläutert, wie Sie mit dem Forms-Element geändert werden. Dies führt zu einem detaillierten...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: 4d77816a489a4fa16cd70ec4214cd2f8ee563029
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78518133"
---
# <a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="87947-104">Konfiguration der Formularauthentifizierung und weiterführende Themen (VB)</span><span class="sxs-lookup"><span data-stu-id="87947-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>

<span data-ttu-id="87947-105">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="87947-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="87947-106">[Code herunterladen](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) oder [PDF herunterladen](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="87947-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="87947-107">In diesem Tutorial werden die verschiedenen Formular Authentifizierungs Einstellungen untersucht, und es wird erläutert, wie Sie mit dem Forms-Element geändert werden.</span><span class="sxs-lookup"><span data-stu-id="87947-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="87947-108">Dies führt zu einem detaillierten Blick darauf, wie der Timeout Wert des Formular Authentifizierungs Tickets angepasst wird, indem eine Anmeldeseite mit einer benutzerdefinierten URL (z. b. "SignIn. aspx" anstelle von "Login. aspx") und cookielose Formular Authentifizierungs Tickets verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="87947-109">Einführung</span><span class="sxs-lookup"><span data-stu-id="87947-109">Introduction</span></span>

<span data-ttu-id="87947-110">Im [vorherigen Tutorial](an-overview-of-forms-authentication-vb.md) haben wir die erforderlichen Schritte zum Implementieren der Formular Authentifizierung in einer ASP.NET-Anwendung erläutert, von der Angabe von Konfigurationseinstellungen in der Datei Web. config bis zum Erstellen einer Anmeldeseite zum Anzeigen verschiedener Inhalte für authentifizierte und anonyme Benutzer.</span><span class="sxs-lookup"><span data-stu-id="87947-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="87947-111">Beachten Sie, dass wir die Website für die Verwendung der Formular Authentifizierung konfiguriert haben, indem Sie das Mode-Attribut des &lt;Authentication&gt;-Elements auf Forms festlegen.</span><span class="sxs-lookup"><span data-stu-id="87947-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="87947-112">Das &lt;Authentication&gt;-Element kann optional ein &lt;Forms&gt; untergeordnetes Element enthalten, über das eine Reihe von Formular Authentifizierungs Einstellungen angegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="87947-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="87947-113">In diesem Tutorial werden die verschiedenen Formular Authentifizierungs Einstellungen untersucht, und es wird erläutert, wie Sie diese über das &lt;Forms-&gt; Element ändern können.</span><span class="sxs-lookup"><span data-stu-id="87947-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="87947-114">Dies führt zu einem detaillierten Blick darauf, wie der Timeout Wert des Formular Authentifizierungs Tickets angepasst wird, indem eine Anmeldeseite mit einer benutzerdefinierten URL (z. b. "SignIn. aspx" anstelle von "Login. aspx") und cookielose Formular Authentifizierungs Tickets verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="87947-115">Außerdem wird die Zusammensetzung des Formular Authentifizierungs Tickets genauer untersucht, und es werden die Vorsichtsmaßnahmen ASP.net, um sicherzustellen, dass die Daten des Tickets vor Prüfung und Manipulation sicher sind.</span><span class="sxs-lookup"><span data-stu-id="87947-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="87947-116">Abschließend erfahren Sie, wie Sie zusätzliche Benutzerdaten im Formular Authentifizierungs Ticket speichern und wie Sie diese Daten über ein benutzerdefiniertes Prinzipal Objekt modellieren.</span><span class="sxs-lookup"><span data-stu-id="87947-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="87947-117">Schritt 1: Untersuchen der &lt;Formularen&gt; Konfigurationseinstellungen</span><span class="sxs-lookup"><span data-stu-id="87947-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="87947-118">Das Formular Authentifizierungssystem in ASP.net bietet eine Reihe von Konfigurationseinstellungen, die je nach Anwendung angepasst werden können.</span><span class="sxs-lookup"><span data-stu-id="87947-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="87947-119">Dies schließt folgende Einstellungen ein: die Lebensdauer des Formular Authentifizierungs Tickets. welche Art von Schutz wird auf das Ticket angewendet? unter welchen Bedingungen werden cookilose Authentifizierungs Tickets verwendet? der Pfad zur Anmeldeseite. und weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="87947-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="87947-120">Um die Standardwerte zu ändern, fügen Sie ein [&lt;Forms&gt;-Element](https://msdn.microsoft.com/library/1d3t3c61.aspx) als untergeordnetes Element des [&lt;Authentication&gt;-Elements](https://msdn.microsoft.com/library/532aee0e.aspx)hinzu, wobei Sie die Eigenschaftswerte angeben, die Sie als XML-Attribute wie folgt anpassen möchten:</span><span class="sxs-lookup"><span data-stu-id="87947-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="87947-121">In Tabelle 1 werden die Eigenschaften zusammengefasst, die über das&gt;-Element &lt;Forms angepasst werden können.</span><span class="sxs-lookup"><span data-stu-id="87947-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="87947-122">Da "Web. config" eine XML-Datei ist, wird bei den Attributnamen in der linken Spalte die Groß-/Kleinschreibung beachtet.</span><span class="sxs-lookup"><span data-stu-id="87947-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="87947-123"><strong>Attribut</strong></span><span class="sxs-lookup"><span data-stu-id="87947-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="87947-124"><strong>Beschreibung</strong></span><span class="sxs-lookup"><span data-stu-id="87947-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="87947-125">ohne Cookies</span><span class="sxs-lookup"><span data-stu-id="87947-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="87947-126">Dieses Attribut gibt an, unter welchen Bedingungen das Authentifizierungs Ticket in einem Cookie gespeichert wird und in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="87947-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="87947-127">Zulässige Werte sind: UseCookies; UseUri; Auto Ermittlung und UseDeviceProfile (Standard).</span><span class="sxs-lookup"><span data-stu-id="87947-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="87947-128">In Schritt 2 wird diese Einstellung ausführlicher geprüft.</span><span class="sxs-lookup"><span data-stu-id="87947-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="87947-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="87947-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="87947-130">Gibt die URL an, an die Benutzer nach der Anmeldung von der Anmeldeseite umgeleitet werden, wenn kein RedirectURL-Wert in der Abfrage Zeichenfolge angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="87947-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="87947-131">Der Standardwert ist default.aspx.</span><span class="sxs-lookup"><span data-stu-id="87947-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="87947-132">Domäne</span><span class="sxs-lookup"><span data-stu-id="87947-132">domain</span></span>           | <span data-ttu-id="87947-133">Bei Verwendung von cookiebasierten Authentifizierungs Tickets gibt diese Einstellung den Wert der Cookiedomäne an.</span><span class="sxs-lookup"><span data-stu-id="87947-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="87947-134">Der Standardwert ist eine leere Zeichenfolge, die bewirkt, dass der Browser die Domäne verwendet, von der er ausgestellt wurde (z. b. www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="87947-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="87947-135">In diesem Fall wird das Cookie <strong>nicht</strong> gesendet, wenn Anforderungen an Unterdomänen, z. b. admin.yourdomain.com, gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="87947-136">Wenn Sie möchten, dass das Cookie an alle Unterdomänen übermittelt wird, müssen Sie das Domänen Attribut auf yourdomain.com festlegen.</span><span class="sxs-lookup"><span data-stu-id="87947-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="87947-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="87947-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="87947-138">Ein boolescher Wert, der angibt, ob authentifizierte Benutzer gespeichert werden, wenn Sie an URLs in anderen Webanwendungen auf demselben Server umgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="87947-139">Die Standardeinstellung ist „false“.</span><span class="sxs-lookup"><span data-stu-id="87947-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="87947-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="87947-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="87947-141">Die URL der Anmeldeseite.</span><span class="sxs-lookup"><span data-stu-id="87947-141">The URL of the login page.</span></span> <span data-ttu-id="87947-142">Der Standardwert ist login.aspx.</span><span class="sxs-lookup"><span data-stu-id="87947-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="87947-143">name</span><span class="sxs-lookup"><span data-stu-id="87947-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="87947-144">Bei Verwendung von cookiebasierten Authentifizierungs Tickets der Name des Cookies.</span><span class="sxs-lookup"><span data-stu-id="87947-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="87947-145">Der Standardwert ist. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="87947-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="87947-146">path</span><span class="sxs-lookup"><span data-stu-id="87947-146">path</span></span>            |                                                                             <span data-ttu-id="87947-147">Bei Verwendung von cookiebasierten Authentifizierungs Tickets gibt diese Einstellung das Pfad Attribut des Cookies an.</span><span class="sxs-lookup"><span data-stu-id="87947-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="87947-148">Mithilfe des Path-Attributs kann ein Entwickler den Gültigkeitsbereich eines Cookies auf eine bestimmte Verzeichnishierarchie beschränken.</span><span class="sxs-lookup"><span data-stu-id="87947-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="87947-149">Der Standardwert ist/. Hiermit wird der Browser angewiesen, das Authentifizierungs Ticket Cookie an eine beliebige Anforderung an die Domäne zu senden.</span><span class="sxs-lookup"><span data-stu-id="87947-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="87947-150">Schutz</span><span class="sxs-lookup"><span data-stu-id="87947-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="87947-151">Gibt an, welche Techniken verwendet werden, um das Formular Authentifizierungs Ticket zu schützen.</span><span class="sxs-lookup"><span data-stu-id="87947-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="87947-152">Folgende Werte sind zulässig: alle (Standard); Verschlüsselungs Gar und Validierung.</span><span class="sxs-lookup"><span data-stu-id="87947-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="87947-153">Diese Einstellungen werden in Schritt 3 ausführlich erläutert.</span><span class="sxs-lookup"><span data-stu-id="87947-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="87947-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="87947-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="87947-155">Ein boolescher Wert, der angibt, ob eine SSL-Verbindung erforderlich ist, um das Authentifizierungs Cookie zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="87947-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="87947-156">Der Standardwert ist false.</span><span class="sxs-lookup"><span data-stu-id="87947-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="87947-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="87947-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="87947-158">Ein boolescher Wert, der angibt, ob das Timeout für das Authentifizierungscookie s jedes Mal zurückgesetzt wird, wenn der Benutzer die Website während einer einzigen Sitzung besucht.</span><span class="sxs-lookup"><span data-stu-id="87947-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="87947-159">Der Standardwert lautet „true“.</span><span class="sxs-lookup"><span data-stu-id="87947-159">The default value is true.</span></span> <span data-ttu-id="87947-160">Die Richtlinie für das Authentifizierungs Ticket-Timeout wird im Abschnitt angeben des Timeouts für Ticket-e-Outs ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="87947-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="87947-161">timeout</span><span class="sxs-lookup"><span data-stu-id="87947-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="87947-162">Gibt die Zeit in Minuten an, nach der das Authentifizierungs Ticket Cookie abläuft.</span><span class="sxs-lookup"><span data-stu-id="87947-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="87947-163">Der Standardwert ist 30.</span><span class="sxs-lookup"><span data-stu-id="87947-163">The default value is 30.</span></span> <span data-ttu-id="87947-164">Die Richtlinie für das Authentifizierungs Ticket-Timeout wird im Abschnitt angeben des Timeouts für Ticket-e-Outs ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="87947-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="87947-165">**Tabelle 1**: eine Zusammenfassung der Attribute des &lt;Forms-&gt; Elements</span><span class="sxs-lookup"><span data-stu-id="87947-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="87947-166">In ASP.NET 2,0 und höher sind die standardmäßigen Formular Authentifizierungs Werte in der FormsAuthenticationConfiguration-Klasse in der .NET Framework hart codiert.</span><span class="sxs-lookup"><span data-stu-id="87947-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="87947-167">Alle Änderungen müssen in der Datei "Web. config" auf Anwendungs Basis angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="87947-168">Dies unterscheidet sich von ASP.NET 1. x, wobei die standardmäßigen Formular Authentifizierungs Werte in der Datei Machine. config gespeichert wurden (und daher über die Bearbeitung von Machine. config geändert werden können).</span><span class="sxs-lookup"><span data-stu-id="87947-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="87947-169">Im Thema ASP.NET 1. x ist es jedoch sinnvoll, zu erwähnen, dass eine Reihe von Formular Authentifizierungs Systemeinstellungen unterschiedliche Standardwerte in ASP.NET 2,0 und höher als in ASP.NET 1. x aufweisen.</span><span class="sxs-lookup"><span data-stu-id="87947-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="87947-170">Wenn Sie Ihre Anwendung aus einer ASP.NET 1. x-Umgebung migrieren, ist es wichtig, dass Sie diese Unterschiede kennen.</span><span class="sxs-lookup"><span data-stu-id="87947-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="87947-171">Eine Liste der Unterschiede finden Sie in [der technischen Dokumentation &lt;Forms&gt;-Elements](https://msdn.microsoft.com/library/1d3t3c61.aspx) .</span><span class="sxs-lookup"><span data-stu-id="87947-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-172">Einige Einstellungen für die Formular Authentifizierung, z. b. Timeout, Domäne und Pfad, geben Details für das resultierende Formular Authentifizierungs Ticket-Cookie an.</span><span class="sxs-lookup"><span data-stu-id="87947-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="87947-173">Weitere Informationen zu Cookies, ihrer Funktionsweise und ihren verschiedenen Eigenschaften finden Sie in [diesem Cookie-Tutorial](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="87947-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="87947-174">Angeben des Timeout Werts für das Ticket</span><span class="sxs-lookup"><span data-stu-id="87947-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="87947-175">Das Formular Authentifizierungs Ticket ist ein Token, das eine Identität darstellt.</span><span class="sxs-lookup"><span data-stu-id="87947-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="87947-176">Bei cookiebasierten Authentifizierungs Tickets wird dieses Token in Form eines Cookies gespeichert und bei jeder Anforderung an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="87947-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="87947-177">Der Besitz des Tokens deklariert im Grunde, ich bin *username*, ich bin bereits angemeldet und wird verwendet, damit die Identität eines Benutzers über Seitenbesuche hinweg gespeichert werden kann.</span><span class="sxs-lookup"><span data-stu-id="87947-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="87947-178">Das Formular Authentifizierungs Ticket umfasst nicht nur die Identität des Benutzers, sondern enthält auch Informationen, mit denen Sie die Integrität und Sicherheit des Tokens sicherstellen können.</span><span class="sxs-lookup"><span data-stu-id="87947-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="87947-179">Schließlich möchten wir nicht, dass ein Benutzer, der keine Benutzer ist, ein gefälschtes Token erstellen oder ein legit-Token in einer anderen Weise ändern kann.</span><span class="sxs-lookup"><span data-stu-id="87947-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="87947-180">Ein solches Informations Paar im Ticket ist ein *Ablauf*Datum, bei dem es sich um das Datum und die Uhrzeit handelt, zu denen das Ticket nicht mehr gültig ist.</span><span class="sxs-lookup"><span data-stu-id="87947-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="87947-181">Jedes Mal, wenn das FormsAuthenticationModule ein Authentifizierungs Ticket überprüft, wird sichergestellt, dass der Ablauf des Tickets noch nicht abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="87947-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="87947-182">Wenn dies der Fall ist, wird das Ticket ignoriert, und der Benutzer wird als anonym bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="87947-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="87947-183">Diese Schutzmaßnahme schützt vor Replay-Angriffen.</span><span class="sxs-lookup"><span data-stu-id="87947-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="87947-184">Ohne Ablauf, wenn ein Hacker ein Benutzer gültiges Authentifizierungs Ticket erhalten konnte, indem er möglicherweise physischen Zugriff auf Ihren Computer erlangt und seine Cookies durchläuft, könnte er eine Anforderung an den Server mit diesem gestohlenen Authentifizierungs Ticket senden und gewinnen Sie einen Eintrag.</span><span class="sxs-lookup"><span data-stu-id="87947-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="87947-185">Während der Ablauf dieses Szenarios nicht verhindert, wird das Fenster, in dem ein solcher Angriff erfolgreich ausgeführt werden kann, eingeschränkt.</span><span class="sxs-lookup"><span data-stu-id="87947-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-186">In Schritt 3 werden zusätzliche Verfahren erläutert, die vom Formular Authentifizierungssystem zum Schutz des Authentifizierungs Tickets verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="87947-187">Beim Erstellen des Authentifizierungs Tickets bestimmt das Formular Authentifizierungssystem seinen Ablauf, indem er die Timeout Einstellung einrichtet.</span><span class="sxs-lookup"><span data-stu-id="87947-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="87947-188">Wie in Tabelle 1 erwähnt, wird die Timeout Einstellung standardmäßig auf 30 Minuten festgelegt. Dies bedeutet, dass beim Erstellen des Formular Authentifizierungs Tickets der Ablauf in der Zukunft auf ein Datum und eine Uhrzeit von 30 Minuten festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="87947-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="87947-189">Der Ablauf definiert eine absolute Zeit in der Zukunft, wenn das Formular Authentifizierungs Ticket abläuft.</span><span class="sxs-lookup"><span data-stu-id="87947-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="87947-190">Doch in der Regel möchten Entwickler eine gleitende Ablaufzeit implementieren, die bei jedem erneuten Besuchen der Website zurückgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="87947-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="87947-191">Dieses Verhalten wird durch die slidingExpiration-Einstellungen festgelegt.</span><span class="sxs-lookup"><span data-stu-id="87947-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="87947-192">Wenn der Wert auf true (Standardeinstellung) festgelegt ist, wird jedes Mal, wenn das FormsAuthenticationModule einen Benutzer authentifiziert, der Ablauf des Tickets aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="87947-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="87947-193">Wenn der Wert auf false festgelegt ist, wird der Ablauf bei jeder Anforderung nicht aktualisiert, was dazu führt, dass das Ticket genau in Minuten nach der ersten Erstellung des Tickets abläuft.</span><span class="sxs-lookup"><span data-stu-id="87947-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-194">Der im Authentifizierungs Ticket gespeicherte Ablauf ist ein absoluter Datums-und Uhrzeitwert, wie z. b. den 2. August, 2008 11:34 Uhr.</span><span class="sxs-lookup"><span data-stu-id="87947-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="87947-195">Außerdem sind Datum und Uhrzeit relativ zur lokalen Zeit des Webservers.</span><span class="sxs-lookup"><span data-stu-id="87947-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="87947-196">Diese Entwurfs Entscheidung kann einige interessante Nebeneffekte in Bezug auf die Sommerzeit (Sommerzeit, DST) aufweisen, bei der Uhren im USA eine Stunde nach vorn verschoben werden (vorausgesetzt, der Webserver wird in einem Gebiets Schema gehostet, in dem die Sommerzeit beobachtet wird).</span><span class="sxs-lookup"><span data-stu-id="87947-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="87947-197">Sehen Sie sich an, was für eine ASP.NET-Website mit einem Ablauf von 30 Minuten in der Zeit passiert, in der der DST beginnt (2:00 Uhr).</span><span class="sxs-lookup"><span data-stu-id="87947-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="87947-198">Stellen Sie sich vor, dass sich ein Besucher am 11. März 2008 um 1:55 Uhr bei der Website anmeldet.</span><span class="sxs-lookup"><span data-stu-id="87947-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="87947-199">Dadurch wird ein Formular Authentifizierungs Ticket generiert, das am 11. März 2008 um 2:25 Uhr (in der Zukunft 30 Minuten) abläuft.</span><span class="sxs-lookup"><span data-stu-id="87947-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="87947-200">Wenn jedoch 2:00 ein Rollback durchführt, springt die Uhr aufgrund von DST auf 3:00 Uhr.</span><span class="sxs-lookup"><span data-stu-id="87947-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="87947-201">Wenn der Benutzer eine neue Seite sechs Minuten nach der Anmeldung lädt (um 3:01 Uhr), stellt das FormsAuthenticationModule fest, dass das Ticket abgelaufen ist, und leitet den Benutzer zur Anmeldeseite um.</span><span class="sxs-lookup"><span data-stu-id="87947-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="87947-202">Eine ausführlichere Erläuterung zu diesem und anderen Authentifizierungs Ticket-Timeout-Oddities sowie Problem Umgehungen erhalten Sie, wenn Sie eine Kopie von Stefan Schackow *Professional ASP.NET 2,0 Security, Membership und Role Management* (ISBN: 978-0-7645-9698-8) übernehmen.</span><span class="sxs-lookup"><span data-stu-id="87947-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="87947-203">Abbildung 1 veranschaulicht den Workflow, wenn slidingExpiration auf false festgelegt ist und Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="87947-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="87947-204">Beachten Sie, dass das bei der Anmeldung generierte Authentifizierungs Ticket das Ablaufdatum enthält. dieser Wert wird bei nachfolgenden Anforderungen nicht aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="87947-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="87947-205">Wenn das FormsAuthenticationModule feststellt, dass das Ticket abgelaufen ist, wird es verworfen und die Anforderung als anonym behandelt.</span><span class="sxs-lookup"><span data-stu-id="87947-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="87947-206">[![eine grafische Darstellung des Ablaufs des Formular Authentifizierungs Tickets, wenn slidingExpiration den Wert false hat.](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="87947-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="87947-207">**Abbildung 01**: eine grafische Darstellung des Ablaufs des Formular Authentifizierungs Tickets, wenn "slidingExpiration" den Wert "false" hat ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="87947-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>

<span data-ttu-id="87947-208">Abbildung 2 zeigt den Workflow, wenn slidingExpiration auf true festgelegt ist und Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="87947-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="87947-209">Wenn eine authentifizierte Anforderung empfangen wird (mit einem nicht abgelaufenen Ticket), wird der Ablauf in der Zukunft auf die Timeout Anzahl von Minuten aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="87947-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="87947-210">[![eine grafische Darstellung der Formular Authentifizierungs Tickets, wenn "slidingExpiration" den Wert "true" hat.](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="87947-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="87947-211">**Abbildung 02**: eine grafische Darstellung der Formular Authentifizierungs Tickets, wenn slidingExpiration true ist ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="87947-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>

<span data-ttu-id="87947-212">Bei der Verwendung von cookiebasierten Authentifizierungs Tickets (Standardeinstellung) wird diese Erörterung etwas verwirrend, da für Cookies auch eigene Expiries angegeben werden können.</span><span class="sxs-lookup"><span data-stu-id="87947-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="87947-213">Der Ablauf eines Cookies weist den Browser an, wenn das Cookie zerstört werden soll.</span><span class="sxs-lookup"><span data-stu-id="87947-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="87947-214">Wenn das Cookie keinen Ablauf hat, wird es zerstört, wenn der Browser heruntergefahren wird.</span><span class="sxs-lookup"><span data-stu-id="87947-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="87947-215">Wenn eine Ablaufzeit vorhanden ist, bleibt das Cookie jedoch so lange auf dem Computer des Benutzers gespeichert, bis das Datum und die Uhrzeit des Ablaufs abgelaufen sind.</span><span class="sxs-lookup"><span data-stu-id="87947-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="87947-216">Wenn ein Cookie vom Browser zerstört wird, wird es nicht mehr an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="87947-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="87947-217">Daher ist die Zerstörung eines Cookies analog zum Benutzer, der sich von der Website abgemeldet hat.</span><span class="sxs-lookup"><span data-stu-id="87947-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-218">Natürlich kann ein Benutzer proaktiv alle Cookies entfernen, die auf dem Computer gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="87947-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="87947-219">In Internet Explorer 7 wechseln Sie zu Extras, Optionen, und klicken Sie im Abschnitt Browserverlauf auf die Schaltfläche Löschen.</span><span class="sxs-lookup"><span data-stu-id="87947-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="87947-220">Klicken Sie dort auf die Schaltfläche Cookies löschen.</span><span class="sxs-lookup"><span data-stu-id="87947-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="87947-221">Das Formular Authentifizierungssystem erstellt Sitzungs basierte oder Ablauf basierte Cookies in Abhängigkeit von dem Wert, der an den *persistcookie* -Parameter übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="87947-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="87947-222">Beachten Sie, dass die Methoden GetAuthCookie, SetAuthCookie und RedirectFromLoginPage der FormsAuthentication-Klasse zwei Eingabeparameter akzeptieren: *username* und *persistcookie*.</span><span class="sxs-lookup"><span data-stu-id="87947-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="87947-223">Die Anmeldeseite, die wir im vorherigen Tutorial erstellt haben, enthielt das Kontrollkästchen "Erinnerung", mit dem bestimmt wird, ob ein dauerhaftes Cookie erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="87947-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="87947-224">Persistente Cookies sind Ablauf basiert. nicht persistente Cookies sind Sitzungs basiert.</span><span class="sxs-lookup"><span data-stu-id="87947-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="87947-225">Das Timeout und die slidingExpiration-Konzepte, die bereits erläutert wurden, gelten auch für Sitzungs basierte und Ablauf basierte Cookies.</span><span class="sxs-lookup"><span data-stu-id="87947-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="87947-226">Es gibt nur einen geringfügigen Unterschied bei der Ausführung: bei Verwendung von Ablauf basierten Cookies mit auf true festgelegtem slidingtimeout wird der Ablauf des Cookies nur aktualisiert, wenn mehr als die Hälfte der angegebenen Zeit abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="87947-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="87947-227">Wir aktualisieren die Timeout Richtlinien für das Authentifizierungs Ticket unserer Website so, dass Tickets nach einer Stunde (60 Minuten) mit einem gleitenden Ablaufzeit Limit überschritten werden.</span><span class="sxs-lookup"><span data-stu-id="87947-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="87947-228">Um diese Änderung zu beeinflussen, aktualisieren Sie die Datei Web. config, und fügen Sie dem &lt;Authentication&gt;-Element mit dem folgenden Markup ein &lt;Forms&gt;-Element hinzu:</span><span class="sxs-lookup"><span data-stu-id="87947-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="87947-229">Verwenden einer anderen Anmelde Seiten-URL als "Login. aspx"</span><span class="sxs-lookup"><span data-stu-id="87947-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="87947-230">Da FormsAuthenticationModule nicht autorisierte Benutzer automatisch an die Anmeldeseite umleitet, muss Sie die URL der Anmeldeseite kennen.</span><span class="sxs-lookup"><span data-stu-id="87947-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="87947-231">Diese URL wird durch das loginUrl-Attribut im &lt;Forms&gt;-Element angegeben und ist standardmäßig Login. aspx.</span><span class="sxs-lookup"><span data-stu-id="87947-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="87947-232">Wenn Sie über eine vorhandene Website portieren, verfügen Sie möglicherweise bereits über eine Anmeldeseite mit einer anderen URL, die bereits mit einem Lesezeichen versehen und von Suchmaschinen indiziert wurde.</span><span class="sxs-lookup"><span data-stu-id="87947-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="87947-233">Anstatt Ihre vorhandene Anmeldeseite in Login. aspx und unterbrechende Links und Benutzer Lesezeichen umzubenennen, können Sie stattdessen das loginUrl-Attribut so ändern, dass es auf Ihre Anmeldeseite verweist.</span><span class="sxs-lookup"><span data-stu-id="87947-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="87947-234">Wenn die Anmeldeseite z. b. den Namen "SignIn. aspx" hat und sich im Verzeichnis "Users" befindet, können Sie die loginUrl-Konfigurationseinstellung auf ~/users/SignIn.aspx wie folgt festlegen:</span><span class="sxs-lookup"><span data-stu-id="87947-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="87947-235">Da unsere aktuelle Anwendung bereits über eine Anmeldeseite mit dem Namen Login. aspx verfügt, ist es nicht erforderlich, einen benutzerdefinierten Wert im &lt;Forms-&gt; Element anzugeben.</span><span class="sxs-lookup"><span data-stu-id="87947-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="87947-236">Schritt 2: Verwenden von Authentifizierungs Tickets für cookielose Formulare</span><span class="sxs-lookup"><span data-stu-id="87947-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="87947-237">Standardmäßig legt das Formular Authentifizierungssystem fest, ob die Authentifizierungs Tickets in der Cookies-Sammlung gespeichert oder in die URL eingebettet werden, basierend auf dem Benutzer-Agent, der die Website besucht.</span><span class="sxs-lookup"><span data-stu-id="87947-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="87947-238">Alle gängigen Desktop Browser wie Internet Explorer, Firefox, Opera und Safari unterstützen Cookies, aber nicht alle mobilen Geräte.</span><span class="sxs-lookup"><span data-stu-id="87947-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="87947-239">Die vom Formular Authentifizierungssystem verwendete cookierichtlinie hängt von der Cookieeinstellung in der &lt;Forms-&gt; Element ab, der einer von vier Werten zugewiesen werden kann:</span><span class="sxs-lookup"><span data-stu-id="87947-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="87947-240">UseCookies: gibt an, dass cookiebasierte Authentifizierungs Tickets immer verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="87947-241">UseUri: gibt an, dass cookiebasierte Authentifizierungs Tickets nie verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="87947-242">Automatische Erkennung: Wenn das Geräte Profil Cookies nicht unterstützt, werden cookiebasierte Authentifizierungs Tickets nicht verwendet. Wenn das Geräte Profil Cookies unterstützt, wird ein Überprüfungsmechanismus verwendet, um zu bestimmen, ob Cookies aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="87947-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="87947-243">UseDeviceProfile-der Standardwert; verwendet cookiebasierte Authentifizierungs Tickets nur dann, wenn das Geräte Profil Cookies unterstützt.</span><span class="sxs-lookup"><span data-stu-id="87947-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="87947-244">Es wird kein Überprüfungsmechanismus verwendet.</span><span class="sxs-lookup"><span data-stu-id="87947-244">No probing mechanism is used.</span></span>

<span data-ttu-id="87947-245">Die Einstellungen Autodetect und UseDeviceProfile basieren auf einem *Geräte Profil* bei der Ermittlung, ob cookiebasierte oder cookilose Authentifizierungs Tickets verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="87947-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="87947-246">ASP.NET verwaltet eine Datenbank mit verschiedenen Geräten und ihren Funktionen, z. b. ob Cookies unterstützt werden, welche JavaScript-Version unterstützt wird, und so weiter.</span><span class="sxs-lookup"><span data-stu-id="87947-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="87947-247">Jedes Mal, wenn ein Gerät von einem Webserver eine Webseite anfordert, sendet es einen *Benutzer-Agent-HTTP-* Header, der den Gerätetyp identifiziert.</span><span class="sxs-lookup"><span data-stu-id="87947-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="87947-248">ASP.NET entspricht automatisch der angegebenen Benutzeragentzeichenfolge, wobei das entsprechende Profil in der Datenbank angegeben ist.</span><span class="sxs-lookup"><span data-stu-id="87947-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-249">Diese Datenbank von Gerätefunktionen wird in einer Reihe von XML-Dateien gespeichert, die das [Schema der Browser Definitionsdatei](https://msdn.microsoft.com/library/ms228122.aspx)einhalten.</span><span class="sxs-lookup"><span data-stu-id="87947-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="87947-250">Die standardmäßigen Geräte Profil Dateien befinden sich unter%windir%\Microsoft.NET\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="87947-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="87947-251">Sie können benutzerdefinierte Dateien auch der APP\_Browser-Ordner Ihrer Anwendung hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="87947-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="87947-252">Weitere Informationen finden Sie unter Gewusst [wie: Erkennen von Browser Typen in ASP.net Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="87947-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="87947-253">Da die Standardeinstellung UseDeviceProfile ist, werden cookiless-Formular Authentifizierungs Tickets verwendet, wenn der Standort von einem Gerät besucht wird, dessen Profil meldet, dass Cookies nicht unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="87947-254">Codieren des Authentifizierungs Tickets in der URL</span><span class="sxs-lookup"><span data-stu-id="87947-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="87947-255">Cookies sind ein natürliches Medium zum Einschließen von Informationen aus dem Browser in jeder Anforderung an eine bestimmte Website. Daher verwenden die standardmäßigen Formular Authentifizierungs Einstellungen Cookies, wenn Sie vom besuchenden Gerät unterstützt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="87947-256">Wenn Cookies nicht unterstützt werden, muss ein alternatives Mittel zum Übergeben des Authentifizierungs Tickets vom Client an den Server verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="87947-257">Eine häufige Problem Umgehung in cookichtlosen Umgebungen besteht darin, die Cookiedaten in der URL zu codieren.</span><span class="sxs-lookup"><span data-stu-id="87947-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="87947-258">Die beste Möglichkeit, um zu sehen, wie diese Informationen in die URL eingebettet werden können, besteht darin, die Website für die Verwendung von cookilosen Authentifizierungs Tickets zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="87947-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="87947-259">Dies kann erreicht werden, indem die Konfigurationseinstellung cookiless auf UseUri festgelegt wird:</span><span class="sxs-lookup"><span data-stu-id="87947-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="87947-260">Nachdem Sie diese Änderung vorgenommen haben, besuchen Sie die Website über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="87947-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="87947-261">Wenn Sie als anonymer Benutzer besuchen, sehen die URLs genau wie zuvor aus.</span><span class="sxs-lookup"><span data-stu-id="87947-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="87947-262">Wenn z. b. die Adressleiste des Browsers auf der Seite "default. aspx" angezeigt wird, wird die folgende URL angezeigt:</span><span class="sxs-lookup"><span data-stu-id="87947-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="87947-263">Bei der Anmeldung wird das Formular Authentifizierungs Ticket jedoch in die URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="87947-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="87947-264">Wenn Sie z. b. die Anmeldeseite besuchen und sich als Sam anmelden, wird die Seite "default. aspx" zurückgegeben, aber die URL lautet:</span><span class="sxs-lookup"><span data-stu-id="87947-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="87947-265">Das Formular Authentifizierungs Ticket wurde in die URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="87947-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="87947-266">Die Zeichenfolge (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-fymalxjfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) stellt die hexadezimal codierten Authentifizierungs Ticketinformationen dar. dabei handelt es sich um dieselben Daten, die normalerweise in einem Cookie gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="87947-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="87947-267">Damit die Authentifizierungs Tickets ohne Cookies funktionieren, muss das System alle URLs auf der Seite codieren, um die Authentifizierungs Ticketdaten einzubeziehen. Andernfalls geht das Authentifizierungs Ticket verloren, wenn der Benutzer auf einen Link klickt.</span><span class="sxs-lookup"><span data-stu-id="87947-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="87947-268">Glücklicherweise wird diese Einbett Ende Logik automatisch ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="87947-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="87947-269">Um diese Funktionalität zu veranschaulichen, öffnen Sie die Seite "default. aspx", und fügen Sie ein Hyperlink-Steuerelement hinzu, indem Sie die Eigenschaften "Text" und "NavigateUrl" auf "Test Link" bzw. "somepage</span><span class="sxs-lookup"><span data-stu-id="87947-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="87947-270">Es spielt keine Rolle, dass es in unserem Projekt wirklich keine Seite mit dem Namen "somepage. aspx" gibt.</span><span class="sxs-lookup"><span data-stu-id="87947-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="87947-271">Speichern Sie die Änderungen an default. aspx, und besuchen Sie Sie dann über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="87947-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="87947-272">Melden Sie sich bei der Website an, sodass das Formular Authentifizierungs Ticket in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="87947-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="87947-273">Klicken Sie als nächstes in "default. aspx" auf den Link "Link testen".</span><span class="sxs-lookup"><span data-stu-id="87947-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="87947-274">Was ist passiert?</span><span class="sxs-lookup"><span data-stu-id="87947-274">What happened?</span></span> <span data-ttu-id="87947-275">Wenn keine Seite mit dem Namen "somepage. aspx" vorhanden ist, ist ein Fehler 404 aufgetreten, aber das ist hier nicht wichtig.</span><span class="sxs-lookup"><span data-stu-id="87947-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="87947-276">Konzentrieren Sie sich stattdessen auf die Adressleiste in Ihrem Browser.</span><span class="sxs-lookup"><span data-stu-id="87947-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="87947-277">Beachten Sie, dass das Formular Authentifizierungs Ticket in der URL enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="87947-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="87947-278">Die URL "somepage. aspx" in der Verknüpfung wurde automatisch in eine URL konvertiert, die das Authentifizierungs Ticket enthielt. wir mussten keinen Code mit Code schreiben!</span><span class="sxs-lookup"><span data-stu-id="87947-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="87947-279">Das Formular Authentifizierungs Ticket wird automatisch in die URL für alle Hyperlinks eingebettet, die nicht mit http://oder/beginnen.</span><span class="sxs-lookup"><span data-stu-id="87947-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="87947-280">Es spielt keine Rolle, ob der Hyperlink in einem Rückruf von Response. Redirect, in einem Hyperlink-Steuerelement oder in einem Anchor-HTML-Element (d. h. &lt;a href = "..."&gt;...&lt;/a&gt;) angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="87947-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="87947-281">Solange die URL nicht http://www.someserver.com/SomePage.aspx oder/SomePage.aspx ist, wird das Formular Authentifizierungs Ticket für uns eingebettet.</span><span class="sxs-lookup"><span data-stu-id="87947-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-282">Cookiless-Formular Authentifizierungs Tickets entsprechen denselben Timeout Richtlinien wie cookiebasierte Authentifizierungs Tickets.</span><span class="sxs-lookup"><span data-stu-id="87947-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="87947-283">Allerdings sind cookilose Authentifizierungs Tickets anfälliger für Wiedergabe Angriffe, da das Authentifizierungs Ticket direkt in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="87947-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="87947-284">Stellen Sie sich vor, dass ein Benutzer, der eine Website besucht, sich anmeldet und dann die URL in eine e-Mail an einen Kollegen einfügt.</span><span class="sxs-lookup"><span data-stu-id="87947-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="87947-285">Wenn der Kollege auf diesen Link klickt, bevor der Ablauf erreicht ist, wird er als der Benutzer angemeldet, der die e-Mail gesendet hat!</span><span class="sxs-lookup"><span data-stu-id="87947-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="87947-286">Schritt 3: Sichern des Authentifizierungs Tickets</span><span class="sxs-lookup"><span data-stu-id="87947-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="87947-287">Das Formular Authentifizierungs Ticket wird entweder in einem Cookie übertragen oder direkt in die URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="87947-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="87947-288">Zusätzlich zu den Identitätsinformationen kann das Authentifizierungs Ticket auch Benutzerdaten einschließen (wie in Schritt 4 zu sehen).</span><span class="sxs-lookup"><span data-stu-id="87947-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="87947-289">Folglich ist es wichtig, dass die Daten des Tickets aus den Augenblicken und (noch wichtiger) verschlüsselt werden, dass das Formular Authentifizierungssystem garantieren kann, dass das Ticket nicht manipuliert wurde.</span><span class="sxs-lookup"><span data-stu-id="87947-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="87947-290">Um den Datenschutz der Ticketdaten sicherzustellen, kann das Formular Authentifizierungssystem die Ticketdaten verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="87947-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="87947-291">Wenn die Ticketdaten nicht verschlüsselt werden, werden potenziell vertrauliche Informationen über das Netzwerk im Klartext gesendet.</span><span class="sxs-lookup"><span data-stu-id="87947-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="87947-292">Um die Authentizität eines Tickets zu gewährleisten *, muss das* Formular Authentifizierungssystem das Ticket überprüfen.</span><span class="sxs-lookup"><span data-stu-id="87947-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="87947-293">Bei der Validierung wird sichergestellt, dass ein bestimmtes Datenelement nicht geändert wurde, und es wird über einen *[Nachrichten Authentifizierungscode (Message Authentication Code, Mac)](http://en.wikipedia.org/wiki/Message_authentication_code)* erreicht.</span><span class="sxs-lookup"><span data-stu-id="87947-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="87947-294">Kurz gesagt, ist der Mac ein kleines Informationselement, das die zu validierenden Daten identifiziert (in diesem Fall das Ticket).</span><span class="sxs-lookup"><span data-stu-id="87947-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="87947-295">Wenn die durch den Mac dargestellten Daten geändert werden, Stimmen der Mac und die Daten nicht ab.</span><span class="sxs-lookup"><span data-stu-id="87947-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="87947-296">Außerdem ist es für einen Hacker Rechen intensiv, sowohl die Daten zu ändern als auch einen eigenen Mac zu generieren, der den geänderten Daten entspricht.</span><span class="sxs-lookup"><span data-stu-id="87947-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="87947-297">Beim Erstellen (oder ändern) eines Tickets erstellt das Formular Authentifizierungssystem einen Mac und fügt ihn an die Ticketdaten an.</span><span class="sxs-lookup"><span data-stu-id="87947-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="87947-298">Wenn eine nachfolgende Anforderung eingeht, vergleicht das Formular Authentifizierungssystem die Mac-und Ticketdaten, um die Authentizität der Ticketdaten zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="87947-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="87947-299">In Abbildung 3 wird dieser Workflow grafisch veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="87947-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="87947-300">[![die Authentizität des Tickets durch einen Mac sichergestellt wird](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="87947-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="87947-301">**Abbildung 03**: die Authentizität des Tickets wird durch einen Mac sichergestellt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="87947-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>

<span data-ttu-id="87947-302">Welche Sicherheitsmaßnahmen auf das Authentifizierungs Ticket angewendet werden, hängt von der Schutz Einstellung im &lt;Forms&gt;-Element ab.</span><span class="sxs-lookup"><span data-stu-id="87947-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="87947-303">Die Schutz Einstellung kann einem der folgenden drei Werte zugewiesen werden:</span><span class="sxs-lookup"><span data-stu-id="87947-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="87947-304">Alle: das Ticket ist verschlüsselt und digital signiert (Standard).</span><span class="sxs-lookup"><span data-stu-id="87947-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="87947-305">Verschlüsselung nur Verschlüsselung wird angewendet-es wird kein Mac generiert.</span><span class="sxs-lookup"><span data-stu-id="87947-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="87947-306">Keine: das Ticket ist weder verschlüsselt noch digital signiert.</span><span class="sxs-lookup"><span data-stu-id="87947-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="87947-307">Validierung: ein Mac wird generiert, aber die Ticketdaten werden im Klartext über das Netzwerk gesendet.</span><span class="sxs-lookup"><span data-stu-id="87947-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="87947-308">Microsoft empfiehlt dringend die Verwendung der Einstellung "alle".</span><span class="sxs-lookup"><span data-stu-id="87947-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="87947-309">Festlegen der Validierungs-und Entschlüsselungsschlüssel</span><span class="sxs-lookup"><span data-stu-id="87947-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="87947-310">Die Verschlüsselungs-und Hash Algorithmen, die vom Formular Authentifizierungssystem zum Verschlüsseln und Überprüfen des Authentifizierungs Tickets verwendet werden, können über das [&lt;machineKey&gt;-Element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in der Datei "Web. config" angepasst werden. In Tabelle 2 werden die Attribute des &lt;machineKey&gt; Elements und ihre möglichen Werte beschrieben.</span><span class="sxs-lookup"><span data-stu-id="87947-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="87947-311">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="87947-311">**Attribute**</span></span> | <span data-ttu-id="87947-312">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="87947-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="87947-313">Entschlüsselung</span><span class="sxs-lookup"><span data-stu-id="87947-313">decryption</span></span> | <span data-ttu-id="87947-314">Gibt den Algorithmus an, der für die Verschlüsselung verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="87947-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="87947-315">Dieses Attribut kann einen der folgenden vier Werte aufweisen:-Auto-the default; bestimmt den Algorithmus basierend auf der Länge des Attributs decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="87947-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="87947-316">-AES: verwendet den [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) -Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="87947-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="87947-317">-Des-verwendet den [Daten Verschlüsselungs Standard (Data Encryption Standard, des)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) . dieser Algorithmus wird als Rechen schwach angesehen und sollte nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="87947-318">-3DES: verwendet den [Triple des](http://en.wikipedia.org/wiki/Triple_DES) -Algorithmus, der den des-Algorithmus dreimal anwendet.</span><span class="sxs-lookup"><span data-stu-id="87947-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="87947-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="87947-319">decryptionKey</span></span> | <span data-ttu-id="87947-320">Der geheime Schlüssel, der vom Verschlüsselungsalgorithmus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="87947-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="87947-321">Bei diesem Wert muss es sich entweder um eine hexadezimale Zeichenfolge der entsprechenden Länge (basierend auf dem Entschlüsselungs Wert), die automatische Generierung oder einen der Werte, die mit IsolateApps angefügt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="87947-322">Das Hinzufügen von IsolateApps weist ASP.net an, einen eindeutigen Wert für jede Anwendung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="87947-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="87947-323">Der Standardwert lautet AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="87947-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="87947-324">Überprüfung</span><span class="sxs-lookup"><span data-stu-id="87947-324">validation</span></span> | <span data-ttu-id="87947-325">Gibt den für die Validierung verwendeten Algorithmus an.</span><span class="sxs-lookup"><span data-stu-id="87947-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="87947-326">Dieses Attribut kann einen der folgenden vier Werte aufweisen:-AES-verwendet den Advanced Encryption Standard (AES)-Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="87947-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="87947-327">-MD5-verwendet den [Message Digest 5-Algorithmus (MD5)](http://en.wikipedia.org/wiki/MD5) .</span><span class="sxs-lookup"><span data-stu-id="87947-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="87947-328">-SHA1-verwendet den [SHA1](http://en.wikipedia.org/wiki/Sha1) -Algorithmus (Standard).</span><span class="sxs-lookup"><span data-stu-id="87947-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="87947-329">-3DES-verwendet den Triple des-Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="87947-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="87947-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="87947-330">validationKey</span></span> | <span data-ttu-id="87947-331">Der geheime Schlüssel, der vom Validierungs Algorithmus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="87947-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="87947-332">Bei diesem Wert muss es sich entweder um eine hexadezimale Zeichenfolge der entsprechenden Länge (basierend auf dem Wert in der Validierung), der automatischen Generierung oder eines der beiden Werte handeln, die mit IsolateApps angefügt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="87947-333">Das Hinzufügen von IsolateApps weist ASP.net an, einen eindeutigen Wert für jede Anwendung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="87947-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="87947-334">Der Standardwert lautet AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="87947-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="87947-335">**Tabelle 2**: die &lt;machineKey-&gt; Element Attribute</span><span class="sxs-lookup"><span data-stu-id="87947-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="87947-336">Eine ausführliche Erläuterung dieser Verschlüsselungs-und Validierungs Optionen sowie der vor-und Nachteile der verschiedenen Algorithmen geht über den Rahmen dieses Tutorials hinaus.</span><span class="sxs-lookup"><span data-stu-id="87947-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="87947-337">Ausführliche Informationen zu diesen Problemen, einschließlich Anleitungen dazu, welche Verschlüsselungs-und Validierungs Algorithmen verwendet werden müssen, welche Schlüssellängen verwendet werden und wie diese Schlüssel am besten generiert werden, finden Sie unter *Professional ASP.NET 2,0 Sicherheit, Mitgliedschaft und Rollen Verwaltung*.</span><span class="sxs-lookup"><span data-stu-id="87947-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="87947-338">Standardmäßig werden die Schlüssel, die für die Verschlüsselung und Validierung verwendet werden, automatisch für jede Anwendung generiert. diese Schlüssel werden in der lokalen Sicherheits Autorität (Local Security Authority, LSA) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="87947-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="87947-339">Kurz gesagt: die Standardeinstellungen garantieren eindeutige Schlüssel auf einem Webserver-by-Webserver-Server und auf Anwendungs Basis.</span><span class="sxs-lookup"><span data-stu-id="87947-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="87947-340">Folglich funktioniert dieses Standardverhalten nicht für die beiden folgenden Szenarien:</span><span class="sxs-lookup"><span data-stu-id="87947-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="87947-341">**Webfarmen** : in einem [Webfarm](http://en.wikipedia.org/wiki/Web_farm) Szenario wird eine einzelne Webanwendung zum Zweck der Skalierbarkeit und Redundanz auf mehreren Webservern gehostet.</span><span class="sxs-lookup"><span data-stu-id="87947-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="87947-342">Jede eingehende Anforderung wird an einen Server in der Farm gesendet. Dies bedeutet, dass während der Lebensdauer der Sitzung eines Benutzers verschiedene Server verwendet werden können, um die verschiedenen Anforderungen zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="87947-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="87947-343">Folglich muss jeder Server dieselben Verschlüsselungs-und Validierungs Schlüssel verwenden, damit das Formular Authentifizierungs Ticket, das auf einem Server erstellt, verschlüsselt und überprüft wird, auf einem anderen Server in der Farm entschlüsselt und überprüft werden kann.</span><span class="sxs-lookup"><span data-stu-id="87947-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="87947-344">**Anwendungsübergreifende Ticket Freigabe** : ein einzelner Webserver kann mehrere ASP.NET-Anwendungen hosten.</span><span class="sxs-lookup"><span data-stu-id="87947-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="87947-345">Wenn Sie für diese verschiedenen Anwendungen die Verwendung eines einzelnen Formular Authentifizierungs Tickets benötigen, ist es zwingend erforderlich, dass die Verschlüsselungs-und Validierungs Schlüssel einander entsprechen.</span><span class="sxs-lookup"><span data-stu-id="87947-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="87947-346">Wenn Sie in einer Webfarm Einstellung arbeiten oder Authentifizierungs Tickets für mehrere Anwendungen auf demselben Server freigeben, müssen Sie das &lt;machineKey-&gt; Element in den betroffenen Anwendungen konfigurieren, damit die Werte für "decryptionKey" und "validationKey" übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="87947-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="87947-347">Obwohl keines der obigen Szenarien für unsere Beispielanwendung gilt, können wir weiterhin explizite decryptionKey-und validationKey-Werte angeben und die zu verwendenden Algorithmen definieren.</span><span class="sxs-lookup"><span data-stu-id="87947-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="87947-348">Fügen Sie der Datei "Web. config" eine &lt;machineKey-&gt; Einstellung hinzu:</span><span class="sxs-lookup"><span data-stu-id="87947-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="87947-349">Weitere Informationen finden Sie [unter Vorgehensweise: Konfigurieren von machineKey in ASP.NET 2,0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="87947-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="87947-350">Die Werte "decryptionKey" und "validationKey" wurden von der [Webseite "perfekte Kenn Wörter](https://www.grc.com/passwords.htm)" von [Steve Gibson](http://www.grc.com/stevegibson.htm)entnommen, die auf jedem Seitenbesuch 64 zufällige hexadezimale Zeichen generiert.</span><span class="sxs-lookup"><span data-stu-id="87947-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="87947-351">Um die Wahrscheinlichkeit zu verringern, dass diese Schlüssel in ihren Produktionsanwendungen umgesetzt werden, wird empfohlen, die oben genannten Schlüssel durch zufällig generierte Schlüssel von der Seite "perfekte Kenn Wörter" zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="87947-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="87947-352">Schritt 4: Speichern zusätzlicher Benutzerdaten im Ticket</span><span class="sxs-lookup"><span data-stu-id="87947-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="87947-353">Viele Webanwendungen zeigen Informationen zu oder basieren auf der Anzeige der Seite auf dem aktuell angemeldeten Benutzer.</span><span class="sxs-lookup"><span data-stu-id="87947-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="87947-354">Beispielsweise kann eine Webseite den Namen des Benutzers und das Datum, an dem sich der letzte angemeldete, in der oberen Ecke jeder Seite anzeigt.</span><span class="sxs-lookup"><span data-stu-id="87947-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="87947-355">Das Formular Authentifizierungs Ticket speichert den Benutzernamen des aktuell angemeldeten Benutzers. Wenn jedoch weitere Informationen erforderlich sind, muss die Seite in den Benutzerspeicher (in der Regel eine Datenbank) gelangen, um die Informationen zu suchen, die nicht im Authentifizierungs Ticket gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="87947-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="87947-356">Mit etwas Code können wir zusätzliche Benutzerinformationen im Formular Authentifizierungs Ticket speichern.</span><span class="sxs-lookup"><span data-stu-id="87947-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="87947-357">Diese Daten können über die [UserData-Eigenschaft](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)der [FormsAuthenticationTicket-Klasse](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)ausgedrückt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="87947-358">Dies ist ein nützlicher Ort, um kleine Mengen von Informationen über den Benutzer zu platzieren, der häufig benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="87947-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="87947-359">Der in der UserData-Eigenschaft angegebene Wert ist als Teil des Authentifizierungs Ticket Cookies enthalten und wird, wie die anderen Ticket Felder, basierend auf der Konfiguration des Formular Authentifizierungssystems verschlüsselt und überprüft.</span><span class="sxs-lookup"><span data-stu-id="87947-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="87947-360">Standardmäßig ist "UserData" eine leere Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="87947-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="87947-361">Um Benutzerdaten im Authentifizierungs Ticket speichern zu können, müssen Sie auf der Anmeldeseite ein wenig Code schreiben, das die benutzerspezifischen Informationen erfasst und im Ticket speichert.</span><span class="sxs-lookup"><span data-stu-id="87947-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="87947-362">Da "UserData" eine Eigenschaft vom Typ "String" ist, müssen die darin gespeicherten Daten ordnungsgemäß als Zeichenfolge serialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="87947-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="87947-363">Stellen Sie sich beispielsweise vor, dass der Benutzerspeicher das Geburtsdatum des Benutzers und den Namen seines Arbeitgebers enthalten hat und wir diese beiden Eigenschaftswerte im Authentifizierungs Ticket speichern wollten.</span><span class="sxs-lookup"><span data-stu-id="87947-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="87947-364">Diese Werte könnten in eine Zeichenfolge serialisiert werden, indem das Datum der Geburts Zeichenfolge des Benutzers mit einer Pipe (|), gefolgt vom Namen des Arbeitgebers, verkettet wird.</span><span class="sxs-lookup"><span data-stu-id="87947-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="87947-365">Für einen Benutzer, der am 15. August 1974, der für Northwind Traders, geboren wurde, weisen wir der UserData-Eigenschaft die Zeichenfolge: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="87947-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="87947-366">Wenn Sie auf die im Ticket gespeicherten Daten zugreifen müssen, können wir dies tun, indem wir das FormsAuthenticationTicket der aktuellen Anforderung erfassen und die UserData-Eigenschaft deserialisieren.</span><span class="sxs-lookup"><span data-stu-id="87947-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="87947-367">Im Fall des Beispiels für das Geburtsdatum und den Namen des Arbeitgeber namens würden wir die UserData-Zeichenfolge basierend auf dem Trennzeichen (|) in zwei Teil Zeichenfolgen aufteilen.</span><span class="sxs-lookup"><span data-stu-id="87947-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="87947-368">[![zusätzlichen Benutzerinformationen können im Authentifizierungs Ticket gespeichert werden.](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="87947-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="87947-369">**Abbildung 04**: zusätzliche Benutzerinformationen können im Authentifizierungs Ticket gespeichert werden ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="87947-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="87947-370">Schreiben von Informationen in UserData</span><span class="sxs-lookup"><span data-stu-id="87947-370">Writing Information to UserData</span></span>

<span data-ttu-id="87947-371">Leider ist das Hinzufügen von benutzerspezifischen Informationen zu einem Formular Authentifizierungs Ticket nicht so einfach wie erwartet.</span><span class="sxs-lookup"><span data-stu-id="87947-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="87947-372">Die UserData-Eigenschaft der FormsAuthenticationTicket-Klasse ist schreibgeschützt und kann nur über den FormsAuthenticationTicket-Klassenkonstruktor angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="87947-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="87947-373">Wenn die UserData-Eigenschaft im Konstruktor angegeben wird, müssen auch die anderen Werte des Tickets angegeben werden: Benutzername, Ausgabedatum, Ablauf usw.</span><span class="sxs-lookup"><span data-stu-id="87947-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="87947-374">Als wir die Anmeldeseite im vorherigen Tutorial erstellt haben, wurde dies von der FormsAuthentication-Klasse für uns erledigt.</span><span class="sxs-lookup"><span data-stu-id="87947-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="87947-375">Beim Hinzufügen von UserData zu FormsAuthenticationTicket müssen wir Code schreiben, um einen Großteil der Funktionen zu replizieren, die bereits von der FormsAuthentication-Klasse bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="87947-376">Sehen wir uns den erforderlichen Code für die Arbeit mit UserData an, indem wir die Seite "Login. aspx" aktualisieren, um zusätzliche Informationen über den Benutzer für das Authentifizierungs Ticket aufzuzeichnen.</span><span class="sxs-lookup"><span data-stu-id="87947-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="87947-377">Angenommen, der Benutzerspeicher enthält Informationen über das Unternehmen, für den der Benutzer arbeitet, und seinen Titel, und wir möchten diese Informationen im Authentifizierungs Ticket erfassen.</span><span class="sxs-lookup"><span data-stu-id="87947-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="87947-378">Aktualisieren Sie den loginbutton-Ereignishandler der Login. aspx-Seite, sodass der Code wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="87947-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="87947-379">Wir können diesen Code schrittweise durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="87947-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="87947-380">Die Methode beginnt mit der Definition von vier Zeichen folgen Arrays: Benutzer, Kenn Wörter, Unternehmens Name und titleatcompany.</span><span class="sxs-lookup"><span data-stu-id="87947-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="87947-381">Diese Arrays enthalten die Benutzernamen, Kenn Wörter, Firmennamen und Titel für die Benutzerkonten im System, von denen es drei gibt: Scott, jisun und Sam.</span><span class="sxs-lookup"><span data-stu-id="87947-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="87947-382">In einer echten Anwendung werden diese Werte aus dem Benutzerspeicher abgefragt, nicht im Quellcode der Seite hart codiert.</span><span class="sxs-lookup"><span data-stu-id="87947-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="87947-383">Wenn die angegebenen Anmelde Informationen gültig sind, haben wir im vorherigen Tutorial einfach FormsAuthentication. RedirectFromLoginPage (username. Text, Erinnerungs Me. Check) aufgerufen, die die folgenden Schritte ausgeführt hat:</span><span class="sxs-lookup"><span data-stu-id="87947-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="87947-384">Das Formular Authentifizierungs Ticket wurde erstellt.</span><span class="sxs-lookup"><span data-stu-id="87947-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="87947-385">Das Ticket wurde in den entsprechenden Speicher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="87947-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="87947-386">Bei Cookies-basierten Authentifizierungs Tickets wird die cookiesammlung des Browsers verwendet. bei cookielosen Authentifizierungs Tickets werden die Ticketdaten in die URL serialisiert.</span><span class="sxs-lookup"><span data-stu-id="87947-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="87947-387">Der Benutzer wurde an die entsprechende Seite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="87947-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="87947-388">Diese Schritte werden im obigen Code repliziert.</span><span class="sxs-lookup"><span data-stu-id="87947-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="87947-389">Zuerst wird die Zeichenfolge, die letztendlich in der UserData-Eigenschaft gespeichert wird, durch Kombinieren des Firmennamens und des Titels gebildet, wobei die beiden Werte durch ein senkrechter Strich (|) getrennt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="87947-390">Dim userdatastring As String = String. Concat (CompanyName (i), "|", titleatcompany (i))</span><span class="sxs-lookup"><span data-stu-id="87947-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="87947-391">Als nächstes wird die FormsAuthentication. GetAuthCookie-Methode aufgerufen, die das Authentifizierungs Ticket erstellt, diese gemäß den Konfigurationseinstellungen verschlüsselt und überprüft und in einem HttpCookie-Objekt platziert.</span><span class="sxs-lookup"><span data-stu-id="87947-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="87947-392">Dim authCookie as HttpCookie = FormsAuthentication. GetAuthCookie (username. Text, Erinnerungen. aktiviert)</span><span class="sxs-lookup"><span data-stu-id="87947-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="87947-393">Um mit dem im Cookie eingebetteten formauthenticationticket-Ereignis arbeiten zu können, müssen wir die [Entschlüsselungsmethode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)der formauthentication-Klasse aufzurufen und dabei den Cookiewert übergeben.</span><span class="sxs-lookup"><span data-stu-id="87947-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="87947-394">Dim Ticket als FormsAuthenticationTicket = FormsAuthentication. entschlpt (authCookie. Value)</span><span class="sxs-lookup"><span data-stu-id="87947-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="87947-395">Anschließend erstellen wir eine *neue* FormsAuthenticationTicket-Instanz basierend auf den vorhandenen Werten von FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="87947-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="87947-396">Dieses neue Ticket enthält jedoch die benutzerspezifischen Informationen (userdatastring).</span><span class="sxs-lookup"><span data-stu-id="87947-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="87947-397">Dim newTicket als FormsAuthenticationTicket = New FormsAuthenticationTicket (Ticket. Version, Ticket. Name, Ticket. IssueDate, Ticket. Ablauf, Ticket. IsPersistent, userdatastring)</span><span class="sxs-lookup"><span data-stu-id="87947-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="87947-398">Anschließend verschlüsseln (und validieren) Sie die neue FormsAuthenticationTicket-Instanz, indem Sie die [Methode verschlüsseln](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)aufrufen und diese verschlüsselten (und validierten) Daten zurück in authCookie ablegen.</span><span class="sxs-lookup"><span data-stu-id="87947-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="87947-399">authCookie. Value = FormsAuthentication. verschlüsseln (newTicket)</span><span class="sxs-lookup"><span data-stu-id="87947-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="87947-400">Zum Schluss wird authCookie der Response. Cookies-Auflistung hinzugefügt, und die GetRedirectUrl-Methode wird aufgerufen, um die entsprechende Seite zum Senden des Benutzers zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="87947-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="87947-401">Der gesamte Code ist erforderlich, da die UserData-Eigenschaft schreibgeschützt ist und die FormsAuthentication-Klasse keine Methoden zum Angeben von UserData-Informationen in ihren GetAuthCookie-, SetAuthCookie-oder RedirectFromLoginPage-Methoden bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="87947-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-402">Der soeben untersuchte Code speichert benutzerspezifische Informationen in einem Cookie-basierten Authentifizierungs Ticket.</span><span class="sxs-lookup"><span data-stu-id="87947-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="87947-403">Die Klassen, die für die Serialisierung des Formular Authentifizierungs Tickets zur URL zuständig sind, sind intern für die .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="87947-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="87947-404">Lange Geschichte kurz: Sie können Benutzerdaten nicht in einem cookiless-Formular Authentifizierungs Ticket speichern.</span><span class="sxs-lookup"><span data-stu-id="87947-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="87947-405">Zugreifen auf die UserData-Informationen</span><span class="sxs-lookup"><span data-stu-id="87947-405">Accessing the UserData Information</span></span>

<span data-ttu-id="87947-406">An diesem Punkt werden die Firmennamen und der Titel jedes Benutzers in der UserData-Eigenschaft des Formular Authentifizierungs Tickets gespeichert, wenn Sie sich anmelden.</span><span class="sxs-lookup"><span data-stu-id="87947-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="87947-407">Auf diese Informationen kann über das Authentifizierungs Ticket auf einer beliebigen Seite zugegriffen werden, ohne dass eine Fahrt zum Benutzerspeicher erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="87947-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="87947-408">Um zu veranschaulichen, wie diese Informationen aus der UserData-Eigenschaft abgerufen werden können, aktualisieren Sie "default. aspx", sodass die Willkommensnachricht nicht nur den Namen des Benutzers enthält, sondern auch das Unternehmen, für das Sie arbeiten, und ihren Titel.</span><span class="sxs-lookup"><span data-stu-id="87947-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="87947-409">"Default. aspx" enthält derzeit ein "authentipeedmessagepanel"-Panel mit einem Label-Steuerelement namens "welcomebackmessage".</span><span class="sxs-lookup"><span data-stu-id="87947-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="87947-410">Dieser Bereich wird nur authentifizierten Benutzern angezeigt.</span><span class="sxs-lookup"><span data-stu-id="87947-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="87947-411">Aktualisieren Sie den Code auf der Seite "default. aspx"\_Load-Ereignishandler, sodass er wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="87947-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="87947-412">Wenn Request. IsAuthenticated auf true festgelegt ist, wird die Text-Eigenschaft von welcomebackmessage zuerst auf Willkommen zurück, *Benutzername*, festgelegt.</span><span class="sxs-lookup"><span data-stu-id="87947-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="87947-413">Anschließend wird die User. Identity-Eigenschaft in ein FormsIdentity-Objekt umgewandelt, sodass wir auf das zugrunde liegende FormsAuthenticationTicket zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="87947-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="87947-414">Sobald wir über das FormsAuthenticationTicket verfügen, deserialisieren wir die UserData-Eigenschaft in den Firmennamen und-Titel.</span><span class="sxs-lookup"><span data-stu-id="87947-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="87947-415">Dies erfolgt durch Aufteilen der Zeichenfolge auf das senkrechter Strich.</span><span class="sxs-lookup"><span data-stu-id="87947-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="87947-416">Der Name und der Titel des Unternehmens werden dann in der Bezeichnung "welcomebackmessage" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="87947-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="87947-417">Abbildung 5 zeigt einen Screenshot dieser Anzeige in Aktion.</span><span class="sxs-lookup"><span data-stu-id="87947-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="87947-418">Bei der Anmeldung als Scott wird eine Willkommensnachricht angezeigt, die Scott das Unternehmen und den Titel enthält.</span><span class="sxs-lookup"><span data-stu-id="87947-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="87947-419">[![das aktuell angemeldete Unternehmen und der Titel des angemeldeten Benutzers angezeigt werden.](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="87947-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="87947-420">**Abbildung 05**: das aktuell angemeldete Unternehmen und der Titel des angemeldeten Benutzers werden angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="87947-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="87947-421">Die UserData-Eigenschaft des Authentifizierungs Tickets dient als Cache für den Benutzerspeicher.</span><span class="sxs-lookup"><span data-stu-id="87947-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="87947-422">Wie bei jedem Cache muss er aktualisiert werden, wenn die zugrunde liegenden Daten geändert werden.</span><span class="sxs-lookup"><span data-stu-id="87947-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="87947-423">Wenn beispielsweise eine Webseite vorhanden ist, von der Benutzer ihr Profil aktualisieren können, müssen die in der UserData-Eigenschaft zwischengespeicherten Felder aktualisiert werden, um die vom Benutzer vorgenommenen Änderungen widerzuspiegeln.</span><span class="sxs-lookup"><span data-stu-id="87947-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="87947-424">Schritt 5: Verwenden eines benutzerdefinierten Prinzipals</span><span class="sxs-lookup"><span data-stu-id="87947-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="87947-425">Bei jeder eingehenden Anforderung versucht FormsAuthenticationModule, den Benutzer zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="87947-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="87947-426">Wenn ein nicht abgelaufenes Authentifizierungs Ticket vorhanden ist, weist das FormsAuthenticationModule die HttpContext. User-Eigenschaft einem neuen GenericPrincipal-Objekt zu.</span><span class="sxs-lookup"><span data-stu-id="87947-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="87947-427">Dieses GenericPrincipal-Objekt verfügt über eine Identität vom Typ FormsIdentity, die einen Verweis auf das Formular Authentifizierungs Ticket enthält.</span><span class="sxs-lookup"><span data-stu-id="87947-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="87947-428">Die GenericPrincipal-Klasse enthält die erforderliche Mindestfunktionalität, die von einer Klasse benötigt wird, die IPrincipal implementiert. Sie verfügt nur über eine Identity-Eigenschaft und eine IsInRole-Methode.</span><span class="sxs-lookup"><span data-stu-id="87947-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="87947-429">Das Prinzipal Objekt hat zwei Aufgaben: um anzugeben, welche Rollen der Benutzer angehört, und um Identitätsinformationen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="87947-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="87947-430">Dies erfolgt über die IsInRole (*roleName*)-Methode bzw. die Identity-Eigenschaft der IPrincipal-Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="87947-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="87947-431">Die GenericPrincipal-Klasse ermöglicht, dass ein Zeichen folgen Array mit Rollennamen über den zugehörigen Konstruktor angegeben wird. die IsInRole (*roleName*)-Methode überprüft lediglich, ob der übergebenen *roleName* im Zeichen folgen Array vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="87947-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="87947-432">Wenn das FormsAuthenticationModule den GenericPrincipal erstellt, übergibt es ein leeres Zeichen folgen Array an den Konstruktor von GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="87947-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="87947-433">Folglich geben alle Aufrufe von IsInRole immer false zurück.</span><span class="sxs-lookup"><span data-stu-id="87947-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="87947-434">Die GenericPrincipal-Klasse erfüllt die Anforderungen für die meisten Formular basierten Authentifizierungs Szenarios, in denen keine Rollen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="87947-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="87947-435">In Situationen, in denen die standardmäßige Rollen Behandlung unzureichend ist, oder wenn Sie dem Benutzer ein benutzerdefiniertes IIdentity-Objekt zuordnen müssen, können Sie ein benutzerdefiniertes IPrincipal-Objekt während des Authentifizierungs Workflows erstellen und es der HttpContext. User-Eigenschaft zuweisen.</span><span class="sxs-lookup"><span data-stu-id="87947-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-436">Wie wir in zukünftigen Tutorials sehen werden, wenn ASP. Das Rollen Framework von NET ist aktiviert und erstellt ein benutzerdefiniertes Prinzipal Objekt vom Typ [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) und überschreibt das von der Formular Authentifizierung erstellte GenericPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="87947-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="87947-437">Dies geschieht, um die IsInRole-Methode des Prinzipals mit der API des Rollen-Frameworks zu verbinden.</span><span class="sxs-lookup"><span data-stu-id="87947-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="87947-438">Da wir uns noch nicht mit Rollen befassen, besteht der einzige Grund, den wir für die Erstellung eines benutzerdefinierten Prinzipals zu diesem Zeitpunkt hätten, darin, dem Prinzipal ein benutzerdefiniertes IIdentity-Objekt zuzuordnen.</span><span class="sxs-lookup"><span data-stu-id="87947-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="87947-439">In Schritt 4 haben wir uns mit dem Speichern zusätzlicher Benutzerinformationen in der UserData-Eigenschaft des Authentifizierungs Tickets beschäftigt. Dies bezieht sich insbesondere auf den Firmennamen und den Titel des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="87947-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="87947-440">Die UserData-Informationen sind jedoch nur über das Authentifizierungs Ticket und nur dann als serialisierte Zeichenfolge zugänglich. Dies bedeutet, dass Sie immer dann, wenn wir die im Ticket gespeicherten Benutzerinformationen anzeigen möchten, die UserData-Eigenschaft analysieren müssen.</span><span class="sxs-lookup"><span data-stu-id="87947-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="87947-441">Wir können die Entwickler Leistung verbessern, indem wir eine Klasse erstellen, die IIdentity implementiert und die Eigenschaften "CompanyName" und "Title" enthält.</span><span class="sxs-lookup"><span data-stu-id="87947-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="87947-442">Auf diese Weise kann ein Entwickler direkt über die Eigenschaften "Unternehmenname" und "Title" auf den Namen und den Titel des angemeldeten Benutzers zugreifen, ohne zu wissen, wie die UserData-Eigenschaft analysiert werden muss.</span><span class="sxs-lookup"><span data-stu-id="87947-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="87947-443">Erstellen der benutzerdefinierten Identitäts-und Prinzipal Klassen</span><span class="sxs-lookup"><span data-stu-id="87947-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="87947-444">In diesem Tutorial erstellen wir die benutzerdefinierten Prinzipal-und Identitäts Objekte im Ordner App\_Code.</span><span class="sxs-lookup"><span data-stu-id="87947-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="87947-445">Fügen Sie zunächst dem Projekt eine APP\_Code Ordner hinzu. Klicken Sie mit der rechten Maustaste auf den Projektnamen in Projektmappen-Explorer, wählen Sie die Option ASP.NET Ordner hinzufügen aus, und wählen Sie App\_Code aus.</span><span class="sxs-lookup"><span data-stu-id="87947-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="87947-446">Der APP-\_Code Ordner ist ein spezieller ASP.NET-Ordner, der für die Website spezifische Klassendateien enthält.</span><span class="sxs-lookup"><span data-stu-id="87947-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="87947-447">Der APP-\_Code Ordner sollte nur verwendet werden, wenn Sie Ihr Projekt über das Website Projekt Modell verwalten.</span><span class="sxs-lookup"><span data-stu-id="87947-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="87947-448">Wenn Sie das [Webanwendungs Projekt Modell](https://msdn.microsoft.com/asp.net/Aa336618.aspx)verwenden, erstellen Sie einen Standardordner, und fügen Sie die-Klassen hinzu.</span><span class="sxs-lookup"><span data-stu-id="87947-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="87947-449">Beispielsweise können Sie einen neuen Ordner namens Classes hinzufügen und den Code dort platzieren.</span><span class="sxs-lookup"><span data-stu-id="87947-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="87947-450">Fügen Sie als nächstes dem App-\_Code Ordner zwei neue Klassendateien hinzu, eine mit dem Namen "customidentity. vb" und eine mit dem Namen "CustomPrincipal. vb".</span><span class="sxs-lookup"><span data-stu-id="87947-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>

<span data-ttu-id="87947-451">[![dem Projekt die customidentity-Klasse und die CustomPrincipal-Klasse hinzufügen](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="87947-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="87947-452">**Abbildung 06**: Hinzufügen der Klassen "customidentity" und "CustomPrincipal" zu Ihrem Projekt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="87947-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>

<span data-ttu-id="87947-453">Die customidentity-Klasse ist für die Implementierung der IIdentity-Schnittstelle zuständig, die die Eigenschaften "AuthenticationType", "IsAuthenticated" und "Name" definiert.</span><span class="sxs-lookup"><span data-stu-id="87947-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="87947-454">Zusätzlich zu den erforderlichen Eigenschaften möchten wir sowohl das zugrunde liegende Formular Authentifizierungs Ticket als auch die Eigenschaften für den Firmennamen und den Titel des Benutzers verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="87947-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="87947-455">Geben Sie den folgenden Code in die customidentity-Klasse ein.</span><span class="sxs-lookup"><span data-stu-id="87947-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="87947-456">Beachten Sie, dass die-Klasse eine FormsAuthenticationTicket-Member-Variable (\_Ticket) enthält und diese Ticketinformationen über den-Konstruktor angegeben werden müssen.</span><span class="sxs-lookup"><span data-stu-id="87947-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="87947-457">Diese Ticketdaten werden bei der Rückgabe des Identitäts namens verwendet. die UserData-Eigenschaft wird so analysiert, dass die Werte für die Eigenschaften "CompanyName" und "Title" zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="87947-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="87947-458">Erstellen Sie als nächstes die CustomPrincipal-Klasse.</span><span class="sxs-lookup"><span data-stu-id="87947-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="87947-459">Da wir zu diesem Zeitpunkt keine Rollen betreffen, akzeptiert der Konstruktor der CustomPrincipal-Klasse nur ein customidentity-Objekt. die IsInRole-Methode gibt immer false zurück.</span><span class="sxs-lookup"><span data-stu-id="87947-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="87947-460">Zuweisen eines CustomPrincipal-Objekts zum Sicherheitskontext der eingehenden Anforderung</span><span class="sxs-lookup"><span data-stu-id="87947-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="87947-461">Wir verfügen jetzt über eine Klasse, die die IIdentity-Standardspezifikation erweitert, sodass Sie die Eigenschaften "CompanyName" und "Title" sowie eine benutzerdefinierte Prinzipal Klasse enthält, die die benutzerdefinierte Identität verwendet.</span><span class="sxs-lookup"><span data-stu-id="87947-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="87947-462">Wir können die ASP.NET-Pipeline schrittweise ausführen und das benutzerdefinierte Prinzipal Objekt dem Sicherheitskontext der eingehenden Anforderung zuweisen.</span><span class="sxs-lookup"><span data-stu-id="87947-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="87947-463">Die ASP.NET-Pipeline nimmt eine eingehende Anforderung an und verarbeitet sie durch eine Reihe von Schritten.</span><span class="sxs-lookup"><span data-stu-id="87947-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="87947-464">Bei jedem Schritt wird ein bestimmtes Ereignis ausgelöst, sodass Entwickler in die ASP.NET-Pipeline tippen und die Anforderung an bestimmten Punkten im Lebenszyklus ändern können.</span><span class="sxs-lookup"><span data-stu-id="87947-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="87947-465">Das FormsAuthenticationModule-Modul wartet beispielsweise darauf, dass ASP.NET das [AuthenticateRequest-Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)aufhebt. an diesem Punkt wird die eingehende Anforderung für ein Authentifizierungs Ticket überprüft.</span><span class="sxs-lookup"><span data-stu-id="87947-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="87947-466">Wenn ein Authentifizierungs Ticket gefunden wird, wird ein GenericPrincipal-Objekt erstellt und der HttpContext. User-Eigenschaft zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="87947-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="87947-467">Nach dem AuthenticateRequest-Ereignis löst die ASP.NET-Pipeline das [PostAuthenticateRequest-Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx)aus, in dem wir das von FormsAuthenticationModule erstellte GenericPrincipal-Objekt durch eine Instanz des CustomPrincipal-Objekts ersetzen können.</span><span class="sxs-lookup"><span data-stu-id="87947-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="87947-468">In Abbildung 7 ist dieser Workflow dargestellt.</span><span class="sxs-lookup"><span data-stu-id="87947-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="87947-469">[![GenericPrincipal im postauthenticationrequest-Ereignis durch einen CustomPrincipal ersetzt](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="87947-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="87947-470">**Abbildung 07**: GenericPrincipal wird im postauthenticationrequest-Ereignis durch einen CustomPrincipal ersetzt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="87947-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>

<span data-ttu-id="87947-471">Um Code als Reaktion auf ein ASP.NET-Pipeline Ereignis auszuführen, können wir entweder den entsprechenden Ereignishandler in "Global. asax" erstellen oder ein eigenes HTTP-Modul erstellen.</span><span class="sxs-lookup"><span data-stu-id="87947-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="87947-472">In diesem Tutorial erstellen wir den Ereignishandler in "Global. asax".</span><span class="sxs-lookup"><span data-stu-id="87947-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="87947-473">Fügen Sie zunächst Global. asax zu Ihrer Website hinzu.</span><span class="sxs-lookup"><span data-stu-id="87947-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="87947-474">Klicken Sie in Projektmappen-Explorer mit der rechten Maustaste auf den Projektnamen, und fügen Sie ein Element des Typs globale Anwendungsklasse mit dem Namen Global. asax hinzu.</span><span class="sxs-lookup"><span data-stu-id="87947-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="87947-475">[![Ihrer Website eine Global. asax-Datei hinzufügen](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="87947-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="87947-476">**Abbildung 08**: Hinzufügen einer Global. asax-Datei zu Ihrer Website ([Klicken Sie, um das Bild in voller Größe anzuzeigen](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="87947-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>

<span data-ttu-id="87947-477">Die Standardvorlage "Global. asax" umfasst Ereignishandler für eine Reihe von ASP.NET-Pipeline Ereignissen, einschließlich Start-, End-und [Fehler Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx).</span><span class="sxs-lookup"><span data-stu-id="87947-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="87947-478">Sie können diese Ereignishandler auch entfernen, da Sie für diese Anwendung nicht benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="87947-479">Das Ereignis, an dem wir interessiert sind, ist PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="87947-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="87947-480">Aktualisieren Sie Ihre Global. asax-Datei, damit das Markup in etwa wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="87947-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="87947-481">Die Anwendung\_onpostauthenticaterequest-Methode wird jedes Mal ausgeführt, wenn die ASP.NET-Laufzeit das PostAuthenticateRequest-Ereignis auslöst, das einmal bei jeder eingehenden Seiten Anforderung auftritt.</span><span class="sxs-lookup"><span data-stu-id="87947-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="87947-482">Der Ereignishandler prüft zunächst, ob der Benutzer authentifiziert ist und über die Formular Authentifizierung authentifiziert wurde.</span><span class="sxs-lookup"><span data-stu-id="87947-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="87947-483">Wenn dies der Fall ist, wird ein neues customidentity-Objekt erstellt, und das Authentifizierungs Ticket der aktuellen Anforderung wird in seinem Konstruktor übergeben.</span><span class="sxs-lookup"><span data-stu-id="87947-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="87947-484">Danach wird ein CustomPrincipal-Objekt erstellt und an das soeben erstellte customidentity-Objekt im Konstruktor übergeben.</span><span class="sxs-lookup"><span data-stu-id="87947-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="87947-485">Schließlich wird der Sicherheitskontext der aktuellen Anforderung dem neu erstellten CustomPrincipal-Objekt zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="87947-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="87947-486">Beachten Sie, dass der letzte Schritt, der das CustomPrincipal-Objekt mit dem Sicherheitskontext der Anforderung verknüpft, dem Prinzipal zwei Eigenschaften zugewiesen wird: HttpContext. User und Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="87947-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="87947-487">Diese beiden Zuweisungen sind aufgrund der Art und Weise erforderlich, wie Sicherheits Kontexte in ASP.NET behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="87947-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="87947-488">Der .NET Framework ordnet jedem laufenden Thread einen Sicherheitskontext zu. Diese Informationen stehen als IPrincipal-Objekt über die [CurrentPrincipal-Eigenschaft](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)des [Thread Objekts](https://msdn.microsoft.com/library/system.threading.thread.aspx)zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="87947-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="87947-489">Was verwirrend ist, besteht darin, dass ASP.net über eigene Sicherheitskontext Informationen (HttpContext. User) verfügt.</span><span class="sxs-lookup"><span data-stu-id="87947-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="87947-490">In bestimmten Szenarien wird die Thread. CurrentPrincipal-Eigenschaft bei der Ermittlung des Sicherheits Kontexts untersucht. in anderen Szenarien wird HttpContext. User verwendet.</span><span class="sxs-lookup"><span data-stu-id="87947-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="87947-491">Beispielsweise gibt es in .NET Sicherheitsfunktionen, mit denen Entwickler deklarativ angeben können, welche Benutzer oder Rollen eine Klasse instanziieren oder bestimmte Methoden aufrufen können (Weitere Informationen finden [Sie unter Hinzufügen von Autorisierungs Regeln zu Geschäfts-und Daten Ebenen mithilfe von "PrincipalPermissionAttribute](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)").</span><span class="sxs-lookup"><span data-stu-id="87947-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="87947-492">Im Hintergrund bestimmen diese deklarativen Techniken den Sicherheitskontext über die Thread. CurrentPrincipal-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="87947-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="87947-493">In anderen Szenarien wird die HttpContext. User-Eigenschaft verwendet.</span><span class="sxs-lookup"><span data-stu-id="87947-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="87947-494">Im vorherigen Tutorial haben wir beispielsweise diese Eigenschaft verwendet, um den Benutzernamen des aktuell angemeldeten Benutzers anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="87947-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="87947-495">Natürlich ist es zwingend erforderlich, dass die Sicherheitskontext Informationen in den Eigenschaften "Thread. CurrentPrincipal" und "HttpContext. User" übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="87947-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="87947-496">Die ASP.NET-Laufzeit synchronisiert diese Eigenschaftswerte automatisch für uns.</span><span class="sxs-lookup"><span data-stu-id="87947-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="87947-497">Diese Synchronisierung erfolgt jedoch nach dem AuthenticateRequest-Ereignis, jedoch *vor* dem PostAuthenticateRequest-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="87947-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="87947-498">Folglich muss beim Hinzufügen eines benutzerdefinierten Prinzipals im PostAuthenticateRequest-Ereignis sicher sein, dass der Thread. CurrentPrincipal oder else Thread. CurrentPrincipal und HttpContext. User nicht synchronisiert werden. Eine ausführlichere Erläuterung zu diesem Problem finden Sie unter [context. User im Vergleich zu Thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) .</span><span class="sxs-lookup"><span data-stu-id="87947-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="87947-499">Zugreifen auf die CompanyName-und Title-Eigenschaften</span><span class="sxs-lookup"><span data-stu-id="87947-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="87947-500">Wenn eine Anforderung eingeht und an die ASP.net-Engine weitergeleitet wird, wird die Anwendung\_onpostauthenticaterequest-Ereignishandler in "Global. asax" ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="87947-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="87947-501">Wenn die Anforderung erfolgreich durch das FormsAuthenticationModule authentifiziert wurde, erstellt der Ereignishandler ein neues CustomPrincipal-Objekt mit einem customidentity-Objekt auf Grundlage des Formular Authentifizierungs Tickets.</span><span class="sxs-lookup"><span data-stu-id="87947-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="87947-502">Wenn diese Logik eingerichtet ist, ist der Zugriff auf Informationen über den Firmennamen und den Titel des aktuell angemeldeten Benutzers unglaublich unkompliziert.</span><span class="sxs-lookup"><span data-stu-id="87947-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="87947-503">Kehren Sie zur Seite\_Load-Ereignishandler in Default. aspx zurück. in Schritt 4 haben wir Code geschrieben, um das Formular Authentifizierungs Ticket abzurufen und die UserData-Eigenschaft zu analysieren, um den Firmennamen und den Titel des Benutzers anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="87947-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="87947-504">Wenn die CustomPrincipal-und customidentity-Objekte jetzt verwendet werden, ist es nicht erforderlich, die Werte aus der UserData-Eigenschaft des Tickets zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="87947-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="87947-505">Verwenden Sie stattdessen einfach einen Verweis auf das customidentity-Objekt, und verwenden Sie die Eigenschaften "CompanyName" und "Title":</span><span class="sxs-lookup"><span data-stu-id="87947-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="87947-506">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="87947-506">Summary</span></span>

<span data-ttu-id="87947-507">In diesem Tutorial wurde erläutert, wie die Einstellungen des Formular Authentifizierungssystems über "Web. config" angepasst werden. Wir haben uns angesehen, wie das Ablaufdatum des Authentifizierungs Tickets behandelt wird und wie die Verschlüsselungs-und Validierungs Schutzvorrichtungen verwendet werden, um das Ticket vor Prüfung und Änderungen zu schützen.</span><span class="sxs-lookup"><span data-stu-id="87947-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="87947-508">Schließlich haben wir die Verwendung der UserData-Eigenschaft des Authentifizierungs Tickets erläutert, um zusätzliche Benutzerinformationen im Ticket selbst zu speichern, und wie benutzerdefinierte Prinzipal-und Identitäts Objekte verwendet werden, um diese Informationen auf Entwickler freundlichere Weise verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="87947-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="87947-509">In diesem Tutorial wird die Untersuchung der Formular Authentifizierung in ASP.net abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="87947-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="87947-510">Im nächsten Tutorial wird unsere Tour in das Mitgliedschafts Framework gestartet.</span><span class="sxs-lookup"><span data-stu-id="87947-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="87947-511">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="87947-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="87947-512">Weitere nützliche Informationen</span><span class="sxs-lookup"><span data-stu-id="87947-512">Further Reading</span></span>

<span data-ttu-id="87947-513">Weitere Informationen zu den in diesem Tutorial behandelten Themen finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="87947-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="87947-514">Dissecting der Formular Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="87947-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="87947-515">Erläutert: Formular Authentifizierung in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="87947-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="87947-516">Vorgehensweise: Schützen der Formular Authentifizierung in ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="87947-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="87947-517">[Professional ASP.NET 2,0 Sicherheit, Mitgliedschaft und Rollen Verwaltung](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="87947-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="87947-518">Sichern von Anmelde Steuerelementen</span><span class="sxs-lookup"><span data-stu-id="87947-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="87947-519">Das &lt;Authentication&gt;-Element</span><span class="sxs-lookup"><span data-stu-id="87947-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="87947-520">Das &lt;Forms&gt; Element für &lt;Authentifizierung&gt;</span><span class="sxs-lookup"><span data-stu-id="87947-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="87947-521">Das &lt;machineKey-&gt; Element</span><span class="sxs-lookup"><span data-stu-id="87947-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="87947-522">Verständnis des Formular Authentifizierungs Tickets und Cookies</span><span class="sxs-lookup"><span data-stu-id="87947-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="87947-523">Video Schulung zu Themen in diesem Tutorial</span><span class="sxs-lookup"><span data-stu-id="87947-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="87947-524">Vorgehensweise beim Ändern der Eigenschaften der Formular Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="87947-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="87947-525">Einrichten und Verwenden der Authentifizierung ohne Cookies in einer ASP.NET-Anwendung</span><span class="sxs-lookup"><span data-stu-id="87947-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="87947-526">Verschieben der ASP-Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="87947-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="87947-527">Benutzerdefinierte Schlüsselkonfiguration für die Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="87947-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="87947-528">Hinzufügen von benutzerdefinierten Daten zur Authentifizierungsmethode</span><span class="sxs-lookup"><span data-stu-id="87947-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="87947-529">Verwenden von benutzerdefinierten Prinzipalobjekten</span><span class="sxs-lookup"><span data-stu-id="87947-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="87947-530">Zum Autor</span><span class="sxs-lookup"><span data-stu-id="87947-530">About the Author</span></span>

<span data-ttu-id="87947-531">Scott Mitchell, Autor mehrerer ASP/ASP. net-Bücher und Gründer von 4GuysFromRolla.com, hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="87947-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="87947-532">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="87947-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="87947-533">Sein letztes Buch ist *[Sams Teach Yourself ASP.NET 2,0 in 24 Stunden](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="87947-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="87947-534">Scott kann über [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) oder über seinen Blog unter [http://ScottOnWriting.NET](http://scottonwriting.net/)erreicht werden.</span><span class="sxs-lookup"><span data-stu-id="87947-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="87947-535">Besonders vielen Dank</span><span class="sxs-lookup"><span data-stu-id="87947-535">Special Thanks To</span></span>

<span data-ttu-id="87947-536">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="87947-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="87947-537">Lead Reviewer für dieses Tutorial war Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="87947-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="87947-538">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="87947-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="87947-539">Wenn dies der Fall ist, können Sie eine Zeile in [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com)ablegen.</span><span class="sxs-lookup"><span data-stu-id="87947-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="87947-540">Previous</span><span class="sxs-lookup"><span data-stu-id="87947-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
