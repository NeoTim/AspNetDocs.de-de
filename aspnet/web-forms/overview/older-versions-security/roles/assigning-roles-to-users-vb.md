---
uid: web-forms/overview/older-versions-security/roles/assigning-roles-to-users-vb
title: Zuweisen von Rollen zu Benutzern (VB) | Microsoft-Dokumentation
author: rick-anderson
description: In diesem Tutorial erstellen wir zwei ASP.NET-Seiten, um die Verwaltung der Benutzer zu unterstützen, die zu welchen Rollen gehören. Die erste Seite enthält Funktionen, um zu sehen, was...
ms.author: riande
ms.date: 03/24/2008
ms.assetid: fd208ee9-69cc-4467-9783-b4e039bdd1d3
msc.legacyurl: /web-forms/overview/older-versions-security/roles/assigning-roles-to-users-vb
msc.type: authoredcontent
ms.openlocfilehash: b53df4494eb0faef7c5e4547c2bf95e5fb071298
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/28/2019
ms.locfileid: "74577858"
---
# <a name="assigning-roles-to-users-vb"></a><span data-ttu-id="c773f-104">Zuweisen von Rollen an Benutzer (VB)</span><span class="sxs-lookup"><span data-stu-id="c773f-104">Assigning Roles to Users (VB)</span></span>

<span data-ttu-id="c773f-105">von [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c773f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c773f-106">[Code herunterladen](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.10.zip) oder [PDF herunterladen](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c773f-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.10.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_vb.pdf)</span></span>

> <span data-ttu-id="c773f-107">In diesem Tutorial erstellen wir zwei ASP.NET-Seiten, um die Verwaltung der Benutzer zu unterstützen, die zu welchen Rollen gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-107">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="c773f-108">Die erste Seite enthält Funktionen, um zu sehen, welche Benutzer zu einer bestimmten Rolle gehören, welche Rollen ein bestimmter Benutzer angehört, und die Möglichkeit, einen bestimmten Benutzer einer bestimmten Rolle zuzuweisen oder zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-108">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="c773f-109">Auf der zweiten Seite erweitern wir das Steuerelement "kreateuserwizard", sodass es einen Schritt zum Angeben der Rollen enthält, zu denen der neu erstellte Benutzer gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-109">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="c773f-110">Dies ist in Szenarios nützlich, in denen ein Administrator neue Benutzerkonten erstellen kann.</span><span class="sxs-lookup"><span data-stu-id="c773f-110">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

## <a name="introduction"></a><span data-ttu-id="c773f-111">Einführung</span><span class="sxs-lookup"><span data-stu-id="c773f-111">Introduction</span></span>

<span data-ttu-id="c773f-112">Im <a id="_msoanchor_1"> </a> [vorherigen Tutorial](creating-and-managing-roles-vb.md) wurden das Rollen Framework und die `SqlRoleProvider`untersucht. Wir haben gesehen, wie Sie die `Roles`-Klasse zum Erstellen, abrufen und Löschen von Rollen verwenden.</span><span class="sxs-lookup"><span data-stu-id="c773f-112">The <a id="_msoanchor_1"></a>[previous tutorial](creating-and-managing-roles-vb.md) examined the Roles framework and the `SqlRoleProvider`; we saw how to use the `Roles` class to create, retrieve, and delete roles.</span></span> <span data-ttu-id="c773f-113">Zusätzlich zum Erstellen und Löschen von Rollen müssen wir in der Lage sein, Benutzer einer Rolle zuzuweisen oder zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-113">In addition to creating and deleting roles, we need to be able to assign or remove users from a role.</span></span> <span data-ttu-id="c773f-114">Leider wird ASP.net nicht mit websteuer Elementen ausgeliefert, um zu verwalten, welche Benutzer zu welchen Rollen gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-114">Unfortunately, ASP.NET does not ship with any Web controls for managing what users belong to what roles.</span></span> <span data-ttu-id="c773f-115">Stattdessen müssen wir eigene ASP.NET-Seiten erstellen, um diese Zuordnungen zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="c773f-115">Instead, we must create our own ASP.NET pages to manage these associations.</span></span> <span data-ttu-id="c773f-116">Die gute Nachricht ist, dass das Hinzufügen und Entfernen von Benutzern zu Rollen recht einfach ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-116">The good news is that adding and removing users to roles is quite easy.</span></span> <span data-ttu-id="c773f-117">Die `Roles`-Klasse enthält eine Reihe von Methoden zum Hinzufügen von Benutzern zu mindestens einer Rolle.</span><span class="sxs-lookup"><span data-stu-id="c773f-117">The `Roles` class contains a number of methods for adding one or more users to one or more roles.</span></span>

<span data-ttu-id="c773f-118">In diesem Tutorial erstellen wir zwei ASP.NET-Seiten, um die Verwaltung der Benutzer zu unterstützen, die zu welchen Rollen gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-118">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="c773f-119">Die erste Seite enthält Funktionen, um zu sehen, welche Benutzer zu einer bestimmten Rolle gehören, welche Rollen ein bestimmter Benutzer angehört, und die Möglichkeit, einen bestimmten Benutzer einer bestimmten Rolle zuzuweisen oder zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-119">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="c773f-120">Auf der zweiten Seite erweitern wir das Steuerelement "kreateuserwizard", sodass es einen Schritt zum Angeben der Rollen enthält, zu denen der neu erstellte Benutzer gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-120">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="c773f-121">Dies ist in Szenarios nützlich, in denen ein Administrator neue Benutzerkonten erstellen kann.</span><span class="sxs-lookup"><span data-stu-id="c773f-121">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

<span data-ttu-id="c773f-122">Fangen wir an!</span><span class="sxs-lookup"><span data-stu-id="c773f-122">Let's get started!</span></span>

## <a name="listing-what-users-belong-to-what-roles"></a><span data-ttu-id="c773f-123">Auflisten, welche Benutzer zu welchen Rollen gehören</span><span class="sxs-lookup"><span data-stu-id="c773f-123">Listing What Users Belong To What Roles</span></span>

<span data-ttu-id="c773f-124">Die erste Geschäftsordnung für dieses Tutorial besteht darin, eine Webseite zu erstellen, von der Benutzer Rollen zugewiesen werden können.</span><span class="sxs-lookup"><span data-stu-id="c773f-124">The first order of business for this tutorial is to create a web page from which users can be assigned to roles.</span></span> <span data-ttu-id="c773f-125">Bevor wir uns mit der Zuweisung von Benutzern zu Rollen befassen, konzentrieren wir uns zunächst darauf, wie Sie bestimmen können, welche Benutzer zu welchen Rollen gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-125">Before we concern ourselves with how to assign users to roles, let's first concentrate on how to determine what users belong to what roles.</span></span> <span data-ttu-id="c773f-126">Diese Informationen können auf zwei Arten angezeigt werden: "nach Rolle" oder "nach Benutzer".</span><span class="sxs-lookup"><span data-stu-id="c773f-126">There are two ways to display this information: "by role" or "by user."</span></span> <span data-ttu-id="c773f-127">Wir könnten dem Besucher gestatten, eine Rolle auszuwählen und dann alle Benutzer anzuzeigen, die der Rolle angehören (die "nach Rolle"-Anzeige). Alternativ können wir den Besucher auffordern, einen Benutzer auszuwählen, und ihm dann die Rollen anzeigen, die diesem Benutzer zugewiesen sind (die "nach Benutzer"-Anzeige).</span><span class="sxs-lookup"><span data-stu-id="c773f-127">We could allow the visitor to select a role and then show them all of the users that belong to the role (the "by role" display), or we could prompt the visitor to select a user and then show them the roles assigned to that user (the "by user" display).</span></span>

<span data-ttu-id="c773f-128">Die Ansicht "nach Rolle" ist hilfreich in Situationen, in denen der Besucher die Gruppe von Benutzern, die zu einer bestimmten Rolle gehören, kennen möchte. die Ansicht "nach Benutzer" ist ideal, wenn der Besucher die Rolle (n) eines bestimmten Benutzers kennen muss.</span><span class="sxs-lookup"><span data-stu-id="c773f-128">The "by role" view is useful in circumstances where the visitor wants to know the set of users that belong to a particular role; the "by user" view is ideal when the visitor needs to know a particular user's role(s).</span></span> <span data-ttu-id="c773f-129">Wir möchten, dass unsere Seite sowohl die Schnittstellen "nach Rolle" als auch "nach Benutzer" enthält.</span><span class="sxs-lookup"><span data-stu-id="c773f-129">Let's have our page include both "by role" and "by user" interfaces.</span></span>

<span data-ttu-id="c773f-130">Wir beginnen mit der Erstellung der "by User"-Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="c773f-130">We will start with creating the "by user" interface.</span></span> <span data-ttu-id="c773f-131">Diese Schnittstelle besteht aus einer Dropdown Liste und einer Liste von Kontrollkästchen.</span><span class="sxs-lookup"><span data-stu-id="c773f-131">This interface will consist of a drop-down list and a list of checkboxes.</span></span> <span data-ttu-id="c773f-132">Die Dropdown Liste wird mit der Gruppe der Benutzer im System aufgefüllt. mit den Kontrollkästchen werden die Rollen aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="c773f-132">The drop-down list will be populated with the set of users in the system; the checkboxes will enumerate the roles.</span></span> <span data-ttu-id="c773f-133">Wenn Sie einen Benutzer aus der Dropdown Liste auswählen, werden die Rollen überprüft, zu denen der Benutzer gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-133">Selecting a user from the drop-down list will check those roles the user belongs to.</span></span> <span data-ttu-id="c773f-134">Die Person, die die Seite besucht, kann dann die Kontrollkästchen aktivieren bzw. deaktivieren, um den ausgewählten Benutzer den entsprechenden Rollen hinzuzufügen oder zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-134">The person visiting the page can then check or uncheck the checkboxes to add or remove the selected user from the corresponding roles.</span></span>

> [!NOTE]
> <span data-ttu-id="c773f-135">Das Verwenden einer Dropdown Liste zum Auflisten der Benutzerkonten ist nicht die ideale Wahl für Websites, auf denen möglicherweise Hunderte von Benutzerkonten vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="c773f-135">Using a drop-down list to list the user accounts is not an ideal choice for websites where there may be hundreds of user accounts.</span></span> <span data-ttu-id="c773f-136">Eine Dropdown Liste ist so konzipiert, dass Benutzer ein Element aus einer relativ kurzen Liste von Optionen auswählen können.</span><span class="sxs-lookup"><span data-stu-id="c773f-136">A drop-down list is designed to allow a user to pick one item from a relatively short list of options.</span></span> <span data-ttu-id="c773f-137">Die Anzahl der Listenelemente wächst schnell, wenn die Anzahl der Listenelemente wächst.</span><span class="sxs-lookup"><span data-stu-id="c773f-137">It quickly becomes unwieldy as the number of list items grows.</span></span> <span data-ttu-id="c773f-138">Wenn Sie eine Website mit einer potenziell großen Anzahl von Benutzerkonten entwickeln, empfiehlt es sich, eine alternative Benutzeroberfläche zu verwenden, z. b. eine ausführbare GridView oder eine filterbare Schnittstelle, die den Besucher auffordert, einen Buchstaben auszuwählen. zeigt die Benutzer an, deren Benutzername mit dem ausgewählten Buchstaben beginnt.</span><span class="sxs-lookup"><span data-stu-id="c773f-138">If you are building a website that will have potentially large numbers of user accounts, you may want to consider using an alternative user interface, such as a pageable GridView or a filterable interface that lists prompts the visitor to choose a letter and then only shows those users whose username starts with the selected letter.</span></span>

## <a name="step-1-building-the-by-user-user-interface"></a><span data-ttu-id="c773f-139">Schritt 1: entwickeln der Benutzeroberfläche "by User"</span><span class="sxs-lookup"><span data-stu-id="c773f-139">Step 1: Building the "By User" User Interface</span></span>

<span data-ttu-id="c773f-140">Öffnen Sie die Seite `UsersAndRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c773f-140">Open the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="c773f-141">Fügen Sie am oberen Rand der Seite ein Label-websteuer Element mit dem Namen `ActionStatus` hinzu, und löschen Sie dessen `Text`-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="c773f-141">At the top of the page, add a Label Web control named `ActionStatus` and clear out its `Text` property.</span></span> <span data-ttu-id="c773f-142">Wir verwenden diese Bezeichnung, um Feedback zu den durchgeführten Aktionen bereitzustellen, wie z. b. "Benutzer-Tito wurde der Rolle" Administratoren "hinzugefügt wurde, oder" User jisun wurde aus der Rolle "Supervisor" entfernt.</span><span class="sxs-lookup"><span data-stu-id="c773f-142">We will use this Label to provide feedback on the actions performed, displaying messages like, "User Tito has been added to the Administrators role," or "User Jisun has been removed from the Supervisors role."</span></span> <span data-ttu-id="c773f-143">Damit diese Nachrichten ausfallen, legen Sie die `CssClass`-Eigenschaft der Bezeichnung auf "wichtig" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-143">In order to make these messages stand out, set the Label's `CssClass` property to "Important".</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample1.aspx)]

<span data-ttu-id="c773f-144">Fügen Sie anschließend der `Styles.css` Stylesheet die folgende CSS-Klassendefinition hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-144">Next, add the following CSS class definition to the `Styles.css` stylesheet:</span></span>

[!code-css[Main](assigning-roles-to-users-vb/samples/sample2.css)]

<span data-ttu-id="c773f-145">Diese CSS-Definition weist den Browser an, die Bezeichnung mit einer großen, roten Schriftart anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="c773f-145">This CSS definition instructs the browser to display the Label using a large, red font.</span></span> <span data-ttu-id="c773f-146">Abbildung 1 zeigt diesen Effekt durch den Visual Studio-Designer.</span><span class="sxs-lookup"><span data-stu-id="c773f-146">Figure 1 shows this effect through the Visual Studio Designer.</span></span>

<span data-ttu-id="c773f-147">[![die CssClass-Eigenschaft der Bezeichnung eine große, rote Schriftart ergibt](assigning-roles-to-users-vb/_static/image2.png)](assigning-roles-to-users-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-147">[![The Label's CssClass Property Results in a Large, Red Font](assigning-roles-to-users-vb/_static/image2.png)](assigning-roles-to-users-vb/_static/image1.png)</span></span>

<span data-ttu-id="c773f-148">**Abbildung 1**: die `CssClass`-Eigenschaft der Bezeichnung ergibt eine große rote Schriftart ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-148">**Figure 1**: The Label's `CssClass` Property Results in a Large, Red Font  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image3.png))</span></span>

<span data-ttu-id="c773f-149">Fügen Sie als nächstes der Seite eine DropDownList hinzu, legen Sie die `ID`-Eigenschaft auf `UserList`fest, und legen Sie deren `AutoPostBack`-Eigenschaft auf true fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-149">Next, add a DropDownList to the page, set its `ID` property to `UserList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="c773f-150">Wir verwenden diese Dropdown Liste, um alle Benutzer im System aufzulisten.</span><span class="sxs-lookup"><span data-stu-id="c773f-150">We will use this DropDownList to list all of the users in the system.</span></span> <span data-ttu-id="c773f-151">Diese Dropdown List wird an eine Auflistung von mitgliedfassungs Objekten gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-151">This DropDownList will be bound to a collection of MembershipUser objects.</span></span> <span data-ttu-id="c773f-152">Da in der Dropdown Liste die UserName-Eigenschaft des Membership shipuser-Objekts angezeigt werden soll (und als Wert der Listenelemente verwendet werden soll), legen Sie die Eigenschaften `DataTextField` und `DataValueField` der Dropdown Liste auf "username" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-152">Because we want the DropDownList to display the UserName property of the MembershipUser object (and use it as the value of the list items), set the DropDownList's `DataTextField` and `DataValueField` properties to "UserName".</span></span>

<span data-ttu-id="c773f-153">Fügen Sie unterhalb der Dropdown List einen Repeater mit dem Namen `UsersRoleList`hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-153">Underneath the DropDownList, add a Repeater named `UsersRoleList`.</span></span> <span data-ttu-id="c773f-154">Mit diesem Wiederholungs Modul werden alle Rollen im System als eine Reihe von Kontrollkästchen aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="c773f-154">This Repeater will list all of the roles in the system as a series of checkboxes.</span></span> <span data-ttu-id="c773f-155">Definieren Sie die `ItemTemplate` des Repeater mit dem folgenden deklarativen Markup:</span><span class="sxs-lookup"><span data-stu-id="c773f-155">Define the Repeater's `ItemTemplate` using the following declarative markup:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample3.aspx)]

<span data-ttu-id="c773f-156">Das `ItemTemplate` Markup enthält ein einzelnes CheckBox-websteuer Element mit dem Namen `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="c773f-156">The `ItemTemplate` markup includes a single CheckBox Web control named `RoleCheckBox`.</span></span> <span data-ttu-id="c773f-157">Die `AutoPostBack`-Eigenschaft des Kontrollkästchens ist auf true festgelegt, und die Eigenschaft `Text` ist an `Container.DataItem`gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-157">The CheckBox's `AutoPostBack` property is set to True and the `Text` property is bound to `Container.DataItem`.</span></span> <span data-ttu-id="c773f-158">Der Grund hierfür ist, dass die Datenbindung-Syntax einfach `Container.DataItem` ist, weil das Rollen Framework die Liste der Rollennamen als Zeichen folgen Array zurückgibt. dieses Zeichen folgen Array wird an den Wiederholungs Dienst gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-158">The reason the databinding syntax is simply `Container.DataItem` is because the Roles framework returns the list of role names as a string array, and it is this string array that we will be binding to the Repeater.</span></span> <span data-ttu-id="c773f-159">Eine ausführliche Beschreibung, warum diese Syntax verwendet wird, um den Inhalt eines Arrays anzuzeigen, das an ein datenweb-Steuerelement gebunden ist, geht über den Rahmen dieses Tutorials hinaus.</span><span class="sxs-lookup"><span data-stu-id="c773f-159">A thorough description of why this syntax is used to display the contents of an array bound to a data Web control is beyond the scope of this tutorial.</span></span> <span data-ttu-id="c773f-160">Weitere Informationen zu diesem Thema finden Sie unter [Binden eines skalaren Arrays an ein datenweb-Steuer](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)Element.</span><span class="sxs-lookup"><span data-stu-id="c773f-160">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="c773f-161">An diesem Punkt sollte das deklarative Markup Ihrer Benutzeroberfläche in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="c773f-161">At this point your "by user" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample4.aspx)]

<span data-ttu-id="c773f-162">Wir sind nun bereit, den Code zu schreiben, um die Gruppe der Benutzerkonten an die Dropdown Liste und den Satz von Rollen an den Repeater zu binden.</span><span class="sxs-lookup"><span data-stu-id="c773f-162">We are now ready to write the code to bind the set of user accounts to the DropDownList and the set of roles to the Repeater.</span></span> <span data-ttu-id="c773f-163">Fügen Sie in der Code Behind-Klasse der Seite eine Methode mit dem Namen `BindUsersToUserList` und eine weitere mit dem Namen `BindRolesList`hinzu, indem Sie den folgenden Code verwenden:</span><span class="sxs-lookup"><span data-stu-id="c773f-163">In the page's code-behind class, add a method named `BindUsersToUserList` and another named `BindRolesList`, using the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample5.vb)]

<span data-ttu-id="c773f-164">Die `BindUsersToUserList`-Methode ruft alle Benutzerkonten im System über die [`Membership.GetAllUsers`-Methode](https://msdn.microsoft.com/library/dy8swhya.aspx)ab.</span><span class="sxs-lookup"><span data-stu-id="c773f-164">The `BindUsersToUserList` method retrieves all of the user accounts in the system via the [`Membership.GetAllUsers` method](https://msdn.microsoft.com/library/dy8swhya.aspx).</span></span> <span data-ttu-id="c773f-165">Dadurch wird ein [`MembershipUserCollection` Objekt](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx)zurückgegeben, bei dem es sich um eine Auflistung von [`MembershipUser` Instanzen](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx)handelt.</span><span class="sxs-lookup"><span data-stu-id="c773f-165">This returns a [`MembershipUserCollection` object](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), which is a collection of [`MembershipUser` instances](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span></span> <span data-ttu-id="c773f-166">Diese Sammlung wird dann an den `UserList` Dropdown List gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-166">This collection is then bound to the `UserList` DropDownList.</span></span> <span data-ttu-id="c773f-167">Die `MembershipUser`-Instanzen, die die Auflistung zusammenstellen, enthalten eine Reihe von Eigenschaften wie `UserName`, `Email`, `CreationDate`und `IsOnline`.</span><span class="sxs-lookup"><span data-stu-id="c773f-167">The `MembershipUser` instances that makeup the collection contain a variety of properties, like `UserName`, `Email`, `CreationDate`, and `IsOnline`.</span></span> <span data-ttu-id="c773f-168">Um die Dropdown Liste anzuweisen, den Wert der `UserName`-Eigenschaft anzuzeigen, stellen Sie sicher, dass die Eigenschaften `DataTextField` und `DataValueField` der `UserList` DropDownList auf "username" festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="c773f-168">In order to instruct the DropDownList to display the value of the `UserName` property, ensure that the `UserList` DropDownList's `DataTextField` and `DataValueField` properties have been set to "UserName".</span></span>

> [!NOTE]
> <span data-ttu-id="c773f-169">Die `Membership.GetAllUsers`-Methode verfügt über zwei über Ladungen: eine, die keine Eingabeparameter akzeptiert und alle Benutzer zurückgibt, und eine, die ganzzahlige Werte für den Seitenindex und die Seitengröße annimmt und nur die angegebene Teilmenge der Benutzer zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="c773f-169">The `Membership.GetAllUsers` method has two overloads: one that accepts no input parameters and returns all of the users, and one that takes in integer values for the page index and page size, and returns only the specified subset of the users.</span></span> <span data-ttu-id="c773f-170">Wenn große Mengen von Benutzerkonten in einem Auslagerungs fähigen Benutzeroberflächen Element angezeigt werden, kann die zweite Überladung verwendet werden, um die Benutzer effizienter zu durchlaufen, da Sie nur die genaue Teilmenge der Benutzerkonten und nicht alle zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="c773f-170">When there are large amounts of user accounts being displayed in a pageable user interface element, the second overload can be used to more efficiently page through the users since it returns just the precise subset of user accounts rather than all of them.</span></span>

<span data-ttu-id="c773f-171">Die `BindRolesToList`-Methode beginnt mit dem Aufrufen der [`GetAllRoles`-Methode](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)der `Roles` Klasse, die ein Zeichen folgen Array mit den Rollen im System zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="c773f-171">The `BindRolesToList` method starts by calling the `Roles` class's [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), which returns a string array containing the roles in the system.</span></span> <span data-ttu-id="c773f-172">Dieses Zeichen folgen Array wird dann an den Repeater gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-172">This string array is then bound to the Repeater.</span></span>

<span data-ttu-id="c773f-173">Zum Schluss müssen diese beiden Methoden aufgerufen werden, wenn die Seite zum ersten Mal geladen wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-173">Finally, we need to call these two methods when the page is first loaded.</span></span> <span data-ttu-id="c773f-174">Fügen Sie dem `Page_Load` -Ereignishandler folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-174">Add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample6.vb)]

<span data-ttu-id="c773f-175">Wenn dieser Code vorhanden ist, nehmen Sie sich einen Moment Zeit, um die Seite über einen Browser zu besuchen. Ihr Bildschirm sollte in etwa wie in Abbildung 2 aussehen.</span><span class="sxs-lookup"><span data-stu-id="c773f-175">With this code in place, take a moment to visit the page through a browser; your screen should look similar to Figure 2.</span></span> <span data-ttu-id="c773f-176">Alle Benutzerkonten werden in der Dropdown Liste ausgefüllt, und darunter wird jede Rolle als Kontrollkästchen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c773f-176">All of the user accounts are populated in the drop-down list and, underneath that, each role appears as a checkbox.</span></span> <span data-ttu-id="c773f-177">Da die `AutoPostBack` Eigenschaften der Dropdown List und der Kontrollkästchen auf true festgelegt werden, wird durch das Ändern des ausgewählten Benutzers oder das Überprüfen bzw. Deaktivieren einer Rolle ein Postback verursacht.</span><span class="sxs-lookup"><span data-stu-id="c773f-177">Because we set the `AutoPostBack` properties of the DropDownList and CheckBoxes to True, changing the selected user or checking or unchecking a role causes a postback.</span></span> <span data-ttu-id="c773f-178">Es wird jedoch keine Aktion ausgeführt, da wir noch Code zum Verarbeiten dieser Aktionen schreiben müssen.</span><span class="sxs-lookup"><span data-stu-id="c773f-178">No action is performed, however, because we have yet to write code to handle these actions.</span></span> <span data-ttu-id="c773f-179">Diese Aufgaben werden in den nächsten beiden Abschnitten behandelt.</span><span class="sxs-lookup"><span data-stu-id="c773f-179">We'll tackle these tasks in the next two sections.</span></span>

<span data-ttu-id="c773f-180">[![auf der Seite werden die Benutzer und Rollen angezeigt.](assigning-roles-to-users-vb/_static/image5.png)](assigning-roles-to-users-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-180">[![The Page Displays the Users and Roles](assigning-roles-to-users-vb/_static/image5.png)](assigning-roles-to-users-vb/_static/image4.png)</span></span>

<span data-ttu-id="c773f-181">**Abbildung 2**: die Seite zeigt die Benutzer und Rollen[an (Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-181">**Figure 2**: The Page Displays the Users and Roles  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image6.png))</span></span>

### <a name="checking-the-roles-the-selected-user-belongs-to"></a><span data-ttu-id="c773f-182">Die Rollen, denen der ausgewählte Benutzer angehört, werden überprüft.</span><span class="sxs-lookup"><span data-stu-id="c773f-182">Checking the Roles the Selected User Belongs To</span></span>

<span data-ttu-id="c773f-183">Wenn die Seite zum ersten Mal geladen wird oder wenn der Besucher in der Dropdown Liste einen neuen Benutzer auswählt, müssen die Kontrollkästchen der `UsersRoleList`aktualisiert werden, damit das Kontrollkästchen für eine bestimmte Rolle nur dann aktiviert wird, wenn der ausgewählte Benutzer zu dieser Rolle gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-183">When the page is first loaded, or whenever the visitor selects a new user from the drop-down list, we need to update the `UsersRoleList`'s checkboxes so that a given role checkbox is checked only if the selected user belongs to that role.</span></span> <span data-ttu-id="c773f-184">Um dies zu erreichen, erstellen Sie eine Methode mit dem Namen `CheckRolesForSelectedUser` mit folgendem Code:</span><span class="sxs-lookup"><span data-stu-id="c773f-184">To accomplish this, create a method named `CheckRolesForSelectedUser` with the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample7.vb)]

<span data-ttu-id="c773f-185">Der obige Code beginnt mit der Ermittlung des ausgewählten Benutzers.</span><span class="sxs-lookup"><span data-stu-id="c773f-185">The above code starts by determining who the selected user is.</span></span> <span data-ttu-id="c773f-186">Anschließend wird die [`GetRolesForUser(userName)`-Methode](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) der Rollen Klasse verwendet, um den Satz von Rollen des angegebenen Benutzers als Zeichen folgen Array zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="c773f-186">It then uses the Roles class's [`GetRolesForUser(userName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) to return the specified user's set of roles as a string array.</span></span> <span data-ttu-id="c773f-187">Im nächsten Schritt werden die Elemente des Repeater aufgelistet, und es wird Programm gesteuert auf das `RoleCheckBox` Kontrollkästchen für jedes Element verwiesen.</span><span class="sxs-lookup"><span data-stu-id="c773f-187">Next, the Repeater's items are enumerated and each item's `RoleCheckBox` CheckBox is programmatically referenced.</span></span> <span data-ttu-id="c773f-188">Das Kontrollkästchen ist nur aktiviert, wenn die Rolle, der Sie entspricht, im `selectedUsersRoles` Zeichen folgen Array enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-188">The CheckBox is checked only if the role it corresponds to is contained within the `selectedUsersRoles` string array.</span></span>

> [!NOTE]
> <span data-ttu-id="c773f-189">Die `Linq.Enumerable.Contains(Of String)(...)` Syntax wird nicht kompiliert, wenn Sie ASP.NET Version 2,0 verwenden.</span><span class="sxs-lookup"><span data-stu-id="c773f-189">The `Linq.Enumerable.Contains(Of String)(...)` syntax will not compile if you are using ASP.NET version 2.0.</span></span> <span data-ttu-id="c773f-190">Die `Contains(Of String)`-Methode ist Teil der [LINQ-Bibliothek](http://en.wikipedia.org/wiki/Language_Integrated_Query), die neu in ASP.NET 3,5 ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-190">The `Contains(Of String)` method is part of the [LINQ library](http://en.wikipedia.org/wiki/Language_Integrated_Query), which is new to ASP.NET 3.5.</span></span> <span data-ttu-id="c773f-191">Wenn Sie weiterhin ASP.NET Version 2,0 verwenden, verwenden Sie stattdessen die [`Array.IndexOf(Of String)`-Methode](https://msdn.microsoft.com/library/eha9t187.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c773f-191">If you are still using ASP.NET version 2.0, use the [`Array.IndexOf(Of String)` method](https://msdn.microsoft.com/library/eha9t187.aspx) instead.</span></span>

<span data-ttu-id="c773f-192">Die `CheckRolesForSelectedUser`-Methode muss in zwei Fällen aufgerufen werden: Wenn die Seite zum ersten Mal geladen wird und wenn der ausgewählte Index `UserList` DropDownList geändert wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-192">The `CheckRolesForSelectedUser` method needs to be called in two cases: when the page is first loaded and whenever the `UserList` DropDownList's selected index is changed.</span></span> <span data-ttu-id="c773f-193">Rufen Sie daher diese Methode aus dem `Page_Load`-Ereignishandler auf (nach den Aufrufen von `BindUsersToUserList` und `BindRolesToList`).</span><span class="sxs-lookup"><span data-stu-id="c773f-193">Therefore, call this method from the `Page_Load` event handler (after the calls to `BindUsersToUserList` and `BindRolesToList`).</span></span> <span data-ttu-id="c773f-194">Erstellen Sie außerdem einen Ereignishandler für das `SelectedIndexChanged` Ereignis DropDownList, und rufen Sie diese Methode von dort auf.</span><span class="sxs-lookup"><span data-stu-id="c773f-194">Also, create an event handler for the DropDownList's `SelectedIndexChanged` event and call this method from there.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample8.vb)]

<span data-ttu-id="c773f-195">Wenn dieser Code vorhanden ist, können Sie die Seite über den Browser testen.</span><span class="sxs-lookup"><span data-stu-id="c773f-195">With this code in place, you can test the page through the browser.</span></span> <span data-ttu-id="c773f-196">Da die Seite "`UsersAndRoles.aspx`" jedoch derzeit nicht die Möglichkeit zum Zuweisen von Benutzern zu Rollen hat, haben keine Benutzer Rollen.</span><span class="sxs-lookup"><span data-stu-id="c773f-196">However, since the `UsersAndRoles.aspx` page currently lacks the ability to assign users to roles, no users have roles.</span></span> <span data-ttu-id="c773f-197">Wir erstellen die Schnittstelle zum Zuweisen von Benutzern zu Rollen in einem Moment. Sie können also entweder das Wort verwenden, dass dieser Code funktioniert, und überprüfen, ob dies später der Fall ist, oder Sie können Benutzer manuell zu Rollen hinzufügen, indem Sie Datensätze in die `aspnet_UsersInRoles` Tabelle einfügen, um diese Funktionalität jetzt zu testen.</span><span class="sxs-lookup"><span data-stu-id="c773f-197">We will create the interface for assigning users to roles in a moment, so you can either take my word that this code works and verify that it does so later, or you can manually add users to roles by inserting records into the `aspnet_UsersInRoles` table in order to test this functionality now.</span></span>

### <a name="assigning-and-removing-users-from-roles"></a><span data-ttu-id="c773f-198">Zuweisen und Entfernen von Benutzern aus Rollen</span><span class="sxs-lookup"><span data-stu-id="c773f-198">Assigning and Removing Users from Roles</span></span>

<span data-ttu-id="c773f-199">Wenn der Besucher ein Kontrollkästchen im `UsersRoleList` Repeater prüft oder deaktiviert, müssen wir den ausgewählten Benutzer der entsprechenden Rolle hinzufügen oder entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-199">When the visitor checks or unchecks a CheckBox in the `UsersRoleList` Repeater we need to add or remove the selected user from the corresponding role.</span></span> <span data-ttu-id="c773f-200">Die `AutoPostBack`-Eigenschaft des Kontrollkästchens ist derzeit auf true festgelegt, wodurch ein Postback ausgelöst wird, sobald ein Kontrollkästchen im Wiederholungs Modul aktiviert oder deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-200">The CheckBox's `AutoPostBack` property is currently set to True, which causes a postback anytime a CheckBox in the Repeater is checked or unchecked.</span></span> <span data-ttu-id="c773f-201">Kurz gesagt, wir müssen einen Ereignishandler für das `CheckChanged` Ereignis des Kontrollkästchens erstellen.</span><span class="sxs-lookup"><span data-stu-id="c773f-201">In short, we need to create an event handler for the CheckBox's `CheckChanged` event.</span></span> <span data-ttu-id="c773f-202">Da sich das Kontrollkästchen in einem Wiederholungs Steuerelement befindet, müssen wir die Ereignishandlerfunktion manuell hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-202">Since the CheckBox is in a Repeater control, we need to manually add the event handler plumbing.</span></span> <span data-ttu-id="c773f-203">Fügen Sie zunächst den Ereignishandler der Code-Behind-Klasse als `Protected` Methode wie folgt hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-203">Start by adding the event handler to the code-behind class as a `Protected` method, like so:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample9.vb)]

<span data-ttu-id="c773f-204">Wir werden zurückkehren, um den Code für diesen Ereignishandler in einem Moment zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="c773f-204">We will return to write the code for this event handler in a moment.</span></span> <span data-ttu-id="c773f-205">Zuerst wird die Behandlung von Ereignis Behandlung durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="c773f-205">But first let's complete the event handling plumbing.</span></span> <span data-ttu-id="c773f-206">Fügen Sie im `ItemTemplate`des Repeater-`OnCheckedChanged="RoleCheckBox_CheckChanged"`hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-206">From the CheckBox within the Repeater's `ItemTemplate`, add `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span></span> <span data-ttu-id="c773f-207">Diese Syntax verdrahtet den `RoleCheckBox_CheckChanged` Ereignishandler mit dem `CheckedChanged` Ereignis des `RoleCheckBox`.</span><span class="sxs-lookup"><span data-stu-id="c773f-207">This syntax wires the `RoleCheckBox_CheckChanged` event handler to the `RoleCheckBox`'s `CheckedChanged` event.</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample10.aspx)]

<span data-ttu-id="c773f-208">Die letzte Aufgabe besteht darin, den `RoleCheckBox_CheckChanged`-Ereignishandler abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="c773f-208">Our final task is to complete the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="c773f-209">Wir müssen zunächst auf das CheckBox-Steuerelement verweisen, das das Ereignis ausgelöst hat, da diese Checkbox-Instanz anzeigt, welche Rolle über die Eigenschaften "`Text`" und "`Checked`" überprüft wurde.</span><span class="sxs-lookup"><span data-stu-id="c773f-209">We need to start by referencing the CheckBox control that raised the event because this CheckBox instance tells us what role was checked or unchecked via its `Text` and `Checked` properties.</span></span> <span data-ttu-id="c773f-210">Wenn diese Informationen zusammen mit dem Benutzernamen des ausgewählten Benutzers verwendet werden, wird der Benutzer über die [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) -oder [`RemoveUserFromRole`-Methode](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)der `Roles` Klasse hinzugefügt oder aus der Rolle entfernt.</span><span class="sxs-lookup"><span data-stu-id="c773f-210">Using this information along with the UserName of the selected user, we add or remove the user from the role via the `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) or [`RemoveUserFromRole` method](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample11.vb)]

<span data-ttu-id="c773f-211">Der obige Code beginnt mit der programmgesteuerten Referenzierung des Kontrollkästchens, das das Ereignis ausgelöst hat, das über den `sender` Eingabeparameter verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-211">The above code starts by programmatically referencing the CheckBox that raised the event, which is available via the `sender` input parameter.</span></span> <span data-ttu-id="c773f-212">Wenn das Kontrollkästchen aktiviert ist, wird der ausgewählte Benutzer der angegebenen Rolle hinzugefügt, andernfalls werden Sie aus der Rolle entfernt.</span><span class="sxs-lookup"><span data-stu-id="c773f-212">If the CheckBox is checked, the selected user is added to the specified role, otherwise they are removed from the role.</span></span> <span data-ttu-id="c773f-213">In beiden Fällen wird in der `ActionStatus` Bezeichnung eine Meldung angezeigt, in der die gerade ausgeführte Aktion zusammengefasst wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-213">In either case, the `ActionStatus` Label displays a message summarizing the action just performed.</span></span>

<span data-ttu-id="c773f-214">Nehmen Sie sich einen Moment Zeit, um diese Seite über einen Browser zu testen.</span><span class="sxs-lookup"><span data-stu-id="c773f-214">Take a moment to test out this page through a browser.</span></span> <span data-ttu-id="c773f-215">Wählen Sie Benutzer Tito aus, und fügen Sie dann in der Rolle Administratoren und Supervisor die Rolle "Tito"</span><span class="sxs-lookup"><span data-stu-id="c773f-215">Select user Tito and then add Tito to both the Administrators and Supervisors roles.</span></span>

<span data-ttu-id="c773f-216">[![Tito wurde den Rollen "Administratoren" und "Supervisor" hinzugefügt.](assigning-roles-to-users-vb/_static/image8.png)](assigning-roles-to-users-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-216">[![Tito Has Been Added to the Administrators and Supervisors Roles](assigning-roles-to-users-vb/_static/image8.png)](assigning-roles-to-users-vb/_static/image7.png)</span></span>

<span data-ttu-id="c773f-217">**Abbildung 3**: Tito wurde den Administratoren-und Aufsichts Rollen hinzugefügt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-217">**Figure 3**: Tito Has Been Added to the Administrators and Supervisors Roles  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image9.png))</span></span>

<span data-ttu-id="c773f-218">Wählen Sie als nächstes in der Dropdown Liste die Option User Bruce aus.</span><span class="sxs-lookup"><span data-stu-id="c773f-218">Next, select user Bruce from the drop-down list.</span></span> <span data-ttu-id="c773f-219">Es gibt ein Postback, und die Kontrollkästchen des Wiederholungs Moduls werden über die `CheckRolesForSelectedUser`aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="c773f-219">There is a postback and the Repeater's CheckBoxes are updated via the `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="c773f-220">Da Bruce noch nicht zu Rollen gehört, sind die beiden Kontrollkästchen deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="c773f-220">Since Bruce does not yet belong to any roles, the two checkboxes are unchecked.</span></span> <span data-ttu-id="c773f-221">Fügen Sie als nächstes Bruce der Rolle "Supervisor" hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-221">Next, add Bruce to the Supervisors role.</span></span>

<span data-ttu-id="c773f-222">[![Bruce wurde der Rolle "Supervisor" hinzugefügt.](assigning-roles-to-users-vb/_static/image11.png)](assigning-roles-to-users-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-222">[![Bruce Has Been Added to the Supervisors Role](assigning-roles-to-users-vb/_static/image11.png)](assigning-roles-to-users-vb/_static/image10.png)</span></span>

<span data-ttu-id="c773f-223">**Abbildung 4**: Bruce wurde der Rolle "Supervisor" hinzugefügt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-223">**Figure 4**: Bruce Has Been Added to the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image12.png))</span></span>

<span data-ttu-id="c773f-224">Um die Funktionalität der `CheckRolesForSelectedUser`-Methode weiter zu überprüfen, wählen Sie einen anderen Benutzer als Tito oder Bruce aus.</span><span class="sxs-lookup"><span data-stu-id="c773f-224">To further verify the functionality of the `CheckRolesForSelectedUser` method, select a user other than Tito or Bruce.</span></span> <span data-ttu-id="c773f-225">Beachten Sie, dass die Kontrollkästchen automatisch deaktiviert werden. Dies bedeutet, dass Sie nicht zu Rollen gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-225">Note how the checkboxes are automatically unchecked, denoting that they do not belong to any roles.</span></span> <span data-ttu-id="c773f-226">Kehren Sie zu Tito zurück.</span><span class="sxs-lookup"><span data-stu-id="c773f-226">Return to Tito.</span></span> <span data-ttu-id="c773f-227">Die Kontrollkästchen Administratoren und Supervisor sollten überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-227">Both the Administrators and Supervisors checkboxes should be checked.</span></span>

## <a name="step-2-building-the-by-roles-user-interface"></a><span data-ttu-id="c773f-228">Schritt 2: entwickeln der Benutzeroberfläche "by Rollen"</span><span class="sxs-lookup"><span data-stu-id="c773f-228">Step 2: Building the "By Roles" User Interface</span></span>

<span data-ttu-id="c773f-229">An dieser Stelle haben wir die Benutzeroberfläche "von Benutzern" abgeschlossen und sind bereit, mit der Bewältigung der "by Rollen"-Schnittstelle zu beginnen.</span><span class="sxs-lookup"><span data-stu-id="c773f-229">At this point we have completed the "by users" interface and are ready to start tackling the "by roles" interface.</span></span> <span data-ttu-id="c773f-230">Die Schnittstelle "by Rollen" fordert den Benutzer auf, eine Rolle aus einer Dropdown Liste auszuwählen, und zeigt dann die Gruppe von Benutzern an, die zu dieser Rolle in einer GridView gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-230">The "by roles" interface prompts the user to select a role from a drop-down list and then displays the set of users that belong to that role in a GridView.</span></span>

<span data-ttu-id="c773f-231">Fügen Sie der `UsersAndRoles.aspx page`ein weiteres DropDownList-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-231">Add another DropDownList control to the `UsersAndRoles.aspx page`.</span></span> <span data-ttu-id="c773f-232">Platzieren Sie diese unter dem Repeater-Steuerelement, benennen Sie Sie `RoleList`, und legen Sie die `AutoPostBack`-Eigenschaft auf true fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-232">Place this one beneath the Repeater control, name it `RoleList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="c773f-233">Fügen Sie darunter eine GridView hinzu, und benennen Sie Sie `RolesUserList`.</span><span class="sxs-lookup"><span data-stu-id="c773f-233">Underneath that, add a GridView and name it `RolesUserList`.</span></span> <span data-ttu-id="c773f-234">In dieser GridView werden die Benutzer aufgelistet, die zur ausgewählten Rolle gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-234">This GridView will list the users that belong to the selected role.</span></span> <span data-ttu-id="c773f-235">Legen Sie die `AutoGenerateColumns`-Eigenschaft der GridView auf false fest, fügen Sie der `Columns` Auflistung des Rasters ein TemplateField-Element hinzu, und legen Sie dessen Eigenschaft `HeaderText` auf "Users" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-235">Set the GridView's `AutoGenerateColumns` property to False, add a TemplateField to the grid's `Columns` collection, and set its `HeaderText` property to "Users".</span></span> <span data-ttu-id="c773f-236">Definieren Sie die `ItemTemplate` von TemplateField, damit der Wert des Datenbindung-Ausdrucks `Container.DataItem` in der `Text`-Eigenschaft einer Bezeichnung mit dem Namen `UserNameLabel`angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-236">Define the TemplateField's `ItemTemplate` so that it displays the value of the databinding expression `Container.DataItem` in the `Text` property of a Label named `UserNameLabel`.</span></span>

<span data-ttu-id="c773f-237">Nach dem Hinzufügen und Konfigurieren von GridView sollte das deklarative Markup der "by Role"-Schnittstelle in etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="c773f-237">After adding and configuring the GridView, your "by role" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample12.aspx)]

<span data-ttu-id="c773f-238">Wir müssen den `RoleList` Dropdown List mit dem Satz von Rollen im System auffüllen.</span><span class="sxs-lookup"><span data-stu-id="c773f-238">We need to populate the `RoleList` DropDownList with the set of roles in the system.</span></span> <span data-ttu-id="c773f-239">Um dies zu erreichen, aktualisieren Sie die `BindRolesToList`-Methode, sodass das von der `Roles.GetAllRoles`-Methode zurückgegebene Zeichen folgen Array an die `RolesList` DropDownList (sowie an den `UsersRoleList` Repeater) bindet.</span><span class="sxs-lookup"><span data-stu-id="c773f-239">To accomplish this, update the `BindRolesToList` method so that is binds the string array returned by the `Roles.GetAllRoles` method to the `RolesList` DropDownList (as well as the `UsersRoleList` Repeater).</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample13.vb)]

<span data-ttu-id="c773f-240">Die letzten zwei Zeilen in der `BindRolesToList`-Methode wurden hinzugefügt, um den Rollensatz an das `RoleList` DropDownList-Steuerelement zu binden.</span><span class="sxs-lookup"><span data-stu-id="c773f-240">The last two lines in the `BindRolesToList` method have been added to bind the set of roles to the `RoleList` DropDownList control.</span></span> <span data-ttu-id="c773f-241">In Abbildung 5 wird das Endergebnis angezeigt, wenn es über einen Browser angezeigt wird – eine Dropdown Liste, die mit den Rollen des Systems gefüllt ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-241">Figure 5 shows the end result when viewed through a browser – a drop-down list populated with the system's roles.</span></span>

<span data-ttu-id="c773f-242">[![werden die Rollen in der Dropdown Liste "rolelist" angezeigt.](assigning-roles-to-users-vb/_static/image14.png)](assigning-roles-to-users-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-242">[![The Roles are Displayed in the RoleList DropDownList](assigning-roles-to-users-vb/_static/image14.png)](assigning-roles-to-users-vb/_static/image13.png)</span></span>

<span data-ttu-id="c773f-243">**Abbildung 5**: die Rollen werden in der Dropdown Liste `RoleList` angezeigt ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-243">**Figure 5**: The Roles are Displayed in the `RoleList` DropDownList  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image15.png))</span></span>

### <a name="displaying-the-users-that-belong-to-the-selected-role"></a><span data-ttu-id="c773f-244">Anzeigen der Benutzer, die zur ausgewählten Rolle gehören</span><span class="sxs-lookup"><span data-stu-id="c773f-244">Displaying the Users That Belong To the Selected Role</span></span>

<span data-ttu-id="c773f-245">Wenn die Seite zum ersten Mal geladen wird oder wenn eine neue Rolle aus der Dropdown Liste `RoleList` ausgewählt ist, müssen wir die Liste der Benutzer, die zu dieser Rolle gehören, in der GridView anzeigen.</span><span class="sxs-lookup"><span data-stu-id="c773f-245">When the page is first loaded, or when a new role is selected from the `RoleList` DropDownList, we need to display the list of users that belong to that role in the GridView.</span></span> <span data-ttu-id="c773f-246">Erstellen Sie eine Methode mit dem Namen `DisplayUsersBelongingToRole`, indem Sie folgenden Code verwenden:</span><span class="sxs-lookup"><span data-stu-id="c773f-246">Create a method named `DisplayUsersBelongingToRole` using the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample14.vb)]

<span data-ttu-id="c773f-247">Diese Methode beginnt mit der Auswahl der ausgewählten Rolle aus der Dropdown Liste `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="c773f-247">This method starts by getting the selected role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="c773f-248">Anschließend wird die [`Roles.GetUsersInRole(roleName)`-Methode](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) verwendet, um ein Zeichen folgen Array mit den Benutzernamen der Benutzer abzurufen, die zu dieser Rolle gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-248">It then uses the [`Roles.GetUsersInRole(roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) to retrieve a string array of the UserNames of the users that belong to that role.</span></span> <span data-ttu-id="c773f-249">Dieses Array wird dann an den `RolesUserList` GridView gebunden.</span><span class="sxs-lookup"><span data-stu-id="c773f-249">This array is then bound to the `RolesUserList` GridView.</span></span>

<span data-ttu-id="c773f-250">Diese Methode muss in zwei Fällen aufgerufen werden: Wenn die Seite zum ersten Mal geladen wird und die ausgewählte Rolle in der `RoleList` Dropdown list geändert wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-250">This method needs to be called in two circumstances: when the page is initially loaded and when the selected role in the `RoleList` DropDownList changes.</span></span> <span data-ttu-id="c773f-251">Aktualisieren Sie daher den `Page_Load`-Ereignishandler, sodass diese Methode nach dem Aufruf von `CheckRolesForSelectedUser`aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-251">Therefore, update the `Page_Load` event handler so that this method is invoked after the call to `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="c773f-252">Erstellen Sie als nächstes einen Ereignishandler für das `SelectedIndexChanged`-Ereignis der `RoleList`, und rufen Sie auch diese Methode von dort auf.</span><span class="sxs-lookup"><span data-stu-id="c773f-252">Next, create an event handler for the `RoleList`'s `SelectedIndexChanged` event, and call this method from there, too.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample15.vb)]

<span data-ttu-id="c773f-253">Wenn dieser Code vorhanden ist, sollte die `RolesUserList` GridView die Benutzer anzeigen, die zur ausgewählten Rolle gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-253">With this code in place, the `RolesUserList` GridView should display those users that belong to the selected role.</span></span> <span data-ttu-id="c773f-254">Wie in Abbildung 6 gezeigt, besteht die Rolle "Supervisor" aus zwei Membern: Bruce und Tito.</span><span class="sxs-lookup"><span data-stu-id="c773f-254">As Figure 6 shows, the Supervisors role consists of two members: Bruce and Tito.</span></span>

<span data-ttu-id="c773f-255">[![der GridView listet die Benutzer auf, die zur ausgewählten Rolle gehören.](assigning-roles-to-users-vb/_static/image17.png)](assigning-roles-to-users-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-255">[![The GridView Lists Those Users That Belong to the Selected Role](assigning-roles-to-users-vb/_static/image17.png)](assigning-roles-to-users-vb/_static/image16.png)</span></span>

<span data-ttu-id="c773f-256">**Abbildung 6**: die GridView listet die Benutzer auf, die zur ausgewählten Rolle gehören ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-256">**Figure 6**: The GridView Lists Those Users That Belong to the Selected Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image18.png))</span></span>

### <a name="removing-users-from-the-selected-role"></a><span data-ttu-id="c773f-257">Entfernen von Benutzern aus der ausgewählten Rolle</span><span class="sxs-lookup"><span data-stu-id="c773f-257">Removing Users from the Selected Role</span></span>

<span data-ttu-id="c773f-258">Wir erweitern die `RolesUserList` GridView, sodass Sie eine Spalte mit den Schaltflächen "Remove" (entfernen) enthält.</span><span class="sxs-lookup"><span data-stu-id="c773f-258">Let's augment the `RolesUserList` GridView so that it includes a column of "Remove" buttons.</span></span> <span data-ttu-id="c773f-259">Wenn Sie für einen bestimmten Benutzer auf die Schaltfläche "entfernen" klicken, werden diese aus der Rolle entfernt.</span><span class="sxs-lookup"><span data-stu-id="c773f-259">Clicking the "Remove" button for a particular user will remove them from that role.</span></span>

<span data-ttu-id="c773f-260">Beginnen Sie, indem Sie der GridView ein Feld zum Löschen einer Schaltfläche hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-260">Start by adding a Delete button field to the GridView.</span></span> <span data-ttu-id="c773f-261">Legen Sie dieses Feld als am weitesten links geändert ein, und ändern Sie dessen `DeleteText`-Eigenschaft von "Delete" (Standard) in "Remove".</span><span class="sxs-lookup"><span data-stu-id="c773f-261">Make this field appear as the left most filed and change its `DeleteText` property from "Delete" (the default) to "Remove".</span></span>

<span data-ttu-id="c773f-262">[![hinzufügen](assigning-roles-to-users-vb/_static/image20.png)](assigning-roles-to-users-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-262">[![Add the](assigning-roles-to-users-vb/_static/image20.png)](assigning-roles-to-users-vb/_static/image19.png)</span></span>

<span data-ttu-id="c773f-263">**Abbildung 7**: Hinzufügen der Schaltfläche "entfernen" zur GridView ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-263">**Figure 7**: Add the "Remove" Button to the GridView  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image21.png))</span></span>

<span data-ttu-id="c773f-264">Wenn Sie auf die Schaltfläche "Remove" (entfernen) klicken, wird ein Postback ausgelöst, und das `RowDeleting`-Ereignis der GridView wird ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="c773f-264">When the "Remove" button is clicked a postback ensues and the GridView's `RowDeleting` event is raised.</span></span> <span data-ttu-id="c773f-265">Wir müssen einen Ereignishandler für dieses Ereignis erstellen und Code schreiben, mit dem der Benutzer aus der ausgewählten Rolle entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-265">We need to create an event handler for this event and write code that removes the user from the selected role.</span></span> <span data-ttu-id="c773f-266">Erstellen Sie den Ereignishandler, und fügen Sie dann den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-266">Create the event handler and then add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample16.vb)]

<span data-ttu-id="c773f-267">Der Code beginnt mit der Ermittlung des ausgewählten Rollen namens.</span><span class="sxs-lookup"><span data-stu-id="c773f-267">The code starts by determining the selected role name.</span></span> <span data-ttu-id="c773f-268">Er verweist dann Programm gesteuert auf das `UserNameLabel` Steuerelement aus der Zeile, auf deren Schaltfläche "entfernen" geklickt wurde, um den Benutzernamen des zu entfernenden Benutzers zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="c773f-268">It then programmatically references the `UserNameLabel` control from the row whose "Remove" button was clicked in order to determine the UserName of the user to remove.</span></span> <span data-ttu-id="c773f-269">Der Benutzer wird dann über einen aufzurufenden `Roles.RemoveUserFromRole` der-Methode aus der Rolle entfernt.</span><span class="sxs-lookup"><span data-stu-id="c773f-269">The user is then removed from the role via a call to the `Roles.RemoveUserFromRole` method.</span></span> <span data-ttu-id="c773f-270">Die `RolesUserList` GridView wird dann aktualisiert, und es wird eine Meldung über das Steuerelement `ActionStatus` Bezeichnung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c773f-270">The `RolesUserList` GridView is then refreshed and a message is displayed via the `ActionStatus` Label control.</span></span>

> [!NOTE]
> <span data-ttu-id="c773f-271">Die Schaltfläche "entfernen" erfordert keine Bestätigung vom Benutzer, bevor der Benutzer aus der Rolle entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-271">The "Remove" button does not require any sort of confirmation from the user before removing the user from the role.</span></span> <span data-ttu-id="c773f-272">Ich lade Sie ein, ein gewisses Maß an Benutzer Bestätigung hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-272">I invite you to add some level of user confirmation.</span></span> <span data-ttu-id="c773f-273">Eine der einfachsten Möglichkeiten, eine Aktion zu bestätigen, ist das Dialogfeld Client seitiges bestätigen.</span><span class="sxs-lookup"><span data-stu-id="c773f-273">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="c773f-274">Weitere Informationen zu dieser Technik finden Sie unter [Hinzufügen der Client seitigen Bestätigung beim Löschen](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span><span class="sxs-lookup"><span data-stu-id="c773f-274">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

<span data-ttu-id="c773f-275">Abbildung 8 zeigt die Seite, nach der der Benutzer Tito aus der Gruppe "Supervisoren" entfernt wurde.</span><span class="sxs-lookup"><span data-stu-id="c773f-275">Figure 8 shows the page after user Tito has been removed from the Supervisors group.</span></span>

<span data-ttu-id="c773f-276">[![leider ist Tito nicht mehr Supervisor.](assigning-roles-to-users-vb/_static/image23.png)](assigning-roles-to-users-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-276">[![Alas, Tito is No Longer a Supervisor](assigning-roles-to-users-vb/_static/image23.png)](assigning-roles-to-users-vb/_static/image22.png)</span></span>

<span data-ttu-id="c773f-277">**Abbildung 8**: Leider ist Tito kein Supervisor mehr ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-277">**Figure 8**: Alas, Tito is No Longer a Supervisor  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image24.png))</span></span>

### <a name="adding-new-users-to-the-selected-role"></a><span data-ttu-id="c773f-278">Der ausgewählten Rolle werden neue Benutzer hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="c773f-278">Adding New Users to the Selected Role</span></span>

<span data-ttu-id="c773f-279">Neben dem Entfernen von Benutzern aus der ausgewählten Rolle sollte der Besucher dieser Seite auch in der Lage sein, der ausgewählten Rolle einen Benutzer hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-279">Along with removing users from the selected role, the visitor to this page should also be able to add a user to the selected role.</span></span> <span data-ttu-id="c773f-280">Die beste Oberfläche zum Hinzufügen eines Benutzers zur ausgewählten Rolle hängt von der Anzahl der erwarteten Benutzerkonten ab.</span><span class="sxs-lookup"><span data-stu-id="c773f-280">The best interface for adding a user to the selected role depends on the number of user accounts you expect to have.</span></span> <span data-ttu-id="c773f-281">Wenn Ihre Website nur ein paar Dutzend Benutzerkonten oder weniger enthält, können Sie hier eine Dropdown Liste verwenden.</span><span class="sxs-lookup"><span data-stu-id="c773f-281">If your website will house just a few dozen user accounts or less, you could use a DropDownList here.</span></span> <span data-ttu-id="c773f-282">Wenn möglicherweise Tausende von Benutzerkonten vorhanden sind, sollten Sie eine Benutzeroberfläche einschließen, die es dem Besucher ermöglicht, die Konten zu durchsuchen, nach einem bestimmten Konto zu suchen oder die Benutzerkonten auf andere Weise zu filtern.</span><span class="sxs-lookup"><span data-stu-id="c773f-282">If there might be thousands of user accounts, you would want to include a user interface that permits the visitor to page through the accounts, search for a particular account, or filter the user accounts in some other fashion.</span></span>

<span data-ttu-id="c773f-283">Verwenden Sie für diese Seite eine sehr einfache Schnittstelle, die unabhängig von der Anzahl der Benutzerkonten im System funktioniert.</span><span class="sxs-lookup"><span data-stu-id="c773f-283">For this page let's use a very simple interface that works regardless of the number of user accounts in the system.</span></span> <span data-ttu-id="c773f-284">Wir verwenden also ein Textfeld, in dem der Besucher aufgefordert wird, den Benutzernamen des Benutzers einzugeben, den Sie der ausgewählten Rolle hinzufügen möchten.</span><span class="sxs-lookup"><span data-stu-id="c773f-284">Namely, we will use a TextBox, prompting the visitor to type in the username of the user she wants to add to the selected role.</span></span> <span data-ttu-id="c773f-285">Wenn kein Benutzer mit diesem Namen vorhanden ist oder der Benutzer bereits Mitglied der Rolle ist, wird in `ActionStatus` Bezeichnung eine Meldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c773f-285">If no user with that name exists, or if the user is already a member of the role, we'll display a message in `ActionStatus` Label.</span></span> <span data-ttu-id="c773f-286">Wenn der Benutzer jedoch vorhanden und kein Mitglied der Rolle ist, fügen wir Sie der Rolle hinzu und aktualisieren das Raster.</span><span class="sxs-lookup"><span data-stu-id="c773f-286">But if the user exists and is not a member of the role, we'll add them to the role and refresh the grid.</span></span>

<span data-ttu-id="c773f-287">Fügen Sie unterhalb der GridView ein Textfeld und eine Schaltfläche hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-287">Add a TextBox and Button beneath the GridView.</span></span> <span data-ttu-id="c773f-288">Legen Sie den `ID` des Textfelds auf `UserNameToAddToRole` fest, und legen Sie die Eigenschaften `ID` und `Text` der Schaltfläche auf `AddUserToRoleButton` und "Benutzer zu Rolle hinzufügen" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-288">Set the TextBox's `ID` to `UserNameToAddToRole` and set the Button's `ID` and `Text` properties to `AddUserToRoleButton` and "Add User to Role", respectively.</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample17.aspx)]

<span data-ttu-id="c773f-289">Erstellen Sie als nächstes einen `Click` Ereignishandler für die `AddUserToRoleButton`, und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-289">Next, create a `Click` event handler for the `AddUserToRoleButton` and add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample18.vb)]

<span data-ttu-id="c773f-290">Der Großteil des Codes im `Click` Ereignishandler führt verschiedene Validierungs Überprüfungen durch.</span><span class="sxs-lookup"><span data-stu-id="c773f-290">The majority of the code in the `Click` event handler performs various validation checks.</span></span> <span data-ttu-id="c773f-291">Dadurch wird sichergestellt, dass der Besucher im Textfeld `UserNameToAddToRole` einen Benutzernamen eingegeben hat, dass der Benutzer im System vorhanden ist, und dass er nicht bereits zur ausgewählten Rolle gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-291">It ensures that the visitor supplied a username in the `UserNameToAddToRole` TextBox, that the user exists in the system, and that they don't already belong to the selected role.</span></span> <span data-ttu-id="c773f-292">Wenn eine dieser Überprüfungen fehlschlägt, wird eine entsprechende Meldung in `ActionStatus` angezeigt, und der Ereignishandler wird beendet.</span><span class="sxs-lookup"><span data-stu-id="c773f-292">If any of these checks fails, an appropriate message is displayed in `ActionStatus` and the event handler is exited.</span></span> <span data-ttu-id="c773f-293">Wenn alle Überprüfungen bestanden werden, wird der Benutzer der Rolle über die `Roles.AddUserToRole`-Methode hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="c773f-293">If all of the checks pass, the user is added to the role via the `Roles.AddUserToRole` method.</span></span> <span data-ttu-id="c773f-294">Danach wird die `Text`-Eigenschaft des Textfelds gelöscht, die GridView wird aktualisiert, und die `ActionStatus` Bezeichnung zeigt eine Meldung an, die angibt, dass der angegebene Benutzer der ausgewählten Rolle erfolgreich hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="c773f-294">Following that, the TextBox's `Text` property is cleared out, the GridView is refreshed, and the `ActionStatus` Label displays a message indicating that the specified user was successfully added to the selected role.</span></span>

> [!NOTE]
> <span data-ttu-id="c773f-295">Um sicherzustellen, dass der angegebene Benutzer nicht bereits zur ausgewählten Rolle gehört, verwenden wir die [`Roles.IsUserInRole(userName, roleName)`-Methode](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), die einen booleschen Wert zurückgibt, der angibt, ob *username* ein Member von *roleName*ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-295">To ensure that the specified user does not already belong to the selected role, we use the [`Roles.IsUserInRole(userName, roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), which returns a Boolean value indicating whether *userName* is a member of *roleName*.</span></span> <span data-ttu-id="c773f-296">Diese Methode wird im <a id="_msoanchor_2"> </a> [nächsten Tutorial](role-based-authorization-vb.md) erneut verwendet, wenn wir die rollenbasierte Autorisierung betrachten.</span><span class="sxs-lookup"><span data-stu-id="c773f-296">We will use this method again in the <a id="_msoanchor_2"></a>[next tutorial](role-based-authorization-vb.md) when we look at role-based authorization.</span></span>

<span data-ttu-id="c773f-297">Besuchen Sie die Seite über einen Browser, und wählen Sie die Rolle "Supervisoren" aus der Dropdown Liste `RoleList` aus.</span><span class="sxs-lookup"><span data-stu-id="c773f-297">Visit the page through a browser and select the Supervisors role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="c773f-298">Versuchen Sie, einen ungültigen Benutzernamen einzugeben – es wird eine Meldung mit dem Hinweis angezeigt, dass der Benutzer im System nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="c773f-298">Try entering an invalid username – you should see a message explaining that the user does not exist in the system.</span></span>

<span data-ttu-id="c773f-299">[![Sie einer Rolle keinen nicht vorhandenen Benutzer hinzufügen können.](assigning-roles-to-users-vb/_static/image26.png)](assigning-roles-to-users-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-299">[![You Cannot Add a Non-Existent User to a Role](assigning-roles-to-users-vb/_static/image26.png)](assigning-roles-to-users-vb/_static/image25.png)</span></span>

<span data-ttu-id="c773f-300">**Abbildung 9**: Es ist nicht möglich, einer Rolle einen nicht vorhandenen Benutzer hinzuzufügen ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-300">**Figure 9**: You Cannot Add a Non-Existent User to a Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image27.png))</span></span>

<span data-ttu-id="c773f-301">Versuchen Sie jetzt, einen gültigen Benutzer hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-301">Now try adding a valid user.</span></span> <span data-ttu-id="c773f-302">Fügen Sie Tito der Rolle "Supervisor" erneut hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-302">Go ahead and re-add Tito to the Supervisors role.</span></span>

<span data-ttu-id="c773f-303">[![Tito ist wieder ein Supervisor!](assigning-roles-to-users-vb/_static/image29.png)](assigning-roles-to-users-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-303">[![Tito Is Once Again a Supervisor!](assigning-roles-to-users-vb/_static/image29.png)](assigning-roles-to-users-vb/_static/image28.png)</span></span>

<span data-ttu-id="c773f-304">**Abbildung 10**: Tito ist wieder ein Supervisor!</span><span class="sxs-lookup"><span data-stu-id="c773f-304">**Figure 10**: Tito Is Once Again a Supervisor!</span></span>  <span data-ttu-id="c773f-305">([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-305">([Click to view full-size image](assigning-roles-to-users-vb/_static/image30.png))</span></span>

## <a name="step-3-cross-updating-the-by-user-and-by-role-interfaces"></a><span data-ttu-id="c773f-306">Schritt 3: übergreifende Aktualisierung der Schnittstellen "durch Benutzer" und "nach Rolle"</span><span class="sxs-lookup"><span data-stu-id="c773f-306">Step 3: Cross-Updating the "By User" and "By Role" Interfaces</span></span>

<span data-ttu-id="c773f-307">Die Seite "`UsersAndRoles.aspx`" bietet zwei unterschiedliche Schnittstellen zum Verwalten von Benutzern und Rollen.</span><span class="sxs-lookup"><span data-stu-id="c773f-307">The `UsersAndRoles.aspx` page offers two distinct interfaces for managing users and roles.</span></span> <span data-ttu-id="c773f-308">Derzeit agieren diese beiden Schnittstellen unabhängig voneinander, daher ist es möglich, dass eine in einer Schnittstelle vorgenommene Änderung nicht sofort in der anderen angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-308">Currently, these two interfaces act independently of one another so it is possible that a change made in one interface will not be reflected immediately in the other.</span></span> <span data-ttu-id="c773f-309">Stellen Sie sich beispielsweise vor, dass der Besucher der Seite die Rolle "Supervisoren" aus der `RoleList` Dropdown Liste auswählt, die Bruce und Tito als Member auflistet.</span><span class="sxs-lookup"><span data-stu-id="c773f-309">For example, imagine that the visitor to the page selects the Supervisors role from the `RoleList` DropDownList, which lists Bruce and Tito as its members.</span></span> <span data-ttu-id="c773f-310">Als nächstes wählt der Besucher in der Dropdown Liste `UserList` den Wert Tito aus, der die Kontrollkästchen Administratoren und Supervisor im `UsersRoleList` Repeater prüft.</span><span class="sxs-lookup"><span data-stu-id="c773f-310">Next, the visitor selects Tito from the `UserList` DropDownList, which checks the Administrators and Supervisors checkboxes in the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="c773f-311">Wenn der Besucher dann die Supervisor-Rolle vom Wiederholungs Modul abhebt, wird Tito aus der Rolle "Supervisor" entfernt. diese Änderung wird jedoch nicht in der "by Role"-Schnittstelle widergespiegelt.</span><span class="sxs-lookup"><span data-stu-id="c773f-311">If the visitor then unchecks the Supervisor role from the Repeater, Tito is removed from the Supervisors role, but this modification is not reflected in the "by role" interface.</span></span> <span data-ttu-id="c773f-312">In der GridView wird Tito weiterhin als Mitglied der Rolle "Supervisor" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c773f-312">The GridView will still show Tito as being a member of the Supervisors role.</span></span>

<span data-ttu-id="c773f-313">Um dieses Problem zu beheben, müssen Sie die GridView aktualisieren, wenn eine Rolle vom `UsersRoleList` Repeater überprüft oder deaktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-313">To fix this we need to refresh the GridView whenever a role is checked or unchecked from the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="c773f-314">Ebenso müssen wir den Repeater aktualisieren, wenn ein Benutzer aus der Schnittstelle "by Role" entfernt oder einer Rolle hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-314">Likewise, we need to refresh the Repeater whenever a user is removed or added to a role from the "by role" interface.</span></span>

<span data-ttu-id="c773f-315">Der Repeater in der Benutzeroberfläche wird durch Aufrufen der `CheckRolesForSelectedUser`-Methode aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="c773f-315">The Repeater in the "by user" interface is refreshed by calling the `CheckRolesForSelectedUser` method.</span></span> <span data-ttu-id="c773f-316">Die "by Role"-Schnittstelle kann im `RowDeleting` Ereignishandler der `RolesUserList` GridView und im `Click` Ereignishandler der `AddUserToRoleButton` Schaltfläche geändert werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-316">The "by role" interface can be modified in the `RolesUserList` GridView's `RowDeleting` event handler and the `AddUserToRoleButton` Button's `Click` event handler.</span></span> <span data-ttu-id="c773f-317">Daher müssen wir die `CheckRolesForSelectedUser`-Methode aus jeder dieser Methoden abrufen.</span><span class="sxs-lookup"><span data-stu-id="c773f-317">Therefore, we need to call the `CheckRolesForSelectedUser` method from each of these methods.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample19.vb)]

<span data-ttu-id="c773f-318">Ebenso wird die GridView in der "by Role"-Schnittstelle durch Aufrufen der `DisplayUsersBelongingToRole`-Methode aktualisiert, und die Benutzeroberfläche "by User" wird durch den `RoleCheckBox_CheckChanged`-Ereignishandler geändert.</span><span class="sxs-lookup"><span data-stu-id="c773f-318">Similarly, the GridView in the "by role" interface is refreshed by calling the `DisplayUsersBelongingToRole` method and the "by user" interface is modified through the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="c773f-319">Daher muss die `DisplayUsersBelongingToRole`-Methode von diesem Ereignishandler aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-319">Therefore, we need to call the `DisplayUsersBelongingToRole` method from this event handler.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample20.vb)]

<span data-ttu-id="c773f-320">Mit diesen geringfügigen Codeänderungen werden die Schnittstellen "durch Benutzer" und "nach Rolle" jetzt ordnungsgemäß aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="c773f-320">With these minor code changes, the "by user" and "by role" interfaces now correctly cross-update.</span></span> <span data-ttu-id="c773f-321">Um dies zu überprüfen, besuchen Sie die Seite über einen Browser, und wählen Sie in den Dropdown Listen für "`UserList`" und "`RoleList`" die Option "Tito"</span><span class="sxs-lookup"><span data-stu-id="c773f-321">To verify this, visit the page through a browser and select Tito and Supervisors from the `UserList` and `RoleList` DropDownLists, respectively.</span></span> <span data-ttu-id="c773f-322">Beachten Sie, dass Sie beim Deaktivieren der Aufsichtsrolle für Tito aus dem Repeater in der "by User"-Schnittstelle automatisch aus der GridView in der "by Role"-Schnittstelle entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-322">Note that as you uncheck the Supervisors role for Tito from the Repeater in the "by user" interface, Tito is automatically removed from the GridView in the "by role" interface.</span></span> <span data-ttu-id="c773f-323">Durch das Hinzufügen von Tito zur Rolle "Supervisor" aus der "by Role"-Schnittstelle wird das Kontrollkästchen "Supervisor" in der Benutzeroberfläche "nach Benutzer" automatisch erneut überprüft.</span><span class="sxs-lookup"><span data-stu-id="c773f-323">Adding Tito back to the Supervisors role from the "by role" interface automatically re-checks the Supervisors checkbox in the "by user" interface.</span></span>

## <a name="step-4-customizing-the-createuserwizard-to-include-a-specify-roles-step"></a><span data-ttu-id="c773f-324">Schritt 4: Anpassen von "buildeuserwizard", um den Schritt "Rollen angeben" einzuschließen</span><span class="sxs-lookup"><span data-stu-id="c773f-324">Step 4: Customizing the CreateUserWizard to Include a "Specify Roles" Step</span></span>

<span data-ttu-id="c773f-325"><a id="_msoanchor_3"> </a>Im Tutorial [*Erstellen von Benutzerkonten*](../membership/creating-user-accounts-vb.md) wurde erläutert, wie Sie das websteuer Element "websteuer Element" von "Web" erstellen, um eine Schnittstelle zum Erstellen eines neuen Benutzerkontos bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="c773f-325">In the <a id="_msoanchor_3"></a>[*Creating User Accounts*](../membership/creating-user-accounts-vb.md) tutorial we saw how to use the CreateUserWizard Web control to provide an interface for creating a new user account.</span></span> <span data-ttu-id="c773f-326">Das Steuerelement "kreateuserwizard" kann auf zwei Arten verwendet werden:</span><span class="sxs-lookup"><span data-stu-id="c773f-326">The CreateUserWizard control can be used in one of two ways:</span></span>

- <span data-ttu-id="c773f-327">Dies bedeutet, dass Besucher auf der Website ein eigenes Benutzerkonto erstellen können.</span><span class="sxs-lookup"><span data-stu-id="c773f-327">As a means for visitors to create their own user account on the site, and</span></span>
- <span data-ttu-id="c773f-328">Als Mittel für Administratoren, neue Konten zu erstellen</span><span class="sxs-lookup"><span data-stu-id="c773f-328">As a means for administrators to create new accounts</span></span>

<span data-ttu-id="c773f-329">Im ersten Anwendungsfall kommt ein Besucher an die Website und füllt den "feateuserwizard" aus und gibt seine Informationen ein, um sich auf der Website zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="c773f-329">In the first use case, a visitor comes to the site and fills out the CreateUserWizard, entering their information in order to register on the site.</span></span> <span data-ttu-id="c773f-330">Im zweiten Fall erstellt ein Administrator ein neues Konto für eine andere Person.</span><span class="sxs-lookup"><span data-stu-id="c773f-330">In the second case, an administrator creates a new account for another person.</span></span>

<span data-ttu-id="c773f-331">Wenn ein Konto von einem Administrator für eine andere Person erstellt wird, kann es hilfreich sein, dem Administrator zu gestatten, die Rollen anzugeben, zu denen das neue Benutzerkonto gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-331">When an account is being created by an administrator for some other person, it might be helpful to allow the administrator to specify what roles the new user account belongs to.</span></span> <span data-ttu-id="c773f-332"><a id="_msoanchor_4"> </a>Im Tutorial [ *Speichern* *zusätzlicher Benutzerinformationen* ](../membership/storing-additional-user-information-vb.md) wurde erläutert, wie Sie den "anateuserwizard" anpassen, indem Sie zusätzliche `WizardSteps`hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="c773f-332">In the <a id="_msoanchor_4"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-vb.md) tutorial we saw how to customize the CreateUserWizard by adding additional `WizardSteps`.</span></span> <span data-ttu-id="c773f-333">Sehen wir uns nun an, wie Sie dem "feateuserwizard" einen weiteren Schritt hinzufügen, um die Rollen des neuen Benutzers anzugeben.</span><span class="sxs-lookup"><span data-stu-id="c773f-333">Let's look at how to add an additional step to the CreateUserWizard in order to specify the new user's roles.</span></span>

<span data-ttu-id="c773f-334">Öffnen Sie die Seite "`CreateUserWizardWithRoles.aspx`", und fügen Sie ein Steuerelement mit dem Namen "`RegisterUserWithRoles`" hinzu.</span><span class="sxs-lookup"><span data-stu-id="c773f-334">Open the `CreateUserWizardWithRoles.aspx` page and add a CreateUserWizard control named `RegisterUserWithRoles`.</span></span> <span data-ttu-id="c773f-335">Legen Sie die `ContinueDestinationPageUrl`-Eigenschaft des Steuer Elements auf "~/default.aspx" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-335">Set the control's `ContinueDestinationPageUrl` property to "~/Default.aspx".</span></span> <span data-ttu-id="c773f-336">Da es hier darum geht, dass ein Administrator ein neues Benutzerkonto mit diesem-Steuerelement von "kreateuserwizard" erstellt, legen Sie die `LoginCreatedUser`-Eigenschaft des Steuer Elements auf "false" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-336">Because the idea here is that an administrator will be using this CreateUserWizard control to create new user accounts, set the control's `LoginCreatedUser` property to False.</span></span> <span data-ttu-id="c773f-337">Diese `LoginCreatedUser` Eigenschaft gibt an, ob der Besucher automatisch als soeben erstellter Benutzer angemeldet ist. der Standardwert ist "true".</span><span class="sxs-lookup"><span data-stu-id="c773f-337">This `LoginCreatedUser` property specifies whether the visitor is automatically logged on as the just-created user, and it defaults to True.</span></span> <span data-ttu-id="c773f-338">Wir legen den Wert auf "false" fest, da ein Administrator ein neues Konto erstellt, wenn er ein neues Konto erstellt.</span><span class="sxs-lookup"><span data-stu-id="c773f-338">We set it to False because when an administrator creates a new account we want to keep him signed in as himself.</span></span>

<span data-ttu-id="c773f-339">Wählen Sie als nächstes die Option "`WizardSteps`hinzufügen/entfernen" aus. im Smarttagmenü von "feateuserwizard", und fügen Sie ein neues `WizardStep`hinzu, indem Sie dessen `ID` auf "`SpecifyRolesStep`" festlegen.</span><span class="sxs-lookup"><span data-stu-id="c773f-339">Next, select the "Add/Remove `WizardSteps`…" option from the CreateUserWizard's Smart Tag and add a new `WizardStep`, setting its `ID` to `SpecifyRolesStep`.</span></span> <span data-ttu-id="c773f-340">Verschieben Sie die `SpecifyRolesStep WizardStep` so, dass Sie nach dem Schritt "registrieren Sie sich für Ihr neues Konto", aber vor dem Schritt "abschließen" angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c773f-340">Move the `SpecifyRolesStep WizardStep` so that it comes after the "Sign Up for Your New Account" step, but before the "Complete" step.</span></span> <span data-ttu-id="c773f-341">Legen Sie die `Title`-Eigenschaft des `WizardStep`auf "Rollen angeben", die `StepType`-Eigenschaft auf `Step`und die `AllowReturn`-Eigenschaft auf "false" fest.</span><span class="sxs-lookup"><span data-stu-id="c773f-341">Set the `WizardStep`'s `Title` property to "Specify Roles", its `StepType` property to `Step`, and its `AllowReturn` property to False.</span></span>

<span data-ttu-id="c773f-342">[![hinzufügen](assigning-roles-to-users-vb/_static/image32.png)](assigning-roles-to-users-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-342">[![Add the](assigning-roles-to-users-vb/_static/image32.png)](assigning-roles-to-users-vb/_static/image31.png)</span></span>

<span data-ttu-id="c773f-343">**Abbildung 11**: Hinzufügen der `WizardStep` "Rollen angeben" zum "feateuserwizard" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-343">**Figure 11**: Add the "Specify Roles" `WizardStep` to the CreateUserWizard  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image33.png))</span></span>

<span data-ttu-id="c773f-344">Nachdem Sie diese Änderung vorgenommen haben, sollte das deklarative Markup von "kreateuserwizard" wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="c773f-344">After this change your CreateUserWizard's declarative markup should look like the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample21.aspx)]

<span data-ttu-id="c773f-345">Fügen Sie im `WizardStep`"Rollen angeben" eine CheckBoxList mit dem Namen `RoleList.` in dieser CheckBoxList werden die verfügbaren Rollen aufgelistet, sodass die Person, die die Seite besucht, überprüfen kann, zu welchen Rollen der neu erstellte Benutzer gehört.</span><span class="sxs-lookup"><span data-stu-id="c773f-345">In the "Specify Roles" `WizardStep`, add a CheckBoxList named `RoleList.` This CheckBoxList will list the available roles, enabling the person visiting the page to check what roles the newly created user belongs to.</span></span>

<span data-ttu-id="c773f-346">Wir haben zwei Codierungs Aufgaben: zuerst muss die `RoleList` CheckBoxList mit den Rollen im System aufgefüllt werden. Zweitens müssen wir den erstellten Benutzer den ausgewählten Rollen hinzufügen, wenn der Benutzer den Schritt "Rollen angeben" in den Schritt "Fertigstellen" verschiebt.</span><span class="sxs-lookup"><span data-stu-id="c773f-346">We are left with two coding tasks: first we must populate the `RoleList` CheckBoxList with the roles in the system; second, we need to add the created user to the selected roles when the user moves from the "Specify Roles" step to the "Complete" step.</span></span> <span data-ttu-id="c773f-347">Wir können die erste Aufgabe im Ereignishandler für `Page_Load` ausführen.</span><span class="sxs-lookup"><span data-stu-id="c773f-347">We can accomplish the first task in the `Page_Load` event handler.</span></span> <span data-ttu-id="c773f-348">Der folgende Code verweist beim ersten Besuch der Seite Programm gesteuert auf das Kontrollkästchen `RoleList` und bindet die Rollen im System an ihn.</span><span class="sxs-lookup"><span data-stu-id="c773f-348">The following code programmatically references the `RoleList` CheckBox on the first visit to the page and binds the roles in the system to it.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample22.vb)]

<span data-ttu-id="c773f-349">Der obige Code sollte Ihnen vertraut erscheinen.</span><span class="sxs-lookup"><span data-stu-id="c773f-349">The above code should look familiar.</span></span> <span data-ttu-id="c773f-350"><a id="_msoanchor_5"> </a>Im Lernprogramm zum [ *Speichern* *zusätzlicher Benutzerinformationen* ](../membership/storing-additional-user-information-vb.md) wurden zwei `FindControl` Anweisungen verwendet, um von einem benutzerdefinierten `WizardStep`aus auf ein websteuer Element zu verweisen.</span><span class="sxs-lookup"><span data-stu-id="c773f-350">In the <a id="_msoanchor_5"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-vb.md) tutorial we used two `FindControl` statements to reference a Web control from within a custom `WizardStep`.</span></span> <span data-ttu-id="c773f-351">Und der Code, der die Rollen an die CheckBoxList bindet, wurde von einem früheren Zeitpunkt in diesem Tutorial entnommen.</span><span class="sxs-lookup"><span data-stu-id="c773f-351">And the code that binds the roles to the CheckBoxList was taken from earlier in this tutorial.</span></span>

<span data-ttu-id="c773f-352">Um die zweite Programmieraufgabe auszuführen, müssen wir wissen, wann der Schritt "Rollen angeben" abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="c773f-352">In order to perform the second programming task we need to know when the "Specify Roles" step has been completed.</span></span> <span data-ttu-id="c773f-353">Beachten Sie, dass der "forateuserwizard" über ein `ActiveStepChanged` Ereignis verfügt, das jedes Mal ausgelöst wird, wenn der Besucher von einem Schritt zu einem anderen navigiert.</span><span class="sxs-lookup"><span data-stu-id="c773f-353">Recall that the CreateUserWizard has an `ActiveStepChanged` event, which fires each time the visitor navigates from one step to another.</span></span> <span data-ttu-id="c773f-354">Hier können Sie feststellen, ob der Benutzer den Schritt "Fertig" erreicht hat. Wenn dies der Fall ist, muss der Benutzer den ausgewählten Rollen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-354">Here we can determine if the user has reached the "Complete" step; if so, we need to add the user to the selected roles.</span></span>

<span data-ttu-id="c773f-355">Erstellen Sie einen Ereignishandler für das `ActiveStepChanged`-Ereignis, und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="c773f-355">Create an event handler for the `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample23.vb)]

<span data-ttu-id="c773f-356">Wenn der Benutzer soeben den Schritt "abgeschlossen" erreicht hat, listet der Ereignishandler die Elemente der `RoleList` CheckBoxList auf, und der soeben erstellte Benutzer wird den ausgewählten Rollen zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="c773f-356">If the user has just reached the "Completed" step, the event handler enumerates the items of the `RoleList` CheckBoxList and the just-created user is assigned to the selected roles.</span></span>

<span data-ttu-id="c773f-357">Besuchen Sie diese Seite über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="c773f-357">Visit this page through a browser.</span></span> <span data-ttu-id="c773f-358">Der erste Schritt in der Datei "Setup" ist der Standard Schritt "registrieren Sie sich für Ihr neues Konto", in dem der Benutzername, das Kennwort, die e-Mail-Adresse und andere Schlüsselinformationen für den neuen Benutzer angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-358">The first step in the CreateUserWizard is the standard "Sign Up for Your New Account" step, which prompts for the new user's username, password, email, and other key information.</span></span> <span data-ttu-id="c773f-359">Geben Sie die Informationen ein, um einen neuen Benutzernamens Wanda zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="c773f-359">Enter the information to create a new user named Wanda.</span></span>

<span data-ttu-id="c773f-360">[![erstellen Sie einen neuen Benutzer mit dem Namen "Wanda"](assigning-roles-to-users-vb/_static/image35.png)](assigning-roles-to-users-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-360">[![Create a New User Named Wanda](assigning-roles-to-users-vb/_static/image35.png)](assigning-roles-to-users-vb/_static/image34.png)</span></span>

<span data-ttu-id="c773f-361">**Abbildung 12**: Erstellen eines neuen Benutzers mit dem Namen "Wanda" ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-361">**Figure 12**: Create a New User Named Wanda  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image36.png))</span></span>

<span data-ttu-id="c773f-362">Klicken Sie auf die Schaltfläche "Benutzer erstellen".</span><span class="sxs-lookup"><span data-stu-id="c773f-362">Click the "Create User" button.</span></span> <span data-ttu-id="c773f-363">Der Skript Erstellungs-Assistent ruft intern die `Membership.CreateUser` Methode auf, erstellt das neue Benutzerkonto und wechselt dann zum nächsten Schritt, "Rollen angeben".</span><span class="sxs-lookup"><span data-stu-id="c773f-363">The CreateUserWizard internally calls the `Membership.CreateUser` method, creating the new user account, and then progresses to the next step, "Specify Roles."</span></span> <span data-ttu-id="c773f-364">Hier werden die System Rollen aufgelistet.</span><span class="sxs-lookup"><span data-stu-id="c773f-364">Here the system roles are listed.</span></span> <span data-ttu-id="c773f-365">Aktivieren Sie das Kontrollkästchen Vorgesetzten, und klicken Sie auf weiter</span><span class="sxs-lookup"><span data-stu-id="c773f-365">Check the Supervisors checkbox and click Next.</span></span>

<span data-ttu-id="c773f-366">[![Wanda Mitglied der Rolle "Supervisor"](assigning-roles-to-users-vb/_static/image38.png)](assigning-roles-to-users-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-366">[![Make Wanda a Member of the Supervisors Role](assigning-roles-to-users-vb/_static/image38.png)](assigning-roles-to-users-vb/_static/image37.png)</span></span>

<span data-ttu-id="c773f-367">**Abbildung 13**: Erstellen eines Mitglieds der Rolle "Supervisor" ([Klicken Sie hier, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-367">**Figure 13**: Make Wanda a Member of the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image39.png))</span></span>

<span data-ttu-id="c773f-368">Wenn Sie auf Weiter klicken, wird ein Postback ausgelöst, und der `ActiveStep` wird auf den Schritt "Complete" aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="c773f-368">Clicking Next causes a postback and updates the `ActiveStep` to the "Complete" step.</span></span> <span data-ttu-id="c773f-369">Im Ereignishandler `ActiveStepChanged` wird das kürzlich erstellte Benutzerkonto der Rolle Supervisor zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="c773f-369">In the `ActiveStepChanged` event handler, the recently-created user account is assigned to the Supervisors role.</span></span> <span data-ttu-id="c773f-370">Um dies zu überprüfen, kehren Sie zur Seite `UsersAndRoles.aspx` zurück, und wählen Sie in der Dropdown Liste `RoleList` die Option Supervisor aus.</span><span class="sxs-lookup"><span data-stu-id="c773f-370">To verify this, return to the `UsersAndRoles.aspx` page and select Supervisors from the `RoleList` DropDownList.</span></span> <span data-ttu-id="c773f-371">Wie in Abbildung 14 gezeigt, bestehen die Vorgesetzten nun aus drei Benutzern: Bruce, Tito und Wanda.</span><span class="sxs-lookup"><span data-stu-id="c773f-371">As Figure 14 shows, the Supervisors are now made up of three users: Bruce, Tito, and Wanda.</span></span>

<span data-ttu-id="c773f-372">[![Bruce, Tito und Wanda sind alle Vorgesetzten.](assigning-roles-to-users-vb/_static/image41.png)](assigning-roles-to-users-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c773f-372">[![Bruce, Tito, and Wanda are All Supervisors](assigning-roles-to-users-vb/_static/image41.png)](assigning-roles-to-users-vb/_static/image40.png)</span></span>

<span data-ttu-id="c773f-373">**Abbildung 14**: Bruce, Tito und Wanda sind alle Vorgesetzten ([Klicken Sie, um das Bild in voller Größe anzuzeigen](assigning-roles-to-users-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="c773f-373">**Figure 14**: Bruce, Tito, and Wanda are All Supervisors  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image42.png))</span></span>

## <a name="summary"></a><span data-ttu-id="c773f-374">Summary</span><span class="sxs-lookup"><span data-stu-id="c773f-374">Summary</span></span>

<span data-ttu-id="c773f-375">Das Rollen Framework bietet Methoden zum Abrufen von Informationen über die Rollen und Methoden eines bestimmten Benutzers, um zu bestimmen, welche Benutzer zu einer bestimmten Rolle gehören.</span><span class="sxs-lookup"><span data-stu-id="c773f-375">The Roles framework offers methods for retrieving information about a particular user's roles and methods for determining what users belong to a specified role.</span></span> <span data-ttu-id="c773f-376">Außerdem gibt es eine Reihe von Methoden zum Hinzufügen und Entfernen von Benutzern zu einer oder mehreren Rollen.</span><span class="sxs-lookup"><span data-stu-id="c773f-376">Furthermore, there are a number of methods for adding and removing one or more users to one or more roles.</span></span> <span data-ttu-id="c773f-377">In diesem Tutorial haben wir uns auf zwei der folgenden Methoden konzentriert: `AddUserToRole` und `RemoveUserFromRole`.</span><span class="sxs-lookup"><span data-stu-id="c773f-377">In this tutorial we focused on just two of these methods: `AddUserToRole` and `RemoveUserFromRole`.</span></span> <span data-ttu-id="c773f-378">Es gibt zusätzliche Varianten, die für das Hinzufügen mehrerer Benutzer zu einer einzelnen Rolle und das Zuweisen mehrerer Rollen zu einem einzelnen Benutzer entworfen wurden.</span><span class="sxs-lookup"><span data-stu-id="c773f-378">There are additional variants designed to add multiple users to a single role and to assign multiple roles to a single user.</span></span>

<span data-ttu-id="c773f-379">Dieses Tutorial enthält auch einen Blick auf das Erweitern des Steuer Elements "kreateuserwizard", um ein `WizardStep` zum Angeben der Rollen des neu erstellten Benutzers einzuschließen.</span><span class="sxs-lookup"><span data-stu-id="c773f-379">This tutorial also included a look at extending the CreateUserWizard control to include a `WizardStep` to specify the newly-created user's roles.</span></span> <span data-ttu-id="c773f-380">Ein solcher Schritt kann einem Administrator dabei helfen, das Erstellen von Benutzerkonten für neue Benutzer zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="c773f-380">Such a step could help an administrator streamline the process of creating user accounts for new users.</span></span>

<span data-ttu-id="c773f-381">An dieser Stelle haben wir gesehen, wie Sie Rollen erstellen und löschen und wie Sie Benutzer zu Rollen hinzufügen und daraus entfernen.</span><span class="sxs-lookup"><span data-stu-id="c773f-381">At this point we have seen how to create and delete roles and how to add and remove users from roles.</span></span> <span data-ttu-id="c773f-382">Wir haben uns jedoch noch mit dem Anwenden der rollenbasierten Autorisierung befasst.</span><span class="sxs-lookup"><span data-stu-id="c773f-382">But we have yet to look at applying role-based authorization.</span></span> <span data-ttu-id="c773f-383"><a id="_msoanchor_6"> </a>Im [folgenden Tutorial](role-based-authorization-vb.md) wird erläutert, wie Sie URL-Autorisierungs Regeln für Rollen Weise definieren und wie Sie auf Seitenebene basierend auf den Rollen des aktuell angemeldeten Benutzers eingeschränkt werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-383">In the <a id="_msoanchor_6"></a>[following tutorial](role-based-authorization-vb.md) we will look at defining URL authorization rules on a role-by-role basis, as well as how to limit page-level functionality based on the currently logged in user's roles.</span></span>

<span data-ttu-id="c773f-384">Fröhliche Programmierung!</span><span class="sxs-lookup"><span data-stu-id="c773f-384">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c773f-385">Weiterführende Themen</span><span class="sxs-lookup"><span data-stu-id="c773f-385">Further Reading</span></span>

<span data-ttu-id="c773f-386">Weitere Informationen zu den in diesem Tutorial behandelten Themen finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="c773f-386">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c773f-387">ASP.net Übersicht über das Websiteverwaltungs-Tool</span><span class="sxs-lookup"><span data-stu-id="c773f-387">ASP.NET Web Site Administration Tool Overview</span></span>](https://msdn.microsoft.com/library/ms228053.aspx)
- [<span data-ttu-id="c773f-388">Untersuchen von ASP. Netzwerk Mitgliedschaft, Rollen und Profil</span><span class="sxs-lookup"><span data-stu-id="c773f-388">Examining ASP.NET's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="c773f-389">Ein eigenes Websiteverwaltungs-Tool</span><span class="sxs-lookup"><span data-stu-id="c773f-389">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="c773f-390">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="c773f-390">About the Author</span></span>

<span data-ttu-id="c773f-391">Scott Mitchell, Autor mehrerer ASP/ASP. net-Bücher und Gründer von 4GuysFromRolla.com, hat seit 1998 mit Microsoft-Webtechnologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="c773f-391">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c773f-392">Scott arbeitet als unabhängiger Berater, Ausbilder und Writer.</span><span class="sxs-lookup"><span data-stu-id="c773f-392">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c773f-393">Sein letztes Buch ist *[Sams Teach Yourself ASP.NET 2,0 in 24 Stunden](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="c773f-393">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c773f-394">Scott kann über [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) oder über seinen Blog unter [http://ScottOnWriting.NET](http://scottonwriting.net/)erreicht werden.</span><span class="sxs-lookup"><span data-stu-id="c773f-394">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c773f-395">Besonders vielen Dank...</span><span class="sxs-lookup"><span data-stu-id="c773f-395">Special Thanks To…</span></span>

<span data-ttu-id="c773f-396">Diese tutorialreihe wurde von vielen hilfreichen Reviewern geprüft.</span><span class="sxs-lookup"><span data-stu-id="c773f-396">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c773f-397">Lead Reviewer für dieses Tutorial war Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="c773f-397">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="c773f-398">Möchten Sie meine bevorstehenden MSDN-Artikel überprüfen?</span><span class="sxs-lookup"><span data-stu-id="c773f-398">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c773f-399">Wenn dies der Fall ist, löschen Sie eine Zeile bei [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c773f-399">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c773f-400">[Zurück](creating-and-managing-roles-vb.md)
> [Weiter](role-based-authorization-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c773f-400">[Previous](creating-and-managing-roles-vb.md)
[Next](role-based-authorization-vb.md)</span></span>
