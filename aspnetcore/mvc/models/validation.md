---
title: Modellvalidierung im ASP.NET Core MVC
author: tdykstra
description: Informationen zur Modellvalidierung im ASP.NET Core MVC
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049067"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="66dc6-103">Modellvalidierung im ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="66dc6-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="66dc6-104">Von [Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="66dc6-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="66dc6-105">Einführung in die Modellvalidierung</span><span class="sxs-lookup"><span data-stu-id="66dc6-105">Introduction to model validation</span></span>

<span data-ttu-id="66dc6-106">Bevor eine App Daten in einer Datenbank speichern kann, muss sie diese Daten überprüfen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="66dc6-107">Daten müssen auf mögliche Sicherheitsbedrohungen überprüft werden. Außerdem muss geprüft werden, ob sie richtig nach Typ und Größe formatiert und mit den Regeln konform sind.</span><span class="sxs-lookup"><span data-stu-id="66dc6-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="66dc6-108">Die Validierung kann zwar redundant und die Implementierung aufwendig sein, jedoch ist sie unbedingt notwendig.</span><span class="sxs-lookup"><span data-stu-id="66dc6-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="66dc6-109">Im MVC werden sowohl der Client als auch der Server validiert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="66dc6-110">Praktischerweise hat .NET die Validierung in Validierungsattribute unterteilt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="66dc6-111">Diese Attribute enthalten Validierungscode, sodass Sie weniger Code schreiben müssen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="66dc6-112">In ASP.NET Core 2.2 und höher umgeht (überspringt) die ASP.NET Core-Runtime die Validierung, wenn sie bestimmen kann, dass ein vorgegebener Modellgraph keine Validierung erfordert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="66dc6-113">Das Überspringen der Validierung kann zu erheblichen Leistungsverbesserungen führen, wenn die zu validierenden Modelle keine Validierungssteuerelemente verwenden können oder ihnen keine Validierungssteuerelemente zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="66dc6-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="66dc6-114">Die übersprungene Validierung umfasst Objekte wie z.B. Sammlungen von primitiven (`byte[]`, `string[]`, `Dictionary<string, string>` usw.) oder komplexen Objektgraphen ohne Validierungssteuerelemente.</span><span class="sxs-lookup"><span data-stu-id="66dc6-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="66dc6-115">[Beispiel anzeigen oder von GitHub herunterladen](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="66dc6-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="66dc6-116">Validierungsattribute</span><span class="sxs-lookup"><span data-stu-id="66dc6-116">Validation Attributes</span></span>

<span data-ttu-id="66dc6-117">Mithilfe von Validierungsattributen können Sie die Modellvalidierung konfigurieren, sodass sie dem Konzept zum Validieren von Feldern in Datenbanktabellen ähnelt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="66dc6-118">Dies beinhaltet Einschränkungen wie das Zuweisen von Datentypen oder erforderlichen Feldern.</span><span class="sxs-lookup"><span data-stu-id="66dc6-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="66dc6-119">Andere Typvalidierungen umfassen die Anwendung von Mustern auf Daten, um Geschäftsregeln zu erzwingen – z.B. das Angeben einer Kreditkarte, einer Telefonnummer oder einer E-Mail-Adresse.</span><span class="sxs-lookup"><span data-stu-id="66dc6-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="66dc6-120">Mithilfe von Validierungsattributen können Anforderungen viel einfacher erzwungen werden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="66dc6-121">Validierungsattribute werden auf der Eigenschaftenebene festgelegt:</span><span class="sxs-lookup"><span data-stu-id="66dc6-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="66dc6-122">Nachfolgend finden Sie ein annotiertes `Movie`-Modell einer App, das Informationen über Filme und Fernsehserien speichert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="66dc6-123">Die meisten Eigenschaften sind erforderlich und einige Zeichenfolgeneigenschaften haben Längenanforderungen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="66dc6-124">Außerdem gibt es neben einem benutzerdefinierten Validierungsattribut auch eine Bereichseinschränkung für die `Price`-Eigenschaft von 0 (null) bis 999,99 $.</span><span class="sxs-lookup"><span data-stu-id="66dc6-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="66dc6-125">Wenn Sie das Modell ansehen, erfahren Sie, welche Regeln über Daten für diese App gelten, wodurch Sie den Code einfacher verwalten können.</span><span class="sxs-lookup"><span data-stu-id="66dc6-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="66dc6-126">Im Folgenden finden Sie verschiedene beliebte integrierte Validierungsattribute:</span><span class="sxs-lookup"><span data-stu-id="66dc6-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="66dc6-127">`[CreditCard]`: Überprüft, ob die Eigenschaft über ein Kreditkartenformat verfügt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="66dc6-128">`[Compare]`: Überprüft, ob zwei Eigenschaften in einem Modell miteinander übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="66dc6-129">`[EmailAddress]`: Überprüft, ob die Eigenschaft über ein E-Mail-Format verfügt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="66dc6-130">`[Phone]`: Überprüft, ob die Eigenschaft über ein Telefonformat verfügt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="66dc6-131">`[Range]`: Überprüft, ob der Eigenschaftenwert im vorgegebenen Bereich liegt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="66dc6-132">`[RegularExpression]`: Überprüft, ob die Daten mit dem angegebenen regulären Ausdruck übereinstimmt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="66dc6-133">`[Required]`: Legt eine Eigenschaft als erforderlich fest.</span><span class="sxs-lookup"><span data-stu-id="66dc6-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="66dc6-134">`[StringLength]`: Überprüft, ob eine Zeichenfolgeneigenschaft die maximale Länge nicht überschreitet.</span><span class="sxs-lookup"><span data-stu-id="66dc6-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="66dc6-135">`[Url]`: Überprüft, ob die Eigenschaft über ein URL-Format verfügt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="66dc6-136">MVC unterstützt alle Attribute, die von `ValidationAttribute` zu Validierungszwecken abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="66dc6-137">Im [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations)-Namespace finden Sie viele nützliche Validierungsattribute.</span><span class="sxs-lookup"><span data-stu-id="66dc6-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="66dc6-138">Für manche Instanzen benötigen Sie ggf. mehr Features als die integrierten Attribute bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="66dc6-139">Wenn dies der Fall ist, können Sie benutzerdefinierte Validierungsattribute erstellen, indem Sie von `ValidationAttribute` ableiten oder Ihr Modell verändern, sodass es `IValidatableObject` implementiert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="66dc6-140">Hinweise zur Verwendung des erforderlichen Attributs</span><span class="sxs-lookup"><span data-stu-id="66dc6-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="66dc6-141">[Werttypen](/dotnet/csharp/language-reference/keywords/value-types), bei denen es sich nicht um Nullable-Typen handelt (wie z.B. `decimal`, `int`, `float` und `DateTime`), sind grundsätzlich erforderlich und benötigen das Attribut `Required` nicht.</span><span class="sxs-lookup"><span data-stu-id="66dc6-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="66dc6-142">Die App führt keine Validierungsüberprüfungen auf Serverseite für nicht auf NULL festlegbare Typen aus, die als `Required` markiert sind.</span><span class="sxs-lookup"><span data-stu-id="66dc6-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="66dc6-143">Die MVC-Modellbindung, die bei der Validierung und bei Validierungsattributen nicht in Betracht gezogen wird, lehnt die Übertragung eines Formularfelds ab, die einen fehlenden Wert oder einen Platzhalter für einen nicht auf NULL festlegbaren Typ enthält.</span><span class="sxs-lookup"><span data-stu-id="66dc6-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="66dc6-144">Wenn kein `BindRequired`-Attribut für die Zieleigenschaft vorhanden ist, ignoriert die Modellbindung die fehlenden Daten für nicht auf NULL festlegbare Typen, wenn das Formularfeld keine eingehenden Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="66dc6-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="66dc6-145">Das [BindRequired-Attribut](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (siehe <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) ist nützlich, um sicherzustellen, dass die Formulardaten vollständig sind.</span><span class="sxs-lookup"><span data-stu-id="66dc6-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="66dc6-146">Wenn das Modellbindungssystem auf eine Eigenschaft angewendet wird, ist ein Wert für diese Eigenschaft erforderlich.</span><span class="sxs-lookup"><span data-stu-id="66dc6-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="66dc6-147">Wenn das Modellbindungssystem auf einen Typ angewendet wird, sind für alle Eigenschaften dieses Typs Werte erforderlich.</span><span class="sxs-lookup"><span data-stu-id="66dc6-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="66dc6-148">Wenn Sie einen [Nullable\<T>-Typ](/dotnet/csharp/programming-guide/nullable-types/) (z.B. `decimal?` oder `System.Nullable<decimal>`) verwenden, und ihn als `Required` markieren, wird eine Validierungsüberprüfung auf Serverseite ausgeführt. Dabei wird angenommen, dass es sich bei der Eigenschaft um einen Nullable-Standardtyp (z.B. eine `string`) handelt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="66dc6-149">Für die Validierung auf Clientseite ist ein Wert für ein Formularfeld, das mit einer Modelleigenschaft übereinstimmt, die Sie als `Required` markiert haben, und für eine nicht auf NULL festlegbare Typeigenschaft erforderlich, die Sie nicht als `Required` markiert haben.</span><span class="sxs-lookup"><span data-stu-id="66dc6-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="66dc6-150">`Required` kann verwendet werden, um die Fehlermeldung der Validierung auf Clientseite zu kontrollieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="66dc6-151">Validierung der Knoten auf oberster Ebene</span><span class="sxs-lookup"><span data-stu-id="66dc6-151">Top-level node validation</span></span>

<span data-ttu-id="66dc6-152">Knoten der obersten Ebene sind unter anderem:</span><span class="sxs-lookup"><span data-stu-id="66dc6-152">Top-level nodes include:</span></span>

* <span data-ttu-id="66dc6-153">Aktionsparameter</span><span class="sxs-lookup"><span data-stu-id="66dc6-153">Action parameters</span></span>
* <span data-ttu-id="66dc6-154">Controllereigenschaften</span><span class="sxs-lookup"><span data-stu-id="66dc6-154">Controller properties</span></span>
* <span data-ttu-id="66dc6-155">Seitenhandlerparameter</span><span class="sxs-lookup"><span data-stu-id="66dc6-155">Page handler parameters</span></span>
* <span data-ttu-id="66dc6-156">Seitenmodelleigenschaften</span><span class="sxs-lookup"><span data-stu-id="66dc6-156">Page model properties</span></span>

<span data-ttu-id="66dc6-157">An ein Modell gebundene Knoten auf oberster Ebene und Modelleigenschaften werden überprüft.</span><span class="sxs-lookup"><span data-stu-id="66dc6-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="66dc6-158">Im folgenden Beispiel aus der Beispiel-App verwendet die `VerifyPhone`-Methode die <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute>-Klasse, um die Benutzerdaten im Telefonfeld eines Formulars zu überprüfen</span><span class="sxs-lookup"><span data-stu-id="66dc6-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="66dc6-159">Knoten auf oberster Ebene können <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> mit Validierungsattributen verwenden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="66dc6-160">Im folgenden Beispiel aus der Beispiel-App gibt die `CheckAge`-Methode an, dass der `age`-Parameter aus der Abfragezeichenfolge gebunden sein muss, wenn das Formular übermittelt wird:</span><span class="sxs-lookup"><span data-stu-id="66dc6-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="66dc6-161">Auf der Seite für die Altersprüfung (*CheckAge.cshtml*) sind zwei Formulare vorhanden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="66dc6-162">Das erste Formular übermittelt einen `Age`-Wert von `99` als Abfragezeichenfolge: `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="66dc6-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="66dc6-163">Wenn ein ordnungsgemäß formatierter `age`-Parameter aus der Abfragezeichenfolge übermittelt wird, wird das Formular überprüft.</span><span class="sxs-lookup"><span data-stu-id="66dc6-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="66dc6-164">Das zweite Formular auf der Seite für die Altersprüfung übermittelt den `Age`-Wert im Anforderungstext, worauf die Validierung fehlschlägt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="66dc6-165">Die Bindung schlägt fehl, da der `age`-Parameter aus einer Abfragezeichenfolge stammen muss.</span><span class="sxs-lookup"><span data-stu-id="66dc6-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="66dc6-166">Die Validierung wird standardmäßig von der Eigenschaft <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> von <xref:Microsoft.AspNetCore.Mvc.MvcOptions> aktiviert und gesteuert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="66dc6-167">Legen Sie in den MVC-Optionen (`Startup.ConfigureServices`) `AllowValidatingTopLevelNodes` auf `false` fest, um die Validierung der Knoten auf oberster Ebene zu deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="66dc6-168">Modellstatus</span><span class="sxs-lookup"><span data-stu-id="66dc6-168">Model State</span></span>

<span data-ttu-id="66dc6-169">Der Modellstatus stellt Validierungsfehler in übermittelten HTML-Formularwerten dar.</span><span class="sxs-lookup"><span data-stu-id="66dc6-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="66dc6-170">MVC überprüft die Felder solange, bis die maximale Anzahl von Fehlern (standardmäßig 200) erreicht wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="66dc6-171">Sie können diese Zahl mit dem folgenden Code in `Startup.ConfigureServices` konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="66dc6-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="66dc6-172">Behandeln von Modellstatusfehlern</span><span class="sxs-lookup"><span data-stu-id="66dc6-172">Handle Model State errors</span></span>

<span data-ttu-id="66dc6-173">Die Modellprüfung erfolgt vor der Ausführung einer Controlleraktion.</span><span class="sxs-lookup"><span data-stu-id="66dc6-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="66dc6-174">Die Überprüfung von `ModelState.IsValid` und entsprechende Maßnahmen erfolgen im Rahmen der Aktion.</span><span class="sxs-lookup"><span data-stu-id="66dc6-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="66dc6-175">Als angemessene Reaktion gilt in der Regel die Rückgabe einer Fehlerantwort, in der bestenfalls der Grund angegeben wird, warum die Modellvalidierung fehlgeschlagen ist.</span><span class="sxs-lookup"><span data-stu-id="66dc6-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="66dc6-176">Wenn `ModelState.IsValid` in Web-API-Controllern mit dem Attribut `[ApiController]` `false` ergibt, wird eine automatische HTTP 400-Antwort mit Details zum Problem zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="66dc6-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="66dc6-177">Weitere Informationen finden Sie unter [Automatische HTTP 400-Antworten](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="66dc6-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="66dc6-178">Einige Apps wählen eine Standardkonvention aus, um Modellvalidierungsfehler zu behandeln. Dann kann ein Filter hilfreich sein, um eine solche Richtlinie zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="66dc6-179">Sie sollten testen, wie sich Ihre Aktionen mit gültigen und ungültigen Modellstatus verhalten.</span><span class="sxs-lookup"><span data-stu-id="66dc6-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="66dc6-180">Manuelle Validierung</span><span class="sxs-lookup"><span data-stu-id="66dc6-180">Manual validation</span></span>

<span data-ttu-id="66dc6-181">Sobald die Modellbindung und die Validierung abgeschlossen sind, sollten Sie einzelne Bestandteile dieser beiden Vorgänge wiederholen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="66dc6-182">Es kann z.B. sein, dass ein Benutzer Text in ein Feld eingegeben hat und einen Integer erwartet, oder dass Sie einen Wert für eine Eigenschaft des Modells berechnen müssen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="66dc6-183">Möglicherweise müssen Sie die Validierung manuell ausführen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-183">You may need to run validation manually.</span></span> <span data-ttu-id="66dc6-184">Rufen Sie dazu wie im Folgenden dargestellt die `TryValidateModel`-Methode auf:</span><span class="sxs-lookup"><span data-stu-id="66dc6-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="66dc6-185">Benutzerdefinierte Validierung</span><span class="sxs-lookup"><span data-stu-id="66dc6-185">Custom validation</span></span>

<span data-ttu-id="66dc6-186">Validierungsattribute funktionieren für die meisten Anforderungen, die im Zusammenhang mit der Validierung stehen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="66dc6-187">Manche Validierungsregeln gelten nur für Ihr Unternehmen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="66dc6-188">Möglicherweise handelt es sich bei Ihren Regeln nicht um häufig verwendete Techniken zur Datenvalidierung wie die Gewährleistung, dass ein Feld erforderlich ist oder dass das Feld mit einem Wertebereich konform ist.</span><span class="sxs-lookup"><span data-stu-id="66dc6-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="66dc6-189">In diesen Szenarios bieten sich Validierungsattribute als Lösung an.</span><span class="sxs-lookup"><span data-stu-id="66dc6-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="66dc6-190">Das Erstellen Ihrer eigenen benutzerdefinierten Validierungsattribute in MVC ist einfach.</span><span class="sxs-lookup"><span data-stu-id="66dc6-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="66dc6-191">Erben Sie einfach von dem `ValidationAttribute`-Attribut, und setzen Sie die `IsValid`-Methode außer Kraft.</span><span class="sxs-lookup"><span data-stu-id="66dc6-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="66dc6-192">Die `IsValid`-Methode akzeptiert zwei Parameter: Bei dem ersten handelt es sich um ein Objekt mit dem Namen *value* und bei dem zweiten handelt es sich um ein `ValidationContext`-Objekt mit dem Namen *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="66dc6-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="66dc6-193">*Value* bezieht sich auf den tatsächlichen Wert aus dem Feld, das Ihr benutzerdefiniertes Validierungssteuerelement überprüft.</span><span class="sxs-lookup"><span data-stu-id="66dc6-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="66dc6-194">Im folgenden Beispiel legt eine Unternehmensregel fest, dass Benutzer das Genre für Filme, die nach 1960 veröffentlicht wurden, möglicherweise nicht auf *Klassiker* festlegen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="66dc6-195">Das `[ClassicMovie]`-Attribut überprüft erst das Genre, und wenn es sich um einen Klassiker handelt, überprüft es, ob das Datum der Veröffentlichung nach 1960 liegt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="66dc6-196">Wenn der Film nach 1960 veröffentlicht wurde, schlägt die Validierung fehl.</span><span class="sxs-lookup"><span data-stu-id="66dc6-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="66dc6-197">Das Attribut akzeptiert einen Integer-Parameter, der für das Jahr steht, das Sie verwenden können, um Daten zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="66dc6-198">Sie können wie folgt den Wert des Parameters im Konstruktor des Attributs erfassen:</span><span class="sxs-lookup"><span data-stu-id="66dc6-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="66dc6-199">Die obenstehende `movie`-Variable stellt ein `Movie`-Objekt dar, das die Daten der Formularübermittlung enthalten, die überprüft werden sollen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="66dc6-200">In diesem Fall überprüft der Validierungscode anhand der Regeln das Datum und das Genre der `ClassicMovieAttribute`-Klasse in der `IsValid`-Methode.</span><span class="sxs-lookup"><span data-stu-id="66dc6-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="66dc6-201">Ist die Validierung erfolgreich, gibt `IsValid` einen `ValidationResult.Success`-Code zurück.</span><span class="sxs-lookup"><span data-stu-id="66dc6-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="66dc6-202">Schlägt die Validierung fehl, wird ein `ValidationResult` mit einer Fehlermeldung zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="66dc6-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="66dc6-203">Wenn ein Benutzer das `Genre`-Feld verändert und das Formular übermittelt, überprüft die `IsValid`-Methode des `ClassicMovieAttribute`-Attributs, ob es sich bei dem Film um einen Klassiker handelt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="66dc6-204">Wenden Sie das `ClassicMovieAttribute`-Attribut wie jedes andere Attribut auch auf eine Eigenschaft wie `ReleaseDate` an, um wie im folgenden Codebeispiel dargestellt sicherzustellen, dass die Validierung durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="66dc6-205">Da das Beispiel nur mit `Movie`-Typen funktioniert, ist es die bessere Option, `IValidatableObject` wie im folgenden Abschnitt dargestellt zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="66dc6-206">Stattdessen kann derselbe Code auch in dem Modell platziert werden, indem er in die `Validate`-Methode auf der `IValidatableObject`-Schnittstelle implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="66dc6-207">Benutzerdefinierte Validierungsattribute funktionieren zwar gut für die Validierung von individuellen Eigenschaften, die Implementierung von `IValidatableObject` kann jedoch verwendet werden, um die Validierung auf Klassenebene zu implementieren:</span><span class="sxs-lookup"><span data-stu-id="66dc6-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="66dc6-208">Validierung auf Clientseite</span><span class="sxs-lookup"><span data-stu-id="66dc6-208">Client side validation</span></span>

<span data-ttu-id="66dc6-209">Die Validierung auf Clientseite ist ein praktisches Feature für Benutzer.</span><span class="sxs-lookup"><span data-stu-id="66dc6-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="66dc6-210">Sie spart Zeit, die andernfalls verloren gehen würde, während sie auf einen Roundtrip auf den Server warten.</span><span class="sxs-lookup"><span data-stu-id="66dc6-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="66dc6-211">In Unternehmen reicht es schon aus, wenn nur Bruchteile von Sekunden mehrere Hundert Male täglich verloren gehen, damit viel Zeit und Aufwand unnötig aufgewendet werden und die Frustration wächst.</span><span class="sxs-lookup"><span data-stu-id="66dc6-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="66dc6-212">Wenn die Prüfung unkompliziert und ohne Umschweife ausgeführt wird, können Benutzer effizienter arbeiten und Eingaben und Ausgaben von besserer Qualität produzieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="66dc6-213">Damit die Validierung auf Clientseite wie im folgenden Codebeispiel dargestellt funktioniert, müssen Sie über eine Ansicht mit den passenden Skriptverweisen für JavaScript verfügen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="66dc6-214">Bei dem [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive)-Skript handelt es sich um eine benutzerdefinierte Front-End-Bibliothek von Microsoft, die auf dem beliebten [jQuery Validate](https://jqueryvalidation.org/)-Plugin basiert.</span><span class="sxs-lookup"><span data-stu-id="66dc6-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="66dc6-215">Ohne dieses Skript müssen Sie dieselbe Validierungslogik an zwei unterschiedlichen Stellen codieren: einmal in den Attributen der Validierung auf Serverseite für Modelleigenschaften und einmal in den Skripts auf Clientseite. In den Beispielen für die [`validate()`](https://jqueryvalidation.org/validate/)-Methode von „jQuery Validate“ können Sie sehen, wie kompliziert dies werden kann.</span><span class="sxs-lookup"><span data-stu-id="66dc6-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="66dc6-216">Stattdessen verwenden die [Taghilfsprogramme](xref:mvc/views/tag-helpers/intro) und die [HTML-Hilfsprogramme](xref:mvc/views/overview) von MVC die Validierungsattribute und Typmetadaten aus den Modelleigenschaften, um HTML 5-[Datenattribute](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in den Formularelementen zu rendern, die validiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="66dc6-217">MVC generiert die `data-`-Attribute für integrierte und benutzerdefinierte Attribute.</span><span class="sxs-lookup"><span data-stu-id="66dc6-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="66dc6-218">„jQuery Unobtrusive Validation“ analysiert dann diese `data-`-Attribute und übergibt die Logik an „jQuery Validate“, wodurch die Logik der Validierung auf Serverseite in den Client „kopiert“ wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="66dc6-219">Sie können Validierungsfehler im Client anzeigen, indem Sie die relevanten Taghilfsprogramme wie folgt verwenden:</span><span class="sxs-lookup"><span data-stu-id="66dc6-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="66dc6-220">Die obenstehenden Taghilfsprogramme rendern die nachfolgende HTML.</span><span class="sxs-lookup"><span data-stu-id="66dc6-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="66dc6-221">Beachten Sie, dass die `data-`-Attribute in der HTML-Ausgabe mit den Validierungsattributen für die `ReleaseDate`-Eigenschaft übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="66dc6-222">Das nachfolgende `data-val-required`-Attribut enthält Fehlermeldungen, um anzuzeigen, ob der Benutzer das Datumsfeld für die Veröffentlichung nicht ausfüllt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="66dc6-223">„jQuery Unobtrusive Validation“ übergibt diesen Wert an die [`required()`](https://jqueryvalidation.org/required-method/)-Methode von „jQuery Unobtrusive Validation“, die dann diese Meldung im zugehörigen **\<span>**-Element anzeigt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="66dc6-224">Die Überprüfung auf Clientseite verhindert die Übermittlung solange, bis das Formular gültig ist.</span><span class="sxs-lookup"><span data-stu-id="66dc6-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="66dc6-225">Die Schaltfläche „Übermitteln“ führt JavaScript aus, das entweder das Formular übermittelt oder Fehlermeldungen anzeigt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="66dc6-226">MVC legt die Typattributwerte anhand des .NET-Datentyps einer Eigenschaft fest, die möglicherweise durch `[DataType]`-Attribute überschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="66dc6-227">Das Basisattribut `[DataType]` führt keine richtige Validierung auf Serverseite aus.</span><span class="sxs-lookup"><span data-stu-id="66dc6-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="66dc6-228">Browser wählen ihre eigenen Fehlermeldungen aus und zeigen diese Fehler nach Belieben an. Das Paket „jQuery Validation Unobtrusive“ kann die Meldungen jedoch überschreiben und sie mit anderen zusammen anzeigen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="66dc6-229">Dies geschieht am deutlichsten, wenn Benutzer `[DataType]`-Unterklassen wie `[EmailAddress]` anwenden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="66dc6-230">Hinzufügen der Validierung zu dynamischen Formularen</span><span class="sxs-lookup"><span data-stu-id="66dc6-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="66dc6-231">Da „jQuery Unobtrusive Validation“ die Validierungslogik und -parameter an „jQuery Validate“ übergibt, wenn die Seite das erste Mal geladen wird, führen dynamisch generierte Formulare nicht automatisch eine Validierung durch.</span><span class="sxs-lookup"><span data-stu-id="66dc6-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="66dc6-232">Stattdessen müssen Sie „ jQuery Unobtrusive Validation“ auffordern, das dynamische Formular direkt nach dem Erstellen zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="66dc6-233">Beispielweise wird im nachfolgenden Beispiel dargestellt, wie Sie die Validierung auf Clientseite für ein Formular einrichten können, das über AJAX hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="66dc6-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="66dc6-234">Die `$.validator.unobtrusive.parse()`-Methode akzeptiert einen jQuery-Selektor für ihr einziges Argument.</span><span class="sxs-lookup"><span data-stu-id="66dc6-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="66dc6-235">Diese Methode fordert „jQuery Unobtrusive Validation“ auf, die `data-`-Attribute von Formularen in diesem Selektor zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="66dc6-236">Die Werte dieser Attribute werden dann an das „jQuery Validate“-Plugin übergeben, sodass das Formular die gewünschten Überprüfungsregeln auf Clientseite ausführt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="66dc6-237">Hinzufügen der Validierung zu dynamischen Steuerelementen</span><span class="sxs-lookup"><span data-stu-id="66dc6-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="66dc6-238">Sie können jetzt die Validierungsregeln für ein Formular aktualisieren, wenn individuelle Steuerelemente wie `<input/>` und `<select/>` dynamisch generiert werden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="66dc6-239">Sie können keine Selektoren für die Elemente direkt an die `parse()`-Methode übergeben, da das umgebende Formular bereits analysiert wurde und nicht mehr aktualisiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="66dc6-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="66dc6-240">Entfernen Sie stattdessen zuerst die vorhanden Validierungsdaten, und analysieren Sie dann wie nachfolgend dargestellt das ganze Formular erneut:</span><span class="sxs-lookup"><span data-stu-id="66dc6-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="66dc6-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="66dc6-241">IClientModelValidator</span></span>

<span data-ttu-id="66dc6-242">Wenn Sie clientseitige Logik für Ihr benutzerdefiniertes Attribut erstellen möchten, führt eine [unaufdringliche Überprüfung](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html), die einen Adapter für die [jQuery-Überprüfung](http://jqueryvalidation.org/documentation/) erstellt, diese automatisch als Teil der Überprüfung auf dem Client aus.</span><span class="sxs-lookup"><span data-stu-id="66dc6-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="66dc6-243">Kontrollieren Sie im ersten Schritt, welche Datenattribute hinzugefügt wurden, indem Sie die `IClientModelValidator`-Schnittstelle wie im Folgenden dargestellt implementieren:</span><span class="sxs-lookup"><span data-stu-id="66dc6-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="66dc6-244">Attribute, die diese Schnittstelle implementieren, können HTML-Attribute zu generierten Feldern hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="66dc6-245">Bei der Untersuchung der Ausgabe für das `ReleaseDate`-Element wird HTML angezeigt, die der im vorherigen Beispiel ähnlich ist. Allerdings gibt es jetzt ein `data-val-classicmovie`-Attribut, das in der `AddValidation`-Methode von `IClientModelValidator` definiert wurde.</span><span class="sxs-lookup"><span data-stu-id="66dc6-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="66dc6-246">Die unaufdringliche Validierung verwendet die Daten in den `data-`-Attributen, die die Fehlermeldungen anzeigen sollen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="66dc6-247">Allerdings kennt „jQuery“ Regeln oder Meldungen erst, wenn Sie sie zum `validator`-Objekt von „jQuery“ hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="66dc6-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="66dc6-248">Dies wird im folgenden Beispiel gezeigt, bei dem eine benutzerdefinierte `classicmovie`-Clientvalidierungsmethode zum jQuery-`validator`-Objekt hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="66dc6-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="66dc6-249">Eine Erläuterung der `unobtrusive.adapters.add`-Methode finden Sie in [Unobtrusive Client Validation in ASP.NET-MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span><span class="sxs-lookup"><span data-stu-id="66dc6-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="66dc6-250">Mit dem vorhergehenden Code führt die `classicmovie`-Methode eine clientseitige Validierung am Veröffentlichungsdatum des Films durch.</span><span class="sxs-lookup"><span data-stu-id="66dc6-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="66dc6-251">Die Fehlermeldung wird angezeigt, wenn die Methode `false` zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="66dc6-252">Remotevalidierung</span><span class="sxs-lookup"><span data-stu-id="66dc6-252">Remote validation</span></span>

<span data-ttu-id="66dc6-253">Die Remotevalidierung ist ein nützliches Feature, das Sie verwenden können, wenn Sie Daten auf dem Client mit Daten auf dem Server abgleichen müssen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="66dc6-254">Beispielsweise muss Ihre App möglicherweise überprüfen, ob eine E-Mail oder ein Benutzername bereits verwendet wird. Dafür muss sie eine große Menge an Daten abfragen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="66dc6-255">Wenn große Mengen an Daten heruntergeladen werden, um mindestens ein Feld zu überprüfen, werden zu viele Ressourcen verbraucht.</span><span class="sxs-lookup"><span data-stu-id="66dc6-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="66dc6-256">Außerdem kann es sein, dass vertrauliche Informationen verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-256">It may also expose sensitive information.</span></span> <span data-ttu-id="66dc6-257">Stattdessen können Sie auch eine Roundtripanforderung senden, um ein Feld zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="66dc6-258">Sie können die Remotevalidierung in zwei Schritten implementieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="66dc6-259">Im ersten Schritt müssen Sie den Änderungsverlauf Ihres Modells mit dem `[Remote]`-Attribut einblenden.</span><span class="sxs-lookup"><span data-stu-id="66dc6-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="66dc6-260">Das `[Remote]`-Attribut akzeptiert mehrere Überladungen, die Sie verwenden können, um clientseitiges JavaScript an den Code weiterzuleiten, der aufgerufen werden soll.</span><span class="sxs-lookup"><span data-stu-id="66dc6-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="66dc6-261">Das nachfolgende Beispiel zeigt auf die `VerifyEmail`-Aktionsmethode des `Users`-Controllers.</span><span class="sxs-lookup"><span data-stu-id="66dc6-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="66dc6-262">Im zweiten Schritt müssen Sie den Validierungscode in die zugehörige Aktionsmethode übergeben, die im `[Remote]`-Attribut definiert ist.</span><span class="sxs-lookup"><span data-stu-id="66dc6-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="66dc6-263">Gemäß der jQuery Validate-[remote](https://jqueryvalidation.org/remote-method/)-Methodendokumentation muss die Serverantwort eine JSON-Zeichenfolge sein, die entweder:</span><span class="sxs-lookup"><span data-stu-id="66dc6-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="66dc6-264">`"true"` ist für gültige Elemente.</span><span class="sxs-lookup"><span data-stu-id="66dc6-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="66dc6-265">`"false"`, `undefined` oder `null` ist für ungültige Elemente. Es wird die Standardfehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="66dc6-266">Wenn die Serverantwort eine Zeichenfolge ist (z.B. `"That name is already taken, try peter123 instead"`), wird die Zeichenfolge als benutzerdefinierte Fehlermeldung anstelle der Standardzeichenfolge angezeigt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="66dc6-267">Die Definition der `VerifyEmail`-Methode hält sich wie nachfolgend dargestellt an diese Regeln.</span><span class="sxs-lookup"><span data-stu-id="66dc6-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="66dc6-268">Sie gibt eine Fehlermeldung für die Validierung zurück, wenn die E-Mail-Adresse bereits vergeben ist, oder `true`, wenn die E-Mail-Adresse frei ist, und umschließt das Ergebnis in einem `JsonResult`-Objekt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="66dc6-269">Die Clientseite kann dann den Rückgabewert verwenden, um fortzufahren oder den Fehler ggf. anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="66dc6-270">Wenn Benutzer jetzt eine E-Mail-Adresse eingeben, führt JavaScript in der Ansicht einen Remoteaufruf durch, um zu überprüfen, ob die E-Mail-Adresse bereits vergeben ist, und zeigt einen Fehler an, falls dies der Fall ist.</span><span class="sxs-lookup"><span data-stu-id="66dc6-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="66dc6-271">Andernfalls kann der Benutzer das Formular wie gewöhnlich übermitteln.</span><span class="sxs-lookup"><span data-stu-id="66dc6-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="66dc6-272">Die `AdditionalFields`-Eigenschaft des `[Remote]`-Attributs ist nützlich für die Validierung von Kombinationen von Feldern im Vergleich zu Daten auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="66dc6-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="66dc6-273">Wenn z.B. das oben genannte `User`-Modell über zwei zusätzliche Eigenschaften verfügt, die `FirstName` und `LastName` aufrufen, sollten Sie überprüfen, dass kein bereits vorhandener Benutzer diese Namenskombination verwendet.</span><span class="sxs-lookup"><span data-stu-id="66dc6-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="66dc6-274">Sie können die neuen Eigenschaften wie im folgenden Codebeispiel dargestellt definieren:</span><span class="sxs-lookup"><span data-stu-id="66dc6-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="66dc6-275">`AdditionalFields` kann explizit auf die Zeichenfolgen `"FirstName"` und `"LastName"` festgelegt werden. Wenn Sie aber so den [`nameof`](/dotnet/csharp/language-reference/keywords/nameof)-Operator verwenden, ist ein Refactoring zu einem späteren Zeitpunkt einfacher.</span><span class="sxs-lookup"><span data-stu-id="66dc6-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="66dc6-276">Die Aktionsmethode muss dann zwei Argumente akzeptieren, um die Validierung auszuführen: eins für den Wert von `FirstName` und eins für den Wert von `LastName`.</span><span class="sxs-lookup"><span data-stu-id="66dc6-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="66dc6-277">Wenn Benutzer jetzt einen Vor- und einen Nachnamen eingeben, führt JavaScript folgende Vorgänge aus:</span><span class="sxs-lookup"><span data-stu-id="66dc6-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="66dc6-278">Es führt einen Remoteaufruf durch, um zu überprüfen, ob diese Namenskombination bereits verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="66dc6-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="66dc6-279">Wenn dem so ist, wird eine Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="66dc6-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="66dc6-280">Andernfalls kann der Benutzer das Formular übermitteln.</span><span class="sxs-lookup"><span data-stu-id="66dc6-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="66dc6-281">Wenn Sie mindestens zwei weitere Felder mit dem `[Remote]`-Attribut überprüfen müssen, geben Sie sie als eine mit Kommas getrennte Liste an.</span><span class="sxs-lookup"><span data-stu-id="66dc6-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="66dc6-282">Wenn Sie z.B. dem Modell eine `MiddleName`-Eigenschaft hinzufügen möchten, legen Sie das `[Remote]`-Attribut wie im folgenden Code veranschaulicht fest:</span><span class="sxs-lookup"><span data-stu-id="66dc6-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="66dc6-283">`AdditionalFields` muss wie alle anderen Attributargumente ein konstanter Ausdruck sein.</span><span class="sxs-lookup"><span data-stu-id="66dc6-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="66dc6-284">Aus diesem Grund müssen Sie keine [interpolierte Zeichenfolge verwenden](/dotnet/csharp/language-reference/keywords/interpolated-strings) oder <xref:System.String.Join*> aufrufen, um `AdditionalFields` zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="66dc6-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="66dc6-285">Für jedes weitere Feld, das Sie dem `[Remote]`-Attribut hinzufügen, müssen Sie der zugehörigen Aktionsmethode des Controllers ein weiteres Argument hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="66dc6-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
